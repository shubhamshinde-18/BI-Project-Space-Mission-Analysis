"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('cartesianVisuals.min.js');var es6,powerbi,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,s,n,l){return new(n=n||Promise)(function(i,t){function a(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(a,r)}o((l=l.apply(e,s||[])).next())})},__generator=this&&this.__generator||function(i,a){var r,o,s,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(s=0<(s=n.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){n.label=t[1];break}if(6===t[0]&&n.label<s[1]){n.label=s[1],s=t;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(t);break}s[2]&&n.ops.pop(),n.trys.pop();continue}t=a.call(i,n)}catch(e){t=[6,e],o=0}finally{r=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__spreadArray=this&&this.__spreadArray||function(e,t){for(var i=0,a=t.length,r=e.length;i<a;i++,r++)e[r]=t[i];return e},__extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();!function(e){var l;((l=e.visuals||(e.visuals={})).CartesianViewModelAdapterUtils||(l.CartesianViewModelAdapterUtils={})).updatePlotResponsiveWarnings=function(e,t){var i,a=e.warningObjectCollection,r={},o=e.legendData,s=t.legendData;for(i in e.showIcon?(r.legend=new l.LegendNotRenderedWarning,r.categoryAxis=new l.AxisAndAxisLabelsNotRenderedWarning,r.valueAxis=new l.AxisAndAxisLabelsNotRenderedWarning):(o.show!==s.show?r.legend=new l.LegendNotRenderedWarning:o.position!==s.position?r.legend=new l.LegendLocationWarning:_.isEqual(o.fontProperties.size,s.fontProperties.size)||(r.legend=new l.LegendFontSizeWarning),o=e.axesData,s=t.axesData,o.categoryAxis.show!==s.categoryAxis.show?r.categoryAxis=new l.AxisAndAxisLabelsNotRenderedWarning:o.categoryAxis.showAxisTitle!==s.categoryAxis.showAxisTitle?r.categoryAxis=new l.AxisLabelsNotRenderedWarning:_.isEqual(o.categoryAxis.labelFontProperties.size,s.categoryAxis.labelFontProperties.size)&&_.isEqual(o.categoryAxis.titleFontProperties.size,s.categoryAxis.titleFontProperties.size)||(r.categoryAxis=new l.AxisFontSizeWarning),o.valueAxis.show!==s.valueAxis.show?r.valueAxis=new l.AxisAndAxisLabelsNotRenderedWarning:o.valueAxis.showAxisTitle!==s.valueAxis.showAxisTitle?r.valueAxis=new l.AxisLabelsNotRenderedWarning:_.isEqual(o.valueAxis.labelFontProperties.size,s.valueAxis.labelFontProperties.size)&&_.isEqual(o.valueAxis.titleFontProperties.size,s.valueAxis.titleFontProperties.size)||(r.valueAxis=new l.AxisFontSizeWarning),e=e.zoomData,t=t.zoomData,e.showOnCategoryAxis===t.showOnCategoryAxis&&e.showOnValueAxis===t.showOnValueAxis&&e.showOnValueSecAxis===t.showOnValueSecAxis||(r.zoom=new l.ZoomSlidersNotRenderedWarning)),r){var n=r[i];a.addForVisualObject(i,{selector:null,warnings:[n]})}}}(powerbi=powerbi||{}),function(e){var r,o;r=e.visuals||(e.visuals={}),o=r.Units.FontSize,r.cartesianLegacyResponsiveViewportsBreakpoints={legendWidth:76,legendHeight:58,axesTitleWidth:128,axesTitleHeight:58,axesHeight:58,axesMedWidth:128,axesWidth:76,maxWidthForMediumFont:180,maxWidthForSmallFont:128},(r.CartesianLegacyResponsiveApplier||(r.CartesianLegacyResponsiveApplier={})).applyLegacyResponsiveChanges=function(e,t){!function(e,t){var i=t.axesData;e.height<=r.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleHeight&&(i.x.showAxisTitle=!1,i.y.showAxisTitle=!1,i.y2.showAxisTitle=!1);e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleWidth&&(i.y.showAxisTitle=!1,i.y2.showAxisTitle=!1);e.height<=r.cartesianLegacyResponsiveViewportsBreakpoints.axesHeight&&(i.x.show=!1);e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.axesWidth&&(i.y.show=!1,i.y2.show=!1);e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.axesMedWidth&&r.Legend.isLeftOrRight(t.legendData.position)&&(i.y.show=!1,i.y2.show=!1);e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(t={x:{tickLabels:r.CartesianChart.xAxisSmallFontSizeInPx,title:r.CartesianChart.xAxisSmallFontSizeInPx},y:{tickLabels:r.CartesianChart.yAxisMediumFontSizeInPx,title:r.CartesianChart.yAxisMediumFontSizeInPx},y2:{tickLabels:r.CartesianChart.yAxisMediumFontSizeInPx,title:r.CartesianChart.yAxisMediumFontSizeInPx}},e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont&&(t.y.tickLabels=r.CartesianChart.yAxisSmallFontSizeInPx,t.y.title=r.CartesianChart.yAxisSmallFontSizeInPx,t.y2.tickLabels=r.CartesianChart.yAxisSmallFontSizeInPx,t.y2.title=r.CartesianChart.yAxisSmallFontSizeInPx),i.x.titleFontProperties=r.FontProperties.inherit(i.x.titleFontProperties,{size:o.createFromPx(t.x.title)}),i.y.titleFontProperties=r.FontProperties.inherit(i.y.titleFontProperties,{size:o.createFromPx(t.y.title)}),i.y2.titleFontProperties=r.FontProperties.inherit(i.y2.titleFontProperties,{size:o.createFromPx(t.y2.title)}),i.x.labelFontProperties=r.FontProperties.inherit(i.x.labelFontProperties,{size:o.createFromPx(t.x.tickLabels)}),i.y.labelFontProperties=r.FontProperties.inherit(i.y.labelFontProperties,{size:o.createFromPx(t.y.tickLabels)}),i.y2.labelFontProperties=r.FontProperties.inherit(i.y2.labelFontProperties,{size:o.createFromPx(t.y2.tickLabels)}))}(e,t),function(e,t){var i=t.legendData.position,a=e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.legendWidth&&r.Legend.isLeftOrRight(i),i=e.height<=r.cartesianLegacyResponsiveViewportsBreakpoints.legendHeight&&r.Legend.isTopOrBottom(i);(a||i)&&(t.legendData.show=!1);e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(a=t.legendData.fontProperties.size.pt,i=void 0,i=e.width<=r.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont?Math.min(a,r.Legend.LegendSmallFontSmallViewportInPt):Math.min(a,r.Legend.LegendMediumFontSmallViewportInPt),t.legendData.fontProperties=r.FontProperties.inherit(t.legendData.fontProperties,{size:o.createFromPt(i)}))}(e,t)}}(powerbi=powerbi||{}),function(e){!function(s){s.cartesianResponsiveBreakpoints={legendPositionWidth:210,legendPositionHeight:100,legendHeight:70,legendWidth:80,xAxesHeight:100,yAxesTitleWidth:210,yAxesWidth:100,xAxesTitleHeight:145,yAxesZoomWidth:280,xAxesZoomHeight:150,iconWidth:50,iconHeight:50};var e=(n.prototype.getData=function(){var e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps),t=e.responsive,i=e.responsiveLegacy,e=this.cartesianData;return e=t||i?this.applyResponsiveChanges(this.viewport,this.cartesianData,t,i):e},n.prototype.enumerateObjectInstances=function(e,t,i){"general"===e.objectName&&this.enumerateGeneral(t,this.dataView,i)},n.prototype.getResponsiveSlice=function(e,t,i){if(t){t=s.cartesianChartProps.general,e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(e,s.cartesianChartProps);return{item:new s.builder.SimpleFormattingSliceBuilder({uidBuilder:new s.builder.FormattingSliceUidBuilder(new s.builder.FormattingGroupUidBuilder(new s.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new s.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:i}).build(),revertToDefaultDescriptors:[t.responsive]}}},n.prototype.enumerateGeneral=function(e,t,i){var a={selector:null,properties:{},objectName:"general"};i&&(t=s.ViewModelAdapterUtils.getResponsiveVisualProperties(t,s.cartesianChartProps),a.properties.responsive=t.responsive),e.pushInstance(a)},n.prototype.applyResponsiveChanges=function(e,t,i,a){var r=s.ViewModelAdapterUtils.cloneData(t),o=r.legendData.position;return i?(this.applyIconResponsiveChanges(e,r),this.applyLegendResponsiveChanges(e,o,r),this.applyAxesResponsiveChanges(e,r),this.applyZoomSliderResponsiveChanges(e,r),this.applyFontSizesChanges(e,r),n.applyScrollbarChanges(e,r)):a&&s.CartesianLegacyResponsiveApplier.applyLegacyResponsiveChanges(e,r),s.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(r,t),r},n.prototype.applyIconResponsiveChanges=function(e,t){t.showIcon=e.height<=s.cartesianResponsiveBreakpoints.iconHeight||e.width<=s.cartesianResponsiveBreakpoints.iconWidth},n.prototype.applyLegendResponsiveChanges=function(e,t,i){(e.width<s.cartesianResponsiveBreakpoints.legendPositionWidth||e.height<s.cartesianResponsiveBreakpoints.legendPositionHeight)&&s.Legend.isLeftOrRight(t)&&(i.legendData.position=s.LegendPosition.Top),(e.height<s.cartesianResponsiveBreakpoints.legendHeight||e.width<s.cartesianResponsiveBreakpoints.legendWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0},n.applyScrollbarChanges=function(e,t){t.scrollbarOptions=n.ScrollbarOptions},n.prototype.applyAxesResponsiveChanges=function(e,t){e.height<s.cartesianResponsiveBreakpoints.xAxesHeight&&(t.axesData.x.show=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesTitleWidth&&(t.axesData.y.showAxisTitle=!1,t.axesData.y2.showAxisTitle=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesWidth&&(t.axesData.y.show=!1,t.axesData.y2.show=!1),e.height<s.cartesianResponsiveBreakpoints.xAxesTitleHeight&&(t.axesData.x.showAxisTitle=!1)},n.prototype.applyZoomSliderResponsiveChanges=function(e,t){(e.height<s.cartesianResponsiveBreakpoints.xAxesZoomHeight||e.width<s.cartesianResponsiveBreakpoints.yAxesZoomWidth)&&(t.zoomData.showOnCategoryAxis=!1,t.zoomData.showOnValueAxis=!1,t.zoomData.showOnValueSecAxis=!1)},n.prototype.applyFontSizesChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},n.ScrollbarOptions={scrollbarWidth:8,scrollbarRadius:4,scrollbarClass:"responsive"},n);function n(e){this.viewport=e.viewport,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.responsiveFontHelper=new s.ResponsiveCartesianFontHelper}s.CartesianViewModelAdapter=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(r){!function(g){var y=r.data.DataViewConcatenateCategoricalColumns,e=(t.prototype.create=function(e){return new i(this.staticUpdateOptions,e)},t);function t(e){this.staticUpdateOptions=e}g.CartesianSmallMultipleUpdateFactory=e;var i=(a.prototype.apply=function(e,t){var i=this.staticUpdateOptions,a=i.layerInitDataOptions,r=i.updateGlobalAxesDomains,o=this.updateOptions,s=o.isSmallMultiples,n=o.reader,l=o.dataViews,i=o.updateOptions,o=o.requestedPerMultipleAxisDomains;if(s)for(var c=g.ComboChart.isComboChart(t)?n.convertComboFrame(e.index):[n.convertFrame(e.index)],u=void 0,d=0;d<c.length;d++){var h=c[d],p=y.concatenateCategoryColumnsForVisual(h.metadata,g.StandardObjectPropertyIdentifiers.formatString,g.cartesianRoleNames.category,h.categorical,!!u);u?p.categorical.categories=u:u=null===(h=p.categorical)||void 0===h?void 0:h.categories,c[d]=p}else c=l;e.hasInitializedData()||e.initData(a);s=__assign(__assign({},i),{dataViews:c,multipleInfo:s?this.buildMultipleInfo(e.index):void 0});e.update(s),o&&(o.categoryAxis||o.valueAxis||o.secondaryValueAxis)&&r(e.getAxesDomains(!0,o))},a.prototype.applySynchronizedAxes=function(e,t){this.updateOptions.isSmallMultiples;e.applySynchronizedDomains(t)},a.prototype.applyResize=function(e){e.resize(this.updateOptions.updateOptions.viewport)},a.prototype.buildMultipleInfo=function(e){this.updateOptions.isSmallMultiples,this.updateOptions.reader;var t=this.updateOptions.reader;if(t){var i=t.getFrameNode(e),t=t.getFrameSourceColumns().map(function(e,t){return{metadata:e,value:i.levelValues[t].value}});return{identity:i.identity,sources:t,isCoreMultiple:0===e}}},a);function a(e,t){this.staticUpdateOptions=e,this.updateOptions=t}g.CartesianSmallMultipleUpdate=i;n.create=function(e,t,i,a,r,o,s){return new n(e,t,i,r,o,a,s)},n.prototype.getDataPoint=function(){var t,e,i;return this.dataPoint||(t=this.multipleInfo,e=_.first(t.sources).metadata.queryName,i=t.sources.map(function(e){return g.buildValueDetailsForColumnValue(e.metadata,e.value,t.identity)}),i=(new g.SelectionIdBuilder).withColumnIdentity(t.identity,e,i).createSelectionId(),this.dataPoint={selected:!1,identity:i},this.interactivityService&&this.interactivityService.applySelectionStateToData([this.dataPoint])),this.dataPoint},n.prototype.getIndex=function(){return this.index},n.prototype.isSelected=function(){return this.getDataPoint().selected},n.prototype.getState=function(){return this.state},n.prototype.initRenderer=function(e){this.getState(),this.renderer=e;var t=this.getLayerInitOptions(e);this.layers.forEach(function(e){return e.initRenderer(t)}),this.state|=2},n.prototype.getRenderer=function(){return this.getState(),this.renderer},n.prototype.initData=function(i){this.getState(),this.layers.forEach(function(e){var t;return null===(t=e.initData)||void 0===t?void 0:t.call(e,i)}),this.style=i.style,this.state|=1},n.prototype.update=function(e){this.getState(),this.dataViews=e.dataViews,this.multipleInfo=e.multipleInfo,this.dataPoint=void 0,this.adapterFactory=e.adapterFactory;var t=this.layers;return this.responsiveData=void 0,this.data=g.CartesianChart.converter({layerStyle:this.style,chartType:this.type,dataViews:e.dataViews,categoryAxisTitleOnByDefault:e.categoryAxisTitleOnByDefault,valueAxisTitleOnByDefault:e.valueAxisTitleOnByDefault,layers:t,featureSwitches:this.featureSwitches,hasDataChanged:null!=e.operationKind,multipleInfo:e.multipleInfo}),this.data},n.prototype.isVisible=function(){return!!(2&this.state)},n.prototype.hasInitializedData=function(){return!!(1&this.state)},n.prototype.getMultipleInfo=function(){return this.multipleInfo},n.prototype.applySynchronizedDomains=function(e){var t,i,a,r,o,s=this.data&&this.data.axesData;e&&s&&(t=s.categoryAxis,i=s.valueAxis,a=s.secondaryValueAxis,r=e.categoryAxis,o=e.valueAxis,s=e.secondaryValueAxis,(e=function(e,t){e&&(t.includeDomains=t.includeDomains||[]).push(g.AxisHelper.createScalarDomainOptions(e,1))})(r,t),e(o,i),e(s,a))},n.prototype.resize=function(e){this.adapterFactory&&this.data&&(!1==!!this.smallMultiples||this.featureSwitches.smallMultiplesResponsive||!this.smallMultiples.isSmallMultiples()?(e=this.adapterFactory.createCartesianAdapter({cartesianData:this.data,dataView:this.dataViews[0],viewport:e,isCoreMultiple:!this.multipleInfo||this.multipleInfo.isCoreMultiple}),this.responsiveData=e.getData()):this.responsiveData=this.data)},n.prototype.getCapabilities=function(){var r={domainAggregateRoles:[],supportedDomainAggregates:void 0},o={domainAggregateRoles:[],supportedDomainAggregates:void 0},s={domainAggregateRoles:[],supportedDomainAggregates:void 0};return this.layers.forEach(function(e){var t=e.getCartesianVisualCapabilities();t.axesCapabilities;var i=t.axesCapabilities,a=i.categoryAxis,e=i.valueAxis,t=i.secondaryValueAxis,i=function(e,t){e&&e.domainAggregateRole&&(t.domainAggregateRoles.push(e.domainAggregateRole),void 0===t.supportedDomainAggregates?t.supportedDomainAggregates=e.supportedDomainAggregates:t.supportedDomainAggregates&=e.supportedDomainAggregates)};i(a,r),i(e,o),i(t,s)}),{axesCapabilities:{categoryAxis:_.isEmpty(r.domainAggregateRoles)?void 0:__assign(__assign({},r),{domainAggregateRoles:_.uniq(r.domainAggregateRoles)}),valueAxis:_.isEmpty(o.domainAggregateRoles)?void 0:__assign(__assign({},o),{domainAggregateRoles:_.uniq(o.domainAggregateRoles)}),secondaryValueAxis:_.isEmpty(s.domainAggregateRoles)?void 0:__assign(__assign({},s),{domainAggregateRoles:_.uniq(s.domainAggregateRoles)})}}},n.prototype.getAxesDomains=function(e,t){for(var i={},a=0;a<this.layers.length;a++){var r=this.layers[a];r.getAxesDomains&&((r=r.getAxesDomains(e,t)).categoryAxis&&(i.categoryAxis=g.AxisHelper.mergeDomains(i.categoryAxis||g.DefaultDomain,r.categoryAxis)),r.valueAxis&&(0<a&&g.ComboChart.isComboChart(this.type)?i.secondaryValueAxis=g.AxisHelper.mergeDomains(i.secondaryValueAxis||g.DefaultDomain,r.valueAxis):i.valueAxis=g.AxisHelper.mergeDomains(i.valueAxis||g.DefaultDomain,r.valueAxis)),r.secondaryValueAxis&&(i.secondaryValueAxis=g.AxisHelper.mergeDomains(i.secondaryValueAxis||g.DefaultDomain,r.secondaryValueAxis)))}return i},n.prototype.getData=function(){return this.responsiveData||this.data},n.prototype.clearSelection=function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].onClearSelection()},n.prototype.updateLayers=function(){this.layers.forEach(function(e){return e.render(!0)})},n.prototype.destroy=function(){this.renderer&&(this.getState(),this.renderer.destroy())},e=n;function n(e,t,i,a,r,o,s){this.smallMultiples=e,this.index=t,this.featureSwitches=i,this.layers=a,this.type=r,this.interactivityService=o,this.getLayerInitOptions=s,this.state=0}g.CartesianSmallMultiple=e}(r.visuals||(r.visuals={}))}(powerbi=powerbi||{}),function(c){var d;function e(e,t,i,a){this.type=e,this.featureSwitches=t,this.layerFactory=i,this.getLayerInitRendererOptions=a,this.multiples=[]}d=c.visuals||(c.visuals={}),e.prototype.init=function(e,t){var i=this;this.rowLoadMoreDataHandler=new d.SimpleLoadMoreDataHandler(e.host),this.updateFactory=new d.CartesianSmallMultipleUpdateFactory({layerInitDataOptions:e,updateGlobalAxesDomains:function(e){return i.updateGlobalAxesDomains(e)}}),this.interactivityService=t,this.multiples=[]},e.prototype.getObjects=function(){return this.reader?this.reader.getObjects():void 0},e.prototype.getCoreMultiple=function(){return this.coreMultiple||(this.coreMultiple=d.CartesianSmallMultiple.create(this,0,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions)),this.coreMultiple},e.prototype.getShouldResetRowMultipleScrollPosition=function(){return this.shouldResetRowMultipleScrollPosition},e.prototype.get=function(e){if(this.isSmallMultiples(),!this.isSmallMultiples())return this.getCoreMultiple();if(this.multipleUpdate,!(i=this.multiples[e]))for(var t=this.multiples.length;t<=e;t++){this.multiples.length;var i=this.multiples[t]=d.CartesianSmallMultiple.create(this,t,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions),a=this.multipleUpdate;a.apply(i,this.type),this.isSmallMultiples()&&a.applySynchronizedAxes(i,this.axesDomains),a.applyResize(i)}return i},e.prototype.clear=function(){this.getMultiples(!0).forEach(function(e){return e.destroy()}),this.multiples=[],this.coreMultiple=void 0,this.axesDomains=void 0,this.shouldResetRowMultipleScrollPosition=void 0,this.multipleUpdate=void 0},e.prototype.resize=function(t){this.getMultiples(!0).forEach(function(e){return e.resize(t)})},e.prototype.update=function(e){var t,i=e.dataViews;this.updateOptions=e;var a=this.isSmallMultiples(i);this.shouldResetRowMultipleScrollPosition=!e.preserveScrollPosition;var r=this.getCoreMultiple();a?(this.reader=d.DataViewMultipleReader.create(i[0],d.StandardObjectPropertyIdentifiers.formatString),this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:a,reader:this.reader,requestedPerMultipleAxisDomains:void 0,updateOptions:e}).apply(r,this.type),e.preserveScrollPosition||(this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,this.requestPerMultipleAxisDomains=this.updateSynchronizedDomainsFromAggregates()),t=this.reader.getFrameCount(),this.rowLoadMoreDataHandler.updateDataView(e.dataViews[0])):(this.reader=void 0,this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,t=1,this.rowLoadMoreDataHandler.updateDataView(void 0)),this.rowLoadMoreDataHandler.onLoadMoreDataCompleted(),this.multipleUpdate=this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:a,reader:this.reader,requestedPerMultipleAxisDomains:this.requestPerMultipleAxisDomains,updateOptions:e}),this.updateMultiples(t)},e.prototype.updateMultiples=function(e){for(var t=this,i=this.multiples,a=this.multipleUpdate,r=this.updateOptions.dataViews,o=this.isSmallMultiples(r),s=this.getCoreMultiple(),n=this.requestPerMultipleAxisDomains,l={startIndex:this.lastUpdatedFrameIndex,endIndex:e},c=l.startIndex;c<l.endIndex;c++){var u=o?i[c]:s;!u&&n&&(i.length,u=i[c]=d.CartesianSmallMultiple.create(this,c,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions)),u&&a.apply(u,this.type)}this.getMultiples(!0).forEach(function(e){e&&(o&&a.applySynchronizedAxes(e,t.axesDomains),a.applyResize(e))}),this.lastUpdatedFrameIndex=l.endIndex},e.prototype.updateSynchronizedDomainsFromAggregates=function(){var e=this.getCoreMultiple().getCapabilities().axesCapabilities,t=e.categoryAxis,i=e.valueAxis,a=e.secondaryValueAxis,r={categoryAxis:!!(2&t.supportedDomainAggregates),valueAxis:!!(2&i.supportedDomainAggregates),secondaryValueAxis:!!(a&&2&a.supportedDomainAggregates)},a={categoryAxis:!!(1&t.supportedDomainAggregates),valueAxis:!!(1&i.supportedDomainAggregates),secondaryValueAxis:!!(a&&1&a.supportedDomainAggregates)};!(r.categoryAxis||r.valueAxis||r.secondaryValueAxis)||(e=this.getTopLevelDomains(e))&&(o={categoryAxis:r.categoryAxis?e.categoryAxis:void 0,valueAxis:r.valueAxis?e.valueAxis:void 0,secondaryValueAxis:r.secondaryValueAxis?e.secondaryValueAxis:void 0}),this.axesDomains=o;var o={categoryAxis:a.categoryAxis&&(!o||_.isEmpty(o.categoryAxis)),valueAxis:a.valueAxis&&(!o||_.isEmpty(o.valueAxis)),secondaryValueAxis:a.secondaryValueAxis&&(!o||_.isEmpty(o.secondaryValueAxis))};return _.every(o,function(e){return!e})?void 0:o},e.prototype.isSmallMultiples=function(e){return!(!e&&!this.updateOptions)&&(e=e||this.updateOptions.dataViews,d.CartesianChart.isSmallMultiples(e,this.featureSwitches.cartesianMultiples))},e.prototype.clearSelection=function(e){this.getMultiples(!0).forEach(function(e){return e.clearSelection()}),this.executeActionForMultiplesInRange(function(e){return e.updateLayers()},e,!1)},e.prototype.checkIfNoLabelsCanBeRendered=function(){return _.every(this.getMultiples(),function(e){return e.isVisible()&&e.getRenderer().noLabelsCanBeRendered})},e.prototype.scrollTo=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollTo(t)},e,!1)},e.prototype.shouldScrollTo=function(t,e){return!!this.getValueForFirstMultipleInRange(function(e){return e.getRenderer().axesRenderer.shouldScrollTo(t)},e,!1)},e.prototype.scrollBy=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollBy(t)},e,!1)},e.prototype.scrollDelta=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollDelta(t)},e,!1)},e.prototype.clearRenderingTimeout=function(){this.getMultiples().forEach(function(e){return e.isVisible()&&e.getRenderer().axesRenderer.clearRenderingTimeout()})},e.prototype.updateScrollbarExtent=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.setExtent(t)},e,!1)},e.prototype.executeActionForMultiplesInRange=function(t,e,i){e=this.getMultiples(i,e);_.isEmpty(e)||e.forEach(function(e){return t(e)})},e.prototype.getValueForFirstMultipleInRange=function(e,t,i){t=this.getMultiples(i,t);if(!_.isEmpty(t))return e(t[0])},e.prototype.getFrameCount=function(){return this.isSmallMultiples()?this.reader.getFrameCount():1},e.prototype.updateGlobalAxesDomains=function(e){var t=this.axesDomains=this.axesDomains||{};e.categoryAxis&&(t.categoryAxis=d.AxisHelper.mergeDomains(t.categoryAxis||d.DefaultDomain,e.categoryAxis)),e.valueAxis&&(t.valueAxis=d.AxisHelper.mergeDomains(t.valueAxis||d.DefaultDomain,e.valueAxis)),e.secondaryValueAxis&&(t.secondaryValueAxis=d.AxisHelper.mergeDomains(t.secondaryValueAxis||d.DefaultDomain,e.secondaryValueAxis))},e.prototype.getTopLevelDomains=function(e){var t,i,a,n=this,r=this.reader,o=e.categoryAxis,s=e.valueAxis,l=e.secondaryValueAxis,e=function(e){var t,i=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t in e)for(var a=0,r=e[t];a<r.length;a++){var o=r[a],s=o.min,o=o.max;(_.isDate(s)||_.isNumber(s)&&isFinite(s))&&(_.isDate(o)||_.isNumber(o)&&isFinite(o))&&(n.featureSwitches.utcDates&&c.isDateWithEpochValue(s)&&c.isDateWithEpochValue(o)&&(s=s.epochTimeStamp,o=o.epochTimeStamp),i=d.AxisHelper.mergeDomains(i,[+s,+o]))}return i};return 2&o.supportedDomainAggregates&&(t=(t=r.getTopLevelAggregates(o.domainAggregateRoles))?e(t):void 0),2&s.supportedDomainAggregates&&(i=(i=r.getTopLevelAggregates(s.domainAggregateRoles))?e(i):void 0),l&&2&l.supportedDomainAggregates&&(a=(a=l&&r.getTopLevelAggregates(l.domainAggregateRoles))?e(a):void 0),t||i||a?{categoryAxis:t,valueAxis:i,secondaryValueAxis:a}:void 0},e.prototype.getMultiples=function(e,t){void 0===e&&(e=!1);var i=[],a=this.isSmallMultiples();return a&&!e||(e=this.getCoreMultiple())&&i.push(e),a&&(a=this.multiples,t&&(a=a.slice(t.startIndex,Math.min(t.endIndex,a.length))),i.push.apply(i,a)),i},d.CartesianSmallMultiples=e}(powerbi=powerbi||{}),function(B){!function(w){var o=w.AxisDataModel.AxesData,g=jsCommon.CssConstants,s=B.visuals.DataLabelUtil,y=B.visuals.DataViewConcatenateUtil,u=B.data.DataViewRoleWildcard,e=B.visuals.LoadMoreDataStatus,l=B.data.Selector;w.INTERACTIVITY_RIGHT_MARGIN=6,w.DefaultDomain=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],w.MultiplesLayoutMinColumns=1,w.MultiplesLayoutMaxColumns=6,w.MultiplesLayoutMinRows=1,w.MultiplesLayoutMaxRows=6,w.MultiplesLayoutMinGridlinesWidth=1,w.MultiplesLayoutMaxGridlinesWidth=12,w.MultiplesSubheaderDefaults=function(){return{FontFamily:w.Font.Family.regular.css,FontPointSize:8,ColorName:"foregroundNeutralSecondary",TextClassName:"title",Vertical:0,Horizontal:0,Show:!0,TitleWrap:!1,bold:!1,italic:!1,underline:!1}};var t=(f.shouldYAxisBeCategorical=function(e){switch(e){case 6:case 5:case 7:return!0}return!1},f.isSmallMultiples=function(e,t){if(!t)return!1;if(_.size(e)<1)return!1;t=null===(t=null===(t=null===(t=null===(t=null===(t=e[0])||void 0===t?void 0:t.matrix)||void 0===t?void 0:t.rows)||void 0===t?void 0:t.levels)||void 0===t?void 0:t[0])||void 0===t?void 0:t.sources;return!(_.size(t)<1)&&(!_.isEmpty(e[0].matrix.rows.root.children)&&_.every(t,function(e){return B.data.DataRoleHelper.hasRole(e,w.cartesianRoleNames.rows)}))},f.prototype.init=function(e){(this.visualInitOptions=e).featureSwitches&&!this.featureSwitches&&(this.featureSwitches=e.featureSwitches);var t=e.element;this.currentViewport=e.viewport,this.hostServices=e.host,this.eventManager=new jsCommon.BubblingEventManager(d3.select(t.get(0))),this.categoryLoadMoreDataHandler=new N(null,this.hostServices,f.LoadMoreThreshold),this.behaviorFactory&&!this.featureSwitches.onObjectFormatting&&(this.interactivityService=w.createInteractivityService(this.hostServices)),this.tooltipService=w.createTooltipService(e.host);var i=this.visualInitOptions.style,a=B.Prototype.inherit(i);a.colorPalette=B.Prototype.inherit(i.colorPalette),a.colorPalette.dataColors=new k(i.colorPalette.dataColors),this.layerStyle=a;var r=o.createDefault(i);this.axisZoom=new w.AxisZoom(t,this.hostServices,this.axes.isScrollable&&!!e.interactivity,this.featureSwitches),this.axes.init({axesData:r,axisZoom:this.axisZoom,isYAxisCategorical:f.shouldYAxisBeCategorical(this.type),interactivityService:this.interactivityService}),this.legend=w.createLegend(t,e.interactivity&&e.interactivity.isInteractiveLegend,13!==this.type?this.interactivityService:void 0,this.axes.isScrollable,void 0,i,this.hostServices);i=B.Prototype.inherit(e);i.style=a,i.chartType=this.type,i.services={tooltips:this.tooltipService},this.multiples.init(i,this.interactivityService),this.layoutBuilder.init(e,this.tooltipService,this.legend,r,this.interactivityService,this.layerStyle,this.multiples.rowLoadMoreDataHandler,this.eventManager),this.layout=this.layoutBuilder.create(this.visualInitOptions.element),this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.featureSwitches.onObject&&(e=null!==(e=null==(e=null===(e=this.hostServices)||void 0===e?void 0:e.getSubSelectionService())?void 0:e.getRenderer())&&void 0!==e?e:w.SubSelectionRegionOutlineRenderer.createWithDefaultHost(),this.subSelectionHelper=w.HtmlSubSelectionHelper.createHtmlSubselectionHelper({hostElement:t.get(0),hostServices:this.hostServices,renderer:e,selectorCallback:this.getSelectorsByColumnSubSelectionCallback}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper))},f.prototype.isPlayAxis=function(){if(!this.dataViews||!this.dataViews[0])return!1;var e=this.dataViews[0];return 10===this.type&&(this.hasAnimator||this.isMobileChart)&&B.data.DataRoleHelper.hasRoleInDataView(e,"Play")},f.prototype.hasBreakdownRole=function(){if(!this.dataViews||!this.dataViews[0])return!1;var e=this.dataViews[0];return 13===this.type&&B.data.DataRoleHelper.hasRoleInDataView(e,"Breakdown")},f.getDataBoundReferenceLines=function(e,t,i,a){var r=[],o=[];if(e)if(e.matrix&&e.matrix.valueSources){var s=e.matrix;if(s.valueSources&&o.push.apply(o,e.matrix.valueSources||[]),s.rows&&s.rows.levels)for(var n=0,l=s.rows.levels;n<l.length;n++){var c=l[n];o.push.apply(o,c.sources||[])}}else if(e.categorical&&e.categorical.values){e=_.head(e.categorical.values.grouped());if(e)for(var u=0,d=e.values;u<d.length;u++){var h=d[u];o.push(h.source)}}for(var p=0;p<o.length;p++){var g=o[p],y=w.ColorHelper.getDataColorByIndex(i,p,w.ForegroundColorName),m=B.DataViewObjects.getUserDefinedObjects(g.objects,"referenceLine"),v=f.getCartesianRoleKind(g,t);r.push.apply(r,w.ReferenceLineHelper.readDataView(m,y,"referenceLine",v,i,a,void 0,g)||[])}return r},f.getCartesianRoleKind=function(e,t){var i=e.roles;if(t.getAxisLocationForRole&&i)for(var a in i)if(i[a])return t.getAxisLocationForRole(a);return 1},f.converter=function(e){return(new w.CartesianChartConverter).convert(e)},f.prototype.updateInternal=function(p,g){return __awaiter(this,void 0,B.Promise,function(){var t,i,a,r,o,s,n,l,c,u,d,h;return __generator(this,function(e){switch(e.label){case 0:return(t=this.dataViews=p.dataViews,i=p.operationKind===B.VisualDataChangeOperationKind.Append||null!=p.resizeMode,this.currentViewport=p.viewport,t)?(s=this.layerFactory.layerMetadata,a=_.some(s,function(e){return!!e.categoryAxisTitleOnByDefault}),r=_.some(s,function(e){return!!e.valueAxisTitleOnByDefault}),h=this.multiples.isSmallMultiples(t),(o=h&&t[0])?(n=o.metadata.objects,l=this.layerStyle,s=f.getMultiplesLayout(n,l),c=f.getMultiplesSubheader(n,l),n=s.columnCount,l=s.rowCount,this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:h,columns:n,rows:l}),this.smallMultiplesViewModelAdapter=this.viewModelAdapterFactory.createSmallMultiplesAdapter({dataView:o,multiplesLayout:s,multiplesSubheader:c,viewport:this.currentViewport})):(this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:h,columns:void 0,rows:void 0}),this.smallMultiplesViewModelAdapter=void 0),h!==this.multiples.isSmallMultiples()&&this.multiples.clear(),null!=g?(d=this.multiples.getCoreMultiple(),c=d.layers,_.isEmpty(t)||(u=f.getLayerDataViews(t),this.cartesianVisualCapabilities=f.getCartesianVisualCapabilities(c),h&&this.cartesianVisualCapabilities&&(this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis=!1),2===(u=this.categoryAxisRenderMode=f.getRenderMode(u,this.cartesianVisualCapabilities,this.featureSwitches.easierHierarchicalAxis))&&(t=t.map(function(e){return y.concatenateCategories(e,w.columnChartProps.general.formatString,w.cartesianRoleNames.category)}))),this.multiples.update({dataViews:t,operationKind:g,categoryAxisTitleOnByDefault:a,valueAxisTitleOnByDefault:r,viewport:this.currentViewport,adapterFactory:this.viewModelAdapterFactory,preserveScrollPosition:i}),this.cartesianData=this.originalCartesianData=d.getData()):(this.multiples.resize(this.currentViewport),this.cartesianData=this.multiples.getCoreMultiple().getData()),null==g&&this.cartesianData&&this.cartesianData.axesData?this.axes.updateResize(this.cartesianData.axesData,this.cartesianData.scrollbarOptions.scrollbarWidth):null!=g&&(_.isEmpty(t)||((d=t[0]).metadata&&(this.background={image:B.DataViewObjects.getValue(d.metadata.objects,w.scatterChartProps.plotArea.image),transparency:B.DataViewObjects.getValue(d.metadata.objects,w.scatterChartProps.plotArea.transparency,w.visualBackgroundHelper.getDefaultTransparency())}),this.categoryLoadMoreDataHandler.update(u,h),this.axes.update(d.categorical?d.categorical.categories:null,this.cartesianData.axesData,u,this.cartesianData.scrollbarOptions.scrollbarWidth)),this.categoryLoadMoreDataHandler.onLoadMoreDataCompleted()),this.cartesianData&&this.cartesianData.zoomData&&this.axisZoom.update({dataViews:t,zoomData:this.cartesianData.zoomData,hasSmallMultiples:h,hasScalarCategoryAxis:this.categoryAxisIsScalar().isScalar,hasYAxisCategorical:this.axes.isYAxisCategorical}),h=!this.hasSetData||p.suppressAnimations||h,[4,this.render(h,i,p.resizeMode)]):[2];case 1:return e.sent(),this.hasSetData=this.hasSetData||!_.isEmpty(t),this.updateWarnings(this.cartesianData.warningObjectCollection),this.subSelectionHelper&&this.subSelectionHelper.updateOutlinesFromSubSelections(p.subSelections),[2]}})})},f.getMultiplesLayout=function(e,t){var i=B.DataViewObjects.getObject(e,w.SmallMultiplesUtils.LayoutObjectName),a=i,r=f.getLayoutDefaults(t),e=w.ColorHelper.create(t),t=(a&&a.layoutType)===w.smallMultiplesLayout.auto?{layoutType:0,rowCount:r.rowCount,columnCount:r.columnCount}:{layoutType:1,rowCount:a&&a.rowCount||r.rowCount,columnCount:a&&a.columnCount||r.columnCount};return t.backgroundColor=e.getColorForPropertyNameWithDefaultColor(i,w.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor.propertyName,r.backgroundColor,!0),t.backgroundTransparency=(a&&void 0!==a.backgroundTransparency?a:r).backgroundTransparency,t.gridLineType=a&&a.gridLineType||r.gridLineType,t.gridLineStyle=a&&a.gridLineStyle||r.gridLineStyle,t.gridLineColor=e.getColorForPropertyNameWithDefaultColor(i,w.StandardObjectPropertyIdentifiers.smallMultiplesGridLineColor.propertyName,r.gridLineColor),t.gridLineWidth=(a&&void 0!==a.gridLineWidth?a:r).gridLineWidth,f.applyPadding(t,a,r),t},f.getLayoutDefaults=function(e){var t={layoutType:0,rowCount:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultRowCount,columnCount:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultColumnCount,backgroundColor:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundColor,backgroundTransparency:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundTransparency,gridLineType:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineType,gridLineStyle:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineStyle,gridLineWidth:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineWidth,gridPadding:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,advancedPaddingOptions:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultAdvancedPaddingOptions,columnPaddingInner:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,columnPaddingOuter:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingInner:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingOuter:w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding};return t.gridLineColor=w.ColorHelper.getThemeColor(e,w.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineColorName),t},f.getCartesianVisualCapabilities=function(e){for(var t,i=0,a=e.length;i<a;i++){var r=e[i].getCartesianVisualCapabilities();t?t.supportsHierarchicalCategoryAxis=t.supportsHierarchicalCategoryAxis&&r.supportsHierarchicalCategoryAxis:t=B.Prototype.inherit(r)}return t},f.getRenderMode=function(e,t,i){for(var a=0,r=e;a<r.length;a++){var o,s=r[a];null!=s&&(s=new h(s,null==t?void 0:t.supportsHierarchicalCategoryAxis,i).getRenderModes(),o=o?_.intersection(o,s):s,_.isEmpty(o))}return _.head(o)},f.getCategoryValueType=function(e){_.isEmpty(e);e=_.find(e,function(e){return e.getCategoryValueType});if(e)return e.getCategoryValueType()},f.applyPadding=function(e,t,i){e.gridPadding=(t&&void 0!==t.gridPadding?t:i).gridPadding,e.advancedPaddingOptions=(t&&void 0!==t.advancedPaddingOptions?t:i).advancedPaddingOptions;var a=t&&t.advancedPaddingOptions,r={gridPadding:e.gridPadding,gridLineSettings:e.gridLineType};a&&void 0!==t.columnPaddingInner?e.columnPaddingInner=t.columnPaddingInner:e.columnPaddingInner=f.getPaddingFromGridPaddingAndDefaults(r,1),a&&void 0!==t.columnPaddingOuter?e.columnPaddingOuter=t.columnPaddingOuter:(r.defaultPadding=i.columnPaddingOuter,e.columnPaddingOuter=f.getPaddingFromGridPaddingAndDefaults(r,0)),a&&void 0!==t.rowPaddingInner?e.rowPaddingInner=t.rowPaddingInner:e.rowPaddingInner=f.getPaddingFromGridPaddingAndDefaults(r,2),a&&void 0!==t.rowPaddingOuter?e.rowPaddingOuter=t.rowPaddingOuter:(r.defaultPadding=i.rowPaddingOuter,e.rowPaddingOuter=f.getPaddingFromGridPaddingAndDefaults(r,0))},f.getPaddingFromGridPaddingAndDefaults=function(e,t){var i=e.gridPadding,a=e.gridLineSettings,r=e.defaultPadding;switch(t){case 0:return w.GridLayout.typeHasOuterGridLines(a)?i:r;case 1:return w.GridLayout.typeHasVerticalGridLines(a)?i:f.floatSafeHalf(i);case 2:return w.GridLayout.typeHasHorizontalGridLines(a)?i:f.floatSafeHalf(i)}},f.floatSafeHalf=function(e){return e%2==0?e/2:Math.ceil(e/2)},f.prototype.isSmallMultiples=function(){return f.isSmallMultiples(this.dataViews,this.featureSwitches.cartesianMultiples)},f.prototype.showLayoutCard=function(){return this.isSmallMultiples()},f.prototype.supportsResponsive=function(){return this.featureSwitches.smallMultiplesResponsive||!this.isSmallMultiples()},f.prototype.enumerateLayout=function(e){var t,i;this.showLayoutCard()&&(t={selector:null,properties:{},validValues:{rowCount:{numberRange:{min:w.MultiplesLayoutMinRows,max:w.MultiplesLayoutMaxRows}},columnCount:{numberRange:{min:w.MultiplesLayoutMinColumns,max:w.MultiplesLayoutMaxColumns}}},objectName:w.SmallMultiplesUtils.LayoutObjectName},0===(i=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle)).layoutType?t.properties.layoutType=w.smallMultiplesLayout.auto:(t.properties.rowCount=i.rowCount,t.properties.columnCount=i.columnCount),e.pushInstance(t),this.featureSwitches.cartesianMultiplesGridFormatting&&(t={selector:{data:[u.fromRoles([w.cartesianRoleNames.rows])]},properties:{backgroundColor:i.backgroundColor},propertyInstanceKind:{backgroundColor:3},altConstantValueSelector:null,objectName:w.SmallMultiplesUtils.LayoutObjectName},e.pushInstance(t,!1),t={selector:null,properties:{backgroundTransparency:i.backgroundTransparency,gridLineType:i.gridLineType},validValues:{gridLineWidth:{numberRange:{min:w.MultiplesLayoutMinGridlinesWidth,max:w.MultiplesLayoutMaxGridlinesWidth}}},objectName:w.SmallMultiplesUtils.LayoutObjectName},i.gridLineType!==w.gridLineType.none&&(t.properties.gridLineColor=i.gridLineColor,t.properties.gridLineWidth=i.gridLineWidth,t.properties.gridLineStyle=i.gridLineStyle),this.featureSwitches.cartesianMultiplesGridPadding&&(i.advancedPaddingOptions||(t.properties.gridPadding=i.gridPadding),t.properties.advancedPaddingOptions=i.advancedPaddingOptions,i.advancedPaddingOptions&&(t.properties.columnPaddingInner=i.columnPaddingInner,t.properties.columnPaddingOuter=i.columnPaddingOuter,t.properties.rowPaddingInner=i.rowPaddingInner,t.properties.rowPaddingOuter=i.rowPaddingOuter))),e.pushInstance(t,!1))},f.prototype.showSmallMultiplesCard=function(){return this.isSmallMultiples()},f.prototype.getSmallMultiplesCard=function(){var a=this;if(9!==this.type&&10!==this.type&&13!==this.type){var r=function(e){return a.hostServices.getLocalizedString(e)},o=this.featureSwitches.cartesianMultiplesGridFormatting,s=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),n=f.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle),l=w.StandardObjectIdentifiers.smallMultiplesLayout,c=w.StandardObjectIdentifiers.subheader,e=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("smallMultiples"),"Role_DisplayName_SmallMultiples",[l.rowCount,l.columnCount,l.gridPadding,l.advancedPaddingOptions,l.columnPaddingInner,l.columnPaddingOuter,l.rowPaddingInner,l.rowPaddingOuter,l.gridLineType,l.gridLineStyle,l.gridLineColor,l.gridLineWidth,l.backgroundColor,l.backgroundTransparency,c.show,c.fontFamily,c.fontSize,c.fontColor,c.underline,c.bold,c.italic,c.position,c.alignment,c.titleWrap],r);return this.showSmallMultiplesCard()?(e.withDescription("Small_Multiples_Layout_Description").addGroup("layout",function(e){var t,i;s.layoutType,e.withDisplayName("Small_Multiples_LayoutGroup").addSimpleSlice("rowCount",new w.builder.NumUpDownBuilder({descriptor:l.rowCount,value:s.rowCount,options:{minValue:{type:0,value:w.MultiplesLayoutMinRows},maxValue:{type:1,value:w.MultiplesLayoutMaxRows}}}).build()).addSimpleSlice("columnCount",new w.builder.NumUpDownBuilder({descriptor:l.columnCount,value:s.columnCount,options:{minValue:{type:0,value:w.MultiplesLayoutMinColumns},maxValue:{type:1,value:w.MultiplesLayoutMaxColumns}}}).build()),o&&a.featureSwitches.cartesianMultiplesGridPadding&&(t=s.advancedPaddingOptions,e.addSimpleSlice("gridPadding",new w.builder.NumUpDownBuilder({descriptor:l.gridPadding,value:s.gridPadding,options:i={minValue:{type:0,value:0},maxValue:{type:1,value:40}}}).build(),function(e){return e.withDisabled(t).withCustomDisplayName("Small_Multiples_All_Padding")}).addSimpleSlice("advancedPadding",new w.builder.ToggleSwitchBuilder({descriptor:l.advancedPaddingOptions,value:s.advancedPaddingOptions}).build(),function(e){return e.withCustomDisplayName("Small_Multiples_Customize_Padding")}),t&&e.addSimpleSlice("columnPaddingInner",new w.builder.SliderBuilder({descriptor:l.columnPaddingInner,value:s.columnPaddingInner,options:i,localize:r}).build()).addSimpleSlice("columnPaddingOuter",new w.builder.SliderBuilder({descriptor:l.columnPaddingOuter,value:s.columnPaddingOuter,options:i,localize:r}).build()).addSimpleSlice("rowPaddingInner",new w.builder.SliderBuilder({descriptor:l.rowPaddingInner,value:s.rowPaddingInner,options:i,localize:r}).build()).addSimpleSlice("rowPaddingOuter",new w.builder.SliderBuilder({descriptor:l.rowPaddingOuter,value:s.rowPaddingOuter,options:i,localize:r}).build()))}),o&&e.addGroup("border",function(e){var t=s.gridLineType!==w.gridLineType.none;e.withDisplayName("Visual_Border").addSimpleSlice("gridLineType",new w.builder.DropdownBuilder({descriptor:l.gridLineType,value:s.gridLineType}).build()).addSimpleSlice("gridLineStyle",new w.builder.DropdownBuilder({descriptor:l.gridLineStyle,value:s.gridLineStyle}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineColor",new w.builder.ColorPickerBuilder({descriptor:l.gridLineColor,value:{value:s.gridLineColor}}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineWidth",new w.builder.NumUpDownBuilder({descriptor:l.gridLineWidth,value:s.gridLineWidth,options:{minValue:{type:0,value:w.MultiplesLayoutMinGridlinesWidth},maxValue:{type:1,value:w.MultiplesLayoutMaxGridlinesWidth}}}).build(),function(e){return e.withDisabled(!t)})}),e.addGroup("title",function(e){e.withDisplayName("Title"),a.featureSwitches.smallMultiplesResponsive&&e.addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:c.show,value:!!a.showSubheaderCard()&&n.show}).build()});var t=n.fontProperties,i=(new w.builder.FontControlBuilder).withFontFamily({descriptor:c.fontFamily,value:t.family}).withFontSizeProperties({descriptor:c.fontSize,value:t.size.pt});a.featureSwitches.enableBIU&&i.withBold({descriptor:c.bold,value:n.labelBold}).withItalic({descriptor:c.italic,value:n.labelItalic}).withUnderline({descriptor:c.underline,value:n.labelUnderline});i=i.build();e.addSimpleSlice("position",function(){var e;switch(n.vertical){default:case 0:e=w.verticalPosition.top;break;case 1:e=w.verticalPosition.bottom}return new w.builder.DropdownBuilder({descriptor:c.position,value:e}).build()}).addCompositeSlice("font","Font",i).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},c.fontColor),{instanceKind:3,selector:{data:[u.fromRoles([w.cartesianRoleNames.rows])]},altConstantValueSelector:null}),value:{value:t.color}}).build()).addSimpleSlice("alignment",function(){var e;switch(n.horizontal){default:case 0:e=w.horizontalPosition.left;break;case 1:e=w.horizontalPosition.center;break;case 2:e=w.horizontalPosition.right}return new w.builder.AlignmentGroupBuilder({descriptor:c.alignment,value:e,mode:"horizontalAlignment"}).build()}),a.featureSwitches.smallMultiplesSubheaderFormatting&&e.addSimpleSlice("titleWrap",new w.builder.ToggleSwitchBuilder({descriptor:c.titleWrap,value:n.titleWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),o&&e.addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},l.backgroundColor),{selector:{data:[u.fromRoles([w.cartesianRoleNames.rows])]},altConstantValueSelector:null,instanceKind:3}),value:{value:s.backgroundColor},isNoFillItemSupported:!0}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("transparency",new w.builder.SliderBuilder({descriptor:l.backgroundTransparency,value:s.backgroundTransparency,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:w.visualLocKeys.PercentLocKey},localize:r}).build(),function(e){return e.withCustomDisplayName("Transparency")})}),e.build()):(e.withDisabled(!0,"Visual_SmallMultipleCard_DisabledReason"),e.build())}},f.getMultiplesSubheader=function(e,t){var i=B.DataViewObjects.getObject(e,"subheader"),a=w.MultiplesSubheaderDefaults(),r=w.ColorHelper.create(t),o=w.FontProperties.createFromObjectOrStyle(i,{family:"fontFamily",size:"fontSize",color:"fontColor",bold:"bold",italic:"italic",underline:"underline"},r,t,a.ColorName,a.TextClassName,{color:w.ColorHelper.getThemeColor(t,a.ColorName),size:w.Units.FontSize.createFromPt(a.FontPointSize),family:a.FontFamily,weight:g.normalValue,style:g.normalValue,textDecoration:g.noneValue}),s={top:0,bottom:2,left:5,right:0},n=o.size.px+s.top+s.bottom,l=a.Vertical,c=a.Horizontal,u=a.TitleWrap,e=a.Show,r=!1,t=!1,a=!1;if(i){switch(i.position){case w.verticalPosition.top:l=0;break;case w.verticalPosition.bottom:l=1}switch(i.alignment){case w.horizontalPosition.left:c=0;break;case w.horizontalPosition.center:c=1;break;case w.horizontalPosition.right:c=2}u=i.titleWrap,void 0!==i.show&&(e=i.show),void 0!==i.bold&&(r=i.bold),void 0!==i.italic&&(t=i.italic),void 0!==i.underline&&(a=i.underline)}return{fontProperties:o,show:e,height:n,margins:s,vertical:l,horizontal:c,titleWrap:u,labelBold:r,labelItalic:t,labelUnderline:a}},f.prototype.showSubheaderCard=function(){return this.isSmallMultiples()},f.prototype.enumerateSubheader=function(e){if(this.showSubheaderCard()){var t,i,a=f.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle);switch(a.horizontal){default:case 0:t=w.horizontalPosition.left;break;case 1:t=w.horizontalPosition.center;break;case 2:t=w.horizontalPosition.right}switch(a.vertical){default:case 0:i=w.verticalPosition.top;break;case 1:i=w.verticalPosition.bottom}var r={objectName:w.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{}};this.featureSwitches.smallMultiplesResponsive&&(r.properties.show=a.show),r.properties.fontFamily=a.fontProperties.family,r.properties.fontSize=a.fontProperties.size.pt,e.pushInstance(r),r={objectName:w.SmallMultiplesUtils.SubheaderObjectName,selector:{data:[u.fromRoles([w.cartesianRoleNames.rows])]},properties:{fontColor:a.fontProperties.color},propertyInstanceKind:{fontColor:3},altConstantValueSelector:null},e.pushInstance(r,!1),r={objectName:w.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{alignment:t,position:i}},this.featureSwitches.smallMultiplesSubheaderFormatting&&(r.properties.titleWrap=a.titleWrap),e.pushInstance(r,!1)}},f.getLayerDataViews=function(e){return _.isEmpty(e)?[]:_.filter(e,function(e){return!w.TrendLineHelper.isDataViewForRegression(e)&&!w.ForecastHelper.isDataViewForForecast(e)&&!w.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)})},f.prototype.render=function(t,i,a){return __awaiter(this,void 0,B.Promise,function(){return __generator(this,function(e){return[2,this.layout.render(this.multiples,this.currentViewport,this.categoryLoadMoreDataHandler,this.background,this.axisZoom,this.trimOrdinalDataOnOverflow,t,3===this.categoryAxisRenderMode,i,this.formatMode,a)]})})},f.prototype.updateWarnings=function(e){var t;if(!_.isEmpty(this.dataViews)){var i=this.dataViews,a=w.getInvalidValueWarnings(i,!1,!1,!1,["Tooltips"],!0);if(_.isEmpty(a)||e.add.apply(e,a||[]),this.axes.addWarnings(e),this.multiples.checkIfNoLabelsCanBeRendered()){a={selector:null,warnings:[new w.DataLabelsNotRenderedWarning]};e.addForVisualObject("labels",a)}else{e.removeForVisualObject("labels");for(var r=0,o=null===(t=this.multiples.getCoreMultiple())||void 0===t?void 0:t.layers;r<o.length;r++){var s=o[r];s.addWarnings&&s.addWarnings(e)}}for(var n=[],l=null===(t=this.cartesianVisualCapabilities)||void 0===t?void 0:t.supportsHierarchicalCategoryAxis,c=0,u=i;c<u.length;c++){var d=u[c];new h(d,l,this.featureSwitches.easierHierarchicalAxis).addObjectWarnings(n)}_.isEmpty(n)||(i=this.cartesianData.warningObjectCollection).addForVisualObject.apply(i,__spreadArray(["categoryAxis"],n)),this.hostServices.setWarnings(this.cartesianData.warningObjectCollection.complete())}},f.prototype.update=function(t){return __awaiter(this,void 0,B.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.featureSwitches.onObject&&t.formatMode!==this.formatMode&&(this.subSelectionHelper.setFormatMode(t.formatMode),this.interactivityService.setFormatMode(t.formatMode),this.formatMode=t.formatMode),null==t.resizeMode?[3,2]:[4,this.updateInternal(t)];case 1:return e.sent(),[3,4];case 2:return[4,this.updateInternal(t,null!=t.operationKind?t.operationKind:B.VisualDataChangeOperationKind.Create)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},f.prototype.destroy=function(){this.multiples&&this.multiples.clear(),this.layout&&this.layout.destroy(),this.axisZoom&&(this.axisZoom.destroy(),this.axisZoom=void 0)},f.prototype.onViewModeChanged=function(e){this.layout.viewMode=e},f.prototype.scrollTo=function(e){var t=this.layout.getVisibleMultiples();this.multiples.scrollTo(e,t)},f.prototype.scrollRowsTo=function(e){this.layout.scrollRowsTo(e)},f.prototype.enumerateObjectInstances=function(e){var t,i=new w.ObjectEnumerationBuilder,a=this.getLayers();if(e.objectName===w.SmallMultiplesUtils.LayoutObjectName)this.enumerateLayout(i);else if("subheader"===e.objectName)this.enumerateSubheader(i);else if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;for(var r={enumeration:i,legendData:this.originalCartesianData.legendData},o=0,s=a;o<s.length;o++)(n=s[o]).enumerateCustomLegend?n.enumerateCustomLegend(r):w.Legend.enumerate(r,this.featureSwitches)}else"categoryAxis"===e.objectName&&this.axes.hasCategoryAxis()?this.enumerateCategoryAxis(i):"valueAxis"===e.objectName?this.enumerateValueAxis(i):"y2Axis"===e.objectName?this.enumerateValueAxis(i,"y2Axis"):e.objectName===w.ReferenceLineHelper.xAxisRefLineObjectName?(t=this.categoryAxisIsScalar().isScalar,w.CartesianChartConverter.supportsStaticReferenceLines(this.dataViews,a)&&t&&(0===this.type&&this.featureSwitches.lineChartVerticalReferenceLine||0!==this.type&&this.featureSwitches.xAxisRefLineImprovements)&&(u=f.getCategoryValueType(a),this.enumerateReferenceLines(i,e.objectName,u))):e.objectName===w.ReferenceLineHelper.y1AxisRefLineObjectName?this.enumerateReferenceLines(i,e.objectName):"referenceLine"===e.objectName?w.CartesianChartConverter.supportsDataBoundReferenceLines(this.dataViews,a)&&this.enumerateReferenceLines(i,e.objectName):"trend"===e.objectName?w.CartesianChartConverter.supportsTrendLines(this.dataViews,a)&&w.TrendLineHelper.enumerateObjectInstances(i,this.originalCartesianData.trendLines,this.layerStyle):"plotArea"===e.objectName?w.visualBackgroundHelper.enumeratePlot(i,this.background):"zoom"===e.objectName&&this.axisZoom.enumerateObjectInstances(i);if("dataPoint"===e.objectName&&w.ComboChart.isComboChart(this.type))w.ComboChart.enumerateDataPoints(i,e,a);else for(var n,l=0,c=a;l<c.length;l++)(n=c[l]).enumerateObjectInstances&&n.enumerateObjectInstances(i,e);var u=this.supportsResponsive();return this.dataViews&&this.dataViews[0]&&(a=this.dataViews[0],this.viewModelAdapterFactory&&this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:a,viewport:void 0,isCoreMultiple:void 0}).enumerateObjectInstances(e,i,u)),this.smallMultiplesViewModelAdapter&&this.smallMultiplesViewModelAdapter.enumerateObjectInstances(e,i,u),i.complete()},f.prototype.getSubSelectionStyles=function(e){if(this.featureSwitches.onObject){var t,i=_.first(e).visualObjects;if(0<i.length)switch(null!=(i=i[0])&&i.selectorsByColumn&&(t=l.normalizeSelector(l.convertSelectorsByColumnToSelector(i.selectorsByColumn))),i.objectName){case"legend-title":case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":return;case"legend-items":var a="legend-text";return w.CartesianChartOnObjectUtil.getFontOnlyTextSubSelectionStyles("Visual-legend",a,a+"-fontselector",a+"-color",this.hostServices);case"data-labels":var r="labels-applySettingsTo-series--values";return w.CartesianChartOnObjectUtil.getFontOnlyTextSubSelectionStyles("Visual-labels",r,r+"-font",r+"-color",this.hostServices,t);case"series-labels":r="seriesLabels-applySettingsTo-series--values";return w.CartesianChartOnObjectUtil.getFontOnlyTextSubSelectionStyles("Visual-seriesLabels",r,r+"-font",r+"-seriesColor",this.hostServices,t);case"x-axis-title":return w.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!this.axes.isYAxisCategorical,this.hostServices);case"y-axis-title":return w.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(this.axes.isYAxisCategorical,this.hostServices);case"x-axis-values":return w.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y-axis-values":return w.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);default:for(var o=0,s=this.getLayers();o<s.length;o++){var n=s[o];if(n.getSubSelectionStyles)return n.getSubSelectionStyles(e)}}}},f.prototype.getSubSelectionShortcuts=function(e){if(this.featureSwitches.onObject){var t=_.first(e).visualObjects;if(0<t.length)switch(t[0].objectName){case"legend-title":return[{type:0},{type:1,destinationUids:[{cardUid:"Visual-legend",groupUid:"legend-title"}],label:this.hostServices.getLocalizedString("Format_Legend_Title")}];case"legend-items":return[{type:0},{type:2,sourceUid:"legend-title-showTitle",enabledLabel:this.hostServices.getLocalizedString("Format_AddLegendTitle"),disabledLabel:""},{type:4,sortableField:{queryName:"",sortDirection:1},label:this.hostServices.getLocalizedString("Format_SortLegend")},{type:1,destinationUids:[{cardUid:"Visual-legend"}],label:this.hostServices.getLocalizedString("Format_Legend")}];case"data-labels":return[{type:0},{type:1,destinationUids:[{cardUid:"Visual-labels",groupUid:"labels-applySettingsTo-series--options"}],label:this.hostServices.getLocalizedString("Format_Data_Labels")}];case"series-labels":return[{type:0},{type:1,destinationUids:[{cardUid:"Visual-seriesLabels",groupUid:"seriesLabels-applySettingsTo-series--options"}],label:this.hostServices.getLocalizedString("Format_Series_Labels")}];case"x-axis-title":return w.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y-axis-title":return w.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"x-axis-values":return w.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"y-axis-values":return w.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":var i="axisZoom-default";return[{type:0},{type:2,sourceUid:i+"-labels",enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderLabels"),disabledLabel:""},{type:2,sourceUid:i+"-tooltips",enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderTooltips"),disabledLabel:""},{type:1,destinationUids:[{cardUid:"Visual-axisZoom",groupUid:i}],label:this.hostServices.getLocalizedString("Format_ZoomSlider")}];default:for(var a=0,r=this.getLayers();a<r.length;a++){var o=r[a];if(o.getSubSelectionStyles)return o.getSubSelectionShortcuts(e)}}}},f.prototype.getSubSelectables=function(e){for(var t=this.subSelectionHelper.getAllSubSelectables(e),i=0,a=this.getLayers();i<a.length;i++){var r=a[i];r.getDisambiguationSubSelectables&&t.push.apply(t,r.getDisambiguationSubSelectables(this.subSelectionHelper,e))}return t},f.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},f.prototype.getFormattingModel=function(){for(var r=this,e=function(e){for(var t,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i))},t=!(13===this.type),i=new w.builder.FormattingModelBuilder(function(){return r.customizeFormattingCard(r.getCategoryAxisCard())},function(){return r.customizeFormattingCard(r.getValueAxisCard())},function(){return r.getSecondaryValueAxisCard()},function(){return r.getLegendCard()},function(){return r.getSmallMultiplesCard()},function(){return r.getGridlinesCard()},function(){return r.axisZoom.getZoomCard(t)}).build(),a=i&&i.cards?i.cards:[],o=this.getLayers(),s={categoryAxisData:this.originalCartesianData.axesData.categoryAxis},n=[],l=0,c=o;l<c.length;l++){var u=c[l];if(!u.getFormattingCards)return;n.push(u.getFormattingCards(s))}w.ComboChart.isComboChart(this.type)||n.length,w.ComboChart.isComboChart(this.type)?(o=w.ComboChart.sortComboChartFormattingCards(w.ComboChart.mergeFormattingCards(n,this.type,e,this.featureSwitches.onObjectFormatPaneUid),this.type,this.featureSwitches.comboChartError),a.push.apply(a,o)):1===n.length?a.push.apply(a,n[0].card):n.length;e=w.visualBackgroundHelper.getBackgroundCard(this.background,e);return e&&a.push(e),i},f.prototype.customizeFormattingCard=function(e){for(var t=e,i=0,a=this.getLayers();i<a.length;i++){var r=a[i];return t=r.customizeFormattingCard?r.customizeFormattingCard(e):t}},f.prototype.resolveFormattingPlaceholder=function(e){if(w.builder.isVisualFormattingSlicePlaceholder(e)){var t=e.name;if("responsive"===t)return this.getResponsiveSlice();for(var i=0,a=this.getLayers();i<a.length;i++){var r=a[i],r=r.resolveFormattingPlaceholder&&r.resolveFormattingPlaceholder(e);if(r)return r}}},f.prototype.getResponsiveSlice=function(){function e(e){return t.hostServices.getLocalizedString(e)}var t=this,i=this.supportsResponsive(),a=this.dataViews&&this.dataViews[0];if(a)return this.smallMultiplesViewModelAdapter?this.smallMultiplesViewModelAdapter.getResponsiveSlice(a,i,e):this.viewModelAdapterFactory?this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:a,viewport:void 0,isCoreMultiple:void 0}).getResponsiveSlice(a,i,e):void 0},f.prototype.getCategoryAxisCard=function(){var s=this,n=this.axes;if(n.hasCategoryAxis()){var a=function(e){return s.hostServices.getLocalizedString(e)},l=w.cartesianChartProps.categoryAxis,c=this.originalCartesianData.axesData.categoryAxis,r=n.isYAxisCategorical,e=r?"Visual_YAxis_Hyphen":"Visual_XAxis_Hyphen",t=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("categoryAxis"),e,[l.show,l.axisType,l.start,l.end,l.fontFamily,l.fontSize,l.bold,l.italic,l.underline,l.labelColor,l.labelDisplayUnits,l.labelPrecision,l.maxMarginFactor,l.position,l.showAxisTitle,l.titleText,l.axisStyle,l.titleFontFamily,l.titleFontSize,l.titleBold,l.titleItalic,l.titleUnderline,l.titleColor,l.concatenateLabels,l.show,l.invertAxis,l.axisScale,l.logAxisScale,l.switchAxisPosition],a);t.addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:l.show,value:c.show}).build()});var i=this.categoryAxisIsScalar(),o=i.isScalar;i.supportedType===w.axisType.both&&t.addGroup("type",function(e){e.addSimpleSlice("type",new w.builder.DropdownBuilder({descriptor:l.axisType,value:o?w.axisType.scalar:w.axisType.categorical}).build())}),o&&t.addGroup("range",function(e){e.withDisplayName("Visual_Axis_Range");var t,i=_.filter(c.includeDomains,function(e){return _.includes(e.domainSources,10)}),a=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,i||[]),r=a&&a.domain||[void 0,void 0],o=r[0],i=r[1];n.isCategoryAxisDateTime()?(a=o&&B.FeatureSwitchedDate.fromTimeValue(s.featureSwitches.utcDates,o),r=i&&B.FeatureSwitchedDate.fromTimeValue(s.featureSwitches.utcDates,i),e.addSimpleSlice("min",new w.builder.DatePickerBuilder({descriptor:__assign(__assign({},l.start),{propertyTypes:{dateTime:!0},instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:a,placeholder:"",validators:{max:{type:1,value:r}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new w.builder.DatePickerBuilder({descriptor:__assign(__assign({},l.end),{propertyTypes:{dateTime:!0},instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:r,placeholder:"",validators:{min:{type:0,value:a}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")})):e.addSimpleSlice("min",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},l.start),{propertyTypes:{numeric:!0},instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:o,options:{maxValue:{type:1,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},l.end),{propertyTypes:{numeric:!0},instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{minValue:{type:0,value:o}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),s.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new w.builder.ToggleSwitchBuilder({descriptor:l.logAxisScale,value:null!==(t=c.logAxisScale)&&void 0!==t?t:c.axisScale===w.axisScale.log}).build(),function(e){return e.withDisabled(!s.isLogAxisScaleAllowed(!1)).withCustomDescription(s.isLogAxisScaleAllowed(!1)?void 0:"Visual_LogarithmicScaleDescription")}):(t=s.getAxisScaleOptions(!1),e.addSimpleSlice("axisType",new w.builder.DropdownBuilder({descriptor:l.axisScale,value:c.axisScale,filterValues:t}).build())),s.featureSwitches.invertAxis&&e.addSimpleSlice("invertAxis",new w.builder.ToggleSwitchBuilder({descriptor:l.invertAxis,value:c.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")})});var u=c.labelFontProperties,d=c.titleFontProperties,e=(new w.builder.FontControlBuilder).withFontFamily({descriptor:l.fontFamily,value:u.family}).withFontSizeProperties({descriptor:l.fontSize,value:u.size.pt}),i=(new w.builder.FontControlBuilder).withFontFamily({descriptor:l.titleFontFamily,value:d.family}).withFontSizeProperties({descriptor:l.titleFontSize,value:d.size.pt});this.featureSwitches.enableBIU&&(e.withBold({descriptor:l.bold,value:u.weight===g.boldValue}).withItalic({descriptor:l.italic,value:u.style===g.italicValue}).withUnderline({descriptor:l.underline,value:u.textDecoration===g.underlineValue}),i.withBold({descriptor:l.titleBold,value:d.weight===g.boldValue}).withItalic({descriptor:l.titleItalic,value:d.style===g.italicValue}).withUnderline({descriptor:l.titleUnderline,value:d.textDecoration===g.underlineValue}));var h=e.build(),p=i.build();return t.addGroup(o?"valuesScalar":"values",function(e){var t,i;e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",h).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},l.labelColor),{instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:{value:u.color}}).build()),o?e.addSimpleSlice("displayUnits",new w.builder.DropdownBuilder({descriptor:l.labelDisplayUnits,value:c.labelDisplayUnits}).build()).addSimpleSlice("precision",new w.builder.NumUpDownBuilder({descriptor:l.labelPrecision,value:c.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:w.DataLabelViewModel.MaxLabelPrecision}}}).build()):(i=r?"Visual_Max_AreaWidth":"Visual_Max_AreaHeight",e.addSimpleSlice(r?"maxAreaWidth":"maxAreaHeight",new w.builder.SliderBuilder({descriptor:l.maxMarginFactor,value:Math.round(100*c.maxMarginFactor),options:{minValue:{type:0,value:15},maxValue:{type:1,value:50},unitSymbol:w.visualLocKeys.PercentLocKey},localize:a}).build(),function(e){return e.withCustomDisplayName(i)})),r&&(s.featureSwitches.switchAxisPosition?e.addSimpleSlice("switchAxisPosition",new w.builder.ToggleSwitchBuilder({descriptor:l.switchAxisPosition,value:c.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")}):e.addSimpleSlice("position",new w.builder.DropdownBuilder({descriptor:l.position,value:c.position}).build())),null!==(t=s.cartesianVisualCapabilities)&&void 0!==t&&t.supportsHierarchicalCategoryAxis&&!o&&e.addSimpleSlice("concatenateLabels",new w.builder.ToggleSwitchBuilder({descriptor:l.concatenateLabels,value:c.concatenateLabels}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:l.showAxisTitle,value:c.showAxisTitle}).build()}).addSimpleSlice("text",new w.builder.TextInputBuilder({descriptor:l.titleText,value:c.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=n.categoryAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly];return new w.builder.DropdownBuilder({descriptor:l.axisStyle,value:c.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",p).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},l.titleColor),{instanceKind:s.featureSwitches.expressionBasedFormatting?3:1}),value:{value:d.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),t.build()}},f.prototype.getValueAxisCard=function(){var a=this,e=null===(n=this.originalCartesianData)||void 0===n?void 0:n.axesData;if(e&&e.isValueAxisSet&&!e.isValueAxisDisabled&&9!==this.type){var t=this.axes,r=w.cartesianChartProps.valueAxis,o=this.originalCartesianData.axesData.valueAxis,i=t.isYAxisCategorical,s=i?"Visual_XAxis_Hyphen":"Visual_YAxis_Hyphen",n=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("valueAxis"),s,[r.show,r.start,r.end,r.axisScale,r.invertAxis,r.fontFamily,r.fontSize,r.bold,r.italic,r.underline,r.labelColor,r.labelDisplayUnits,r.labelPrecision,r.position,r.showAxisTitle,r.titleText,r.axisStyle,r.titleFontFamily,r.titleFontSize,r.titleBold,r.titleItalic,r.titleUnderline,r.titleColor,r.logAxisScale,r.switchAxisPosition],function(e){return a.hostServices.getLocalizedString(e)}),l=o.labelFontProperties,c=o.titleFontProperties,e=(new w.builder.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:l.family}).withFontSizeProperties({descriptor:r.fontSize,value:l.size.pt}),s=(new w.builder.FontControlBuilder).withFontFamily({descriptor:r.titleFontFamily,value:c.family}).withFontSizeProperties({descriptor:r.titleFontSize,value:c.size.pt});this.featureSwitches.enableBIU&&(e.withBold({descriptor:r.bold,value:o.labelBold}).withItalic({descriptor:r.italic,value:o.labelItalic}).withUnderline({descriptor:r.underline,value:o.labelUnderline}),s.withBold({descriptor:r.titleBold,value:o.titleBold}).withItalic({descriptor:r.titleItalic,value:o.titleItalic}).withUnderline({descriptor:r.titleUnderline,value:o.titleUnderline}));var u=e.build(),d=s.build();return n.addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:r.show,value:o.show}).build()}).addGroup("range",function(e){var t=_.filter(o.includeDomains,function(e){return _.includes(e.domainSources,10)}),i=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,t||[]),t=i&&i.domain||[void 0,void 0],i=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").withInheritDisabled(!1).addSimpleSlice("min",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.start),{propertyTypes:{numeric:!0},instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.end),{propertyTypes:{numeric:!0},instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),13!==a.type&&(a.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new w.builder.ToggleSwitchBuilder({descriptor:r.logAxisScale,value:o.logAxisScale}).build(),function(e){return e.withDisabled(!a.isLogAxisScaleAllowed(!0)).withCustomDescription(a.isLogAxisScaleAllowed(!0)?void 0:"Visual_LogarithmicScaleDescription")}):(i=a.getAxisScaleOptions(!0),e.addSimpleSlice("axisType",new w.builder.DropdownBuilder({descriptor:r.axisScale,value:o.axisScale,filterValues:i}).build()))),a.featureSwitches.invertAxis&&e.addSimpleSlice("invertAxis",new w.builder.ToggleSwitchBuilder({descriptor:r.invertAxis,value:o.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")})}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",u).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.labelColor),{instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:{value:l.color}}).build()),7!==a.type&&8!==a.type&&e.addSimpleSlice("displayUnits",new w.builder.DropdownBuilder({descriptor:r.labelDisplayUnits,value:o.labelDisplayUnits}).build()).addSimpleSlice("precision",new w.builder.NumUpDownBuilder({descriptor:r.labelPrecision,value:o.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:w.DataLabelViewModel.MaxLabelPrecision}}}).build()),i||(a.featureSwitches.switchAxisPosition?e.addSimpleSlice("switchAxisPosition",new w.builder.ToggleSwitchBuilder({descriptor:r.switchAxisPosition,value:o.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")}):e.addSimpleSlice("position",new w.builder.DropdownBuilder({descriptor:r.position,value:o.position}).build()))}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:r.showAxisTitle,value:o.showAxisTitle}).build()}).addSimpleSlice("text",new w.builder.TextInputBuilder({descriptor:r.titleText,value:o.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=t.valueAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly];return new w.builder.DropdownBuilder({descriptor:r.axisStyle,value:o.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",d).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.titleColor),{instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:{value:c.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),n.build()}},f.prototype.getSecondaryValueAxisCard=function(){var e,t,a,r=this,i=null===(d=this.originalCartesianData)||void 0===d?void 0:d.axesData;if(i&&i.isValueAxisSet&&!i.isValueAxisDisabled){switch(this.type){case 0:case 1:e=!0,t=w.cartesianChartProps.y2Axis.show,a=w.cartesianChartProps.y2Axis;break;case 14:case 15:case 16:case 17:e=!0,t=w.cartesianChartProps.valueAxis.secShow,a=w.cartesianChartProps.valueAxis;break;default:e=!1}if(e){var o=this.axes,s=this.originalCartesianData.axesData,n=s.y2,l=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("y2Axis"),"Visual_Y2Axis_Hyphen",__assign(__assign({},a),{alignZeros:w.cartesianChartProps.valueAxis.alignZeros}),function(e){return r.hostServices.getLocalizedString(e)}),c=n.labelFontProperties,u=n.titleFontProperties,d=(new w.builder.FontControlBuilder).withFontFamily({descriptor:a.secFontFamily,value:c.family}).withFontSizeProperties({descriptor:a.secFontSize,value:c.size.pt}),i=(new w.builder.FontControlBuilder).withFontFamily({descriptor:a.secTitleFontFamily,value:u.family}).withFontSizeProperties({descriptor:a.secTitleFontSize,value:u.size.pt});this.featureSwitches.enableBIU&&(d.withBold({descriptor:a.secBold,value:n.labelBold}).withItalic({descriptor:a.secItalic,value:n.labelItalic}).withUnderline({descriptor:a.secUnderline,value:n.labelUnderline}),i.withBold({descriptor:a.secTitleBold,value:n.titleBold}).withItalic({descriptor:a.secTitleItalic,value:n.titleItalic}).withUnderline({descriptor:a.secTitleUnderline,value:n.titleUnderline}));var h=d.build(),p=i.build();return l.addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:t,value:n.show}).build()}).addGroup("range",function(e){var t=_.filter(n.includeDomains,function(e){return _.includes(e.domainSources,10)}),i=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,t||[]),t=i&&i.domain||[void 0,void 0],i=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").addSimpleSlice("min",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},a.secStart),{instanceKind:r.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new w.builder.NumUpDownBuilder({descriptor:__assign(__assign({},a.secEnd),{instanceKind:r.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),r.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new w.builder.ToggleSwitchBuilder({descriptor:a.secLogAxisScale,value:n.logAxisScale}).build(),function(e){return e.withDisabled(!r.isLogAxisScaleAllowed(!0,!0)).withCustomDescription(r.isLogAxisScaleAllowed(!0,!0)?void 0:"Visual_LogarithmicScaleDescription")}):(i=r.getAxisScaleOptions(!0,!0),e.addSimpleSlice("axisType",new w.builder.DropdownBuilder({descriptor:a.secAxisScale,value:n.axisScale,filterValues:i}).build())),w.ComboChart.isComboChart(r.type)&&e.addSimpleSlice("alignZeroes",new w.builder.ToggleSwitchBuilder({descriptor:w.cartesianChartProps.valueAxis.alignZeros,value:s.valueAxis.alignZeros}).build())}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",h).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:a.secLabelColor,value:{value:c.color}}).build()),7!==r.type&&8!==r.type&&e.addSimpleSlice("displayUnits",new w.builder.DropdownBuilder({descriptor:a.secLabelDisplayUnits,value:n.labelDisplayUnits}).build()).addSimpleSlice("precision",new w.builder.NumUpDownBuilder({descriptor:a.secLabelPrecision,value:n.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:w.DataLabelViewModel.MaxLabelPrecision}}}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:a.secShowAxisTitle,value:n.showAxisTitle}).build()}).addSimpleSlice("text",new w.builder.TextInputBuilder({descriptor:a.secTitleText,value:n.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=o.valueAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly];return new w.builder.DropdownBuilder({descriptor:a.secAxisStyle,value:n.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",p).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:a.secTitleColor,value:{value:u.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),l.build()}}},f.prototype.getLegendCard=function(){for(var e={legendData:this.originalCartesianData.legendData},t=0,i=this.getLayers();t<i.length;t++){var a=i[t];a.customizeLegendFormattingModelOptions&&(e=a.customizeLegendFormattingModelOptions(e))}var r=14===this.type?"Visual_LegendCard_ComboLineClustered_DisabledReason":15===this.type?"Visual_LegendCard_ComboLineStacked_DisabledReason":"Visual_LegendCard_DisabledReason";return w.Legend.getLegendFormattingModel(e,this.hostServices,this.featureSwitches,!this.shouldShowLegendCard(),r)},f.prototype.getGridlinesCard=function(){var t,i,a,r,o=this,e=this.axes,s=e.hasCategoryAxis(),n=e.isYAxisCategorical,l=this.originalCartesianData.axesData,e=3===this.categoryAxisRenderMode,e=this.categoryAxisIsScalar().isScalar||e;n?(t=w.cartesianChartProps.categoryAxis,i=l.categoryAxis,s&&(a=w.cartesianChartProps.valueAxis,9!==this.type&&(r=l.valueAxis))):(t=w.cartesianChartProps.valueAxis,9!==this.type&&(i=l.valueAxis),s&&13!==this.type&&(a=w.cartesianChartProps.categoryAxis,r=l.categoryAxis));l=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("gridlines"),"Visual_Gridline_Show",[w.cartesianChartProps.categoryAxis.gridlineShow,w.cartesianChartProps.categoryAxis.gridlineStyle,w.cartesianChartProps.categoryAxis.gridlineColor,w.cartesianChartProps.categoryAxis.gridlineThickness,w.cartesianChartProps.valueAxis.gridlineShow,w.cartesianChartProps.valueAxis.gridlineStyle,w.cartesianChartProps.valueAxis.gridlineColor,w.cartesianChartProps.valueAxis.gridlineThickness],function(e){return o.hostServices.getLocalizedString(e)});return 9!==this.type||e?((i&&!n||n&&e)&&l.addGroup("horizontal",function(e){return c(e,t,i,"Visual_LabelOrientation_Horizontal",o.featureSwitches)}),(r&&n||!n&&e)&&l.addGroup("vertical",function(e){return c(e,a,r,"Visual_LabelOrientation_Vertical",o.featureSwitches)})):l.withDisabled(!0,"Visual_Ribbon_Chart_Gridlines_DisabledReason"),l.build();function c(e,t,i,a,r){e.withDisplayName(a).addTopLevelToggle("show",function(){return new w.builder.ToggleSwitchBuilder({descriptor:t.gridlineShow,value:!!i.show&&i.gridlineShow}).build()},function(e){return e.withDisabled(!i.show)}).addSimpleSlice("style",new w.builder.DropdownBuilder({descriptor:t.gridlineStyle,value:i.gridlineStyle}).build(),function(e){return e.withCustomDisplayName("Style")}).addSimpleSlice("color",new w.builder.ColorPickerBuilder({descriptor:__assign(__assign({},t.gridlineColor),{instanceKind:r.expressionBasedFormatting?3:1}),value:{value:i.gridlineColor}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("width",new w.builder.NumUpDownBuilder({descriptor:t.gridlineThickness,value:i.gridlineThickness,options:{minValue:{type:0,value:1},maxValue:{type:1,value:4},unitSymbol:w.visualLocKeys.PixelUnitSymbol}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}},f.prototype.getTelemetryInformation=function(){var e,t={};this.isSmallMultiples()&&(e=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),t.smallMultiples={layout:{type:e.layoutType,rows:e.rowCount,columns:e.columnCount}});for(var i=this.getLayers(),a=0;a<i.length;a++){var r=i[a];!_.isFunction(r.getTelemetryInformation)||(r=r.getTelemetryInformation())&&(t[a.toString()]=r)}if(!_.isEmpty(t))return t},f.prototype.getLayers=function(){var e=this.multiples.getCoreMultiple();return 1&e.getState()?e.layers:[]},f.prototype.enumerateReferenceLines=function(e,t,i){var a=w.ColorHelper.getDataColorByIndex(this.layerStyle,0,w.ForegroundColorName),r=_.filter(this.originalCartesianData.referenceLines,function(e){return e.type===t});w.ReferenceLineHelper.enumerateObjectInstances(e,r,a,t,this.originalCartesianData.axesData.isValueAxisDisabled,i,this.featureSwitches)},f.prototype.shouldShowLegendCard=function(){var e,t=null===(e=this.multiples.getCoreMultiple())||void 0===e?void 0:e.layers,i=this.dataViews;if(this.cartesianData.legendData.isGradientLegend)return!0;if(t&&i)for(var a=t.length,r=0,o=0;o<a;o++){if(t[o].hasLegend())return!0;var s=i[o];if(s&&s.categorical&&s.categorical.values&&0<s.categorical.values.length&&1<++r)return!0}return!1},f.prototype.getAxisScaleOptions=function(e,t){void 0===t&&(t=!1);var i=this.axes.isYAxisCategorical,t=(e=void 0===e?!1:e)?i?0:t?2:1:i?1:0,i=[w.DEFAULT_AXIS_SCALE_TYPE];return this.axes.isLogScaleAllowed(t)&&i.push(w.axisScale.log),i},f.prototype.isLogAxisScaleAllowed=function(e,t){void 0===t&&(t=!1);var i=this.axes.isYAxisCategorical,i=(e=void 0===e?!1:e)?i?0:t?2:1:i?1:0;return this.axes.isLogScaleAllowed(i)},f.prototype.categoryAxisIsScalar=function(){var e=this.originalCartesianData.axesData.categoryAxis,t=3===this.categoryAxisRenderMode?w.axisType.categorical:w.axisType.both,i=!1,a=null===(a=this.multiples.getCoreMultiple())||void 0===a?void 0:a.layers;return{isScalar:i=t===w.axisType.both&&a&&a[0].getSupportedCategoryAxisType?(t=a[0].getSupportedCategoryAxisType())===w.axisType.scalar||(i=w.CartesianHelper.isScalar(t===w.axisType.both,e))&&(a&&a[0].getVisualCategoryAxisIsScalar?a[0].getVisualCategoryAxisIsScalar():0===this.categoryAxisRenderMode):i,supportedType:t}},f.prototype.enumerateCategoryAxis=function(e){var t,i,a,r,o,s,n,l,c,u=this;this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isCategoryAxisSet&&(t=this.originalCartesianData.axesData.categoryAxis,i=w.cartesianChartProps.categoryAxis,a=3===this.categoryAxisRenderMode,r=(s=this.categoryAxisIsScalar()).isScalar,o=s.supportedType,(s={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:this.getAxisScaleOptions(!1),axisStyle:this.axes.categoryAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1}}).properties[i.show.propertyName]=t.show,this.axes.isYAxisCategorical&&(this.featureSwitches.switchAxisPosition?s.properties[i.switchAxisPosition.propertyName]=t.switchAxisPosition:s.properties[i.position.propertyName]=t.position),o===w.axisType.both&&(s.properties[i.axisType.propertyName]=r?w.axisType.scalar:w.axisType.categorical),r&&(this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!1)?s.properties[i.logAxisScale.propertyName]=null!==(n=t.logAxisScale)&&void 0!==n?n:t.axisScale===w.axisScale.log:s.properties[i.axisScale.propertyName]=t.axisScale,l=_.filter(t.includeDomains,function(e){return _.includes(e.domainSources,10)}),n=(l=(n=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,l||[]))&&n.domain||[void 0,void 0])[0],l=l[1],s.properties[i.start.propertyName]=n,s.properties[i.end.propertyName]=l,this.featureSwitches.invertAxis&&(s.properties[i.invertAxis.propertyName]=t.invertAxis)),s.properties[i.labelColor.propertyName]=w.AxisDataModel.toColorFill(t.labelFontProperties.color),s.properties[i.fontSize.propertyName]=t.labelFontProperties.size.pt,s.properties[i.fontFamily.propertyName]=t.labelFontProperties.family,this.featureSwitches.enableBIU&&(s.properties[i.bold.propertyName]=t.labelBold,s.properties[i.italic.propertyName]=t.labelItalic,s.properties[i.underline.propertyName]=t.labelUnderline),r&&(s.properties[i.labelDisplayUnits.propertyName]=t.labelDisplayUnits,s.properties[i.labelPrecision.propertyName]=t.labelPrecision,l={numberRange:{min:0,max:w.DataLabelViewModel.MaxLabelPrecision}},s.validValues[i.labelPrecision.propertyName]=l),this.axes.isCategoryAxisDateTime()?(s.propertyTypes[i.start.propertyName]={dateTime:!0},s.propertyTypes[i.end.propertyName]={dateTime:!0}):(s.propertyTypes[i.start.propertyName]={numeric:!0},s.propertyTypes[i.end.propertyName]={numeric:!0}),r||(s.properties[i.preferredCategoryWidth.propertyName]=t.preferredCategoryWidth,s.properties[i.maxMarginFactor.propertyName]=Math.round(100*t.maxMarginFactor),s.validValues[i.maxMarginFactor.propertyName]={numberRange:{min:15,max:50},unitSymbol:"Slider_Percent"},9!==this.type&&(c=t.innerPadding,s.properties[i.innerPadding.propertyName]=void 0!==c?Math.round(100*c):void 0,s.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:"Slider_Percent"})),_.find([9,10],function(e){return e===u.type})||(c=t.innerPadding,s.properties[i.innerPadding.propertyName]=void 0!==c?Math.round(100*c):void 0,s.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:"Slider_Percent"}),null!==(c=this.cartesianVisualCapabilities)&&void 0!==c&&c.supportsHierarchicalCategoryAxis&&!r&&(c=i.concatenateLabels.propertyName,s.properties[c]=t.concatenateLabels),s.properties[i.showAxisTitle.propertyName]=t.showAxisTitle,s.properties[i.showAxisTitle.propertyName]&&(s.properties[i.axisStyle.propertyName]=t.axisStyle,s.properties[i.titleColor.propertyName]=w.AxisDataModel.toColorFill(t.titleFontProperties.color),s.properties[i.titleText.propertyName]=t.titleText,s.properties[i.titleFontSize.propertyName]=t.titleFontProperties.size.pt,s.properties[i.titleFontFamily.propertyName]=t.titleFontProperties.family,this.featureSwitches.enableBIU&&(s.properties[i.titleBold.propertyName]=t.titleBold,s.properties[i.titleItalic.propertyName]=t.titleItalic,s.properties[i.titleUnderline.propertyName]=t.titleUnderline)),(r||a)&&(s.properties[i.gridlineShow.propertyName]=t.gridlineShow,t.gridlineShow&&(s.properties[i.gridlineColor.propertyName]=w.AxisDataModel.toColorFill(t.gridlineColor),s.properties[i.gridlineThickness.propertyName]=t.gridlineThickness,s.validValues.gridlineThickness=["1","2","3","4"],s.properties[i.gridlineStyle.propertyName]=t.gridlineStyle)),e.pushInstance(s))},f.prototype.enumerateValueAxis=function(e,t){var i,a,r,o,s,n;void 0===t&&(t="valueAxis"),this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isValueAxisSet&&!this.originalCartesianData.axesData.isValueAxisDisabled&&("y2Axis"===t&&2===this.type||(i={numberRange:{min:0,max:w.DataLabelViewModel.MaxLabelPrecision}},s=this.originalCartesianData.axesData.valueAxis,n="y2Axis"===t,a=w.cartesianChartProps.valueAxis,t={selector:null,properties:{},objectName:t,validValues:{axisScale:this.getAxisScaleOptions(!0),secAxisScale:this.getAxisScaleOptions(!0,!0),axisStyle:this.axes.valueAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly],secAxisStyle:this.axes.secondaryValueAxisHasUnitType?[w.axisStyle.showTitleOnly,w.axisStyle.showUnitOnly,w.axisStyle.showBoth]:[w.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1,secStart:this.featureSwitches.expressionBasedFormatting?3:1,secEnd:this.featureSwitches.expressionBasedFormatting?3:1}},n||(t.properties[a.show.propertyName]=s.show,t.properties[a.axisLabel.propertyName]=s.axisLabel,this.axes.isYAxisCategorical||(this.featureSwitches.switchAxisPosition?t.properties[a.switchAxisPosition.propertyName]=s.switchAxisPosition:t.properties[a.position.propertyName]=s.position),this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!0)?t.properties[a.logAxisScale.propertyName]=s.logAxisScale:t.properties[a.axisScale.propertyName]=s.axisScale,o=_.filter(s.includeDomains,function(e){return _.includes(e.domainSources,10)}),r=(o=(r=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,o||[]))&&r.domain||[void 0,void 0])[0],o=o[1],t.properties[a.start.propertyName]=r,t.properties[a.end.propertyName]=o,t.propertyTypes[a.start.propertyName]={numeric:!0},t.propertyTypes[a.end.propertyName]={numeric:!0},this.featureSwitches.invertAxis&&(t.properties[a.invertAxis.propertyName]=s.invertAxis),t.properties[a.labelColor.propertyName]=w.AxisDataModel.toColorFill(s.labelFontProperties.color),t.properties[a.fontSize.propertyName]=s.labelFontProperties.size.pt,t.properties[a.fontFamily.propertyName]=s.labelFontProperties.family,this.featureSwitches.enableBIU&&(t.properties[a.bold.propertyName]=s.labelBold,t.properties[a.italic.propertyName]=s.labelItalic,t.properties[a.underline.propertyName]=s.labelUnderline),7!==this.type&&8!==this.type&&(t.properties[a.labelDisplayUnits.propertyName]=s.labelDisplayUnits,t.properties[a.labelPrecision.propertyName]=s.labelPrecision,t.validValues[a.labelPrecision.propertyName]=i),this.featureSwitches.waterfallTotals&&13===this.type&&!this.hasBreakdownRole()&&(t.properties[a.totalsEnabled.propertyName]=s.totalsEnabled),t.properties[a.showAxisTitle.propertyName]=s.showAxisTitle,t.properties[a.showAxisTitle.propertyName]&&(t.properties[a.axisStyle.propertyName]=s.axisStyle,t.properties[a.titleColor.propertyName]=w.AxisDataModel.toColorFill(s.titleFontProperties.color),t.properties[a.titleText.propertyName]=s.titleText,t.properties[a.titleFontSize.propertyName]=s.titleFontProperties.size.pt,t.properties[a.titleFontFamily.propertyName]=s.titleFontProperties.family,this.featureSwitches.enableBIU&&(t.properties[a.titleBold.propertyName]=s.titleBold,t.properties[a.titleItalic.propertyName]=s.titleItalic,t.properties[a.titleUnderline.propertyName]=s.titleUnderline)),t.properties[a.gridlineShow.propertyName]=s.gridlineShow,s.gridlineShow&&(t.properties[a.gridlineColor.propertyName]=w.AxisDataModel.toColorFill(s.gridlineColor),t.properties[a.gridlineThickness.propertyName]=s.gridlineThickness,t.validValues.gridlineThickness=["1","2","3","4"],t.properties[a.gridlineStyle.propertyName]=s.gridlineStyle)),r=this.originalCartesianData.axesData.y2,n?t.properties[a.show.propertyName]=r.show:t.properties[a.secShow.propertyName]=r.show,(o=n||w.ComboChart.isComboChart(this.type)&&r.show)&&!n&&(t.properties[a.alignZeros.propertyName]=s.alignZeros,t.properties.secAxisLabel=""),n=_.filter(r.includeDomains,function(e){return _.includes(e.domainSources,10)}),s=(n=(s=w.AxisHelper.mergeScalarAxisDomains.apply(w.AxisHelper,n||[]))&&s.domain||[void 0,void 0])[0],n=n[1],t.properties[a.secStart.propertyName]=s,t.properties[a.secEnd.propertyName]=n,t.propertyTypes[a.secStart.propertyName]={numeric:!0},t.propertyTypes[a.secEnd.propertyName]={numeric:!0},o&&(this.featureSwitches.invertAxis&&(t.properties[a.secInvertAxis.propertyName]=r.invertAxis),this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!0,!0)?t.properties[a.secLogAxisScale.propertyName]=r.logAxisScale:t.properties[a.secAxisScale.propertyName]=r.axisScale,t.properties[a.secLabelColor.propertyName]=w.AxisDataModel.toColorFill(r.labelFontProperties.color),t.properties[a.secFontSize.propertyName]=r.labelFontProperties.size.pt,t.properties[a.secFontFamily.propertyName]=r.labelFontProperties.family,this.featureSwitches.enableBIU&&(t.properties[a.secBold.propertyName]=r.labelBold,t.properties[a.secItalic.propertyName]=r.labelItalic,t.properties[a.secUnderline.propertyName]=r.labelUnderline),t.properties[a.secLabelDisplayUnits.propertyName]=r.labelDisplayUnits,t.properties[a.secLabelPrecision.propertyName]=r.labelPrecision,t.validValues[a.secLabelPrecision.propertyName]=i),t.properties[a.secShowAxisTitle.propertyName]=r.showAxisTitle,o&&t.properties[a.secShowAxisTitle.propertyName]&&(t.properties[a.secAxisStyle.propertyName]=r.axisStyle,t.properties[a.secTitleColor.propertyName]=w.AxisDataModel.toColorFill(r.titleFontProperties.color),t.properties[a.secTitleText.propertyName]=r.titleText,t.properties[a.secTitleFontSize.propertyName]=r.titleFontProperties.size.pt,this.featureSwitches.enableBIU&&(t.properties[a.secTitleBold.propertyName]=r.titleBold,t.properties[a.secTitleItalic.propertyName]=r.titleItalic,t.properties[a.secTitleUnderline.propertyName]=r.titleUnderline),t.properties[a.secTitleFontFamily.propertyName]=r.titleFontProperties.family),e.pushInstance(t)))},f.prototype.onClearSelection=function(){this.hasSetData&&this.multiples.clearSelection(this.layout.getVisibleMultiples())},f.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},f.prototype.createLayers=function(){return this.layerFactory.createLayers({type:this.type,interactivityService:this.interactivityService,isScrollable:this.axes.isScrollable,tooltipsEnabled:this.tooltipsEnabled,featureSwitches:this.featureSwitches})},f.prototype.getLayerRendererInitOptions=function(e){var t=this;return{animator:e.animator,svg:e.axesRenderer.getLayerContainer(),labelsContext:e.axesRenderer.getDataLabelContainers().foreground,cartesianHost:{updateLegend:function(e){return t.legend.drawLegend(e,t.currentViewport,3===t.categoryAxisRenderMode)},triggerRender:function(e){return t.render(e,!1)}},scaleDetector:this.featureSwitches.removeScaleDetector?void 0:this.layout.svgScaleDetector,eventManager:this.eventManager,useManagedTabIndex:this.useManagedTabIndex()}},f.prototype.useManagedTabIndex=function(){return this.featureSwitches.cartesianMultiplesAccessibility&&this.isSmallMultiples()},f.MinScalarRectThickness=2,f.LoadMoreThreshold=1,f.xAxisSmallFontSizeInPx=9,f.yAxisSmallFontSizeInPx=9,f.yAxisMediumFontSizeInPx=11,f);function f(e){var r=this,t=!(this.getSelectorsByColumnSubSelectionCallback=function(e){switch(d3.select(e).attr(w.SubSelectableObjectNameAttribute)){case"data-labels":case"series-labels":return s.getLabelSelectorsByColumn(e);default:for(var t=0,i=r.getLayers();t<i.length;t++){var a=i[t];if(a.getSelectorsByColumnFromSubselectedElement)return a.getSelectorsByColumnFromSubselectedElement(e)}return{}}});this.trimOrdinalDataOnOverflow=!0,this.featureSwitches={},e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.type=e.chartType,this.featureSwitches=e.featureSwitches||{},void 0!==e.trimOrdinalDataOnOverflow&&(this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow),e.isScrollable&&(t=e.isScrollable),e.behaviorFactory&&(this.behaviorFactory=e.behaviorFactory)),this.hasAnimator=!(null==e||!e.animator),this.axes=new w.CartesianAxes(t,a.ScrollbarWidth,this.trimOrdinalDataOnOverflow),this.viewModelAdapterFactory=new w.ResponsiveCartesianAdapterFactory(this.featureSwitches.smallMultiplesResponsive),this.layerFactory=new T(this.type,this.viewModelAdapterFactory),this.layoutBuilder=new w.CartesianChartLayoutBuilder(e,this.behaviorFactory,this.featureSwitches,this.axes,this.type,function(){return r.isPlayAxis()},t,function(){return r.smallMultiplesViewModelAdapter}),this.multiples=new w.CartesianSmallMultiples(this.type,this.featureSwitches,function(){return r.createLayers()},function(e){return r.getLayerRendererInitOptions(e)})}w.CartesianChart=t;i.prototype.updateScrollCallbacks=function(e){this.scrollCallbacks=e},i.prototype.clearNavigationLayers=function(){this.navigationLayers=[]},i.prototype.addNavigationLayer=function(e){this.navigationLayers.push(e)},i.prototype.getFirstElement=function(){this.currentNavigationLayerIndex=0;var e,t=this.navigationLayers[this.currentNavigationLayerIndex].getFirstElement();return{element:e=t?t.element||this.getNextDataPoint(t.targetCategoryIndex,t.targetSeriesIndex,w.DataDirection.NextSeries).element:e}},i.prototype.getNextDataPoint=function(e,t,i){t=this.composeLayerPointInfo(e,t);return this.getNextDataPointWithStartData(t,i,t)},i.prototype.getNextDataPointWithStartData=function(i,a,r){var o=this,s=i.categoryIndex,n=i.seriesIndex,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getNextDataPoint(s,n,a),e=c.targetCategoryIndex,u=a===w.DataDirection.NextSeries||a===w.DataDirection.NextCategory,d=this.navigationLayers.length;if(1<d&&c.targetCategoryIndex!==s){var t=s,h=0,p=u?1:-1;do{switch(a){case w.DataDirection.NextSeries:case w.DataDirection.PreviousSeries:this.currentNavigationLayerIndex+=p,this.layerRollOverCheck(this.currentNavigationLayerIndex,d)?(this.currentNavigationLayerIndex=this.currentNavigationLayerIndex<0?d-1:0,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(e,!u),t=e=_.isFinite(c.targetCategoryIndex)?c.targetCategoryIndex:e,h++):(l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(t,!u));break;case w.DataDirection.NextCategory:case w.DataDirection.PreviousCategory:h=d}}while(!c.element&&h<d&&(!this.layerRollOverCheck(this.currentNavigationLayerIndex+p,d)||h<d-1))}if(!c.element&&null!=e&&this.shouldScroll(e)){this.getPendingFocusElement=function(){if(o.getPendingFocusElement=void 0,a===w.DataDirection.NextSeries?o.currentNavigationLayerIndex=0:a===w.DataDirection.PreviousSeries&&(o.currentNavigationLayerIndex=d-1),l=o.navigationLayers[o.currentNavigationLayerIndex],!(c=l.getNextDataPoint(s,n,a)).element)for(var e=o.currentNavigationLayerIndex;o.currentNavigationLayerIndex++,o.currentNavigationLayerIndex>=o.navigationLayers.length&&(o.currentNavigationLayerIndex=0),!(c=o.navigationLayers[o.currentNavigationLayerIndex].getNextDataPoint(s,n,a)).element&&o.currentNavigationLayerIndex!==e;);if(o.shouldFindNextPoint(c,i,r,u)){var t=o.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex);return o.getNextDataPointWithStartData(t,a,r).element}return c.element};var g=e-s;g<0?this.scrollCallbacks.scrollTo(e):this.scrollCallbacks.scrollBy(g)}else if(this.shouldFindNextPoint(c,i,r,u)){g=this.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex);return this.getNextDataPointWithStartData(g,a,r)}return c},i.prototype.shouldScroll=function(e){return!!this.scrollCallbacks&&this.scrollCallbacks.shouldScrollTo(e)},i.prototype.layerRollOverCheck=function(e,t){return t<=e||e<0},i.prototype.composeLayerPointInfo=function(e,t){return{categoryIndex:e,seriesIndex:t,layerIndex:this.currentNavigationLayerIndex}},i.prototype.shouldFindNextPoint=function(e,t,i,a){if(e.element&&!e.noShape||null===e.targetCategoryIndex||null===e.targetSeriesIndex)return!1;var r=this.composeLayerPointInfo(e.targetCategoryIndex,e.targetSeriesIndex);switch(this.compareLayerPointInfo(i,r,a)){case 1:if(0<=this.compareLayerPointInfo(t,r,a)&&0<this.compareLayerPointInfo(i,t,a))return!1;break;case 0:return!1;case-1:if(0<this.compareLayerPointInfo(i,t,a))return!1;if(0<=this.compareLayerPointInfo(t,r,a))return!1}return!0},i.prototype.compareLayerPointInfo=function(e,t,i){return e.categoryIndex>t.categoryIndex?i?1:-1:e.categoryIndex<t.categoryIndex?i?-1:1:e.seriesIndex>t.seriesIndex?i?1:-1:e.seriesIndex<t.seriesIndex?i?-1:1:e.layerIndex>t.layerIndex?i?1:-1:e.layerIndex<t.layerIndex?i?-1:1:0},t=i;function i(){this.navigationLayers=[],this.currentNavigationLayerIndex=0}w.CartesianChartNavigationHelper=t;var h=(n.prototype.processDataView=function(e,t){var i,a,r,o,s;this.renderModes=[],e&&e.metadata&&e.categorical&&!_.isEmpty(e.categorical.categories)?(o=e.metadata,r=e.categorical.categories,i=_.head(r),a=w.ScalarUtils.getScalarKeys(i),s=w.CartesianHelper.hasCategoryHierarchy(e),a=w.ScalarUtils.shouldDrawScalar(o.objects,w.columnChartProps.categoryAxis.axisType,i.source.type,a,s),s?(s=n.areNonLeafLevelsFilteredToUniqueValue(r),r=B.DataViewObjects.getValue(o.objects,w.cartesianChartProps.categoryAxis.concatenateLabels,w.CartesianHelper.DefaultConcatenateLabelsValue),s&&r?this.renderModes.unshift(1):(o=n.isSortedByCategoryFirst(e),e=_.some(e.categorical.categories,function(e){return e.source&&e.source.identityExprs}),s=t&&!r&&e&&(o||s||this.easierHierarchicalAxis),this.renderModes.unshift(2),s&&this.renderModes.unshift(3),r||e||(this.warnings=[{selector:null,warnings:[new w.NoIdentityExprWarning]}]))):this.renderModes.unshift(1),a&&this.renderModes.unshift(0)):this.renderModes.push(2)},n.prototype.getRenderMode=function(){return _.head(this.renderModes)},n.prototype.getRenderModes=function(){return this.renderModes},n.prototype.addObjectWarnings=function(e){this.warnings&&e.push.apply(e,this.warnings||[])},n.isSortedByCategoryFirst=function(e){return!(!e||!e.categorical||_.isEmpty(e.categorical.categories)||!e.metadata||_.isEmpty(e.metadata.columns))&&_.every(e.categorical.categories,function(e,t){e=e.source;return e&&null!=e.sort&&e.sortOrder===t})},n.areNonLeafLevelsFilteredToUniqueValue=function(e){if(_.isEmpty(e))return!1;for(var t=e.length-1,i=0;i<t;i++){var a=e[i].source;if(!a||!B.DataViewObjects.getValue(a.objects,w.cartesianChartProps.filters.filteredToUniqueValue,!1))return!1}return!0},n);function n(e,t,i){this.easierHierarchicalAxis=i,this.processDataView(e,t)}w.CartesianAxisRenderModeSelector=h;var a=(D.filterDataToViewport=function(e){if(e&&e.scrollScale){var t=e.scrollScale,i=e.mainAxisScale,a=w.AxisHelper.invertOrdinalScale(t,e.extent.start),r=a+e.visibleCategoryCount,p=t.domain().slice(a,r);if(!_.isEqual(p,i.domain())){if(p&&0<p.length){for(var o=0,s=e.layers;o<s.length;o++)s[o].setFilteredData(p[0],p[p.length-1]+1);i.domain(p);var g=e.axesLayout.axes,t=void 0;(t=e.axesLayout.isXScrollBarVisible?g.x:g.y1).axis.scale(i),t.scale(i),t.axis.ticks(p.length),t.axis.tickValues(p);var n=w.SvgCartesianAxes.getTickFormatter(t.axis);if(t.values=_.map(p,function(e){return n(e)}),!_.isEmpty(g.xStack))for(var y=e.axesLayout.tickLabelMargins,m=w.CartesianAxes.getLeafHeight(y.xMax,y.stackHeight,g.xStack.length),l=0;l<g.xStack.length;l++)!function(e){var t=g.xStack[e],i=w.AxisHelper.getCategoryThickness(t.scale),a=t.values,r=D.setLabelsAtEdges(p,a);if(t.axis.ticks(p.length),t.axis.tickValues(p),t.axis.tickFormat(function(e){e=a[r[p.indexOf(e)]];return e===w.CartesianAxes.hierarchyPlaceholder?"":_.isString(e)?e:e+""}),0===e)return;for(var o=[],s=[],n=[],l=void 0,c=0;c<r.length;c++){var u,d=p[c],h=r[c];t.values[h]!==w.CartesianAxes.hierarchyPlaceholder?(null!=l&&(o[l]=w.CartesianAxes.getMaxCategoryWidth(u=d-l,i),s[l]=w.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:y.stackHeight,leafHeight:m,categorySpanCount:u,categoryWidth:i})),n[d]=a[h],l=d):n[d]=w.CartesianAxes.hierarchyPlaceholder}null!=l&&(u=p[r.length-1]-l+1,o[l]=w.CartesianAxes.getMaxCategoryWidth(u,i),s[l]=w.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:y.stackHeight,leafHeight:m,categorySpanCount:u,categoryWidth:i})),t.xLabelMaxWidths=o,t.lineStyleInfo=s,t.adjustedValues=n}(l)}return{startIndex:a,endIndex:r-1}}}},D.prototype.destroy=function(){this.scrollbar.remove()},D.prototype.render=function(e,t,i,a,r,o,s,n,l,c){var u=this,d=e.plotArea;this.axisScale=null;var h=e.isXScrollBarVisible||e.isYScrollBarVisible,p=w.CartesianChartConverter.isLineComboChart(l)?w.CartesianChartConverter.getMaximumSeriesSettings(t):w.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings(),g=e.margin,y=!0;w.ComboChart.isComboChart(l)&&!c&&(y=!1);var m,v,f,S,x,b,C,c=e.viewport.width-(g.left+g.right),y=p.seriesPosition===w.labelSeriesPosition.right?g.left:g.left+this.getSeriesWidth(c,p,y);if((s||h)&&(C=(b=(x=this.cartesianAxes.isYAxisCategorical?(this.axisScale=e.axes.y1.scale,m=e.viewport.width,v=e.margin.top,C=e.axes.y1.categoryThickness,f=e.axes.y1.outerPaddingRatio,S=e.axes.y1.innerPaddingRatio,b=C*f,d.height):(this.axisScale=e.axes.x.scale,m=y,v=e.viewport.height,C=e.axes.x.categoryThickness,f=e.axes.x.outerPaddingRatio,S=e.axes.x.innerPaddingRatio,b=C*f,d.width),Math.max(1,B.Double.floorWithPrecision((x-2*b)/C))),x)),!h)return s&&(s.resetViewport(b),s.shouldLoadMoreData()&&s.loadMoreData()),this.scrollbar.remove(),void a(t,e,i,this.animateCategoryAxis,this.animateValueAxis,r);this.scrollScale=this.axisScale.copy(),this.scrollScale.range([0,C]).paddingInner(.1).paddingOuter(0),this.extentLength=this.scrollScale(b-1)+this.scrollScale.bandwidth(),this.scrollHandler=new A({visibleScale:this.axisScale,fullScale:this.scrollScale,onScroll:function(e){e=u.scrollScale(e);u.scrollbar.setExtent({start:e,end:null}),u.scrollbar.refreshExtentAndVisual()}}),this.axisScale.range([0,x]).paddingInner(S).paddingOuter(f),this.scrollbar.setOrientation(e.isXScrollBarVisible),this.scrollbar.setScale(this.scrollScale,n),this.scrollbar.scrollBarLength=C,this.scrollbar.setExtentLength(this.extentLength),o||this.scrollbar.setExtent({start:0,end:null}),this.renderVisualOptions={axesLayout:e,layers:t,categoryLoadMoreDataHandler:s,mainAxisScale:this.axisScale,renderDelegate:a,scrollScale:this.scrollScale,visibleCategoryCount:b,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis};this.scrollbar.render(m,v,function(){return u.onRefreshVisual(function(e,t){return D.renderVisual(u.renderVisualOptions,e,t,r)})}),o&&s?(s=s.viewportDataRange?s.viewportDataRange.startIndex:0,this.scrollTo(s)):D.renderVisual(this.renderVisualOptions,this.scrollbar.getExtent(),i,r)},D.prototype.getSeriesWidth=function(e,t,i){return t&&t.show&&i?t.seriesMaximumWidth/100*e:0},D.prototype.scrollDelta=function(e){this.scrollHandler.scrollDelta(e)},D.prototype.scrollTo=function(e){this.scrollHandler.scrollTo(e)},D.prototype.shouldScrollTo=function(e){if(!this.scrollHandler)return!1;var t=this.axisScale.domain();return!_.isEmpty(t)&&(e<t[0]||e>t[t.length-1])},D.prototype.setExtent=function(e){this.scrollbar.setExtent(e),this.scrollbar.refreshExtentAndVisual()},D.prototype.scrollBy=function(e){var t=this.axisScale.domain();_.isEmpty(t)||this.scrollHandler.scrollTo(t[0]+e)},D.prototype.clearRenderingTimeout=function(){this.scrollbar&&this.scrollbar.clearRenderingTimeout()},D.prototype.onRefreshVisual=function(e){e(this.scrollbar.getExtent(),!0)},D.setLabelsAtEdges=function(e,t){if(e.length<=1||t[e[0]]!==w.CartesianAxes.hierarchyPlaceholder)return e;var i=e[0],e=e.slice();if(i<t.length&&0<=i){for(;t[i]===w.CartesianAxes.hierarchyPlaceholder&&0<=i;i--);e[0]=i}return e},D.renderVisual=function(e,t,i,a){var r=D.filterDataToViewport({mainAxisScale:e.mainAxisScale,layers:e.layers,scrollScale:e.scrollScale,extent:t,visibleCategoryCount:e.visibleCategoryCount,axesLayout:e.axesLayout,animateCategoryAxis:e.animateCategoryAxis,animateValueAxis:e.animateValueAxis});r&&(e.categoryLoadMoreDataHandler&&((t=e.categoryLoadMoreDataHandler).viewportDataRange=r,t.shouldLoadMoreData()&&t.loadMoreData()),e.renderDelegate(e.layers,e.axesLayout,i,e.animateCategoryAxis,e.animateValueAxis,a))},D.ScrollbarWidth=10,D);function D(e,t,i,a){this.cartesianAxes=e,this.scrollbar=t,this.animateCategoryAxis=i,this.animateValueAxis=a}w.ScrollableAxes=a;var A=(r.prototype.scrollDelta=function(e){_.isEmpty(this.visibleScale.domain())||(this.totalScrollDistance<0&&0<e||0<this.totalScrollDistance&&e<0?this.totalScrollDistance=e:this.totalScrollDistance+=e,e=r.getStepSize(this.visibleScale),Math.abs(this.totalScrollDistance)>=e?(this.extendScrollTimeout&&this.extendScrollTimeout.cancel(),e=this.getNewStartIndex(this.totalScrollDistance),this.scrollTo(e),this.totalScrollDistance=0):this.extendScrollTimeout())},r.prototype.scrollTo=function(e){e=this.clampIndex(e);this.onScroll(e)},r.getStepSize=function(e){var t=_.map(e.domain(),e);if(1<t.length)return t[1]-t[0];e=e.range();return e[1]-e[0]},r.prototype.getNewStartIndex=function(e){var t=0<=e;e=t?e:-e;var i=this.visibleScale,a=_.map(i.domain(),i),r=i.domain(),o=r[0],e=a[0]+e;return(t?1:-1)*(i.range()[1]<e?r.length:w.AxisHelper.invertOrdinalScale(i,e)-o)+o},r.prototype.clampIndex=function(e){var t=this.fullScale.domain(),i=_.head(t),t=_.last(t);return Math.max(i,Math.min(t,e))},r.prototype.onTimeout=function(){this.totalScrollDistance=0},r.defaultTimeoutMs=1e3,r);function r(e){e.visibleScale,e.fullScale,e.onScroll,this.visibleScale=e.visibleScale,this.fullScale=e.fullScale,this.onScroll=e.onScroll;e=jsCommon.Utility.valueOrDefault(e.timeout,r.defaultTimeoutMs);this.extendScrollTimeout=_.debounce(this.onTimeout,e),this.totalScrollDistance=0}w.AxisScrollHandler=A;var c=(d.prototype.create=function(e,t){e=__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(2,e)}}});return new w.ScatterChart(e)},d);function d(){this.categoryAxisTitleOnByDefault=!0,this.valueAxisTitleOnByDefault=!0}var p=(m.prototype.create=function(e,t){e=__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(3,e)}}});return new w.WaterfallChart(e)},m);function m(){}var v=(S.prototype.create=function(e,t){return new w.DataDotChart(e)},S);function S(){}var x=(b.prototype.create=function(e,t){e={interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches,chartType:this.type,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(5,e)}}};return new w.ColumnChart(e)},b);function b(e){this.type=e}var C=(P.prototype.create=function(e,t){return new w.Histogram(e)},P);function P(){}var L=(M.prototype.create=function(e,t){e={interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,chartType:this.type,featureSwitches:e.featureSwitches,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(0,e)}}};return this.inComboChart&&(e.chartType=8|e.chartType),new w.LineChart(e)},M);function M(e,t){this.type=e,this.inComboChart=t}var V=(F.prototype.create=function(e,t){return e.isScrollable=!1,new w.RealTimeLineChart(e)},F);function F(){}var T=(I.prototype.createLayers=function(e){var t=this,i={isScrollable:null!=e.isScrollable&&e.isScrollable,interactivityService:e.interactivityService,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches};return _.map(this.layerMetadata,function(e){return e.create(i,t.viewModelAdapterFactory)})},I.initLayerMetadata=function(e){var t=[];switch(e){case 1:t.push(new L(2,!1));break;case 0:t.push(new L(1,!1));break;case 2:t.push(new L(16,!1));break;case 18:t.push(new V);break;case 10:t.push(new c);break;case 13:t.push(new p);break;case 12:t.push(new v);break;case 4:t.push(new x(20));break;case 3:t.push(new x(12));break;case 8:t.push(new x(52));break;case 6:t.push(new x(18));break;case 5:t.push(new x(10));break;case 7:t.push(new x(50));break;case 9:t.push(new x(68));break;case 11:var i=I.getComboColumnType();t.push(new x(i)),t.push(new L(1,!0));break;case 14:t.push(new x(12)),t.push(new L(1,!0));break;case 15:t.push(new x(20)),t.push(new L(1,!0));break;case 16:t.push(new x(12)),t.push(new v);break;case 17:t.push(new x(20)),t.push(new v);break;case 19:t.push(new C)}return t},I.getComboColumnType=function(e){var t=12;if(e){var i=e.general;if(i){switch(i.visualType1){case"Column":t=12;break;case"ColumnStacked":t=20;break;default:i.visualType1}i.visualType2&&i.visualType2}}return t},I);function I(e,t){this.viewModelAdapterFactory=t,this.layerMetadata=I.initLayerMetadata(e)}var k=(O.prototype.getAllColors=function(){return this.palette.getAllColors()},O.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},O.prototype.getNewColorScale=function(){return this.preferredScale},O.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},O.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},O.prototype.getGradientColors=function(){return this.palette.getGradientColors()},O.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},O.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},O.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},O.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))},O);function O(e){this.palette=e,this.clearPreferredScale()}w.SharedColorPalette=k;var N=(R.prototype.update=function(e,t){this.enabled=!t&&0!==e},R.prototype.resetViewport=function(e){this.viewportDataRange={startIndex:0,endIndex:e}},R.prototype.setScale=function(e){e=e&&e.domain&&e.domain().length;e&&(this.loadMoreThresholdIndex=e-1-this.loadMoreThreshold)},R.prototype.isLoadingMoreData=function(){return this.loadingMoreData},R.prototype.onLoadMoreDataCompleted=function(){this.loadingMoreData=!1},R.prototype.shouldLoadMoreData=function(){var e=this.viewportDataRange;return!(!this.enabled||!e||this.isLoadingMoreData())&&e.endIndex>=this.loadMoreThresholdIndex},R.prototype.loadMoreData=function(){return this.shouldLoadMoreData(),this.isLoadingMoreData()?e.WaitingForData:(this.loadingMoreData=!0,this.hostServices.loadMoreData(),e.TriggeredLoadMore)},R);function R(e,t,i){void 0===i&&(i=0),this.enabled=!1,this.loadMoreThreshold=i,this.hostServices=t,this.setScale(e)}w.CartesianCategoryLoadMoreDataHandler=N}(B.visuals||(B.visuals={}))}(powerbi=powerbi||{}),function(e){!function(u){var a=jsCommon.BrowserUtils,s={rectangle:{name:"rectangle",directionMode:0},centerBasedRectangle:{name:"centerBasedRectangle",directionMode:1},edgeBasedRectangle:{name:"edgeBasedRectangle",directionMode:2}},e=(t.prototype.create=function(){var e=this.behaviorFactories.map(function(e){return e.create()});return new i(e,this.featureSwitches)},t);function t(e,t){this.behaviorFactories=e,this.featureSwitches=t}u.CartesianChartBehaviorFactory=e;var i=(c.prototype.bindEvents=function(e,t,i,a){for(var r,o,s=this.behaviors,n=0,l=s.length;n<l;n++)s[n].bindEvents(e.layerOptions[n],t,i,a);this.axesLayout=e.axesLayout,this.categorySubRangeCount=e.categorySubRangeCount,this.verticalCategoryAxis=e.verticalCategoryAxis,this.selectionHandler=t,a?e.clearCatcher.on("click",null):e.clearCatcher.on("click",function(){u.InteractivityUtils.handleClearSelection(t)}),i&&(r=i.dataPointNavigationManager,o=i.pointSourceKey,r.isEmpty(o)||this.registerFocusKeyHandler(e.root,e.layerOptions))},c.prototype.renderSelection=function(e){for(var t=0,i=this.behaviors;t<i.length;t++)i[t].renderSelection(e)},c.prototype.renderFocus=function(e){for(var t=0,i=this.behaviors;t<i.length;t++)i[t].renderFocus(e)},c.prototype.lassoSelectRect=function(e,t){var i=[],a=this.getLassoSelectDirectionMode(),r=this.getScaledRegion(t,a);if(void 0!==a){for(var o=0,s=this.behaviors;o<s.length;o++){var n,l=s[o];l.lassoSelectRectLayer&&l.getLassoSelectDirectionMode&&(n=l.getLassoSelectDirectionMode(),(n=c.getRectResultKeys(n)).length,n=r[n[0]],i.push.apply(i,l.lassoSelectRectLayer(n)))}u.InteractivityUtils.lassoSelectPoints(e,i,this.selectionHandler)}},c.prototype.getLassoSelectDirectionMode=function(){for(var i=[],e=0,t=this.behaviors;e<t.length;e++)!function(e){var t;e.getLassoSelectDirectionMode&&(t=e.getLassoSelectDirectionMode(),_.some(i,function(e){return e===t})||i.push(t))}(t[e]);if(0!==i.length)return 1===i.length?i[0]:3},c.getRectResultKeys=function(e){return 0===e?[s.rectangle.name]:1===e?[s.centerBasedRectangle.name]:2===e?[s.edgeBasedRectangle.name]:[s.centerBasedRectangle.name,s.edgeBasedRectangle.name]},c.prototype.getScaledRegion=function(e,t){for(var i={},a=0,r=c.getRectResultKeys(t);a<r.length;a++){var o=r[a];i[o]={dataSpace:this.getScaledRegionInternal(e,s[o].directionMode),pixelValue:e}}return i},c.prototype.getScaledRegionInternal=function(e,t){var i=e.left-this.axesLayout.margin.left,a=e.top-this.axesLayout.margin.top,r=e.right-this.axesLayout.margin.left,o=e.bottom-this.axesLayout.margin.top,s=2===t?this.categorySubRangeCount:void 0,n=0===t||this.verticalCategoryAxis?0:-1,l=0===t||this.verticalCategoryAxis?0:1,c=0!==t&&this.verticalCategoryAxis?-1:0,e=0!==t&&this.verticalCategoryAxis?1:0,l={left:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,l,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,i,n,t,s),top:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,o,e,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,a,c,t,s),right:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,i,n,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,l,t,s),bottom:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,a,c,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,o,e,t,s)};return this.axesLayout.axes.y2&&_.assign(l,{top2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,o,e,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,a,c,t,s),bottom2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,a,c,t,s):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,o,e,t,s)}),l},c.prototype.registerFocusKeyHandler=function(e,i){e.on("keydown.cartesian",function(){var e,t=d3.event;27===t.keyCode&&_.some(i,function(e){return $.contains(e.root.node(),t.target)})&&(t.preventDefault(),t.stopPropagation(),e=_.find(i,function(e){return $(e.root.node()).is(":tabbable")}),a.focus(e.root.node()))})},c);function c(e,t){this.behaviors=e}u.CartesianChartBehavior=i}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(le){!function(se){var e=(Object.defineProperty(ne.prototype,"displayNames",{get:function(){var e;return this._displayNames||(e=this.options.hostServices,this._displayNames={negative:e.getLocalizedString("Visual_TotalTooltipNegative"),positive:e.getLocalizedString("Visual_TotalTooltipPositive"),net:e.getLocalizedString("Visual_TotalTooltipNet"),simple:e.getLocalizedString("Visual_Total")}),this._displayNames},enumerable:!1,configurable:!0}),ne.prototype.convert=function(e){var t=(this.options=e).dataView,i=e.style,a=e.is100PercentStacked,r=void 0!==a&&a,o=e.isScalar,s=void 0!==o&&o,n=e.dataViewMetadata,l=void 0===n?null:n,c=e.multipleInfo,u=e.chartType,d=e.interactivityService,h=e.tooltipsEnabled,p=void 0===h||h,g=e.hostServices,y=e.ribbonChart,m=e.isCombo,v=e.buildCategories,f=e.supportsTotalLabels,S=se.CartesianHelper.getCategoryAxisProperties(l,!1),x=se.CartesianHelper.getPreferredCategoryWidth(S),s=se.CartesianHelper.isScalar(s,S),b=t.categorical,a=new k(t,i),o=se.converterHelper.getPivotedCategories(b,se.columnChartProps.general.formatString,v),n=o.categories,h=o.categoryFormatter,e=se.CartesianHelper.getScalarKeyinfo(b,s).category.source,S=se.ColumnChart.getDefaultColumnLabelSettings(i,m);l&&l.objects&&(w=l.objects.labels,se.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(w,S,!se.ColumnChart.isBar(u),i,m));var C,v=__assign(__assign({},S),{show:!1});f&&l&&l.objects&&((A=l.objects.totals)&&se.DataLabelViewModel.updateLabelSettingsFromLabelsObject(A,v,!1,i,m)),this.totalLabelsSettings=v,y&&(C=se.ColumnChart.getRibbonsUtils().getRibbonOptionsFromDataviewObjects(l,se.columnChartProps));var w,o=a.getLegend(),b=o.legend.dataPoints,D=o.seriesSources,A=se.ColumnChart.getDefaultLineChartSeriesLabelSettings(i);l&&l.objects&&(w=l.objects.seriesLabels,se.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(w,A,i,m),A.defaultSeriesWidth=A.defaultSeriesWidth?-1:null,A.seriesMaximumWidth=A.defaultSeriesWidth?-1:A.seriesMaximumWidth);g=this.createDataPoints({dataView:t,categories:n,legend:b,converterStrategy:a,defaultDataLabelsSettings:S,defaultSeriesSettings:A,totalLabelsSettings:v,is100PercentStacked:r,isScalar:s,isCombo:!!m,style:i,chartType:u,categoryMetadata:e,multipleInfo:c,tooltipsEnabled:p,ribbonChart:y,hostServices:g,ribbonOptions:C,supportsTotalLabels:f}),f=g.series;se.canSupportOutsidePosition(u,f.length)?null!=S.position&&_.includes(se.clusteredValidLabelPositionOptions,S.position)||(S.position=se.labelPosition.auto):null!=S.position&&_.includes(se.stackedValidLabelPositionOptions,S.position)||(S.position=se.labelPosition.auto);for(var P,L=[],M=0,V=b.length;M<V;M++)L.push(D[M]);if(d){for(var F=0,T=f;F<T.length;F++){var I=T[F];d.applySelectionStateToData(I.data)}d.applySelectionStateToData(o.legend.dataPoints)}return i.isHighContrast&&(P={visible:!0,color:se.ColorHelper.getThemeColor(i,se.ForegroundColorName),width:se.CartesianHelper.defaultLineStrokeWidth}),{categories:n,categoryIdentities:g.categoryIdentities,categoryFormatter:h,preferredCategoryWidth:x,series:f,totals:g.totals,hasPositive:g.hasPositive,hasNegative:g.hasNegative,hasNetPositive:g.hasNetPositive,hasNetNegative:g.hasNetNegative,hasY2Role:le.data.DataRoleHelper.hasRoleInDataView(t,"Y2"),valuesMetadata:L,legendData:o.legend,hasHighlights:g.hasHighlights,valuesMetadataBySeries:g.valuesMetadataBySeries,categoryMetadata:e,scalarCategoryAxis:s,dataLabelsSettings:S,seriesLabelSetings:A,totalLabelsSettings:v,hasDynamicSeries:g.hasDynamicSeries,isMultiMeasure:g.isMultiMeasure,ribbonChartData:y?{ribbonChartDataPoints:g.ribbonChartDataPoints,ribbonOptions:C}:void 0,strokeSettings:P,multipleIdentity:g.multipleIdentity}},ne.prototype.createDataPoints=function(O){var N=this,R=O.dataView,B=R.categorical,H=se.columnChartProps.general.formatString,U=se.cartesianRoleNames.y,z=le.data.createDataViewCategoricalReaderAdvanced(R,{staticSeriesRoleNames:[U],colorOptions:{valueRole:U,visualStyle:O.style},formatStringProp:H,errorRangeProp:se.ErrorObjectProps.errorRange}),j=B&&B.values?B.values.grouped():void 0,E=O.categories.length,W=z.data.hasValues(U)?z.data.getSeriesCount():void 0,G=[],Y=[],X=O.chartType,l=se.ColumnChart.isStacked(X,W);if(W<1||E<1)return{series:G,totals:Y,hasPositive:!1,hasNegative:!1,hasNetPositive:!1,hasNetNegative:!1,valuesMetadataBySeries:[],categoryIdentities:[],ribbonChartDataPoints:null,hasHighlights:!1,hasDynamicSeries:!1,isMultiMeasure:!1};var e,K,Z,t=B.categories,i=(O.categoryMetadata,_.isEmpty(t)?null:_.last(t).source),i=se.AxisHelper.getCategoryValueType(i),q=se.AxisHelper.isDateTime(i),$=[],a=[],J=[],Q=[],ee=[],c=[],te=!(!B.values||!B.values.source),i=!te&&1<W,ie=O.multipleInfo;ie&&(K=_.first(ie.sources).metadata.queryName,Z=ie.sources.map(function(e){return se.buildValueDetailsForColumnValue(e.metadata,e.value,ie.identity)}),e=(new se.SelectionIdBuilder).withColumnIdentity(ie.identity,K,Z).createSelectionId());for(var ae=!1,re=z.data.hasHighlights(),r=O.converterStrategy,o=0;o<W;o++){for(var s=[],n=[],u=0;u<E;u++){var d,h=r.getValueBySeriesAndCategory(o,u),p=r.getFormatStringBySeriesAndCategory(o,u);s[u]={value:h,formatString:p},re&&(d=r.getHighlightBySeriesAndCategory(o,u),p=r.getHighlightFormatStringBySeriesAndCategory(o,u),n[u]={value:d,formatString:p},0<=h&&0<=d&&le.Double.greaterOrEqualWithPrecision(h,d)||h<=0&&d<=0&&le.Double.lessOrEqualWithPrecision(h,d)||(ae=!0))}$.push(s),re&&a.push(n)}ae&&!se.canSupportOutsidePosition(X,W)&&(re=ae=!1,$=a);for(var g=function(P){var L=[],e=O.legend[P],t=void 0,i=void 0;(z.data.hasSeries()||O.isCombo)&&(a=void 0,r=(a=O.isCombo&&!z.data.hasSeries()?z.objects.getValueMetadataObjects(U,P):z.objects.getSeriesDataObjects(P))&&a.labels,o=a&&a.seriesLabels,r&&(t=le.Prototype.inherit(O.defaultDataLabelsSettings),se.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(r,t,void 0,O.style,O.isCombo)),o&&(i=le.Prototype.inherit(O.defaultSeriesSettings),se.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(o,i,O.style,O.isCombo)));var a=e.color,r=z.columns.getValueColumnBySeries(P),M=Q[P]=z.columns.getValueMetadataColumn(U,P),o=i||O.defaultSeriesSettings,i=_.findIndex(Q,M);-1!==i&&(c[i]?c[i].usedInSeriesIndices.push(P):c[i]={metadataColumn:M,usedInSeriesIndices:[P],valueSelector:(new se.SelectionIdBuilder).withMeasure(M.queryName,r).createSelectionId()});var V=se.UncertaintyHelper.convertErrorMetadata(l?{}:M.objects,O.style,a,P,__assign(__assign({},O.defaultDataLabelsSettings),{show:!1}),{isCombo:O.isCombo,hideBand:!0,valueAxisHorizontal:se.ColumnChart.isBar(X),staticObjects:z.objects.getStaticObjects()}),F=V.hasUncertainty,o={displayName:e.label,key:"series"+P,index:P,data:L,identity:e.identity,color:a,labelSettings:t,uncertainty:V,type:M.type,seriesSettings:o};G.push(o);for(var T=se.GradientUtils.getGradientMeasureIndex(B),I=se.GradientUtils.getGradientValueColumn(B),k=se.valueFormatter.getLocalizedString("Percentage"),s=function(l){var c=se.AxisHelper.normalizeNonFiniteNumber($[P][l].value),u=$[P][l].formatString;if(null==c&&0<P)return"continue";var d=c,e=O.categories[l];if(q&&null!=e&&!(e instanceof Date))return"continue";var h,t=void 0,t=e instanceof Date?le.FeatureSwitchedDate.getEpochTimeStamp(oe.options.featureSwitches.utcDates,e):e;if(O.isScalar&&(null==t||isNaN(t)))return"continue";F&&(h=se.UncertaintyHelper.convertCategoricalDataPoint(z.data,l,P,c));var i=void 0,p=O.is100PercentStacked;p&&(i=se.StackedUtil.getStackedMultiplier(_.map($,function(e){return _.map(e,function(e){return e.value})}),l));var a=c;ee[P]||(ee[P]=[]);var r=ee[P][l]=c<0;i&&(c*=r?i.neg:i.pos),Y[l]||(Y[l]={positive:0,negative:0,net:0,categoryValue:t,categoryIndex:l});var o=oe.totalLabelsSettings.fontProperties.color;Y[l].labelFill=se.DataLabelUtil.determineTotalLabelFillColor(o,z,l,P);var g=Math.abs(c),s=void 0;r?(s=Y[l].negative,isNaN(g)||(Y[l].negative-=g,Y[l].net-=g)):(isNaN(g)||(Y[l].positive+=g,Y[l].net+=g),s=Y[l].positive);var n=j&&j.length>P&&j[P].values?j[P]:null,y=_.isEmpty(B.categories)?null:B.categories[0],m=z.columns.getValueColumn(U,P),v=ne.createIdentities(B,y,l,n,m,M,ie,K,Z),f=v.identity,S=v.identityKey;J[l]||(J[l]=function(){return se.CartesianHelper.getCategoryIdentity(l,y)});var x,b,C,w,D,e=z.colors.createBySeries(P,l),A=0===T?null:I,o=void 0,n=void 0,m=void 0;re&&(x=z.data.getHighlight(U,l,P),b=z.data.getHighlightFormatString(U,l,P),o=null!==(w=x)?(F&&(C=se.UncertaintyHelper.convertCategoricalDataPoint(z.data,l,P,x,!0)),p&&(x*=0<x?i.pos:i.neg),Math.abs(x)):0,n=function(e,t,i,a,r){0<i?e-=a-r:(null===i||0===i)&&0<t&&(e-=a);return e}(s,c,x,g,o),m=se.SelectionId.createWithHighlight(f)),O.tooltipsEnabled&&(D=new se.LazyTooltipBuilder).withLazyValues(function(){var e,t=[];!ie||(e=se.TooltipBuilder.withMultipleColumnAndValues(ie.sources.map(function(e){return e.metadata}),ie.sources.map(function(e){return e.value}),!0,se.FormattingStrategies.defaultFormatter(H)))&&t.push(e()),y&&(s=se.CategoryLevelUtils.getCategoryLevels(R.categorical.categories,l,H),i=se.CategoryLevelUtils.concatenateCategoryLevels(s),132===X&&(i=se.Histogram.buildTooltipCategories(s,l,E)),t.push({displayName:i.displayName,value:i.value})),te&&(y&&y.source===B.values.source||t.push({displayName:B.values.source.displayName,value:se.converterHelper.formatFromMetadataColumn(j[P].name,B.values.source,H)}));var i,a,r,o,s=function(e){return se.converterHelper.formatFromMetadataColumn(e,M,H,!1,u)};null!=d&&(i=void 0,a=s(d),i=p?a+" ("+se.valueFormatter.format(g,k)+")":a,a=V.tooltips,F&&!re&&a.show&&a.format===se.errorFormat.range?(void 0===(r=se.UncertaintyHelper.getTooltipItems(h,c,V,s,O.hostServices,{overrideDisplayName:M.displayName}))||r.length,_.isEmpty(r)?t.push({displayName:M.displayName,value:i}):t.push(r[0])):t.push({displayName:M.displayName,value:i})),re&&(s=function(e){return se.converterHelper.formatFromMetadataColumn(e,M,H,!1,b)},(o=function(e,t,i,a,r,o,s){var n;{var l;null!=e&&null!=t&&(l=se.valueFormatter.format(t,a),n=se.converterHelper.formatFromMetadataColumn(e,r,o,!1,i),l=n+" ("+l+")")}if(s)return l;return n}(w,x,b,k,M,H,p))&&(a=V.tooltips,F&&a.show&&a.format===se.errorFormat.range?(void 0===(r=se.UncertaintyHelper.getTooltipItems(h,c,V,s,O.hostServices,{overrideDisplayName:se.ToolTipComponent.localizationOptions.highlightedValueDisplayName}))||r.length,_.isEmpty(r)?t.push({displayName:se.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:o}):t.push(r[0])):t.push({displayName:se.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:o}))),!F||V.tooltips.format===se.errorFormat.range||(o=re?C:h)&&t.push.apply(t,se.UncertaintyHelper.getTooltipItems(o,d,V,s,O.hostServices,{hideMarker:!0})),A&&null!=A.values[l]&&(n=le.DataViewObjects.getValue(null===(n=A.objects)||void 0===n?void 0:n[l],H),t.push({displayName:A.source.displayName,value:se.converterHelper.formatFromMetadataColumn(A.values[l],A.source,H,!1,n)})),se.TooltipBuilder.addTooltipMeasures(z,t,l,te?P:void 0,H);var n=N.getTotalTooltip(P,l,ee,Y,Q,H);return n&&t.push(n),t});v=G[P],i=v.labelSettings||O.defaultDataLabelsSettings,v=void 0;se.ColumnChart.isStacked(X,W)&&(v=function(e,t,i,a,r){for(var o=!(e&&t===i-1&&1!==i),s=t+1;s<i;s++){var n=se.AxisHelper.normalizeNonFiniteNumber(r[s][a].value);if(null!==n&&((!e||0===t)&&0<n||e&&0!==t)){o=!1;break}}return o}(r,P,W,l,$));r=se.DataLabelUtil.determineDataLabelFillColor(i.fontProperties.color,z,l,P),S={categoryValue:t,value:c,position:s,valueAbsolute:g,valueOriginal:a,seriesIndex:P,labelSettings:i,uncertainty:h,categoryIndex:l,color:e,selected:!1,originalValue:c,originalPosition:s,originalValueAbsolute:g,identity:f,key:S,get tooltipInfo(){return D&&D.getTooltipItems()},get formattedTooltip(){return D&&D.getFormattedTooltipItems()},labelFill:r,labelFormatString:u||M.format,lastSeries:v,chartType:X};L.push(S),re&&(v={categoryValue:t,value:x,position:n,valueAbsolute:o,valueOriginal:w,seriesIndex:P,labelSettings:i,uncertainty:C,categoryIndex:l,color:e,selected:!1,highlight:!0,originalValue:c,originalPosition:s,originalValueAbsolute:g,drawThinner:ae,identity:m,key:m.getKey(),get tooltipInfo(){return D&&D.getTooltipItems()},get formattedTooltip(){return D&&D.getFormattedTooltipItems()},labelFormatString:b||M.format,labelFill:r,lastSeries:v,chartType:X},L.push(v))},n=0;n<E;n++)s(n)},oe=this,o=0;o<W;o++)g(o);for(var y,m=!1,v=!1,f=!1,S=!1,x=0,b=Y;x<b.length;x++){var C=b[x];C&&(m=m||0<C.positive,v=v||C.negative<0,f=f||0<C.net,S=S||C.net<0)}return this.hasNetPositive=f,this.hasNetNegative=S,1<W&&1<E&&O.ribbonChart&&(y=se.ColumnChart.getRibbonsUtils().createRibbonChartDataPoints({dataView:R,columnSeries:G,hasHighlights:re,hasDynamicSeries:te,ribbonChartDataPoints:y,categoryCount:E,formatStringProp:H,reader:z,hostServices:O.hostServices,ribbonOptions:O.ribbonOptions})),{series:G,totals:Y,hasPositive:m,hasNegative:v,hasNetPositive:f,hasNetNegative:S,valuesMetadataBySeries:c,categoryIdentities:J,ribbonChartDataPoints:y,hasHighlights:re,hasDynamicSeries:te,isMultiMeasure:i,multipleIdentity:e}},ne.createIdentities=function(e,t,i,a,r,o,s,n,l){var c=e.originalCategories||[t],i=se.SelectionIdBuilder.builder().withCategory(c,i,null===(t=null==t?void 0:t.source)||void 0===t?void 0:t.queryName,!0).withSeries(e.values,a,!0).withMeasure(o.queryName,r,i),i=(i=s?i.withColumnIdentity(s.identity,n,l):i).createSelectionId();return{identity:i,identityKey:i.getKey()}},ne.prototype.getTotalTooltip=function(e,t,i,a,r,o){var s=this.options;if(s.tooltipsEnabled&&s.supportsTotalLabels&&this.totalLabelsSettings.show){i=i[e][t];return this.existingTooltips[t]||(this.existingTooltips[t]={}),this.totalLabelsSettings.showPositiveAndNegative?(this.existingTooltips[t][i=i?"negative":"positive"]||(this.existingTooltips[t][i]={displayName:this.displayNames[i],value:se.converterHelper.formatFromMetadataColumn(a[t][i],r[e],o,!1)}),this.existingTooltips[t][i]):(this.existingTooltips[t].net||(this.existingTooltips[t].net={displayName:this.hasNetPositive&&this.hasNetNegative?this.displayNames.net:this.displayNames.simple,value:se.converterHelper.formatFromMetadataColumn(a[t].net,r[e],o,!1)}),this.existingTooltips[t].net)}},ne);function ne(){this.existingTooltips=[]}se.ColumnChartConverter=e;var k=(t.prototype.getLegend=function(){var e=[],t=[],i=[],a=!1,r=this.reader;if(this.dataView&&this.dataView.values){for(var o=r.columns.getSeriesCount(se.cartesianRoleNames.y),s=se.columnChartProps.general.formatString,n=r.columns.hasDynamicSeries(),l=0;l<o;l++){var c=r.columns.getValueMetadataColumnBySeries(l),u=r.objects.getSeriesDataObjects(l);t.push(c),i.push(u);var d=(d=new se.SelectionIdBuilder).withMeasure(c.queryName),h=(d=n?d.withSeries(r.columns.getSeriesValueColumns(),r.columns.getSeriesValueColumnGroup(l),!0):d).createSelectionId(),u=se.converterHelper.getFormattedLegendLabel(c,this.dataView.values,s),d=r.colors.createBySeries(l);e.push({icon:se.LegendIcon.Box,color:d,label:u,identity:h,selected:!1,index:l}),void 0!==c.groupName&&(a=!0)}var p=this.dataView.values,g=p&&p.source?p.source.displayName:""}p=se.Legend.getDefaultLegendData(this.visualStyle);return p.title=g,p.dataPoints=e,p.grouped=a,{legend:p,seriesSources:t,seriesObjects:i}},t.prototype.getValueBySeriesAndCategory=function(e,t){return this.reader.data.getValue("Y",t,e)},t.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.reader.data.getHighlight("Y",t,e)},t.prototype.getFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getFormatString("Y",t,e)},t.prototype.getHighlightFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getHighlightFormatString("Y",t,e)},t);function t(e,t){this.visualStyle=t,this.dataView=e&&e.categorical,this.reader=le.data.createDataViewCategoricalReaderAdvanced(e,{staticSeriesRoleNames:[se.cartesianRoleNames.y],colorOptions:{valueRole:se.cartesianRoleNames.y,visualStyle:t},formatStringProp:se.columnChartProps.general.formatString})}se.ColumnChartConverterHelper=k}(le.visuals||(le.visuals={}))}(powerbi=powerbi||{}),function(f){!function(m){var h=f.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,u=f.data.DataViewWildcard,i=jsCommon.DOMConstants,a=jsCommon.EnumExtensions,n=m.shapes.Rect,p=f.data.Selector,g="Auto";m.clusteredValidLabelPositionOptions=[g,m.labelPosition.outsideEnd,m.labelPosition.insideEnd,m.labelPosition.insideCenter,m.labelPosition.insideBase],m.stackedValidLabelPositionOptions=[g,m.labelPosition.insideCenter,m.labelPosition.insideEnd,m.labelPosition.insideBase],m.innerPaddingMin=0,m.innerPaddingMax=50,m.preferredCategoryWidthMin=20,m.preferredCategoryWidthMax=180;var r=(y.prototype.initData=function(e){this.currentViewport=e.viewport,this.element=e.element,this.hostService=e.host,this.interactivity=e.interactivity,this.isComboChart=m.ComboChart.isComboChart(e.chartType),this.style=e.style,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},y.prototype.initRenderer=function(e){var t;this.animator=e.animator,this.cartesianVisualHost=e.cartesianHost,this.svg=e.svg,this.svg.classed("columnChart",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.useManagedTabIndex=e.useManagedTabIndex,this.interactivityService&&(t=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({"aria-label":this.hostService.getLocalizedString("Visual_Plot"),"data-automation-type":"mainGraphicsContext","aria-multiselectable":"true",role:"listbox"}).classed(m.SetFocusRingClassName,!t),e.useManagedTabIndex?(this.mainGraphicsContext.classed(m.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(i.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attrs({tabindex:0,focusable:!0}))},y.prototype.getCategoryLayout=function(e,t,i,a,r){var o=y.isBar(this.chartType)?this.currentViewport.height-(this.margin.top+this.margin.bottom):this.currentViewport.width-(this.margin.left+this.margin.right);o=Math.max(0,o);var s=this.data?this.data.preferredCategoryWidth:null,n=this.data?this.data.categoryMetadata:void 0,l=m.AxisHelper.getCategoryValueType(n),n=this.getVisualCategoryAxisIsScalar(),t=m.AxisHelper.createDomain(this.data.series,l,n,[t.includeDomain]);return m.CartesianChartLayout.getLayout(this.data,{availableWidth:o,categoryCount:e,preferredCategoryWidth:s,domain:t,isScalar:n,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:i,outerPaddingRatio:a,innerPaddingRatio:r})},y.getDefaultColumnLabelSettings=function(e,t){void 0===t&&(t=!1);var i=m.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",noColor:!0});return i.position=null,i.labelDensity=m.DataLabelViewModel.defaultLabelDensity,i.labelOrientation=1,t?(i.enableBackground=!0,i.backgroundColor=m.ColorHelper.getThemeColor(e,m.BackgroundColorName),i.backgroundTransparency=m.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):i.enableBackground=!1,i},y.getDefaultLineChartSeriesLabelSettings=function(e){var t=m.ColorHelper.getThemeColor(e,m.DataLabelViewModel.DefaultLabelColorName),e=m.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:t,seriesPosition:m.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1}},y.converter=function(e){return(new m.ColumnChartConverter).convert(e)},y.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++)(a[r]=f.Prototype.inherit(e[r])).data=e[r].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<t});return a},y.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},y.prototype.setData=function(e,t){var i,a,r=y.isStacked100(this.chartType);this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,dataLabelsSettings:y.getDefaultColumnLabelSettings(this.style),seriesLabelSetings:y.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,isMultiMeasure:!1},0<e.length&&((i=this.dataView=e[0])&&i.categorical&&(e=(a=i.categorical.categories)&&0<a.length?a[0].source:null,a=m.AxisHelper.getCategoryValueType(e),e=m.CartesianHelper.hasCategoryHierarchy(i),e=m.ScalarUtils.shouldDrawScalar(i.metadata?i.metadata.objects:null,m.columnChartProps.categoryAxis.axisType,a,void 0,e),this.data=this.originalData=y.converter({dataView:i,style:this.style,is100PercentStacked:r,isScalar:e,dataViewMetadata:i.metadata,multipleInfo:t,chartType:this.chartType,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,hostServices:this.hostService,ribbonChart:this.ribbonChart,isCombo:this.isComboChart,buildCategories:void 0,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches})))},y.getChartStrategy=function(e,t){switch(e){case 10:return new m.ClusteredBarChartStrategy;case 12:return new m.ClusteredColumnChartStrategy;case 18:return new(y.isStacked(e,t)?m.StackedBarChartStrategy:m.ClusteredBarChartStrategy);case 50:return new m.StackedBarChartStrategy;case 20:return new(y.isStacked(e,t)?m.StackedColumnChartStrategy:m.ClusteredColumnChartStrategy);default:return new m.StackedColumnChartStrategy}},y.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&1<this.data.series.length)},y.prototype.getSeriesSettings=function(){return f.Prototype.inherit(this.data).seriesLabelSetings},y.prototype.enumerateObjectInstances=function(e,t){var i;switch(t.objectName){case"dataPoint":this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)&&this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!==(i=this.featureSwitches)&&void 0!==i&&i.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case"ribbonChart":y.getRibbonsUtils().enumerateRibbonChart(e,this.data.ribbonChartData,this.ribbonChart)}},y.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.ribbonChart?y.getRibbonsUtils().getRibbonChartCard(t.getRibbonDataPointFormattingOptions(e.categoryAxisData)):t.getDataPointCard(e.categoryAxisData)},function(){return t.getLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:5}},y.prototype.getDataPointCard=function(i){var a=this;if(this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)){var r=function(e){return a.hostService.getLocalizedString(e)},o=this.originalData;if(o){var s=o.series.length;if(0!==s){var e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("bars"),y.isColumn(this.chartType)?"Role_DisplayName_Columns":"Visual_Bars_Title",[m.columnChartProps.dataPoint.fill,m.columnChartProps.dataPoint.showAllDataPoints,m.cartesianChartProps.categoryAxis.innerPadding,m.cartesianChartProps.categoryAxis.preferredCategoryWidth],r);return e.addGroup("colors",function(e){if(e.withDisplayName("Visual_Colors"),o.hasDynamicSeries||1<s||!o.categoryMetadata){var t={groupBuilder:e,dataPoints:o.series,seriesColorProps:m.columnChartProps.dataPoint,localize:r,featureSwitches:a.featureSwitches};return f.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t)}e={groupBuilder:e,colorProps:m.columnChartProps.dataPoint,featureSwitches:a.featureSwitches,hostService:a.hostService,options:{dataView:a.dataView,style:a.style,categories:_.map(o.series[0].data,function(e){var t,i=(i=null===(t=null===(i=o.categoryIdentities)||void 0===i?void 0:i[e.categoryIndex])||void 0===t?void 0:t.call(i))||e.identity;return{color:e.color,displayName:o.categoryFormatter.format(o.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:o.multipleIdentity?m.columnRoleNames.rows:void 0}};f.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(e)}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){var t=i.innerPadding;e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new m.builder.SliderBuilder({descriptor:m.cartesianChartProps.categoryAxis.innerPadding,value:void 0!==t?Math.round(100*t):void 0,options:{minValue:{type:0,value:m.innerPaddingMin},maxValue:{type:1,value:m.innerPaddingMax},unitSymbol:"Numeric_Pixel"},localize:r}).build()).addSimpleSlice("categoryWidth",new m.builder.NumUpDownBuilder({descriptor:m.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:i.preferredCategoryWidth,options:{minValue:{type:0,value:m.preferredCategoryWidthMin},maxValue:{type:1,value:m.preferredCategoryWidthMax},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()}}}},y.prototype.getLabelsCard=function(){function o(e){return s.hostService.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,t=n.dataLabelsSettings.position!==m.labelPosition.outsideEnd,u=v(this.chartType,n.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions;e.position&&u.indexOf(e.position)<0&&(e.position=g);var i=__assign(__assign({},m.columnChartProps.labels),{position:m.columnChartProps.labels.labelPosition,precision:m.columnChartProps.labels.labelPrecision,displayUnits:m.columnChartProps.labels.labelDisplayUnits,labelBackgroundColor:m.columnChartProps.labels.backgroundColor,labelBackgroundTransparency:m.columnChartProps.labels.backgroundTransparency});y.isColumn(this.chartType)||delete i.labelOrientation;var a=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",i,o),r=this.getLabelSettingsOptions(void 0,e,null,c,u,t),d={cardBuilder:a,dataLabelsProps:i,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:r,individualSelector:this.isComboChart?void 0:m.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:!!_.first(n.categories),hasDynamicSeries:n.hasDynamicSeries,seriesSelector:1===l&&_.first(n.series).identity.getSelector()})};return i.show&&a.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:i.show,value:r.dataLabelsSettings.show}).build()}),a.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var i=n.series[t],a=i.labelSettings||n.dataLabelsSettings;a.position&&u.indexOf(a.position)<0&&(a.position=g);var r=i.identity.getSelector(),a=s.getLabelSettingsOptions(void 0,a,r,void 0,u);d.selector=n.hasDynamicSeries?p.normalizeSelector(r):r,d.individualSelector=m.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:s.featureSwitches,hasCategories:!!_.first(n.categories),hasDynamicSeries:n.hasDynamicSeries,seriesSelector:r}),d.options=a,d.displayDisabledSlices=((a={}).labelOverflow=!0,a),e.addContainerItem(i.displayName,i.displayName,function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),a.build()},y.prototype.getTotalsCard=function(){var t=this,e=this.originalData,i=e.totalLabelsSettings;if(i&&!y.isClustered(this.chartType)&&!this.ribbonChart&&!y.isStacked100(this.chartType)){var a=__assign(__assign({},m.columnChartProps.totals),{precision:m.columnChartProps.totals.labelPrecision,displayUnits:m.columnChartProps.totals.labelDisplayUnits}),r=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",a,function(e){return t.hostService.getLocalizedString(e)});if(!this.supportsTotalLabels()){var o=!(!this.data||!this.data.multipleIdentity);return r.withDisabled(!0,o?"Visual_Totals_DisabledReason_SmallMultiples":"Visual_Totals_DisabledReason"),r.build()}e={cardBuilder:r,dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:this.getTotalLabelSettingsOptions(void 0,i),individualSelector:m.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:!!_.first(e.categories),hasDynamicSeries:e.hasDynamicSeries})};return m.DataLabelViewModel.getDataLabelsFormattingModel(e)}},y.prototype.getErrorBarsCard=function(){var n=this;if(this.featureSwitches&&this.featureSwitches.columnChartError&&this.featureSwitches.lineChartError&&!this.isStacked()&&!this.ribbonChart){var l=this.originalData;if(l&&l.series&&0!==l.series.length){var c=function(e){return n.hostService.getLocalizedString(e)},e=m.StandardObjectIdentifiers.error,e=[e.enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.markerShape,e.markerSize,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.tooltipShow,e.tooltipFormat],e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,c,!0,!0);return e.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=l.valuesMetadataBySeries;e<t.length;e++)!function(e){var t,i,a,r,o=_.first(e.usedInSeriesIndices);null!=o&&(t=e.metadataColumn,i=l.series[o],a=__assign({},e.valueSelector.getSelector()),o=__assign(__assign({},a),{data:[u.create()],highlightMatching:1}),r={localize:c,uncertainty:i.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:a,dataPointSelector:o,featureSwitches:n.featureSwitches,uncertaintyOptions:{isCombo:n.isComboChart,hideBand:!0}},s.addContainerItem(t.queryName,t.displayName,function(e){return m.UncertaintyHelper.getFormattingContainer(r,e)}))}(t[e])})}),e.build()}}},y.prototype.getRibbonDataPointFormattingOptions=function(e){var t=this,a=this.originalData;if(a){var i=a.series.length;if(0!==i)return{localize:function(e){return t.hostService.getLocalizedString(e)},categoryAxisData:e,ribbonChartData:this.data.ribbonChartData,data:a,colorOptions:{groupBuilder:void 0,colorProps:m.columnChartProps.dataPoint,featureSwitches:this.featureSwitches,hostService:this.hostService,options:{dataView:this.dataView,style:this.style,categories:_.map(a.series[0].data,function(e){var t,i=(i=null===(t=null===(i=a.categoryIdentities)||void 0===i?void 0:i[e.categoryIndex])||void 0===t?void 0:t.call(i))||e.identity;return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:a.multipleIdentity?m.columnRoleNames.rows:void 0}}}}},y.prototype.enumerateDataLabels=function(e){var t=this.originalData,i=t.dataLabelsSettings,a=t.series.length,r=1<a||!t.categoryMetadata||this.isComboChart,o=t.dataLabelsSettings.position!==m.labelPosition.outsideEnd,s=v(this.chartType,t.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions;if(m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,i,null,r,s,o),this.featureSwitches),r&&i.showLabelPerSeries)for(var n=0;n<a;n++){var l=t.series[n],c=l.labelSettings||t.dataLabelsSettings,u=l.identity.getSelector();t.hasDynamicSeries&&(u=p.normalizeSelector(u)),e.pushContainer({displayName:l.displayName}),m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,c,u,void 0,s),this.featureSwitches),e.popContainer()}},y.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},y.prototype.enumerateSeriesDataLabels=function(e){var t,i;this.showSeriesCard()&&(t=this.originalData.seriesLabelSetings,i=this.showLabelPerSeries(),m.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,t,null,i),this.featureSwitches))},y.prototype.getLabelSettingsOptions=function(e,t,i,a,r,o){var s=!!i;return{enumeration:e,dataLabelsSettings:t,show:!0,position:!_.isEmpty(r),positionObject:r,labelOrientation:!y.isBar(this.chartType)&&!s,displayUnits:!y.isStacked100(this.chartType),precision:!0,selector:i,showAll:a,fontSize:!0,fontFamily:!0,labelDensity:this.data&&this.data.scalarCategoryAxis,labelOverflow:!s&&o,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},y.prototype.getSeriesLabelSettingsOptions=function(e,t,i,a){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:i,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:a,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},y.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},y.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&m.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},y.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,showPositiveAndNegative:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},y.prototype.enumerateDataPoints=function(e){var t,a=this.originalData;!a||0!==(t=a.series.length)&&(a.hasDynamicSeries||1<t||!a.categoryMetadata?f.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:a.series},this.featureSwitches):f.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(a.series[0].data,function(e){var t,i=(i=null===(t=null===(i=a.categoryIdentities)||void 0===i?void 0:i[e.categoryIndex])||void 0===t?void 0:t.call(i))||e.identity;return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:a.multipleIdentity?m.columnRoleNames.rows:void 0},this.featureSwitches))},y.prototype.getCategoryDomain=function(){var e=this.data;return e?m.AxisHelper.createDomain(e.series,e.categoryMetadata?e.categoryMetadata.type:f.ValueType.fromDescriptor({text:!0}),e.scalarCategoryAxis,void 0):void 0},y.prototype.calculateAxesProperties=function(e){this.currentViewport=e.viewport,this.viewModelAdapterFactory&&this.originalData&&(p=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=p.getData());var t=this.data,i=this.margin=e.margin,a=this.ribbonChart?y.ribbonChartInnerPaddingRatio:e.innerPaddingRatio,r=t&&t.categories?t.categories.length:0,o=t?this.getCategoryLayout(r,e.categoryAxisOptions,e.trimOrdinalDataOnOverflow,e.outerPaddingRatio,a):this.getEmptyChartLayout(),t=this.adjustLayoutForScroll(t,r,e.trimOrdinalDataOnOverflow,o),s=y.isStacked100(this.chartType);this.updateColumnChart(t,o,i);var n,l,c,u=y.isBar(this.chartType),d=u?(n=e.valueAxisOptions,e.categoryAxisOptions):(n=e.categoryAxisOptions,e.valueAxisOptions),h=this.strategy.createXAxis({is100Pct:s,forcedTickCount:e.forcedTickCount,includeXDomain:n.includeDomain,axisZoom:e.axisZoom,axisScaleType:n.scaleType,logAxisScale:n.logAxisScale,axisDisplayUnits:n.displayUnits,axisPrecision:n.precision,outerPaddingRatio:u?0:o.outerPaddingRatio,margin:i,innerPaddingRatio:a,invertAxis:n.invertAxis},this.featureSwitches),p=this.strategy.createYAxis({is100Pct:s,forcedTickCount:e.forcedTickCount,includeYDomain:d.includeDomain,axisZoom:e.axisZoom,axisScaleType:d.scaleType,logAxisScale:d.logAxisScale,axisDisplayUnits:d.displayUnits,axisPrecision:d.precision,outerPaddingRatio:u?o.outerPaddingRatio:0,margin:i,innerPaddingRatio:a,invertAxis:d.invertAxis},this.featureSwitches),r=t.dataLabelsSettings&&t.dataLabelsSettings.show,o=t.totalLabelsSettings&&t.totalLabelsSettings.show&&this.supportsTotalLabels(),r=r&&y.isClustered(this.chartType);return(o||r)&&(t=y.adjustDomainForLabels(u,t,h,p),u?(l=m.AxisHelper.createScalarDomainOptions(h.scale.domain(),0),c=m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(t,0,[!0,!0]),n.includeDomain,l),h=this.strategy.createXAxis({is100Pct:s,forcedTickCount:e.forcedTickCount,includeXDomain:c,axisZoom:e.axisZoom,axisScaleType:n.scaleType,logAxisScale:n.logAxisScale,axisDisplayUnits:n.displayUnits,axisPrecision:n.precision,outerPaddingRatio:0,margin:i,innerPaddingRatio:a,skipAxisZoomUpdate:!0,invertAxis:n.invertAxis},this.featureSwitches)):(l=m.AxisHelper.createScalarDomainOptions(p.scale.domain(),0),c=m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(t,0,[!0,!0]),d.includeDomain,l),p=this.strategy.createYAxis({is100Pct:s,forcedTickCount:e.forcedTickCount,includeYDomain:c,axisZoom:e.axisZoom,axisScaleType:d.scaleType,logAxisScale:d.logAxisScale,axisDisplayUnits:d.displayUnits,axisPrecision:d.precision,outerPaddingRatio:0,margin:i,innerPaddingRatio:a,skipAxisZoomUpdate:!0,invertAxis:d.invertAxis},this.featureSwitches))),[h,p]},y.prototype.setAxesLayout=function(e){this.currentViewport=e.layout.viewport,this.viewModelAdapterFactory&&this.originalData&&(r=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=r.getData());var t=e.layout.axes;this.xAxisProperties=t.x,this.yAxisProperties=t.y1;var i=this.margin=e.layout.margin,a=this.data,r=this.xAxisProperties;y.isBar(this.chartType)&&(r=this.yAxisProperties);t=a&&a.categories?a.categories.length:0,r=a?{categoryCount:_.isEmpty(r.categoryIdentities)?0:r.categoryIdentities.length,categoryThickness:r.categoryThickness,outerPaddingRatio:r.outerPaddingRatio,innerPaddingRatio:r.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:this.getEmptyChartLayout();this.data=this.adjustLayoutForScroll(a,t,e.trimOrdinalDataOnOverflow,r),this.updateColumnChart(this.data,r,i)},y.prototype.getAxesDomains=function(e,t){var i,a={},r=this.data;return r&&(t.categoryAxis&&r.scalarCategoryAxis&&((i=this.getCategoryDomain())&&(m.AxisHelper.assertScalarDomain(i),a.categoryAxis=[i[0],i[1]])),t.valueAxis&&(i=y.isStacked100(this.chartType),t=void 0,e=(t=this.isStacked()?[(i=m.StackedUtil.calcValueDomain(r.series,i)).min,i.max]:m.AxisHelper.createUncertaintyAwareValueDomain(r.series,e)||m.emptyDomain)[0],t=t[1],void 0!==e&&void 0!==t&&(a.valueAxis=[e,t]))),a},y.prototype.getEmptyChartLayout=function(){return{categoryCount:0,categoryThickness:m.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1}},y.prototype.updateColumnChart=function(e,t,i){var a=this.getPreferredPlotArea(t.isScalar,t.categoryCount,t.categoryThickness,t.outerPaddingRatio),i={height:a.height,width:a.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,margin:this.margin,layout:t,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(i.top+i.bottom),viewportWidth:this.currentViewport.width-(i.left+i.right),is100Pct:y.isStacked100(this.chartType),isComboChart:this.isComboChart};this.strategy=y.getChartStrategy(this.chartType,this.data&&this.data.series.length),this.strategy.setData(e),this.applyInteractivity(i),this.strategy.setupVisualProps(i),this.strategy.setAxisProperties(this.xAxisProperties,this.yAxisProperties)},y.prototype.adjustLayoutForScroll=function(e,t,i,a){return this.scrolledData=void 0,!e||a.isScalar||this.isScrollable||!i||(a=Math.min(t,a.categoryCount))!==t&&((e=this.scrolledData=f.Prototype.inherit(e)).series=y.sliceSeries(e.series,a),e.categories=e.categories.slice(0,a),e.categoryIdentities&&(e.categoryIdentities=e.categoryIdentities.slice(0,a))),e},y.adjustDomainForLabels=function(e,t,i,a){var r=e?i:a,o=r.dataDomain;if(o&&null!=o[0]&&null!=o[1]){var s=o[0].toString(),n=o[1].toString(),l=r.scale,c="";0<t.series.length&&0<t.series[0].data.length&&(c=t.series[0].data[0].labelFormatString);a=m.DataLabelViewModel.createColumnFormatterCacheManager(),i=m.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,t.totalLabelsSettings),a=a.getOrCreate(c,t.totalLabelsSettings,i.units,t.totalLabelsSettings.precision),c=m.DataLabelRenderer.getLabelFormattedText(a.format(s)),i=m.DataLabelRenderer.getLabelFormattedText(a.format(n)),s=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,c),a=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,i),n=void 0,c=void 0,i=void 0,i=e?(n=f.TextMeasurementService.measureSvgTextWidth(s),c=f.TextMeasurementService.measureSvgTextWidth(a),r.invertAxis?-1:1):(n=f.TextMeasurementService.estimateSvgTextHeight(s),c=f.TextMeasurementService.estimateSvgTextHeight(a),r.invertAxis?1:-1),n=l(o[0])-i*(n+m.DataLabelViewModel.labelMargin),i=l(o[1])+i*(c+m.DataLabelViewModel.labelMargin),c=!1;return[(t.totalLabelsSettings.showPositiveAndNegative?(c=t.hasPositive,t.hasNegative):(c=t.hasNetPositive,t.hasNetNegative))?l.invert(n):void 0,c?l.invert(i):void 0]}},y.prototype.getPreferredPlotArea=function(e,t,i,a){var r={height:this.currentViewport.height-this.margin.top-this.margin.bottom,width:this.currentViewport.width-this.margin.left-this.margin.right};return this.isScrollable&&!e&&(a=m.CartesianChartLayout.getPreferredCategorySpan(t,i,a),y.isBar(this.chartType)?r.height=Math.max(a,r.height):r.width=Math.max(a,r.width)),r},y.prototype.applyInteractivity=function(e){var i=this,t=this.interactivity;t&&(t.dragDataPoint&&(e.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),t.isInteractiveLegend&&(e=function(){var e=d3.mouse(i.mainGraphicsContext.node()),t=e[0],e=e[1],e=i.strategy.getClosestColumnIndex(t,e);i.selectColumn(e)},t=y.getInteractiveColumnChartDomElement(this.element),this.svg.on("click",e),d3.select(t).on("click",e).style("touch-action","none"),e=d3.drag().on("drag",e),this.svg.call(e),d3.select(t).call(e)))},y.prototype.selectLastSelectedColumnOrDefault=function(e){void 0===e&&(e=!1);var t=void 0===this.lastInteractiveSelectedColumnIndex?m.CartesianHelper.findMaxCategoryIndex(this.data.series):this.lastInteractiveSelectedColumnIndex;this.selectColumn(t,e)},y.prototype.selectColumn=function(e,t){var i;!(t=void 0!==t&&t)&&this.lastInteractiveSelectedColumnIndex===e||(i=this.createInteractiveLegendDataPoints(e),this.strategy.selectColumn(e,this.lastInteractiveSelectedColumnIndex,t),this.cartesianVisualHost.updateLegend(i),this.lastInteractiveSelectedColumnIndex=e)},y.prototype.createInteractiveLegendDataPoints=function(e){var t=this.data,i=m.Legend.getDefaultLegendData(this.style);if(!t||_.isEmpty(t.series))return i;for(var a=m.columnChartProps.general.formatString,r=[],o=t.categories&&t.categories[e],s=t.series,n=t.legendData&&t.legendData.dataPoints,l=new m.ColumnChartConverterHelper(this.dataView,this.style),c=0,u=s.length;c<u;c++){var d,h=l.getValueBySeriesAndCategory(c,e),p=t.valuesMetadata[c],g=m.converterHelper.getFormattedLegendLabel(p,this.dataView.categorical.values,a),y=void 0;y=1===s.length?(d=s[0]).data.length>e&&d.data[e].color:n.length>c&&n[c].color,r.push({color:y,icon:m.LegendIcon.Box,label:g,category:t.categoryFormatter?t.categoryFormatter.format(o):o,measure:m.valueFormatter.format(h,m.valueFormatter.getFormatString(p,a)),identity:m.SelectionId.createNull(),selected:!1,index:c})}return i.dataPoints=r,i},y.prototype.overrideXScale=function(e){this.xAxisProperties=e},y.prototype.render=function(e){var t=this.strategy.drawColumns(!e,this.style),i=this.data,a=this.margin,r=this.currentViewport,e=r.height-(a.top+a.bottom),r=r.width-(a.left+a.right);this.mainGraphicsContext.attr("height",e).attr("width",r),this.tooltipsEnabled&&this.tooltipService.addTooltip(t.eventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity&&[e.data.identity]}),this.tooltipsEnabled&&t.ribbonChartEventGroup&&this.tooltipService.addTooltip(t.ribbonChartEventGroup,function(e){return e.data&&e.data.tooltipInfo},function(){return[m.SelectionId.createNull()]});var o,s,n=[],a=this.strategy.getColumnWidth(),e=this.strategy.getCategoryWidth?this.strategy.getCategoryWidth():a,r=y.isBar(this.chartType);if(this.interactivityService){for(var l=0,c=i.series.length;l<c;l++)n=n.concat(i.series[l].data);o={datapoints:n,columnChartDrawInfo:t,hasHighlights:i.hasHighlights,root:this.mainGraphicsContext,showLabel:i.dataLabelsSettings.show,bandsTransparency:this.data.ribbonChartData?this.data.ribbonChartData.ribbonOptions.bandsTransparency:30,visualInstanceId:this.hostService.instanceId,hitTester:new d({dataPoints:n,isScalar:i.scalarCategoryAxis,hasCategories:!!i.categoryIdentities&&0<i.categoryIdentities.length,isBar:r,isClustered:y.isClustered(this.chartType),categoryAxisScale:this.strategy.getCategoryAxisScale(),columnWidth:a,categoryWidth:e,seriesLength:i.series.length}),useManagedTabIndex:this.useManagedTabIndex},s={navigationStrategy:1<i.series.length?m.DataPointNavigationStrategy.CategoryFirst:m.DataPointNavigationStrategy.CategoryOnly,helper:this}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.selectLastSelectedColumnOrDefault(!0),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:n,behaviorOptions:o,navigationOptions:s,labelDataPoints:[],labelDataPointGroups:t.labelDataPointGroups,labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:t.animateLabels,categorySubRangeCount:Math.round(e/a),verticalCategoryAxis:r}},y.prototype.getFirstElement=function(e,t){void 0===t&&(t=!1);var i=(this.scrolledData||this.data).series;if(_.isEmpty(i))return null;var a,r,o=null!=e?e:i[0].data[0].categoryIndex,e=t?this.findSeriesIndex(i.length-1,o,!1):this.findSeriesIndex(0,o,!0);return 0<=e?(a=this.data.series[e].data[o],r=this.getDataPointElement(e,o)):e=t?i.length-1:0,{element:r,targetCategoryIndex:o,targetSeriesIndex:e,noShape:a&&0===a.valueAbsolute}},y.prototype.getNextDataPoint=function(e,t,i){switch(i=y.isBar(this.chartType)&&!this.getVisualCategoryAxisIsScalar()&&(i===m.DataDirection.NextSeries||i===m.DataDirection.PreviousSeries)?i===m.DataDirection.NextSeries?m.DataDirection.PreviousSeries:m.DataDirection.NextSeries:i){case m.DataDirection.NextCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!0);break;case m.DataDirection.PreviousCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!1);break;case m.DataDirection.NextSeries:(t=this.findSeriesIndex(t+1,e,!0))<0&&(e=this.loopIndex(e+1,this.data.categories.length),t=this.findSeriesIndex(0,e,!0));break;case m.DataDirection.PreviousSeries:(t=0<t?this.findSeriesIndex(t-1,e,!1):-1)<0&&(e=this.loopIndex(e-1,this.data.categories.length),t=this.findSeriesIndex(this.data.series.length-1,e,!1))}var a,r;if(0<=t&&0<=e)a=this.data.series[t].data[e],r=this.getDataPointElement(t,e);else if(e<0)switch(i){case m.DataDirection.NextCategory:e=this.loopIndex(e+1,this.data.categories.length);break;case m.DataDirection.PreviousCategory:e=this.loopIndex(e-1,this.data.categories.length)}else switch(i){case m.DataDirection.NextSeries:t=0;break;case m.DataDirection.PreviousSeries:t=this.data.series.length-1}return this.isInViewport(r)?{element:r,targetCategoryIndex:e,targetSeriesIndex:t,noShape:a&&0===a.valueAbsolute}:this.getNextDataPoint(e,t,i)},y.prototype.isInViewport=function(e){if(!e)return!0;var t=e.getBBox(),e=this.currentViewport;return 0<t.y+t.height&&t.y<e.height&&0<t.x+t.width&&t.x<e.width},y.prototype.getDataPointElement=function(t,i){var e=y.isColumn(this.chartType)?".column":".bar";return this.mainGraphicsContext.selectAll(e).filter(function(e){return e.categoryIndex===i&&e.seriesIndex===t}).node()},y.prototype.findSeriesIndex=function(e,t,i){return(i?_.findIndex:_.findLastIndex)(this.data.series,function(e){return _.some(e.data,function(e){return e.categoryIndex===t&&null!=e.value})},e)},y.prototype.findCategoryIndex=function(e,t,i){var a=i?1:-1,i=_.findIndex(e,function(e){return e.categoryIndex===t});return i<0?i:e[i=this.loopIndex(i+a,e.length)].categoryIndex},y.prototype.loopIndex=function(e,t){return t<=e?0:e<0?t-1:e},y.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},y.prototype.getCategoryValueType=function(){return m.AxisHelper.getCategoryValueType(this.data.categoryMetadata)},y.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},y.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,e=m.AxisHelper.getCategoryValueType(e);return m.AxisHelper.isOrdinal(e)?m.axisType.categorical:m.axisType.both},y.prototype.setFilteredData=function(e,t){var i=this.scrolledData=f.Prototype.inherit(this.data);return i.series=y.sliceSeries(i.series,t,e),i.categories=i.categories.slice(e,t),this.strategy.setData(i),i},y.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()&&!y.isStacked100(this.chartType)},y.prototype.supportsTrendLine=function(){if(this.data.multipleIdentity)return!1;var e=this.dataView,t=f.data.createDataViewCategoricalReader(e),e=this.getVisualCategoryAxisIsScalar();return 12===this.chartType&&e&&t.data.hasValues("Y")},y.prototype.supportsStaticReferenceLines=function(){return 68!==this.chartType},y.prototype.supportsValueAxis=function(){return 68!==this.chartType},y.prototype.isStacked=function(){return y.isStacked(this.chartType,this.data&&this.data.series.length)},y.isBar=function(e){return a.hasFlag(e,2)},y.isColumn=function(e){return a.hasFlag(e,4)},y.isClustered=function(e){return a.hasFlag(e,8)},y.isStacked=function(e,t){return a.hasFlag(e,16)&&(1!==t||y.isStacked100(e))},y.isStacked100=function(e){return a.hasFlag(e,48)},y.isRibbon=function(e){return a.hasFlag(e,64)},y.prototype.getCartesianVisualCapabilities=function(){var e=this.supportsValueAxis(),t=e&&!this.isStacked(),t={categoryAxis:{domainAggregateRole:m.columnRoleNames.category,supportedDomainAggregates:this.data&&this.data.scalarCategoryAxis?3:0},valueAxis:{domainAggregateRole:m.columnRoleNames.y,supportedDomainAggregates:t?3:1}};return{supportsHierarchicalCategoryAxis:y.isColumn(this.chartType),supportsValueAxis:e,axesCapabilities:t}},y.prototype.getStaticSeriesRole=function(){return"Y"},y.getRibbonsUtils=function(){return f.ribbonChartUtilsModuleFactory()},y.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},y.RibbonChartItemClasses=e("ribbonChartArea"),y.RibbonChartLayerClasses=e("ribbonChartLayer"),y.ribbonChartInnerPaddingRatio=.6,y);function y(e){var t=e.chartType;this.chartType=t,this.isScrollable=e.isScrollable,this.tooltipsEnabled=!e.featureSwitches.onObjectFormatting&&e.tooltipsEnabled,this.interactivityService=e.featureSwitches.onObjectFormatting?void 0:e.interactivityService,this.ribbonChart=68===this.chartType,this.viewModelAdapterFactory=e.viewModelAdapterFactory}m.ColumnChart=r;var d=(t.prototype.queryRegion=function(e){var t,i,a,r,o=this,s=[],e=e.dataSpace;return(this.isScalar||this.hasCategories&&!_.some([e.bottom,e.left,e.right,e.top],function(e){return void 0===e}))&&(r=this.isBar?(i=this.isScalar?(t=e.bottom.value,e.top.value):(t=this.getAdjustedCategoryIndex(e.top.value,e.top.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.bottom.value,e.bottom.seriesIndex,this.seriesLength)),a=e.left.value,e.right.value):(i=this.isScalar?(t=e.left.value,e.right.value):(t=this.getAdjustedCategoryIndex(e.left.value,e.left.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.right.value,e.right.seriesIndex,this.seriesLength)),a=e.bottom.value,e.top.value),s=_.filter(this.dataPoints,function(e){return 0!==e.valueAbsolute&&t<=i&&a<=r&&n.overlappingRange(t,i,o.getAreaCategoryBound(e,!1),o.getAreaCategoryBound(e,!0))&&n.overlappingRange(a,r,o.getAreaValueLowerBound(e),o.getAreaValueUpperBound(e))})),s},t.prototype.getAreaValueLowerBound=function(e){return this.isClustered?Math.min(0,e.value):e.position-e.valueAbsolute},t.prototype.getAreaValueUpperBound=function(e){return this.isClustered?Math.max(0,e.value):e.position},t.prototype.getAreaCategoryBound=function(e,t){if(this.isScalar){var i=(t=this.isBar?!t:t)?this.columnWidth:0,a=this.isClustered?e.seriesIndex:0,t=this.categoryAxisScale(e.categoryValue)-this.categoryWidth/2;return m.AxisHelper.invertScale(this.categoryAxisScale,t+a*this.columnWidth+i,0,0,void 0).value}return this.getAdjustedCategoryIndex(e.categoryIndex,e.seriesIndex,this.seriesLength)},t.prototype.getAdjustedCategoryIndex=function(e,t,i){return this.isClustered?e*i+t:e},t);function t(e){e.columnWidth,e.categoryWidth,this.categoryAxisScale=e.categoryAxisScale,this.categoryWidth=e.categoryWidth,this.columnWidth=e.columnWidth,this.dataPoints=e.dataPoints,this.hasCategories=e.hasCategories,this.isBar=e.isBar,this.isClustered=e.isClustered,this.isScalar=e.isScalar,this.seriesLength=e.seriesLength}function v(e,t){return!r.isStacked(e,t)&&!r.isRibbon(e)}m.ColumnChartHitTester=d,m.canSupportOutsidePosition=v}(f.visuals||(f.visuals={}))}(powerbi=powerbi||{}),function(e){var l,t;function i(e){return t.call(this,e)||this}l=e.visuals||(e.visuals={}),t=l.BaseAnimator,__extends(i,t),i.prototype.animate=function(e){var t={failed:!0,shapes:null},i=e.viewModel,a=this.previousViewModel;return i.categories.length*i.series.length>l.AnimatorCommon.MaxDataPointsToAnimate||a&&a.categories.length!==i.categories.length||(a&&(i.hasHighlights&&!a.hasHighlights?t=this.animateNormalToHighlighted(e):i.hasHighlights&&a.hasHighlights?t=this.animateHighlightedToHighlighted(e):!i.hasHighlights&&a.hasHighlights&&(t=this.animateHighlightedToNormal(e))),this.previousViewModel=i),t},i.prototype.animateNormalToHighlighted=function(e){var t=e.viewModel,i=e.itemCS,a=e.layout,r=e.series.selectAll(i.selector).data(function(e){return e.data},function(e){return e.key}),o=e.interactivityService&&e.interactivityService.hasSelection(),s=t.hasHighlights,n=r.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).attrs(a.shapeLayoutWithoutHighlights).merge(r);return n.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,o,s)}).transition().duration(this.animationDuration).attrs(a.shapeLayout),r.exit().remove(),{failed:!1,shapes:n,uncertaintyShapes:l.ColumnUtil.drawUncertainty(t,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService)}},i.prototype.animateHighlightedToHighlighted=function(e){return{failed:!1,shapes:this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS,e.interactivityService&&e.interactivityService.hasSelection()),uncertaintyShapes:l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService)}},i.prototype.animateHighlightedToNormal=function(e){var t=e.itemCS,i=e.series.selectAll(t.selector).data(function(e){return e.data},function(e){return e.key}),a=e.interactivityService&&e.interactivityService.hasSelection(),r=i.enter().append("rect").attr("class",function(e){return t.class.concat(e.highlight?" highlight":"")}).merge(i);return r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,e.selected,!e.selected)}).transition().duration(this.animationDuration).attrs(e.layout.shapeLayout).transition().duration(0).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,a,!1)}),i.exit().transition().duration(this.animationDuration).attrs(a?e.layout.zeroShapeLayout:e.layout.shapeLayoutWithoutHighlights).remove(),{failed:!1,shapes:r,uncertaintyShapes:l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService)}},i.prototype.animateDefaultShapes=function(t,e,i,a,r){var o=e.selectAll(a.selector).data(function(e){return e.data},function(e){return e.key}),e=o.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}).merge(o);return e.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,t.hasHighlights)}).transition().duration(this.animationDuration).attrs(i.shapeLayout),o.exit().remove(),e},l.WebColumnChartAnimator=i}(powerbi=powerbi||{}),function(e){!function(n){var l=jsCommon.BrowserUtils,e=(t.prototype.create=function(){return new i},t);function t(){}n.ColumnChartWebBehaviorFactory=e;var i=(a.prototype.bindEvents=function(e,i,t){var a=this;this.options=e,this.hitTester=e.hitTester;var r,o,s=e.columnChartDrawInfo.eventGroup;t&&(r=t.dataPointNavigationManager,o=t.pointSourceKey,r.isEmpty(o)||(t=e.root,n.InteractivityUtils.appendUseElementForFocus(t,e.visualInstanceId,o),n.InteractivityUtils.registerEnterPlotAreaHandler(t,r,o),n.InteractivityUtils.registerDataPointNavigationHandler(t,r,o),n.InteractivityUtils.registerClearCatcherShortcut(t,i))),s.on("click",function(){return a.handleSelection(i)}).on("keydown.select",function(){var e=d3.event.keyCode;32!==e&&13!==e||a.handleSelection(i)},!0),s.on("contextmenu",function(){var t,e=d3.event;l.isCtrlOrMeta(e)||(e.preventDefault(),n.EventBubblingUtil.markAsHandled(e),t=n.InteractivityUtils.getPositionOfLastInputEvent(),n.InteractivityUtils.tryToSelectD3Target(function(e){return i.handleContextMenu(e,t)}))})},a.prototype.renderSelection=function(t){var e,i=this.options,a=i.columnChartDrawInfo;a.ribbonChartEventGroup&&(e=(100-i.bandsTransparency)/100,e=n.ColumnUtil.getFillOpacity(!1,!1,t,i.hasHighlights,e),a.ribbonChartEventGroup.style("fill-opacity",e).style("stroke-opacity",e)),a.shapesSelection.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights)}).style("stroke-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights)}),a.uncertaintyShapes&&(null!==(e=a.uncertaintyShapes.bars)&&void 0!==e&&e.each(function(e){e.uncertainty.bar;d3.select(this).selectAll(n.ColumnUtil.UncertaintyBar.selector).style("fill-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights):null}).style("stroke-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights):null})}),null!==(e=a.uncertaintyShapes.markerPaths)&&void 0!==e&&e.style("opacity",t?n.ColumnUtil.getFillOpacity(!1,!0,t,i.hasHighlights):null),null!==(a=(e=a.uncertaintyShapes).updateActiveHighlightMarkers)&&void 0!==a&&a.call(e,t,i.hasHighlights))},a.prototype.renderFocus=function(e){var t=n.CurrentFocusDataPointId+"-"+this.options.visualInstanceId;this.options.root.select("#"+t).attr("id",null),e&&(e.setAttribute("id",t),(t=this.options.root.select("#"+t)).empty()||(t.attr("aria-label",function(e){return e.formattedTooltip}),l.focus(e)))},a.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},a.prototype.getLassoSelectDirectionMode=function(){return 2},a.prototype.handleSelection=function(t){n.InteractivityUtils.tryToSelectD3Target(function(e){return n.InteractivityUtils.handleSelection(e,t)},!this.options.useManagedTabIndex)},a);function a(){}n.ColumnChartWebBehavior=i}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(e){!function(y){var e=(u.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},u.prototype.setData=function(e){this.data=e},u.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t,e&&this.setSeriesOffsetScale(e.innerPaddingRatio)},u.prototype.createXAxis=function(e,t){var i=e.includeXDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.width,c=y.AxisHelper.hasForcedDomain(i),c=y.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!1,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis);return this.setSeriesOffsetScale(e.innerPaddingRatio),c},u.prototype.createYAxis=function(e,t){e.is100Pct;var i=e.forcedTickCount,a=e.includeYDomain,r=e.axisScaleType,o=e.logAxisScale,s=e.axisDisplayUnits,n=e.axisPrecision,l=e.outerPaddingRatio,c=e.margin,u=this.viewportHeight,d=y.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||y.emptyDomain,h=y.AxisHelper.getAxisFormatString(this.data.series),p=y.AxisHelper.mergeScalarAxisDomains(a,y.AxisHelper.createScalarDomainOptions(d,0)),d=y.AxisHelper.scaleShouldClamp(p&&p.domain,d);!a||!_.includes(a.domainSources,10)||a.forced&&a.domain;a=y.AxisHelper.hasForcedDomain(p);return y.AxisHelper.createAxis({pixelSpan:u,dataDomain:p&&p.domain,axisZoom:e.axisZoom,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:null!=h?h:y.valueFormatter.getFormatString(this.data.valuesMetadata[0],y.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,logAxisScale:o,axisDisplayUnits:s,axisPrecision:n,shouldClamp:d,outerPaddingRatio:l,margin:c,preventNice:a,includeZero:y.AxisHelper.shouldIncludeZero(p),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t})},u.prototype.createLabelDataPoints=function(e){return y.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!0,e,this.yProps.invertAxis)},u.prototype.createUncertaintyLabels=function(e){return y.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.yProps,!1,e,this.hostService)},u.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},u.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},u.prototype.getCategoryAxisScale=function(){return this.xProps.scale},u.prototype.drawColumns=function(e,t){var i=this.data;this.columnsCenters=null;var a=this.getCategoryWidth(),r={columnWidth:this.getColumnWidth(),categoryWidth:a,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis},o=this.layout=u.getLayout(i,r),s=i.dataLabelsSettings,a=[];s&&s.show&&(a=this.createLabelDataPoints(t));var n,l,c,s=_.filter(i.series,function(e){return null===(e=e.uncertainty)||void 0===e?void 0:e.labels.show});_.isEmpty(s)||(a=a.concat(this.createUncertaintyLabels(t)));t=y.ColumnUtil.drawSeries(i,this.graphicsContext.mainGraphicsContext,r);return this.animator&&e&&(l=(n=this.animator.animate({viewModel:i,series:t,valueAxisProps:this.yProps,isBar:!1,columnWidth:this.getColumnWidth(),layout:o,itemCS:u.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes,c=n.uncertaintyShapes),this.animator&&e&&!n.failed||(c=y.ColumnUtil.drawUncertainty(i,!1,this.graphicsContext.mainGraphicsContext,this.yProps,this.layout,this.getColumnWidth(),this.interactivityService),l=y.ColumnUtil.drawDefaultShapes(i,t,o,u.classes.item,!this.animator,this.interactivityService)),y.ColumnUtil.applyInteractivity(l,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:l,uncertaintyShapes:c,viewport:{height:this.height,width:this.width},axisOptions:r,labelDataPointGroups:a,animateLabels:n&&!n.failed}},u.prototype.selectColumn=function(e,t,i){y.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,u.classes.item.selector,e,t,i),this.moveHandle(e)},u.prototype.getClosestColumnIndex=function(e,t){return y.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},u.prototype.getColumnsCenters=function(){var t,e,i=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return i.xProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},u.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},u.prototype.moveHandle=function(e){var t,i=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(e=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:e,x2:e}),t.select("circle").attrs({cx:e})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:e,x2:e,y1:0,y2:this.height}),t.append("circle").attrs({cx:e,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},u.getLayout=function(e,t){var i=t.columnWidth,a=.5*i,r=a/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=n(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return e.drawThinner?a:i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){e=c?Math.min(0,e.value):Math.max(0,e.value);return u+y.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(y.AxisHelper.diffScaled(n,0,e.value))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},y:function(e){e=c?Math.min(0,e.originalValue):Math.max(0,e.originalValue);return u+y.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(y.AxisHelper.diffScaled(n,0,e.originalValue))}},zeroShapeLayout:{width:function(e){return e.drawThinner?a:i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){return u},height:function(e){return 0}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return n(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return n(e)}}}},u.classes={item:{class:"column",selector:".column"}},u);function u(){}y.ClusteredColumnChartStrategy=e;d.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},d.prototype.setData=function(e){this.data=e},d.prototype.setAxisProperties=function(e,t){this.xProps=e,(this.yProps=t)&&this.setSeriesOffsetScale(t.innerPaddingRatio)},d.prototype.createYAxis=function(e,t){var i=e.includeYDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.height,c=y.AxisHelper.hasForcedDomain(i),c=y.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!0,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis);return this.setSeriesOffsetScale(e.innerPaddingRatio),c},d.prototype.createXAxis=function(e,t){e.is100Pct;var i=e.forcedTickCount,a=e.includeXDomain,r=e.axisScaleType,o=e.logAxisScale,s=e.axisDisplayUnits,n=e.axisPrecision,l=e.outerPaddingRatio,c=e.margin,u=e.invertAxis,d=this.width,h=y.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||y.emptyDomain,p=y.AxisHelper.getAxisFormatString(this.data.series),g=y.AxisHelper.mergeScalarAxisDomains(a,y.AxisHelper.createScalarDomainOptions(h,0)),a=y.AxisHelper.scaleShouldClamp(g&&g.domain,h),h=y.AxisHelper.hasForcedDomain(g),t=y.AxisHelper.createAxis({pixelSpan:d,dataDomain:g&&g.domain,axisZoom:e.axisZoom,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:null!=p?p:y.valueFormatter.getFormatString(this.data.valuesMetadata[0],y.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,logAxisScale:o,axisDisplayUnits:s,axisPrecision:n,shouldClamp:a,outerPaddingRatio:l,margin:c,preventNice:h,includeZero:y.AxisHelper.shouldIncludeZero(g),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:u,featureSwitches:t});return t.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),t},d.prototype.createLabelDataPoints=function(e){return y.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!0,e,this.xProps.invertAxis)},d.prototype.createUncertaintyLabels=function(e){return y.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.xProps,!0,e,this.hostService)},d.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},d.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},d.prototype.getCategoryAxisScale=function(){return this.yProps.scale},d.prototype.drawColumns=function(e,t){var i=this.data;this.barsCenters=null;var a=this.getCategoryWidth(),r={columnWidth:this.getColumnWidth(),categoryWidth:a,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis},o=this.layout=d.getLayout(i,r),s=i.dataLabelsSettings,a=[];s&&s.show&&(a=this.createLabelDataPoints(t));var n,l,c,s=_.filter(i.series,function(e){return null===(e=e.uncertainty)||void 0===e?void 0:e.labels.show});_.isEmpty(s)||(a=a.concat(this.createUncertaintyLabels(t)));t=y.ColumnUtil.drawSeries(i,this.graphicsContext.mainGraphicsContext,r);return this.animator&&e&&(c=(n=this.animator.animate({viewModel:i,series:t,valueAxisProps:this.xProps,columnWidth:this.getColumnWidth(),isBar:!0,layout:o,itemCS:d.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!n.failed||(l=y.ColumnUtil.drawUncertainty(i,!0,this.graphicsContext.mainGraphicsContext,this.xProps,this.layout,this.getColumnWidth(),this.interactivityService),c=y.ColumnUtil.drawDefaultShapes(i,t,o,d.classes.item,!this.animator,this.interactivityService)),y.ColumnUtil.applyInteractivity(c,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:c,uncertaintyShapes:l,viewport:{height:this.height,width:this.width},axisOptions:r,labelDataPointGroups:a,animateLabels:n&&!n.failed}},d.prototype.selectColumn=function(e,t,i){y.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,d.classes.item.selector,e,t,i),this.moveHandle(e)},d.prototype.getClosestColumnIndex=function(e,t){return y.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},d.prototype.getBarsCenters=function(){var t,e,i=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return i.yProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},d.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},d.prototype.moveHandle=function(e){var t,i=this.getBarsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(e=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:e,y2:e}),t.select("circle").attrs({cy:e})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:e,y2:e}),t.append("circle").attrs({cx:0,cy:e,r:"6px"}).classed("drag-handle",!0)))},d.getLayout=function(e,t){var i=t.columnWidth,a=.5*i,r=a/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=s(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return Math.abs(y.AxisHelper.diffScaled(s,0,e.value))},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?a:i}},shapeLayoutWithoutHighlights:{width:function(e){return Math.abs(y.AxisHelper.diffScaled(s,0,e.originalValue))},x:function(e){e=c?Math.max(0,e.originalValue):Math.min(0,e.originalValue);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?a:i}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return s(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return s(e)}}}},d.classes={item:{class:"bar",selector:".bar"}},e=d;function d(){}y.ClusteredBarChartStrategy=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(e){!function(m){var e=(c.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},c.prototype.setData=function(e){this.data=e},c.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},c.prototype.createXAxis=function(e,t){var i=e.includeXDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.width,c=m.AxisHelper.hasForcedDomain(i);return m.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!1,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis)},c.prototype.createYAxis=function(e,t){var i=e.is100Pct,a=e.forcedTickCount,r=e.includeYDomain,o=e.axisScaleType,s=e.logAxisScale,n=e.axisDisplayUnits,l=e.axisPrecision,c=e.outerPaddingRatio,u=e.margin,d=this.viewportHeight,h=m.StackedUtil.calcValueDomain(this.data.series,i),p=m.AxisHelper.getAxisFormatString(this.data.series),g=[h.min,h.max],y=m.AxisHelper.mergeScalarAxisDomains(r,m.AxisHelper.createScalarDomainOptions(g,0)),h=m.AxisHelper.scaleShouldClamp(y&&y.domain,g),g=this.data.valuesMetadata[0],p=i?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=p?p:m.valueFormatter.getFormatString(g,m.columnChartProps.general.formatString),g=m.AxisHelper.hasForcedDomain(y);return m.AxisHelper.createAxis({pixelSpan:d,dataDomain:y&&y.domain,axisZoom:e.axisZoom,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:p,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,logAxisScale:s,axisDisplayUnits:n,axisPrecision:l,is100Pct:i,shouldClamp:h,margin:u,preventNice:g,includeZero:m.AxisHelper.shouldIncludeZero(r),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t})},c.prototype.createLabelDataPoints=function(e){return m.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!1,e,this.yProps.invertAxis)},c.prototype.createTotalLabelDataPoints=function(e){var t=m.CartesianHelper.getFirstMetadataColumn(this.data.valuesMetadata),t=m.valueFormatter.getFormatString(t,m.columnChartProps.general.formatString);return m.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,e,t,this.yProps.invertAxis)},c.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},c.prototype.getCategoryAxisScale=function(){return this.xProps.scale},c.prototype.drawColumns=function(e,t){var i=this.data;this.columnsCenters=null;var a={columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis},r=this.layout=c.getLayout(i,a),o=i.dataLabelsSettings,s=[];o&&o.show&&(s=s.concat(this.createLabelDataPoints(t)));var n,l,o=i.totalLabelsSettings;o&&o.show&&!this.graphicsContext.is100Pct&&(s=s.concat(this.createTotalLabelDataPoints(t)));o=m.ColumnUtil.drawSeries(i,this.graphicsContext.mainGraphicsContext,a);this.animator&&e&&(l=(n=this.animator.animate({viewModel:i,series:o,layout:r,itemCS:c.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!n.failed||(m.ColumnUtil.drawUncertainty(i,!1,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),l=m.ColumnUtil.drawDefaultShapes(i,o,r,c.classes.item,!this.animator,this.interactivityService));o=this.data.ribbonChartData;return t=(t=o&&o.ribbonChartDataPoints?(r=m.ColumnChart.getRibbonsUtils().getRibbonChartAreaLayout(this.layout,o.ribbonChartDataPoints,!0),{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:r,ribbonChartAreaSelector:m.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:m.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:o.ribbonOptions.colorBands,bandsTransparency:o.ribbonOptions.bandsTransparency,showBorder:o.ribbonOptions.showBorder,style:t,interactivityService:this.interactivityService}):{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:[],ribbonChartAreaSelector:m.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:m.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:!1,bandsTransparency:c.defaultBandsTransparency,showBorder:!1,style:t,interactivityService:this.interactivityService},m.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(t)),m.ColumnUtil.applyInteractivity(l,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,ribbonChartEventGroup:t,shapesSelection:l,viewport:{height:this.height,width:this.width},axisOptions:a,labelDataPointGroups:s,animateLabels:n&&!n.failed}},c.prototype.selectColumn=function(e,t,i){m.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,c.classes.item.selector,e,t,i),this.moveHandle(e)},c.prototype.getClosestColumnIndex=function(e,t){return m.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},c.prototype.getColumnsCenters=function(){var t,e,i=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return i.xProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},c.prototype.moveHandle=function(e){var t,i=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(e=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:e,x2:e}),t.select("circle").attrs({cx:e})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:e,x2:e,y1:0,y2:this.height}),t.append("circle").attrs({cx:e,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},c.getLayout=function(e,t){var i=t.columnWidth,a=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=a?i/2:0;return{shapeLayout:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.position-e.valueAbsolute:e.position)},height:function(e){return Math.abs(o(e.position-e.valueAbsolute)-o(e.position))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.originalPosition-e.originalValueAbsolute:e.originalPosition)},height:function(e){return Math.abs(o(e.originalPosition-e.originalValueAbsolute)-o(e.originalPosition))}},zeroShapeLayout:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return 0<=e.value?o(e.position-e.valueAbsolute):o(e.position)},height:function(e){return 0}}}},c.classes={item:{class:"column",selector:".column"},highlightItem:{class:"highlightColumn",selector:".highlightColumn"}},c.defaultBandsTransparency=30,c);function c(){}m.StackedColumnChartStrategy=e;u.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.isComboChart=e.isComboChart},u.prototype.setData=function(e){this.data=e},u.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},u.prototype.createYAxis=function(e,t){var i=e.includeYDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.height,c=m.AxisHelper.hasForcedDomain(i);return m.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!0,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis)},u.prototype.createXAxis=function(e,t){var i=e.is100Pct,a=e.forcedTickCount,r=e.includeXDomain,o=e.axisScaleType,s=e.logAxisScale,n=e.axisDisplayUnits,l=e.axisPrecision,c=e.outerPaddingRatio,u=e.margin,d=this.width,h=m.StackedUtil.calcValueDomain(this.data.series,i),p=m.AxisHelper.getAxisFormatString(this.data.series),g=[h.min,h.max],h=m.AxisHelper.mergeScalarAxisDomains(r,m.AxisHelper.createScalarDomainOptions(g,0)),r=m.AxisHelper.scaleShouldClamp(h&&h.domain,g),g=this.data.valuesMetadata[0],p=i?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=p?p:m.valueFormatter.getFormatString(g,m.columnChartProps.general.formatString),g=m.AxisHelper.hasForcedDomain(h),t=m.AxisHelper.createAxis({pixelSpan:d,dataDomain:h&&h.domain,axisZoom:e.axisZoom,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:p,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!1,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,logAxisScale:s,axisDisplayUnits:n,axisPrecision:l,is100Pct:i,shouldClamp:r,margin:u,preventNice:g,skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t});return t.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),t},u.prototype.createLabelDataPoints=function(e){return m.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!1,e,this.xProps.invertAxis)},u.prototype.createTotalLabelDataPoints=function(e){var t=this.data.valuesMetadata[0],t=m.valueFormatter.getFormatString(t,m.columnChartProps.general.formatString);return m.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,e,t,this.xProps.invertAxis)},u.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},u.prototype.getCategoryAxisScale=function(){return this.yProps.scale},u.prototype.drawColumns=function(e,t){var i=this.data;this.barsCenters=null;var a={columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis},r=this.layout=u.getLayout(i,a),o=i.dataLabelsSettings,s=[];o&&o.show&&(s=s.concat(this.createLabelDataPoints(t)));var n,l,o=i.totalLabelsSettings;o&&o.show&&!this.graphicsContext.is100Pct&&(s=s.concat(this.createTotalLabelDataPoints(t)));t=m.ColumnUtil.drawSeries(i,this.graphicsContext.mainGraphicsContext,a);return this.animator&&e&&(l=(n=this.animator.animate({viewModel:i,series:t,layout:r,itemCS:u.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!n.failed||(m.ColumnUtil.drawUncertainty(i,!0,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),l=m.ColumnUtil.drawDefaultShapes(i,t,r,u.classes.item,!this.animator,this.interactivityService)),m.ColumnUtil.applyInteractivity(l,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:l,viewport:{height:this.height,width:this.width},axisOptions:a,labelDataPointGroups:s,animateLabels:n&&!n.failed}},u.prototype.selectColumn=function(e,t,i){m.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,u.classes.item.selector,e,t,i),this.moveHandle(e)},u.prototype.getClosestColumnIndex=function(e,t){return m.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},u.prototype.getBarsCenters=function(){var t,e,i=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return i.yProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},u.prototype.moveHandle=function(e){var t,i=this.getBarsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(e=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:e,y2:e}),t.select("circle").attrs({cy:e})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:e,y2:e}),t.append("circle").classed("drag-handle",!0).attrs({cx:0,cy:e,r:"6px"})))},u.getLayout=function(e,t){var i=t.columnWidth,a=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=a?i/2:0;return{shapeLayout:{width:function(e){return s?r(e.position-e.valueAbsolute)-r(e.position):r(e.position)-r(e.position-e.valueAbsolute)},x:function(e){return r(s?e.position:e.position-e.valueAbsolute)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}},shapeLayoutWithoutHighlights:{width:function(e){return s?r(e.originalPosition-e.originalValueAbsolute)-r(e.originalPosition):r(e.originalPosition)-r(e.originalPosition-e.originalValueAbsolute)},x:function(e){return r(s?e.originalPosition:e.originalPosition-e.originalValueAbsolute)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(e){return 0<=e.value?r(e.position-e.valueAbsolute):r(e.position)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}}}},u.classes={item:{class:"bar",selector:".bar"},highlightItem:{class:"highlightBar",selector:".highlightBar"}},e=u;function u(){}m.StackedBarChartStrategy=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(e){var g,b,C,y,w,t;function m(r,e,o,s,n,t,l){var t=(t===s?e:r).topLevelToggle,c=__assign(__assign({},r),{topLevelToggle:t}),u={};e.groups.forEach(function(e){return u[e.uid]=e}),r.groups.forEach(function(e,t){var i,a;b.isPlaceholder(e)||(i=u[e.uid])&&(a="errorBars"===r.uid,c.groups[t]=D(e,i,o,s,n,l,a),delete u[e.uid])});for(var i=0,a=e.groups;i<a.length;i++){var d=a[i];if(b.isPlaceholder(d))return;d=u[d.uid];d&&c.groups.push(d)}var e=_.unionWith(r.revertToDefaultDescriptors,e.revertToDefaultDescriptors,_.isEqual),h=g.comboChartObjectProps;return c.revertToDefaultDescriptors=e.filter(function(e){return h[e.objectName]&&h[e.objectName][e.propertyName]}),c}function D(e,t,i,a,r,o,s){var n=__assign({},t),l=e.slices;l&&l.every(function(e){return!b.isPlaceholder(e)});var c=t.slices;return c&&c.every(function(e){return!b.isPlaceholder(e)}),n.slices=A(l,c,i,a,r,o),e.container&&t.container?n.container=function(e,t,i,a,r,o,s){var n=__assign({},t);n.containerItems=[];var l=__spreadArray([],e.containerItems),c=__spreadArray([],t.containerItems);if(s)(s=n.containerItems).push.apply(s,__spreadArray(__spreadArray([],c),l));else{var u=void 0;l[0].displayName,c[0].displayName,0<e.containerItems.length&&0<t.containerItems.length&&(u=function(e,t,a,r,o,s){var n=__assign(__assign({},t),{groups:[],slices:[]}),l={};t.groups.forEach(function(e){return l[e.uid]=e}),e.groups.forEach(function(e,t){var i=l[e.uid];i?(n.groups[t]=D(e,i,a,r,o,s),delete l[e.uid]):n.groups[t]=e});for(var i=0,c=t.groups;i<c.length;i++){var u=c[i];l[u.uid]&&n.groups.push(l[u.uid])}return n.slices=A(e.slices,t.slices,a,r,o,s),n}(l.shift(),c.shift(),i,a,r,o)),n.containerItems.push(u);for(var d=[],h=0,p=l;h<p.length;h++){var g=p[h];d.push({containerItem:g,layerType:i})}for(var y=0,m=c;y<m.length;y++){var v=m[y];d.push({containerItem:v,layerType:a})}for(var f=0,S=d;f<S.length;f++){var x=S[f];n.containerItems.push(function(e,t,o){var s=__assign({},t),i={};return t.groups.forEach(function(e){return i[C.getGroupUid(e.uid)]=e}),e.groups.length,t.groups.length,e.groups.forEach(function(e,a){var r,t=C.getGroupUid(e.uid);i[t]&&(r={},i[t].slices.forEach(function(e){return r[w.getGroupAndSliceUid(e.uid)]=e}),s.groups[a].slices=[],e.slices.forEach(function(e){var t,i;b.isPlaceholder(e)||(t=w.getGroupAndSliceUid(e.uid),(i=(i=r[t])||r[t.replace("__"+o+"__","")])&&("Dropdown"!==i.control.type||"Dropdown"!==e.control.type||P(i.control.properties,e.control.properties))?(i.displayName=e.displayName,s.groups[a].slices.push(i)):s.groups[a].slices.push(__assign(__assign({},e),{displayName:e.displayName,disabled:!0})))}))}),s}(u,x.containerItem,x.layerType))}}return n}(e.container,t.container,i,a,r,o,s):n.container=e.container||t.container,n}function A(e,t,o,i,s,n){var l=[],c=g.comboChartObjectProps,u={};t.forEach(function(e){v(e,c)&&(u[y.getSliceUid(e,n)]=e)}),e.forEach(function(e){if(v(e,c)){var t=u[y.getSliceUid(e,n)],i=e.displayName;if(function(e,t){if(t&&t.control.type===e.control.type&&_.isEqual(t.control.properties.descriptor,e.control.properties.descriptor)){if("Dropdown"!==t.control.type)return!0;t=t.control.properties,e=e.control.properties;return!!P(t,e)}return!1}(e,t)){if(b.isCompositeSlice(e)&&b.isCompositeSlice(t))for(var a in e.control.properties){var r=e.control.properties[a],a=t.control.properties[a];r&&a&&_.isEqual(r.descriptor,a.descriptor)&&(r.value=a.value)}else e.control.properties.value=t.control.properties.value;delete u[y.getSliceUid(t,n)]}else i=f(e.uid,o,s);l.push(__assign(__assign({},e),{displayName:i}))}});for(var a=0,r=t;a<r.length;a++){var d=r[a],h=u[y.getSliceUid(d,n)],p=d.uid+"__"+i+"__";h&&(d=f(h.uid,i,s),l.push(__assign(__assign({},h),{displayName:d,uid:p})))}return l}function i(e){return void 0===e.items}function P(e,t){return i(e)&&i(t)&&_.isEqual(e.filterValues,t.filterValues)}function v(e,t){if(b.isCompositeSlice(e)){var i=e.control.properties;return i?Object.keys(i).every(function(e){e=i[e],e=null==e?void 0:e.descriptor;return!e||!!(e&&t[e.objectName]&&t[e.objectName][e.propertyName])}):!1}e=e.control.properties.descriptor;return!!(e&&t[e.objectName]&&t[e.objectName][e.propertyName])}function r(e,t){if(0===t.length)return e;var i={};e.forEach(function(e){return i[e.uid]=e});for(var a=[],r=0,o=t;r<o.length;r++){var s=o[r];i[s]&&a.push(i[s])}return a}function f(e,t,i){return i("Visual_Slice_Placeholder_"+w.getSliceUid(e),function(e,t){switch(e){case 5:return t("DisplayName_QuickCalc_PercentOfColumnTotal");case 0:return t("Visual_Slice_PlaceholderChartType_Line")}}(t,i))}g=e.visuals||(e.visuals={}),b=e.visuals.builder,C=b.FormattingGroupUidBuilder,y=e.visuals.FormattingModelUtil,w=b.FormattingSliceUidBuilder,t=[[g.comboChartRoleNames.y,g.comboChartRoleNames.tooltips],[g.comboChartRoleNames.y2]],(e=g.ComboChart||(g.ComboChart={})).enumerateDataPoints=function(e,t,i){if(i){for(var a,r=i.length,o=0;o<r;o++){var s=i[o];s.enumerateObjectInstances&&(s instanceof g.ColumnChart?a=o:s.enumerateObjectInstances(e,t))}void 0!==a&&i[a].enumerateObjectInstances(e,t)}},e.isComboChart=function(e){return 11===e||14===e||15===e||16===e||17===e},e.getRoleGroups=function(){return t},e.mergeFormattingCards=function(e,t,i,a){if(0!==e.length){var r,o;switch(t){case 14:case 15:r=[0,5],o=5}if(0===(e=function(e,t){if(0===t.length)return;var i={};e.forEach(function(e){return i[e.type]=e.card});for(var a=[],r=0,o=t;r<o.length;r++)!function(t){i[t]&&i[t].forEach(function(e){return a.push({card:e,type:t})})}(o[r]);return a}(e,r)).length)return[];for(var s={},n=0,l=e;n<l.length;n++){var c=l[n],u=c.card;s[u.uid]?s[u.uid]={card:m(s[u.uid].card,u,s[u.uid].type,c.type,i,o,a),type:c.type}:s[u.uid]={card:u,type:c.type}}for(var d=[],h=0,p=_.values(s);h<p.length;h++){var g=p[h];d.push(g.card)}return d}},e.mergeFormattingCard=m,e.existsInProps=v,e.sortComboChartFormattingCards=function(e,t,i){var a=[];switch(t){case 14:case 15:a=["lines","markers","bars","labels","seriesLabels","totals"],i&&a.push("errorBars")}return r(e,a)},e.sortFormattingCards=r}(powerbi=powerbi||{}),function(y){var m;function v(e){this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}m=y.visuals||(y.visuals={}),v.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.animationOptions=e.animation},v.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(v.ClassName,!0),this.mainGraphicsG=this.svg.append("g").classed("dataDotChartMainGraphicsContext",!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg")},v.prototype.setData=function(e){this.data={series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1},0<e.length&&((e=e[0])&&e.categorical&&(this.data=v.converter(e,m.valueFormatter.format(null),this.interactivityService)))},v.prototype.setFilteredData=function(e,t){var i=this.clippedData=y.Prototype.inherit(this.data);return i&&i.series&&i.series.data&&(i.series={data:i.series.data.slice(e,t),xCol:i.series.xCol,yCol:i.series.yCol}),i},v.prototype.calculateAxesProperties=function(e){var i=this;this.currentViewport=e.viewport,this.margin=e.margin;var t=this.clippedData=this.data,a=this.currentViewport,r=this.margin,o=t?t.series:null,s=o&&o.data&&0<o.data.length?[o]:[],n=o&&o.data?o.data.length:0;t.hasHighlights&&(n/=2);var l,c=a.width-(r.left+r.right),u=a.height-(r.top+r.bottom);v.hasDataPoint(o)&&(l=o.xCol,d=o.yCol);a=m.CartesianChartLayout.getLayout(null,{availableWidth:c,categoryCount:n,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:e.innerPaddingRatio}),o=a.categoryThickness*a.outerPaddingRatio;this.isScrollable||(this.clippedData=v.createClippedDataIfOverflowed(t,a.categoryCount));n=this.getAxesDomains(!1,{valueAxis:!0}),t=e.valueAxisOptions,n=m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(n.valueAxis,0),t.includeDomain),t=m.AxisHelper.hasForcedDomain(n);this.yAxisProperties=m.AxisHelper.createAxis({pixelSpan:u,dataDomain:n&&n.domain,axisZoom:void 0,metaDataColumn:d,formatString:m.valueFormatter.getFormatString(d,v.formatStringProp),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,margin:r,preventNice:t,includeZero:!0});var d=this.xAxisProperties?this.xAxisProperties.axisType:y.ValueType.fromDescriptor({text:!0}),t=e.categoryAxisOptions.includeDomain,d=m.AxisHelper.createDomain(s,d,!1,[t]),t=m.AxisHelper.hasForcedDomain(t);return this.xAxisProperties=m.AxisHelper.createAxis({pixelSpan:c,dataDomain:d,axisZoom:void 0,metaDataColumn:l,formatString:m.valueFormatter.getFormatString(l,v.formatStringProp),outerPadding:o,isScalar:!1,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,categoryThickness:a.categoryThickness,getValueFn:function(e,t){return i.lookupXValue(e,t)},isCategoryAxis:!0,margin:r,preventNice:t,innerPaddingRatio:e.innerPaddingRatio}),[this.xAxisProperties,this.yAxisProperties]},v.prototype.getAxesDomains=function(e,t){var i={},a=this.clippedData||this.data;return a&&t.valueAxis&&(a=a.series&&!_.isEmpty(a.series.data)?[a.series]:[],i.valueAxis=m.AxisHelper.createValueDomain(a)),i},v.prototype.setAxesLayout=function(e){},v.createClippedDataIfOverflowed=function(e,t){var i=e.hasHighlights?Math.min(e.series.data.length,2*t):Math.min(e.series.data.length,t);if(i>=e.series.data.length)return e;t=y.Prototype.inherit(e);return t.series=y.Prototype.inherit(e.series),t.series.data=t.series.data.slice(0,i),t},v.hasDataPoint=function(e){return e&&e.data&&0<e.data.length},v.prototype.lookupXValue=function(e,t){var i=this.data;if(m.AxisHelper.isDateTime(t))return new Date(e);if(i&&i.series){i=i.series.data;if(i){i=i[e];if(i)return i.categoryValue}}return e},v.prototype.overrideXScale=function(e){this.xAxisProperties=e},v.prototype.render=function(e){var t=this;if(this.clippedData){var i=this.clippedData,a=i.series.data,r=i.hasHighlights,o=this.margin,s=this.currentViewport,i=s.width-(o.left+o.right),s=s.height-(o.top+o.bottom),n=this.xAxisProperties.scale,l=this.yAxisProperties.scale,c=this.xAxisProperties.categoryThickness*(1-this.xAxisProperties.innerPaddingRatio),u=c/2,o=this.style.colorPalette.dataColors.getNewColorScale().getColor(v.DotColorKey),d=!!this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsContext.attr("width",i).attr("height",s);i=this.mainGraphicsContext.selectAll(v.DotClassSelector).data(a,function(e){return e.identity.getKey()}),s=i.enter().append("circle").classed(v.DotClassName,!0).merge(i);s.styles({fill:o.value}).style("fill-opacity",function(e){return m.ColumnUtil.getFillOpacity(e.selected,e.highlight,d,r)}).classed("null-value",function(e){return null===e.value}).attrs({r:function(e){return u},cx:function(e){return n(e.categoryIndex)+u},cy:function(e){return l(e.value)}}),i.exit().remove();var i=this.mainGraphicsContext.selectAll(v.DotLabelClassSelector).data(a,function(e){return e.identity.getKey()}),h=i.enter().append("text").classed(v.DotLabelClassName,!0).attrs({"text-anchor":v.DotLabelTextAnchor,dy:v.DotLabelVerticalOffset}).merge(i);h.classed("null-value",function(e){return null===e.value}).classed("overflowed",!1).attrs({x:function(e){return n(e.categoryIndex)+u},y:function(e){return l(e.value)}}).text(function(e){return t.yAxisProperties.formatter.format(e.value)});var p,g=!1;return h.each(function(){var e;g||$("<div>").addClass($(this).attr("class")).hasClass("null-value")||(e=y.TextMeasurementService.measureSvgTextElementWidth(this),c<e&&(h.classed("overflowed",!0),g=!0))}),i.exit().remove(),this.interactivityService&&(p={dots:s,dotLabels:h,datapoints:a}),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions,s,h),{dataPoints:a,behaviorOptions:p,labelDataPoints:[],labelsAreNumeric:!0,animateLabels:!1}}},v.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},v.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},v.converter=function(e,t,i){var e=e.categorical,a=e.categories&&0<e.categories.length?e.categories[0]:{source:void 0,values:[t],identity:void 0},r=null!==(t=e.originalCategories)&&void 0!==t?t:[a],t=m.AxisHelper.getCategoryValueType(a.source),o=m.AxisHelper.isDateTime(t),s=a.values;if(_.isEmpty(e.values))return{series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1};for(var n=e.values[0],l=!!n.highlights,c=[],u=0,d=n.values.length;u<d;u++){a.identity&&a.identity.length;var h=new m.SelectionIdBuilder,p=(h=a.identity?h.withCategory(r,u,null===(g=null==a?void 0:a.source)||void 0===g?void 0:g.queryName,!0):h).withMeasure(n.source.queryName).createSelectionId(),g=s[u];(!o||null==g||g instanceof Date)&&(c.push({categoryValue:o&&g?g.getTime():g,value:n.values[u],categoryIndex:u,seriesIndex:0,selected:!1,identity:p,highlight:!1}),l&&(h=m.SelectionId.createWithHighlight(p),p=n.highlights[u],c.push({categoryValue:o&&g?g.getTime():g,value:p,categoryIndex:u,seriesIndex:0,selected:!1,identity:h,highlight:!0})))}return i&&i.applySelectionStateToData(c),{series:{xCol:a.source,yCol:n.source,data:c},hasHighlights:l,hasDynamicSeries:!0}},v.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},v.prototype.getStaticSeriesRole=function(){},v.formatStringProp={objectName:"general",propertyName:"formatString"},v.ClassName="dataDotChart",v.DotClassName="dot",v.DotClassSelector=".dot",v.DotColorKey="dataDot",v.DotLabelClassName="label",v.DotLabelClassSelector=".label",v.DotLabelVerticalOffset="0.4em",v.DotLabelTextAnchor="middle",m.DataDotChart=v}(powerbi=powerbi||{}),function(e){!function(r){var e=(t.prototype.create=function(){return new i},t);function t(){}r.DataDotChartWebBehaviorFactory=e;var i=(a.prototype.bindEvents=function(e,t,i){var a=this.dots=e.dots,e=e.dotLabels;r.InteractivityUtils.registerStandardInteractivityHandlers(a,t),e&&r.InteractivityUtils.registerStandardInteractivityHandlers(e,t)},a.prototype.renderSelection=function(t){this.dots.style("fill-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})},a);function a(){}r.DataDotChartWebBehavior=i}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(l){var c,e,t,u;function d(e){this.chartType=132,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService}c=l.visuals||(l.visuals={}),e=jsCommon.CssConstants.createClassAndSelector,t=l.data.DataViewTransform,u=c.histogramProps.general.formatString,d.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches},d.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed("histogram",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("histogramUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(c.SetFocusRingClassName,!e))},d.prototype.setData=function(e){this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!0,dataLabelsSettings:null,legendData:null,hasDynamicSeries:!0,isMultiMeasure:!1,binType:c.binType.numOfBins,binSize:d.DefaultBinSize,numberOfBins:d.DefaultBinCount},0<e.length&&((e=this.dataView=d.view)&&e.categorical&&(this.data=this.originalData=d.converter(e,this.style,e.metadata,this.featureSwitches,this.chartType,this.interactivityService,!0,this.hostService)))},d.prototype.calculateAxesProperties=function(e){this.margin=e.margin,this.currentViewport=e.viewport,this.viewModelAdapterFactory&&this.originalData&&(r=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=r.getData());var t=this.data,i=t.categories.length,a=this.getPreferredPlotArea(!0,i,c.CartesianHelper.MinOrdinalRectThickness,e.outerPaddingRatio),r=t?t.preferredCategoryWidth:null,i=c.CartesianChartLayout.getLayout(null,{availableWidth:a.width,categoryCount:i,preferredCategoryWidth:r,domain:null,isScalar:!0,isScrollable:!1,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:0}),r=d.getXAxisCreationOptions(t,a.width,i,e),e=d.getYAxisCreationOptions(t,a.height,e),r=this.xAxisProperties=c.AxisHelper.createAxis(r),e=this.yAxisProperties=c.AxisHelper.createAxis(e);return this.xAxisProperties.outerPaddingRatio=i.outerPaddingRatio,[r,e]},d.prototype.getAxesDomains=function(e,t){var i,a={},r=this.data;return r&&(t.categoryAxis&&(i=c.AxisHelper.getCategoryValueType(r.categoryMetadata,!0),(i=c.AxisHelper.createDomain(r.series,i,!0,[c.AxisHelper.createScalarDomainOptions(c.AxisHelper.createIntervalDomain(r.series),0,[!0,!0])]))&&(c.AxisHelper.assertScalarDomain(i),a.categoryAxis=i)),t.valueAxis&&(a.valueAxis=c.AxisHelper.createValueDomain(r.series))),a},d.prototype.setAxesLayout=function(e){},d.getXAxisCreationOptions=function(e,t,i,a){var r=a.categoryAxisOptions,o=c.AxisHelper.getCategoryValueType(e.categoryMetadata,!0),s=c.AxisHelper.createDomain(e.series,o,!0,[c.AxisHelper.createScalarDomainOptions(c.AxisHelper.createIntervalDomain(e.series),0,[!0,!0])]),n=i.categoryThickness,l=n*i.outerPaddingRatio,o=c.AxisHelper.hasForcedDomain(r.includeDomain);return{pixelSpan:t,dataDomain:s,axisZoom:void 0,metaDataColumn:e.categoryMetadata,formatString:c.valueFormatter.getFormatString(e.categoryMetadata,u),isScalar:!0,outerPadding:l,categoryThickness:n,forcedTickCount:a.forcedTickCount,isCategoryAxis:!0,axisDisplayUnits:r.displayUnits,axisPrecision:r.precision,outerPaddingRatio:i.outerPaddingRatio,preventNice:o,innerPaddingRatio:0}},d.prototype.getVisualCategoryAxisIsScalar=function(){return!0},d.getYAxisCreationOptions=function(e,t,i){var a=i.valueAxisOptions,r=c.AxisHelper.createValueDomain(e.series),o=c.AxisHelper.mergeScalarAxisDomains(c.AxisHelper.createScalarDomainOptions(r,0),a.includeDomain),r=c.AxisHelper.hasForcedDomain(o);return{pixelSpan:t,dataDomain:o&&o.domain,axisZoom:void 0,isScalar:!0,isVertical:!0,metaDataColumn:e.valuesMetadata,formatString:c.valueFormatter.getFormatString(e.valuesMetadata[0],u),outerPadding:0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,axisDisplayUnits:a.displayUnits,axisPrecision:a.precision,outerPaddingRatio:0,preventNice:r}},d.prototype.getPreferredPlotArea=function(e,t,i,a){return c.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,!1,e,this.margin,a)},d.prototype.overrideXScale=function(e){this.xAxisProperties=e},d.prototype.render=function(e){var t=this,i=this.data;if(i){var a=this.margin,r=this.currentViewport,o=r.height-(a.top+a.bottom),r=r.width-(a.left+a.right),a=i.series;this.mainGraphicsContext.attr("height",o).attr("width",r),this.mainGraphicsContext.selectAll(d.SeriesSelector.selector).remove();r=this.mainGraphicsContext.selectAll(d.SeriesSelector.selector).data(a).enter().append("g").classed("bar",!0),a=r.selectAll(d.BinsSelector.selector).data(function(e){return e.data});a.enter().append("rect").classed(d.BinsSelector.class,!0).attr("x",function(e){return t.xAxisProperties.scale(e.categoryValue.min)}).attr("y",function(e){return t.yAxisProperties.scale(e.value)}).attr("height",function(e){return o-t.yAxisProperties.scale(e.value)}).attr("width",function(e){return t.xAxisProperties.scale(e.categoryValue.max)-t.xAxisProperties.scale(e.categoryValue.min)}).style("fill",function(e){return e.color}),a.exit().remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(r,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity&&[e.data.identity]});var s=[];if(this.interactivityService)for(var n=0,l=i.series.length;n<l;n++)s=s.concat(i.series[n].data);return{dataPoints:s,behaviorOptions:void 0,navigationOptions:void 0,labelDataPoints:[],labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:!0}}},d.converter=function(e,t,i,a,r,o,s,n){s=c.ColumnChart.converter({dataView:e,style:t,is100PercentStacked:!1,isScalar:!0,dataViewMetadata:i=void 0===i?null:i,multipleInfo:void 0,chartType:r,interactivityService:o,tooltipsEnabled:s=void 0===s?!0:s,hostServices:n,ribbonChart:!1,isCombo:!1,buildCategories:d.buildCategories,supportsTotalLabels:!1,featureSwitches:a}),n=l.DataViewObjects.getValue(e.metadata.objects,c.histogramProps.binning.binType),a=l.DataViewObjects.getValue(e.metadata.objects,c.histogramProps.binning.binCount,d.DefaultBinCount),e=l.DataViewObjects.getValue(e.metadata.objects,c.histogramProps.binning.binSize,d.DefaultBinSize);return __assign(__assign({},s),{series:s.series,binType:n,numberOfBins:a,binSize:e})},d.buildCategories=function(e){e.categories,e.categories.length;for(var t=new Array,i=e.categories[0].values.length,a=0;a<i;a++)t.push({min:e.categories[0].values[a],max:e.categories[1].values[a]});return t},d.buildTooltipCategories=function(e,t,i){return e.length,(t+=1)===i?{displayName:_.first(e).displayName,value:"["+_.map(e,function(e){return e.value}).join(", ")+"]"}:{displayName:_.first(e).displayName,value:"["+_.map(e,function(e){return e.value}).join(", ")+")"}},d.prototype.enumerateObjectInstances=function(e,t){if(this.originalData)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"binning":this.enumerateBinning(e,t.objectName)}},d.prototype.enumerateBinning=function(e,t){t={selector:null,properties:{binType:this.data.binType===c.binType.binSize?c.binType.binSize:c.binType.numOfBins},validValues:{},objectName:t};this.data.binType===c.binType.binSize?t.properties[c.histogramProps.binning.binSize.propertyName]=this.data.binSize:t.properties[c.histogramProps.binning.binCount.propertyName]=this.data.numberOfBins,e.pushInstance(t)},d.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&t.series&&0!==t.series.length&&l.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.series,function(e){return{color:e.color,displayName:e.displayName,identity:e.identity}})},this.featureSwitches)},d.prototype.hasLegend=function(){return!0},d.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},d.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1,supportsValueAxis:!0}},d.prototype.getStaticSeriesRole=function(){return"Y"},d.BinsSelector=e("bin"),d.SeriesSelector=e("bar"),d.DefaultBinCount=5,d.DefaultBinSize=10,d.view={metadata:{columns:[{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:"Max of HourOfDay",queryName:"Sum(commits5.HourOfDay)",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}}],objects:{categoryAxis:{axisType:"Categorical"},general:{formatString:"0"}}},categorical:{categories:[{source:{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},values:[0,4,8,12,16,20],identity:null,identityFields:null},{source:{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:null,queryName:"query",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}},values:[4,8,12,16,20,24]}],values:t.createValueColumns([{source:{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},values:[5272,5427,11478,15509,12732,5158],highlights:[null,null,null,null,1662,2519]}])}},t=d,c.Histogram=t}(powerbi=powerbi||{}),function(N){!function(ae){var w=N.visuals.AxisHelper,d=jsCommon.BrowserUtils,h=N.visuals.builder,re=jsCommon.Color,e=jsCommon.CssConstants.createClassAndSelector,u=N.data.DataViewRoleWildcard,p=N.data.DataViewWildcard,s=jsCommon.DOMConstants,oe=jsCommon.EnumExtensions,g=N.data.Selector,y=N.data.Selector.normalizeSelector;ae.horizontalLabelBackgroundPadding=4;var o=(se.getDefaultLineChartLabelSettings=function(e,t){void 0===t&&(t=!1);var i=ae.ColorHelper.getThemeColor(e,ae.DataLabelViewModel.DefaultLabelColorName),i=ae.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:i,textClassName:"smallLightLabel"}).fontProperties,i={show:!1,position:ae.labelPosition.auto,displayUnits:0,precision:ae.DataLabelViewModel.defaultLabelPrecision,fontProperties:i,labelDensity:ae.DataLabelViewModel.defaultLabelDensity};return t?(i.enableBackground=!0,i.backgroundColor=ae.ColorHelper.getThemeColor(e,ae.BackgroundColorName),i.backgroundTransparency=ae.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):i.enableBackground=!1,i.bold=!1,i.italic=!1,i.underline=!1,i},se.getDefaultLineChartSeriesLabelSettings=function(e){var t=ae.ColorHelper.getThemeColor(e,ae.DataLabelViewModel.DefaultLabelColorName),e=ae.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:t,seriesPosition:ae.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,bold:!1,italic:!1,underline:!1}},se.getDefaultLineChartSeriesWidthSettings=function(e,t){var i=1;if(t)for(var a=t.length,r=0;r<a;r++)var o=ae.DataLabelRenderer.LabelTextProperties,o={text:t[r],fontFamily:e.family,fontSize:jsCommon.PixelConverter.fromPoint(e.size.pt),fontWeight:o.fontWeight},o=N.TextMeasurementService.measureSvgTextWidth(o)+2*ae.horizontalLabelBackgroundPadding,i=i<o?o:i;return i},se.converter=function(e){return new ae.LineChartConverter(e).convert()},se.getInteractiveLineChartDomElement=function(e){return e.children("svg").get(0)},se.createStackedValueDomain=function(e){return 0===e.length?null:[d3.min(e,function(e){return d3.min(e.data,function(e){return e&&e.stackedValue})}),d3.max(e,function(e){return d3.max(e.data,function(e){return e&&e.stackedValue})})]},se.prototype.initData=function(e){this.options=e,this.style=e.style;var t=e.chartType;this.isComboChart=11===t||14===t||15===t,this.isAreaChart=1===t||2===t,this.element=e.element,this.currentViewport=e.viewport,this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.isInteractiveVisual=e.interactivity&&e.interactivity.isVisualInteractive,this.host=e.host},se.prototype.initRenderer=function(e){var t=this;this.animator=e.animator,this.cartesianHost=e.cartesianHost,this.scaleDetector=e.scaleDetector;var i=e.svg;i.classed(se.ClassName,!0);var a=this.mainGraphicsSVG=i.append("svg").classed(se.lineChartSVGClassName,!0);this.svgDefs=a.append("defs");i=!this.isComboChart&&!this.isInteractiveChart;this.tooltipService=new n(this.options.services.tooltips,a,i),this.mainGraphicsContext=a.append("g").attr("role","listbox").attr("aria-label",this.host.getLocalizedString("Visual_Plot")).attr("aria-live","polite").classed(se.MainGraphicsContextClassName,!0),this.interactivityService&&(this.isComboChart?this.mainGraphicsContext.attr(s.skipChildrenFocusAttribute,!0):(o=d.isInternetExplorerOrEdge(),e.useManagedTabIndex?(this.mainGraphicsContext.classed(ae.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(s.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0),this.mainGraphicsContext.classed(ae.SetFocusRingClassName,!o))),this.hoverLineContext=a.append("g").classed("hover-line",!0),this.hoverLineContext.append(se.LineElementName).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0);var r,o=this.hoverLine=this.hoverLineContext.select(se.LineElementName);this.isInteractiveChart&&o.classed("interactive",!0),o.style("opacity",ae.SVGUtil.AlmostZero),o.style("stroke",ae.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")),this.selectionCircles=[],this.xAxisProperties={axis:null,scale:null,axisType:null,formatter:null,graphicsContext:null,values:null,axisLabel:null,isCategoryAxis:!0},this.isInteractiveChart&&(r=se.getInteractiveLineChartDomElement(this.element),a=function(){t.lastDragMoveXPosition=d3.mouse(r)[0],t.deferDragMoveOperation()},o=d3.drag().on("drag",a),d3.select(r).style("touch-action","none").call(o).on("click",a)),this.markerRenderer=new ae.MarkerRenderer,this.anomalyNavigationHelper=new ae.AnomalyDetectionKeyboardNavigationHelper},se.prototype.setData=function(e,t){var i,a,r,o,s,n;this.data=this.originalData={series:[],dataLabelsSettings:se.getDefaultLineChartLabelSettings(this.style),seriesLabelSetings:se.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],categoryIdentities:[],lineStyle:ae.LineStyle.getDefault(),binnedLineSamplingApplied:!1,legendMarkerRendering:null!==(r=this.featureSwitches)&&void 0!==r&&r.removeDefaultToCircleToggle?ae.legendMarkerRendering.markerCircleDefault:ae.legendMarkerRendering.markerOnly,matchLineColor:!1,defaultToCircle:null===(o=this.featureSwitches)||void 0===o||!o.removeDefaultToCircleToggle},this.focusedDatum=void 0,_.isEmpty(e)?this.dataView=void 0:(i=_.first(e),a=_.find(e,function(e){return ae.ForecastHelper.isDataViewForForecast(e)}),n=_.find(e,function(e){return ae.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)}),i&&i.categorical&&(r={text:!0},o=void 0,(e=(this.dataView=i).categorical.categories)&&!_.isEmpty(e)&&(e[0].source&&e[0].source.type&&(r=e[0].source.type),o=ae.ScalarUtils.getScalarKeys(e[0])),e=ae.CartesianHelper.hasCategoryHierarchy(i),r=ae.ScalarUtils.shouldDrawScalar(i.metadata?i.metadata.objects:null,ae.lineChartProps.categoryAxis.axisType,r,o,e),e=!(!(o=this.host&&this.host.tooltips())||!o.enabled()),s=this.tooltipsEnabled=this.tooltipsEnabledOnHost&&(!o||e)&&!(null!==(s=null===(s=this.options)||void 0===s?void 0:s.featureSwitches)&&void 0!==s&&s.onObjectFormatting),this.data=this.originalData=se.converter({dataView:i,style:this.style,isScalar:r,host:this.host,interactivityService:this.interactivityService,isComboChart:this.isComboChart,tooltipsEnabled:s,forecastDataView:a,anomalyDetectionDataView:n,shouldCalculateStacked:oe.hasFlag(this.lineType,16),multipleInfo:t,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches}),n=this.previousCategoryIds,t=this.data.categoryIdentities,this.suppressAnimation=se.shouldSuppressAnimations(n,t),this.previousCategoryIds=t,t=_.find(this.data.series,function(e){return e.data[0]}),this.focusedDatum=t&&t.data[0]))},se.shouldSuppressAnimations=function(e,t){var i;if(null!=e&&!(e.length>ae.AnimatorCommon.MaxDataPointsToAnimate||t.length>ae.AnimatorCommon.MaxDataPointsToAnimate))if(i=!1,0===e.length)i=!0;else for(var a=0,r=Math.min(e.length,t.length);a<r;a++)if(!ae.SelectionId.isEqual(e[a],t[a])){i=!0;break}return i},se.prototype.getCategoryDomain=function(e){var t=se.getForecastDomain(e.forecastLines),i=t&&t.x,t=this.getCategoryValueType();return w.createDomain(e.series,t,e.isScalar,[w.createScalarDomainOptions(i,0)])},se.prototype.getAxesDomains=function(e,t){if(!this.data)return{};var i,a,r,o=this.data,s={},n=se.getForecastDomain(o.forecastLines);return t.categoryAxis&&o.isScalar&&((r=this.getCategoryDomain(o))&&(w.assertScalarDomain(r),a=r[0],i=r[1],void 0!==a&&void 0!==i&&(s.categoryAxis=[a,i]))),(t.valueAxis||t.secondaryValueAxis)&&(r=n&&n.y,a=this.lineType,t.valueAxis&&(i=se.getValueDataDomain(o,e,!1,a),i=(n=w.mergeDomains(r,i))[0],n=n[1],void 0!==i&&void 0!==n&&(s.valueAxis=[i,n])),t.secondaryValueAxis&&(a=se.getValueDataDomain(o,e,!0,a),a=(r=w.mergeDomains(r,a))[0],r=r[1],void 0!==a&&void 0!==r&&(s.secondaryValueAxis=[a,r]))),s},se.getValueDataDomain=function(e,t,i,a){i=se.getDataForValueAxis(e,i).seriesData;return oe.hasFlag(a,16)?se.createStackedValueDomain(i):w.createUncertaintyAwareValueDomain(i,t)},se.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&(1<this.data.series.length||1<this.data.valuesMetadata.length))},se.prototype.setFilteredData=function(e,t){var i=t-e,a=this.scrolledData=N.Prototype.inherit(this.data);return a.series=se.sliceSeries(a.series,i,e),a.categories=a.categories.slice(e,t),a},se.prototype.getSeriesSettings=function(){return N.Prototype.inherit(this.data).seriesLabelSetings},se.getForecastDomain=function(e){if(!_.isEmpty(e)){for(var t=[],i=[],a=0,r=e;a<r.length;a++){var o=r[a];_.isEmpty(o.points)||(t.push.apply(t,_.map(o.points,function(e){return e.point.x})),i.push.apply(i,_.map(o.points,function(e){return e.point.y})),t.push.apply(t,_.map(o.points,function(e){return e.upperBound.x})),i.push.apply(i,_.map(o.points,function(e){return e.upperBound.y})),t.push.apply(t,_.map(o.points,function(e){return e.lowerBound.x})),i.push.apply(i,_.map(o.points,function(e){return e.lowerBound.y})))}return{x:[d3.min(t),d3.max(t)],y:[d3.min(i),d3.max(i)]}}},se.prototype.calculateAxesProperties=function(e){var i=this,t=e.viewport;this.currentViewport=t,this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow,this.margin=e.margin;var a=this.data;this.viewModelAdapter&&this.originalData&&(a=(this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport})).getData());var r=e.margin,o=a.series&&0<a.series.length?a.series[0].data.length:0,s=this.getCategoryLayout(o,e,a),n=this.getPreferredPlotArea(s.isScalar,s.categoryCount,s.categoryThickness,s.outerPaddingRatio);a=this.adjustLayoutForScroll(a,o,s);var l,c,u=e.roleName,d=a.series,h=!1,p=this.data.valuesMetadata;_.some(d,function(e){return e.isY2})&&(h=u===ae.LineChartRoles.Y2,d=(C=se.getDataForValueAxis(a,h)).seriesData,p=C.valuesMetadata),l=!_.isEmpty(a.series)&&a.series[0].xCol,d&&0<d.length&&(c=d[0].yCol);var g,y,m=e.categoryAxisOptions,v=e.valueAxisOptions,f=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!h,secondaryValueAxis:h}),S=w.createScalarDomainOptions(h?f.secondaryValueAxis:f.valueAxis,0),x=w.getAxisFormatString(d),b=w.mergeScalarAxisDomains(v.includeDomain,S),t=w.hasForcedDomain(b),o=w.createAxis({pixelSpan:n.height,dataDomain:b&&b.domain,axisZoom:e.axisZoom,zeroScalarDomain:[-1,1],metaDataColumn:p,formatString:null!=x?x:ae.valueFormatter.getFormatString(c,ae.lineChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,isSecValueAxis:h||this.isComboChart,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:v.scaleType,logAxisScale:v.logAxisScale,axisDisplayUnits:v.displayUnits,axisPrecision:v.precision,shouldClamp:!1,outerPaddingRatio:0,margin:r,preventNice:t,invertAxis:v.invertAxis,featureSwitches:this.featureSwitches}),u=a.totalLabelsSettings&&a.totalLabelsSettings.show,C=!1,d=0,b=!1;o.dataDomain&&_.isNumber(o.dataDomain[0])&&_.isNumber(o.dataDomain[1])&&(C=u&&this.supportsTotalLabels(),d=se.getMaximumMarkerSize(a.series),b=_.some(a.anomalyDetections,function(e){return-1!==e.highestAnomalyPointIndex||-1!==e.lowestAnomalyPointIndex})),(C||d||b)&&(!!o.dataDomain&&_.isNumber(o.dataDomain[0])&&_.isNumber(o.dataDomain[1]),u=!(t=[Number.MAX_VALUE,Number.MIN_VALUE]),!C||(C=se.adjustDomainForLabels(o,a)).adjusted&&(u=!0,C=C.domain,t=[Math.min(t[0],C[0]),Math.max(t[1],C[1])]),!d||(d=se.adjustDomainCommon(o,d)).adjusted&&(u=!0,d=d.domain,t=[Math.min(t[0],d[0]),Math.max(t[1],d[1])]),b&&(u=!0,b=ae.AnomalyDetectionVisualPlugin.adjustDomainForAnomalyMarkers(o.dataDomain,o.scale,a.anomalyDetections),t=[Math.min(t[0],b[0]),Math.max(t[1],b[1])]),u&&(t=w.mergeScalarAxisDomains(v.includeDomain,S,w.createScalarDomainOptions(t,0)),o=w.createAxis({pixelSpan:n.height,dataDomain:t&&t.domain,axisZoom:e.axisZoom,zeroScalarDomain:[-1,1],metaDataColumn:p,formatString:null!=x?x:ae.valueFormatter.getFormatString(c,ae.lineChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,isSecValueAxis:h||this.isComboChart,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:v.scaleType,logAxisScale:v.logAxisScale,axisDisplayUnits:v.displayUnits,axisPrecision:v.precision,shouldClamp:!1,outerPaddingRatio:0,margin:r,preventNice:!0,invertAxis:v.invertAxis,featureSwitches:this.featureSwitches}))),h?this.y2AxisProperties=o:this.yAxisProperties=o,y=a.isScalar?(g=(y=w.mergeScalarAxisDomains(w.createScalarDomainOptions(f.categoryAxis,0),m.includeDomain))&&y.domain,w.hasForcedDomain(y)):(g=this.getCategoryDomain(a),!1);m=w.createAxis({pixelSpan:n.width,dataDomain:g,axisZoom:e.axisZoom,zeroScalarDomain:[-1,1],metaDataColumn:l,formatString:ae.valueFormatter.getFormatString(l,ae.lineChartProps.general.formatString),outerPadding:a.isScalar?se.ScalarOuterPadding:0,isScalar:a.isScalar,isVertical:!1,forcedTickCount:e.forcedTickCount,maxTickCount:a.scalarKeyCount,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return ae.CartesianHelper.lookupXValue(a,e,t,a.isScalar,i.featureSwitches)},categoryThickness:s.categoryThickness,isCategoryAxis:!0,scaleType:m.scaleType,logAxisScale:m.logAxisScale,axisDisplayUnits:m.displayUnits,axisPrecision:m.precision,outerPaddingRatio:s.outerPaddingRatio,margin:r,allowSingleScalarTick:a.isScalar,preventNice:y,invertAxis:!!a.isScalar&&m.invertAxis,featureSwitches:this.featureSwitches});return this.interactivityService&&!this.data.isScalar&&(m.categoryIdentities=_.map(a.categoryIdentities,function(e){return function(){return e}})),[m,o]},se.prototype.getCategoryValueType=function(){var e=this.data.scalarMetadata||this.data.categoryMetadata;return w.getCategoryValueType(e)},se.getDataForValueAxis=function(e,t){var i=e.series,a=e.valuesMetadata,e=t?{roles:{Y2:!0}}:{roles:{Y:!0}};return{seriesData:_.filter(i,function(e){return e.isY2===t}),valuesMetadata:_.filter(a,e)}},se.prototype.adjustLayoutForScroll=function(e,t,i){return this.scrolledData=void 0,!e||e.isScalar||this.isScrollable||!this.trimOrdinalDataOnOverflow||t!==(i=Math.min(t,i.categoryCount))&&((e=this.scrolledData=N.Prototype.inherit(e)).series=se.sliceSeries(e.series,i),e.categories=e.categories.slice(0,i),e.categoryIdentities&&(e.categoryIdentities=e.categoryIdentities.slice(0,i))),e},se.prototype.setAxesLayout=function(e){var t=e.layout;this.currentViewport=t.viewport,this.margin=t.margin,this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow,this.viewModelAdapter&&this.originalData&&(a=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=a.getData());var i=this.data.series&&0<this.data.series.length?this.data.series[0].data.length:0,a=e.layout.axes.x,a=this.data?{categoryCount:_.isEmpty(a.values)?0:a.values.length,categoryThickness:a.categoryThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:{categoryCount:0,categoryThickness:ae.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1};this.data=this.adjustLayoutForScroll(this.data,i,a),this.xAxisProperties=t.axes.x,2&e.axisType&&(this.isComboChart?this.yAxisProperties=t.axes.y2:this.y2AxisProperties=t.axes.y2),1&e.axisType&&(this.yAxisProperties=t.axes.y1)},se.adjustDomainForLabels=function(e,t){var i="";0<t.series.length&&0<t.series[0].data.length&&(i=t.series[0].data[0].labelFormatString);var a=ae.DataLabelViewModel.createColumnFormatterCacheManager(),r=ae.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(e,t.totalLabelsSettings),i=a.getOrCreate(i,t.totalLabelsSettings,r.units,t.totalLabelsSettings.precision),r=e.dataDomain[0].toString(),r=ae.DataLabelRenderer.getLabelFormattedText(i.format(r)),r=ae.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,r),r=N.TextMeasurementService.estimateSvgTextHeight(r)+ae.DataLabelViewModel.labelMargin;return se.adjustDomainCommon(e,r)},se.getMaximumMarkerSize=function(e){var t=0;return t=0<e.length?d3.max(e,function(e){return e.lineStyle.markerProperties.showMarker?e.lineStyle.markerProperties.size:0})*ae.MarkerRenderer.sizeRatio:t},se.adjustDomainCommon=function(e,t){var i=e.dataDomain,a=e.scale.domain(),r=e.scale,e=r(i[0])+t,t=r(i[1])-t,e=r.invert(e),t=r.invert(t);return w.adjustDomainWithConstantPixelDifference(a[0],a[1],e,t)},se.prototype.getCategoryLayout=function(e,t,i){if(!i)return{categoryCount:0,categoryThickness:ae.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio,isScalar:!1};var a=this.getAvailableWidth(),r=i?i.preferredCategoryWidth:null,o=i?i.categoryMetadata:void 0,s=w.getCategoryValueType(o),n=this.getVisualCategoryAxisIsScalar(),o=t.categoryAxisOptions,o=w.createDomain(i.series,s,n,[o.includeDomain]);return ae.CartesianChartLayout.getLayout(this.data,{availableWidth:a,categoryCount:e,preferredCategoryWidth:r,domain:o,isScalar:n,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})},se.prototype.getErrorBarsCard=function(){var n=this;if(null!==(e=this.featureSwitches)&&void 0!==e&&e.lineChartError&&!this.isAreaChart){var l=this.originalData;if(l&&l.series&&0!==l.series.length){var c=function(e){return n.host.getLocalizedString(e)},e=ae.StandardObjectIdentifiers.error,e=[e.enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.shadeShow,e.shadeBandStyle,e.shadeColor,e.shadeMatchSeriesColor,e.shadeTransparency,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.markerShape,e.markerSize,e.tooltipShow,e.tooltipFormat],e=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,c,!0,!0);return e.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=l.valuesMetadataBySeries;e<t.length;e++)!function(e){var t,i,a,r,o=_.first(e.usedInSeriesIndices);null!=o&&(t=e.metadataColumn,i=l.series[o],a=e.valueSelector.getSelector(),o=n.isComboChart?u.fromRoles([ae.LineChartRoles.Rows,ae.LineChartRoles.Category]):p.create(),o=__assign(__assign({},a),{data:[o],highlightMatching:1}),r={localize:c,uncertainty:i.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:a,dataPointSelector:o,featureSwitches:n.featureSwitches},s.addContainerItem(t.queryName,t.displayName,function(e){return ae.UncertaintyHelper.getFormattingContainer(r,e)}))}(t[e])})}),e.build()}}},se.prototype.getDataPointCard=function(t){var a=this,r=this.originalData;if(r&&r.series&&0!==r.series.length){var o=function(e){return a.host.getLocalizedString(e)},s=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,ae.lineChartObjectProps.lineStyles.showSeries,!0),e=[ae.lineChartObjectProps.lineStyles.lineStyle,ae.lineChartObjectProps.lineStyles.showSeries,ae.lineChartObjectProps.lineStyles.strokeWidth,ae.lineChartObjectProps.lineStyles.strokeLineJoin,ae.lineChartObjectProps.lineStyles.stepped,ae.lineChartObjectProps.dataPoint.fill,ae.lineChartObjectProps.dataPoint.showAllDataPoints,ae.lineChartObjectProps.dataPoint.defaultColor,ae.lineChartObjectProps.dataPoint.transparency,ae.cartesianChartProps.categoryAxis.preferredCategoryWidth,ae.comboChartObjectProps.lineStyles.shadeArea],e=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("lines"),"Visual_Lines",e,o),n={lineStyle:ae.lineChartObjectProps.lineStyles.lineStyle,strokeLineJoin:ae.lineChartObjectProps.lineStyles.strokeLineJoin,strokeWidth:ae.lineChartObjectProps.lineStyles.strokeWidth,stepped:ae.lineChartObjectProps.lineStyles.stepped,showSeries:ae.lineChartObjectProps.lineStyles.showSeries},l={styleProps:n,style:r.lineStyle,showSeries:!0,showSeriesValue:s},c=this.getValidDataPointIndices(r);return e.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).withContainerDisabled(!s).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){var t;a.addDataPointGroupsToContainer(l,e,c),s||(t=[ae.lineChartObjectProps.lineStyles.lineStyle,ae.lineChartObjectProps.lineStyles.strokeWidth,ae.lineChartObjectProps.lineStyles.strokeLineJoin,ae.lineChartObjectProps.lineStyles.stepped,ae.lineChartObjectProps.lineStyles.showMarker,ae.lineChartObjectProps.lineStyles.markerShape,ae.lineChartObjectProps.lineStyles.markerSize,ae.lineChartObjectProps.lineStyles.markerColor],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:ae.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<r.series.length)for(var t=0,i=r.series;t<i.length;t++)!function(t){l={styleProps:n,style:t.lineStyle,selector:y(t.identity.getSelector())},e.addContainerItem(t.seriesName,t.seriesName,function(e){return a.addDataPointGroupsToContainer(l,e,c,t)})}(i[t])})}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("categoryWidth",new ae.builder.NumUpDownBuilder({descriptor:ae.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:t.preferredCategoryWidth,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()}},se.prototype.addDataPointGroupsToContainer=function(i,e,a,r){var o=this;ae.LineStyle.addLineStyleFormattingContainers(i,e);function s(e){return o.host.getLocalizedString(e)}var n=this.originalData,l=_.map(n.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}}),c=0<a.length&&se.chartTypeSupportsExplicitDots(n.isComboChart);e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors");var t={groupBuilder:e,dataPoints:l,seriesColorProps:ae.lineChartObjectProps.dataPoint,localize:s,featureSwitches:o.featureSwitches};r?(t=__assign(__assign({},t),{selector:i.selector}),N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t,i.selector)):N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t);t=o.featureSwitches&&o.featureSwitches.markersShowAllColors;c&&!t&&(t=o.getCategoryColorsOptions(n,a,e,c),N.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(t)),o.isComboChart&&(r?e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:__assign(__assign({},ae.comboChartObjectProps.lineStyles.shadeArea),{selector:r.identity.getSelector()}),value:r.lineStyle.shadeArea}).build()}):e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:ae.comboChartObjectProps.lineStyles.shadeArea,value:n.lineStyle.shadeArea}).build()}))});var t=this.isAreaChart&&se.areaTransparencyEnabled,u=n.areaTransparency;c&&t&&e.addGroup("shadeArea",function(e){e.withDisplayName("Visual_Shapes_ShadeArea").addSimpleSlice("transparency",h.SliderBuilder.getTransparencySliderBuilder({descriptor:ae.lineChartObjectProps.dataPoint.transparency,value:u,localize:s}).build(),function(e){return e.withDisabled(!!r)}),r&&e.withDisabled(!0,"")})},se.prototype.getMarkersCard=function(){var s=this,n=this.originalData;if(n&&n.series&&0!==n.series.length){var l=function(e){return s.host.getLocalizedString(e)},c=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,ae.lineChartObjectProps.lineStyles.showSeries,!0),u={showMarker:ae.lineChartObjectProps.lineStyles.showMarker,markerShape:ae.lineChartObjectProps.lineStyles.markerShape,markerSize:ae.lineChartObjectProps.lineStyles.markerSize,markerColor:ae.lineChartObjectProps.lineStyles.markerColor,showAllDataPoints:ae.lineChartObjectProps.dataPoint.showAllDataPoints,fill:ae.lineChartObjectProps.dataPoint.fill,showSeries:ae.lineChartObjectProps.lineStyles.showSeries},e=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",u,l);return e.addTopLevelToggle("showMarkerTopLevel",function(){return new h.ToggleSwitchBuilder({descriptor:__assign({},u.showMarker),value:n.lineStyle.markerProperties.showMarker}).build()}),e.addGroup("applySettingsTo",function(e){var t=s.getValidDataPointIndices(n),i=0<t.length&&se.chartTypeSupportsExplicitDots(n.isComboChart),r=i?s.getCategoryColorsOptions(n,t,e,i):void 0,o={styleProps:u,style:n.lineStyle,categoryColorsOptions:r,featureSwitches:s.featureSwitches};e.withContainerDisabled(!c).withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",l("All"),function(e){var t;ae.MarkerProperties.addMarkersFormattingContainers(o,e),c||(t=[ae.lineChartObjectProps.lineStyles.lineStyle,ae.lineChartObjectProps.lineStyles.strokeWidth,ae.lineChartObjectProps.lineStyles.strokeLineJoin,ae.lineChartObjectProps.lineStyles.stepped,ae.lineChartObjectProps.lineStyles.showMarker,ae.lineChartObjectProps.lineStyles.markerShape,ae.lineChartObjectProps.lineStyles.markerSize,ae.lineChartObjectProps.lineStyles.markerColor,ae.lineChartObjectProps.dataPoint.showAllDataPoints,ae.lineChartObjectProps.dataPoint.fill],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:ae.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<n.series.length)for(var t=0,i=n.series;t<i.length;t++){var a=i[t];o={styleProps:u,style:a.lineStyle,categoryColorsOptions:r,featureSwitches:s.featureSwitches,selector:y(a.identity.getSelector())},e.addContainerItem(a.seriesName,a.seriesName,function(e){return ae.MarkerProperties.addMarkersFormattingContainers(o,e)})}})}),e.build()}},se.prototype.getDataLabelsCard=function(){function o(e){return s.host.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,u=[ae.labelPosition.auto,ae.labelPosition.above,ae.labelPosition.under];this.isStacked()&&(u=[ae.labelPosition.auto,ae.labelPosition.insideCenter,ae.labelPosition.insideEnd]),e.position&&u.indexOf(e.position)<0&&(e.position=ae.labelPosition.auto);var t=__assign(__assign({},ae.lineChartObjectProps.labels),{position:ae.lineChartObjectProps.labels.labelPosition,precision:ae.lineChartObjectProps.labels.labelPrecision,displayUnits:ae.lineChartObjectProps.labels.labelDisplayUnits,labelBackgroundColor:ae.lineChartObjectProps.labels.backgroundColor,labelBackgroundTransparency:ae.lineChartObjectProps.labels.backgroundTransparency}),i=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",t,o),a=this.getLabelSettingsOptions(void 0,e,null,c,u),d={cardBuilder:i,dataLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,options:a,individualSelector:this.isComboChart?void 0:ae.DataLabelViewModel.generateLabelIndividualSelector({hasCategories:!!_.first(n.categories),hasDynamicSeries:n.hasDynamicSeries,featureSwitches:this.featureSwitches,seriesSelector:1===l&&_.first(n.series).identity.getSelector()})};return i.withDescription("Visual_DataPointsLabelsDescription"),t.show&&i.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:a.dataLabelsSettings.show}).build()}),i.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return ae.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var i=n.series[t],a=i.labelSettings||n.dataLabelsSettings;a.position&&u.indexOf(a.position)<0&&(a.position=ae.labelPosition.auto);var r=i.identity.getSelector(),a=s.getLabelSettingsOptions(void 0,a,r,void 0,u);d.selector=n.hasDynamicSeries?g.normalizeSelector(r):r,d.individualSelector=ae.DataLabelViewModel.generateLabelIndividualSelector({hasCategories:!!_.first(n.categories),hasDynamicSeries:n.hasDynamicSeries,featureSwitches:s.featureSwitches,seriesSelector:r}),d.options=a,e.addContainerItem(i.seriesName,i.seriesName,function(e){return ae.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),i.build()},se.prototype.getSeriesLabelsCard=function(){var o=this;if(this.showSeriesCard()){var s=this.originalData,e=s.seriesLabelSetings,n=s.series.length,l=this.showLabelPerSeries(),c=function(e){return o.host.getLocalizedString(e)},t=__assign(__assign({},ae.lineChartObjectProps.seriesLabels),{show:{objectName:"seriesLabels",propertyName:"show"}}),i=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("seriesLabels"),"Visual_SeriesLabels",t,c),a=this.getSeriesLabelSettingsOptions(void 0,e,null,l),u={cardBuilder:i,seriesLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,seriesOptions:a,individualSelector:ae.DataLabelViewModel.generateLabelIndividualSelector({hasCategories:!!_.first(s.categories),hasDynamicSeries:s.hasDynamicSeries,featureSwitches:this.featureSwitches,seriesSelector:1===n&&_.first(s.series).identity.getSelector()})};return i.withDescription("Visual_SeriesDescription"),t.show&&i.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:a.seriesLabelsSettings.show}).build()}),i.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",c("All"),function(e){return ae.DataLabelViewModel.createSeriesLabelsFormattingContainers(u,e)}),l)for(var t=0;t<n;t++){var i=s.series[t],a=i.seriesSettings||s.seriesLabelSetings,r=i.identity.getSelector(),a=o.getSeriesLabelSettingsOptions(void 0,a,r,void 0);u.selector=s.hasDynamicSeries?g.normalizeSelector(r):r,u.individualSelector=ae.DataLabelViewModel.generateLabelIndividualSelector({hasCategories:!!_.first(s.categories),hasDynamicSeries:s.hasDynamicSeries,featureSwitches:o.featureSwitches,seriesSelector:r}),u.seriesOptions=a,e.addContainerItem(i.seriesName,i.seriesName,function(e){return ae.DataLabelViewModel.createSeriesLabelsFormattingContainers(u,e)})}})}),i.build()}},se.prototype.getTotalsCard=function(){var t=this;if(this.supportsTotalLabels()){var e=this.originalData,i=e.totalLabelsSettings;if(i){var a=__assign(__assign({},ae.lineChartObjectProps.totals),{precision:ae.lineChartObjectProps.totals.labelPrecision,displayUnits:ae.lineChartObjectProps.totals.labelDisplayUnits}),r=new ae.builder.FormattingCardBuilder(new ae.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",a,function(e){return t.host.getLocalizedString(e)});r.withDescription("Visual_DataTotalLabelsDescription");e={cardBuilder:r,dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.host,options:this.getTotalLabelSettingsOptions(void 0,i),individualSelector:ae.DataLabelViewModel.generateLabelIndividualSelector({hasCategories:!!_.first(e.categories),hasDynamicSeries:e.hasDynamicSeries,featureSwitches:this.featureSwitches})};return ae.DataLabelViewModel.getDataLabelsFormattingModel(e)}}},se.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getDataPointCard(e.categoryAxisData)},function(){return t.getMarkersCard()},function(){return t.getDataLabelsCard()},function(){return t.getSeriesLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:0}},se.prototype.getDisambiguationSubSelectables=function(e,t){if(!this.data)return[];var i=[];if(void 0===t||3===t)for(var t=this.data.series,a=this.buildViewModel(0),r=this.mainGraphicsSVG,o=0,s=t;o<s.length;o++){var n,l,c=s[o];c.lineStyle.markerProperties.showMarker&&(n=null===(l=null==c?void 0:c.identity)||void 0===l?void 0:l.getSelectorsByColumn(),l=this.host.getLocalizedString("MiniToolbar_Markers",c.seriesName),c=se.getMarkerOutlinesForSeries(c,a,r),i.push(e.createVisualSubSelectionForSingleObject({objectName:"markers",subSelectionType:3,displayName:l,showUI:!0,selectorsByColumn:n,customOutlines:c})))}return i},se.prototype.getSelectorsByColumnFromSubselectedElement=function(e){if("lines"===d3.select(e).attr(ae.SubSelectableObjectNameAttribute)){var e=d3.select(e).datum(),e=null===(e=null==e?void 0:e.identity)||void 0===e?void 0:e.getSelectorsByColumn();if(e)return e}return{}},se.prototype.getSubSelectionStyles=function(e){var t,e=_.first(e).visualObjects;if(0<e.length)switch((e=e[0])&&e.selectorsByColumn&&(t=g.normalizeSelector(g.convertSelectorsByColumnToSelector(e.selectorsByColumn))),e.objectName){case"lines":return t?{type:3,stroke:{reference:{cardUid:"Visual-lines",groupUid:"lines-applySettingsTo-series--colors",sliceUid:"lines-applySettingsTo-series--colors-datapoint",selector:t},label:this.host.getLocalizedString("Visual_Shape_Line")}}:void 0;case"markers":return t?{type:3,fill:{reference:{cardUid:"Visual-markers",groupUid:"markers-applySettingsTo-series--markers",sliceUid:"markers-applySettingsTo-series--markers-markerColor",selector:t},label:this.host.getLocalizedString("Visual_Fill")}}:void 0;default:return}},se.prototype.getSubSelectionShortcuts=function(e){e=_.first(e).visualObjects;if(0<e.length)switch(e[0].objectName){case"lines":return[{type:0},{type:2,sourceUid:"Visual-labels",enabledLabel:this.host.getLocalizedString("Format_AddDataLabels"),disabledLabel:""},{type:2,sourceUid:"Visual-markers",enabledLabel:this.host.getLocalizedString("Format_AddMarkers"),disabledLabel:""},{type:1,destinationUids:[{cardUid:"Visual-lines"}],label:this.host.getLocalizedString("Format_Line")}];case"markers":return[{type:0},{type:1,destinationUids:[{cardUid:"Visual-markers"}],label:this.host.getLocalizedString("Format_Markers")}];default:return}},se.prototype.enumerateObjectInstances=function(e,t){var i,a,r=this.originalData;if(r)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!==(i=this.featureSwitches)&&void 0!==i&&i.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case ae.lineChartProps.lineStyles.strokeLineJoin.objectName:se.enumerateLineStyles(e,r,this.dataView);break;case ae.ForecastHelper.forecastObjectName:this.supportsForecast()&&(a=void 0,_.isEmpty(r.anomalyDetections)||(a=this.host.getLocalizedString("Visual_AnomalyDetection_WarningMessage_NoWithForecast")),ae.ForecastHelper.enumerateObjectInstances(e,r.forecastLines,this.style,a));break;case ae.AnomalyDetectionObjectConstants.capabilityObjectName:this.supportsAnomalyDetection()&&(a=r.isScalar,ae.AnomalyDetectionVisualPlugin.enumerateAnomalyObjectInstances(this.host,this.data,this.dataView,e,r.anomalyDetections,this.style,a,t.selectors))}},se.prototype.enumerateDataPoints=function(e){var i=this.originalData;if(i&&i.series&&0!==i.series.length){N.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(i.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}})},this.featureSwitches);var t=this.getValidDataPointIndices(i),a=0<t.length&&se.chartTypeSupportsExplicitDots(i.isComboChart);if(a){for(var r=[],o=0,s=t;o<s.length;o++){var n=s[o],n=ae.CategoryLevelUtils.concatenateCategoryLevels(i.categoryData[n.categoryIndex].hierarchyCategoryLevels);r.push(n.value)}N.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t,function(e,t){return{color:i.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:i.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:i.hasDynamicSeries?1:3,noDefaultFillColor:a,multipleRole:i.multipleIdentity?ae.LineChartRoles.Rows:void 0,supportDataPointTransparency:this.isAreaChart&&se.areaTransparencyEnabled,dataPointTransparency:i.areaTransparency},this.featureSwitches)}}},se.prototype.enumerateDataLabels=function(e){var t=this.originalData,i=t.dataLabelsSettings,a=t.series.length,r=this.showLabelPerSeries(),o=[ae.labelPosition.auto,ae.labelPosition.above,ae.labelPosition.under];if(this.isStacked()&&(o=[ae.labelPosition.auto,ae.labelPosition.insideCenter,ae.labelPosition.insideEnd],i.position&&o.indexOf(i.position)<0&&(i.position=ae.labelPosition.auto)),ae.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,i,null,r,o),this.featureSwitches),r&&i.showLabelPerSeries)for(var s=0;s<a;s++){var n=t.series[s],l=n.labelSettings||t.dataLabelsSettings;e.pushContainer({displayName:n.seriesName});n=n.identity.getSelector();t.hasDynamicSeries&&(n=g.normalizeSelector(n)),ae.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,l,n,void 0,o),this.featureSwitches),e.popContainer()}},se.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},se.prototype.enumerateSeriesDataLabels=function(e){if(this.showSeriesCard()){var t=this.originalData,i=t.seriesLabelSetings,a=t.series.length,r=this.showLabelPerSeries();if(ae.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,i,null,r),this.featureSwitches),r&&i.showLabelPerSeries)for(var o=0;o<a;o++){var s=t.series[o],n=s.seriesSettings||t.seriesLabelSetings;e.pushContainer({displayName:s.seriesName});s=s.identity.getSelector();t.hasDynamicSeries&&(s=g.normalizeSelector(s)),ae.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,n,s,void 0),this.featureSwitches),e.popContainer()}}},se.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&ae.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},se.enumerateLineStyles=function(e,t,i){var a;if(1<t.series.length&&(a=N.DataViewObjects.getValue(i&&i.metadata&&i.metadata.objects,ae.lineChartProps.lineStyles.showSeries,!1)),ae.LineStyle.enumerate({enumeration:e,style:t.lineStyle,showSeries:a}),a)for(var r=0,o=t.series.length;r<o;r++){var s=t.series[r];e.pushContainer({displayName:s.seriesName}),ae.LineStyle.enumerate({enumeration:e,style:s.lineStyle,selector:s.identity.getSelector()}),e.popContainer()}},se.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()},se.prototype.supportsTrendLine=function(){if(this.data.multipleIdentity)return!1;var e=this.getVisualCategoryAxisIsScalar(),t=this.haveY2Data()&&!this.isComboChart;return!oe.hasFlag(this.lineType,16)&&e&&this.data.hasValues&&!t},se.prototype.supportsStaticReferenceLines=function(){return this.getVisualCategoryAxisIsScalar()},se.prototype.supportsForecast=function(){if(this.data.multipleIdentity)return!1;var e=this.getVisualCategoryAxisIsScalar();return!oe.hasFlag(this.lineType,16)&&e&&this.data.hasValues&&1===this.data.series.length&&!this.hasLegend()},se.prototype.supportsAnomalyDetection=function(){return!this.data.multipleIdentity&&(this.options.featureSwitches.daxTransformEnabled&&!oe.hasFlag(this.lineType,16)&&this.data.hasValues)},se.prototype.isStacked=function(){return oe.hasFlag(this.lineType,16)},se.prototype.shouldSuppressAnimation=function(){return!!this.suppressAnimation},se.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},se.prototype.getLabelSettingsOptions=function(e,t,i,a,r){return{enumeration:e,dataLabelsSettings:t,show:!0,position:!0,positionObject:r,displayUnits:!0,precision:!0,selector:i,showAll:a,fontSize:!0,fontFamily:!0,labelDensity:this.data.isScalar,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},se.prototype.getSeriesLabelSettingsOptions=function(e,t,i,a){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:i,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:a,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},se.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},se.prototype.overrideXScale=function(e){this.xAxisProperties=e},se.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},se.prototype.render=function(e,t,i){var a=this,r=ae.AnimatorCommon.GetAnimationDuration(this.animator,e);this.suppressAnimation&&(r=0);var o=this.buildViewModel(r),s={hoverLine:this.hoverLine,hoverLineContext:this.hoverLineContext,mainGraphicsContext:this.mainGraphicsContext,svgDefs:this.svgDefs,mainGraphicsSVG:this.mainGraphicsSVG};ae.AnomalyDetectionCartesianRenderer.render(this.data.anomalyDetections,s.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration,this.host,this.isInteractiveVisual);var n,r=se.hasAnomalies(this.data)?this.data.anomalyDetections[0].anomalies:[];return this.anomalyNavigationHelper.update(r,this.scrolledData,this.focusedDatum,function(e){return se.updateFocusElement(a.mainGraphicsContext,e,a.buildViewModel(0),a.host)},this.mainGraphicsContext),this.isInteractiveChart?(r=$.extend(s,{dragHandle:this.dragHandle,selectionCircles:this.selectionCircles}),n=se.renderOld(o,r,this.interactivityService,this,this,this.isInteractiveChart,e,this.markerRenderer,this.style),r.dragHandle&&(this.dragHandle=r.dragHandle)):n=se.renderNew({viewModel:o,renderContext:s,interactivityService:this.interactivityService,plotAreaHelper:this,tooltipService:this.tooltipService,tooltipInteractivity:this,markerRenderer:this.markerRenderer,style:this.style,host:this.host,anomalyNavigationHelper:this.anomalyNavigationHelper,featureSwitches:this.featureSwitches,formatMode:i}),this.interactivityService&&(n.navigationOptions={helper:this,navigationStrategy:o.data.isScalar?ae.DataPointNavigationStrategy.SeriesFirst:ae.DataPointNavigationStrategy.CategoryFirst}),ae.ForecastHelper.render(this.data.forecastLines,s.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration),ae.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),n},se.prototype.buildViewModel=function(e){return{currentViewport:this.currentViewport,data:this.scrolledData||this.data,allData:this.data,animationDuration:e,horizontalOffset:this.getXOfFirstCategory(),isComboChart:this.isComboChart,lineClassAndSelector:this.lineClassAndSelector,lineType:this.lineType,margin:this.margin,scale:this.featureSwitches.removeScaleDetector?void 0:this.scaleDetector.getScale(),tooltipsEnabled:this.tooltipsEnabled,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,y2AxisProperties:this.y2AxisProperties,focusedDatum:this.focusedDatum}},se.renderNew=function(o){var s=o.viewModel,n=o.renderContext,l=o.plotAreaHelper,a=o.tooltipService,e=o.tooltipInteractivity,t=o.viewModel.data,i=o.markerRenderer,r=o.style;if(t){for(var c=_.filter(t.series,function(e){return e.uncertainty&&e.uncertainty.renderUncertainty}),u=!_.isEmpty(c),d=[],h=0,p=s.data.series;h<p.length;h++){var g=p[h];d.push(g.lineStyle.markerProperties),u&&g.uncertainty&&(d.push(g.uncertainty.markers),g.uncertainty.markersFlipped&&d.push(g.uncertainty.markersFlipped))}i.ensureMarkers(o.renderContext.svgDefs,d);var y=oe.hasFlag(s.lineType,16),m=s.margin,v=s.currentViewport,f=v.height-(m.top+m.bottom),S=v.width-(m.left+m.right),x=s.xAxisProperties.scale,b=s.yAxisProperties.scale,C=s.y2AxisProperties&&s.y2AxisProperties.scale,w=s.horizontalOffset,D=t.isScalar,v=t.seriesLabelSetings;v&&v.show&&(L=v?100*v.defaultSeriesWidth/S:0,M=Math.min(Math.max(1,L),50),S-=(v?v.defaultSeriesWidth?M:v.seriesMaximumWidth:0)/100*S);var m=s.focusedDatum,A=o.interactivityService&&o.interactivityService.hasSelection(),P=oe.hasFlag(s.lineType,2)||oe.hasFlag(s.lineType,16),L=P||t.lineStyle.shadeArea||_.some(t.series,function(e){return e.lineStyle.shadeArea}),M=s.animationDuration;(t.categories.length*t.series.length>ae.AnimatorCommon.MaxDataPointsToAnimate||i.shouldDisableAnimations()&&_.some(d,function(e){return e.showMarker})||L)&&(M=0);var V,F,T=function(e){return x(se.getXValue(e,D))+w},I=y?(E=function(e){return b(e.stackedValue-e.value)},function(e){return b(e.stackedValue)}):(E=function(e){return(e.isY2?C:b)(0)},function(e){return(e.isY2?C:b)(e.value)});L&&(V=se.getAreaGenerator(T,E,I),F=se.getAreaGenerator(T,E,I).curve(d3.curveStep));var k=se.getLineGenerator(T,I),O=se.getLineGenerator(T,I).curve(d3.curveStep);oe.hasFlag(s.lineType,4)&&(k.curve(d3.curveBasis),V&&V.curve(d3.curveBasis));var N,R,B,H,U,z,j,E=se.hasAnomalies(t)?o.host.getLocalizedString("Visual_Plot")+" "+o.host.getLocalizedString("Visual_Plot_ScreenReader_NavigateToAnomalies"):o.host.getLocalizedString("Visual_Plot");n.mainGraphicsContext.attr("aria-label",E),n.mainGraphicsSVG.attr("height",f).attr("width",S),L?(N=(L=n.mainGraphicsContext.selectAll(se.CategoryAreaSelector.selector).data(_.filter(t.series,function(e){return P||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append(se.PathElementName).classed(se.CategoryAreaSelector.class,!0).merge(L).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return A&&!e.selected?se.AreaTransparencyReductionFactor*(1-t.areaTransparency/100):1-t.areaTransparency/100}),M?N.transition().ease(d3.easeLinear).duration(M).attr("d",function(e){return(e.lineStyle.stepped?F:V)(e.data)}):N.attr("d",function(e){return(e.lineStyle.stepped?F:V)(e.data)}),N.order(),L.exit().remove()):N=n.mainGraphicsContext.selectAll(se.CategoryAreaSelector.selector).remove(),u?(W=n.mainGraphicsContext.selectAll(se.UncertaintySelector.selector).data([1]).join("g").attr("class",se.UncertaintySelector.class),R=d3.area().x(T).y0(function(e){return null!=e.uncertainty.lower?(e.isY2?C:b)(e.uncertainty.lower):I(e)}).y1(function(e){return null!=e.uncertainty.upper?(e.isY2?C:b)(e.uncertainty.upper):I(e)}).defined(function(e){return e&&e.uncertainty&&(null!=e.uncertainty.upper||null!=e.uncertainty.lower)}),B=d3.line().x(T).y(function(e){return(e.isY2?C:b)(e.uncertainty.lower)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.lower}),H=d3.line().x(T).y(function(e){return(e.isY2?C:b)(e.uncertainty.upper)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.upper}),U=function(e,t){return ae.ColumnUtil.getFillOpacity(e.selected,!1,A,A,re.convertTransparencyToOpacity(t))},W.selectAll(se.UncertaintyAreas.selector).data(_.filter(c,function(e){return e.uncertainty.band.show}),function(e){return e.identity.getKey()}).join("g").attr("class",se.UncertaintyAreas.class).order().each(function(e){var t,i,a,r;null==e||_.isEmpty(e.data)||(t=e.uncertainty.band,i=d3.select(this),a=_.filter(e.data,function(e){return!!e}),r=t.bandStyle!==ae.confidenceBandStyle.line?["0"]:[],i.selectAll(se.UncertaintyArea.selector).data(r,function(e){return e}).join("path").attr("class",se.UncertaintyArea.class).style("fill",t.color).style("fill-opacity",U(e,t.transparency)).attr("d",R(a)),r=t.bandStyle!==ae.confidenceBandStyle.fill?["0"]:[],i.selectAll(se.UncertaintyLines.selector).data(r,function(e){return e}).join("g").attr("class",se.UncertaintyLines.class).style("stroke",t.color).style("stroke-opacity",U(e,t.transparency)).style("stroke-width",2).selectAll(se.UncertaintyLine.selector).data(["upper","lower"],function(e){return e}).join("path").attr("class",se.UncertaintyLine.class).attr("d",function(e){return("upper"===e?H:B)(a)}))}),W.selectAll(se.UncertaintyBars.selector).data(_.filter(c,function(e){return e.uncertainty.bar.show}),function(e){return e.identity.getKey()}).join("g").attr("class",se.UncertaintyBars.class).style("fill",function(e){return e.uncertainty.bar.color}).style("stroke",function(e){return e.uncertainty.bar.borderColor}).style("stroke-width",function(e){return e.uncertainty.bar.borderWidth}).order().each(function(e){var t;null==e||_.isEmpty(e.data)||(t=e.uncertainty.bar,e=_.filter(e.data,function(e){return!!e}),d3.select(this).selectAll(se.UncertaintyBar.selector).data(e,function(e){return e.identity.getKey()}).join("path").attr("class",se.UncertaintyBar.class).attr("transform",function(e){return"translate("+T(e)+", "+(e.isY2?C:b)(e.value)+")"}).attr("d",function(e){return d3.symbol().type(ae.UncertaintyHelper.errorBarSymbol(e,t,e.isY2?C:b)).size(10)()}))}),z=b.range()[1]>b.range()[0],G=W.selectAll(se.UncertaintyMarkers.selector).data(_.filter(c,function(e){return e.uncertainty.markers.showMarker}),function(e){return e.identity.getKey()}).join("g").attr("class",se.UncertaintyMarkers.class).style("stroke-opacity",0).style("stroke-width",2).order().selectAll(se.UncertaintyMarker.selector).data(function(t){return _.map(["upper","lower"],function(e){return{seriesData:t,type:e}})}).join("path").attr("class",se.UncertaintyMarker.class).style("stroke-width","inherit").attr("d",function(e){return("upper"===e.type&&!z||"lower"===e.type&&z?H:B)(e.seriesData.data)}),i.renderUncertaintyMarkers(G),j=[se.UncertaintyAreas,se.UncertaintyBars,se.UncertaintyMarkers],(G=W.selectAll(_.map(j,function(e){return e.selector}).join(", ")).nodes()).sort(function(e,t){for(var i=0,a=0,r=j.length;a<r;a++)i+=Number(d3.select(e).classed(j[a].class))*a,i-=Number(d3.select(t).classed(j[a].class))*a;return i}),d3.selectAll(G).order()):n.mainGraphicsContext.selectAll(se.UncertaintySelector.selector).remove();var W=n.mainGraphicsContext.selectAll(s.lineClassAndSelector.selector).data(t.series,function(e){return e.identity.getKey()}),G=W.enter().append(se.PathElementName).classed(s.lineClassAndSelector.class,!0).merge(W);G.style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return ae.ColumnUtil.getFillOpacity(e.selected,!1,A,A)}).style("stroke-width",function(e){return r.isHighContrast?ae.CartesianHelper.defaultLineStrokeWidth:e.lineStyle.strokeWidth}).style("stroke-linejoin",function(e){return e.lineStyle.lineJoin}).style("stroke-dasharray",function(e){return ae.LineStyle.getStrokeDashArrayFromLineStyle(e.lineStyle.style)}),M?G.transition().ease(d3.easeLinear).duration(M).attr("d",function(e){return(e.lineStyle.stepped?O:k)(e.data)}):G.attr("d",function(e){return(e.lineStyle.stepped?O:k)(e.data)}),G.order(),W.exit().remove();G=n.mainGraphicsContext.selectAll(se.MarkerLineClassSelector.selector).data(_.filter(t.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()}),W=G.enter().append(se.PathElementName).classed(se.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",ae.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(G);M?Y=W.transition().ease(d3.easeLinear).duration(M).attr("d",function(e){return k(e.data)}).style("opacity",function(e){return ae.ColumnUtil.getFillOpacity(e.selected,!1,A,!1)}).style("pointer-events","none"):W.attr("d",function(e){return k(e.data)}).style("opacity",function(e){return ae.ColumnUtil.getFillOpacity(e.selected,!1,A,!1)}).style("pointer-events","none"),W.order(),i.renderMarkers(Y||W),G.exit().remove();var i=n.mainGraphicsContext.selectAll(se.InteractivityLineClassSelector.selector).data(_.filter(t.series,function(e){return se.getLeftmostPathPointFromSeriesData(e)}),function(e){return e.identity.getKey()}),Y=i.enter().append(se.PathElementName).classed(se.InteractivityLineClassSelector.class,!0).style("stroke-width",se.interactivityStrokeWidth).style("stroke-linejoin",ae.strokeLineJoin.round).attr(ae.SubSelectableObjectNameAttribute,"lines").attr(ae.SubSelectableTypeAttribute,3).classed(ae.HtmlSubSelectableClass,!0).classed(ae.UngroupableSubSelectionClass,!0).merge(i);Y.attr("d",function(e){if(!D){var t=se.getLeftmostPathPointFromSeriesData(e);if(t){var i=_.findIndex(e.data,function(e){return e&&e.categoryIndex===t.categoryIndex});if(0<i&&i<e.data.length){i=e.data.slice(i);return(e.lineStyle.stepped?O:k)(i)}}}return(e.lineStyle.stepped?O:k)(e.data)}),i.exit().remove(),Y.order(),Y.each(function(){var t=this;ae.HtmlSubSelectionHelper.setDataForElement(t,{getDisplayName:function(){var e=d3.select(t).datum();return o.host.getLocalizedString("MiniToolbar_Line",e.seriesName)},getRegionOutlines:function(){var e=d3.select(t).datum();return se.getMarkerOutlinesForSeries(e,o.viewModel,o.renderContext.mainGraphicsSVG)}})});W=n.mainGraphicsContext.selectAll(se.CategorySelector.selector).data(t.series,function(e){return e.identity.getKey()}),G=W.enter().append("g").classed(se.CategorySelector.class,!0).merge(W);W.exit().remove(),W.order();i=G.selectAll(se.CategoryValuePoint.selector).data(function(i){return i.data.filter(function(e,t){return se.shouldDrawCircle(i,t)})},function(e){return e.key}),W=i.enter().append(se.CircleElementName).classed(se.CategoryValuePoint.class,!0).merge(i);W.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return e.lineStyle.markerProperties.showMarker?0:ae.ColumnUtil.getFillOpacity(e.selected,!1,A,!1)}),M?W.transition().duration(M).attrs({cx:function(e,t){return x(se.getXValue(e,D))+w},cy:function(e,t){return e.isY2?C(e.value):b(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+se.CircleRadiusExtra}):W.attrs({cx:function(e,t){return x(se.getXValue(e,D))+w},cy:function(e,t){return e.isY2?C(e.value):b(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+se.CircleRadiusExtra}),i.exit().remove();var X,K,i=G.selectAll(se.CategoryPointSelector.selector).data(function(e){return se.chartTypeSupportsExplicitDots(s.isComboChart)?_.filter(e.data,function(e){return e&&null!=e.pointColor}):[]},function(e){return e.key}),G=i.enter().append(se.CircleElementName).classed(se.CategoryPointSelector.class,!0).style("pointer-events","none").merge(i);G.style("fill",function(e){return e.pointColor}),M?G.transition().duration(M).attrs({cx:function(e){return x(se.getXValue(e,D))+w},cy:function(e,t){return e.isY2?C(e.value):b(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+se.PointRadiusExtra}):G.attrs({cx:function(e){return x(se.getXValue(e,D))+w},cy:function(e,t){return e.isY2?C(e.value):b(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+se.PointRadiusExtra}),i.exit().remove(),G.order(),0<t.series.length&&(n.mainGraphicsContext.selectAll(se.SelectedMarkerLineClassSelector.selector).data([0]).enter().append("g").attr("class",se.SelectedMarkerLineClassSelector.class),(X=this.renderSelectedPointsGenerator(n.mainGraphicsContext,s))(A)),o.interactivityService&&(K=this.updateFocusElement(n.mainGraphicsContext,m,s,o.host));M=t.dataLabelsSettings,i=[],m=[];M&&M.show&&(i=i.concat(this.createLabelDataPoints(s,r))),v&&v.show&&(Z=v.seriesPosition===ae.labelSeriesPosition.right?1:0,m=m.concat(this.createSeriesLabelDataPoints(s,r,Z?S:0,Z)));var Z=t.totalLabelsSettings;Z&&Z.show&&y&&(i=i.concat(this.createTotalLabelDataPoints(s,r))),_.map(_.filter(c,function(e){return e.uncertainty.labels.show}),function(e){return e.uncertainty.labels})&&(i=i.concat(this.createUncertaintyLabels(s,r,o.host)));G={width:S,height:f,interactivityLines:Y,dots:W,explicitDots:G,isComboChart:s.isComboChart,binnedLineSamplingApplied:t.binnedLineSamplingApplied,hasDynamicSeries:t.hasDynamicSeries};a.removeTooltips(G,e),s.tooltipsEnabled&&!o.formatMode&&a.applyTooltips(G,l,e);var q,e=n.mainGraphicsContext.selectAll(_.map(se.RenderOrderableElements,function(e){return e.selector}).join(", ")).nodes();e.sort(function(e,t){for(var i=0,a=0;a<se.RenderOrderableElements.length;a++)i+=Number(d3.select(e).classed(se.RenderOrderableElements[a].class))*a,i-=Number(d3.select(t).classed(se.RenderOrderableElements[a].class))*a;return i}),d3.selectAll(e).order();var $=[];if(o.interactivityService){for(var J=[],Q=0,ee=s.allData.series;Q<ee.length;Q++){g=ee[Q];$.push(g);var te=_.filter(g.data,function(e){return e});J.push.apply(J,te||[])}q=[],se.hasAnomalies(t)&&(ie=_.filter(t.anomalyDetections[0].anomalies,function(e){return e.isAnomaly}),q.push.apply(q,ie||[]));var ie=n.mainGraphicsSVG.selectAll(ae.AnomalyDetectionCartesianRenderer.anomalyPointClassSelector.selector),ie={interactivityLines:Y,root:n.mainGraphicsContext,focusMarker:K,selectedMarkersCallback:X,dots:W,areas:N,tooltipOverlay:a.getTooltipOverlayElement(),getCategoryIndex:function(e,t,i){return i=i&&!a.usingHoverLine,l.getCategoryIndexFromSeriesAndPointX(e,t,i)},categoryIdentities:t.categoryIdentities,hitTester:new ne({dataPoints:J,isComboChart:s.isComboChart,isScalar:D,hasCategories:0<t.categoryIdentities.length}),onSelecting:o.host.onSelecting,anomalies:ie,anomalyNavigationHelper:o.anomalyNavigationHelper,areaTransparency:t.areaTransparency,onLineSubSelection:function(e,t,i,a,r){se.onLineSubSelection(e,t,i,a,l,o.host,s,n.mainGraphicsSVG,r)}}}return{dataPoints:J?__spreadArray(__spreadArray([],$),J):void 0,behaviorOptions:ie,labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:i,labelDataPointSeriesGroups:m,animateLabels:!1,anomalies:q}}},se.hasAnomalies=function(e){return _.some(e.anomalyDetections,function(e){return!_.isEmpty(e.anomaliesCategoryIndex)})},se.isAnomaly=function(e){return e.isAnomaly},se.getAreaGenerator=function(e,t,i){return d3.area().x(e).y0(t).y1(i).defined(function(e){return e&&null!==e.value})},se.getLineGenerator=function(e,t){return d3.line().x(e).y(t).defined(function(e){return e&&null!==e.value})},se.renderSelectedPointsGenerator=function(s,n){var e=n.data,l=e.series,c=e.isScalar,u=oe.hasFlag(n.lineType,16),d=n.horizontalOffset,h=n.xAxisProperties.scale,p=n.yAxisProperties.scale,g=n.y2AxisProperties&&n.y2AxisProperties.scale,y=s.selectAll(se.SelectedMarkerLineClassSelector.selector);return function(i){var e=_.flatten(_.map(l,function(e){return _.filter(e.data,function(e){return e&&e.selected&&null!==e.value})})),t=y.selectAll(se.PathElementName).data(e,function(e){return e.key}),a=_.map(e,function(e){return e.seriesIndex}),e=t.enter().append(se.PathElementName).attr("pointer-events","none").merge(t);e.attr("d",function(e){return e.lineStyle.markerProperties.showMarker?ae.Markers.getPathWithRadius(e.lineStyle.markerProperties.shape,e.lineStyle.markerProperties.size*ae.MarkerRenderer.sizeRatio):ae.Markers.getPathWithRadius(ae.markerShape.circle,e.lineStyle.strokeWidth/2+se.TooltipCircleRadiusExtra)}).attr("transform",function(e){return"translate("+(h(se.getXValue(e,c))+d)+","+(e.isY2?g(e.value):p(u?e.stackedValue:e.value))+")"}).style("stroke-width",function(e){return ae.Markers.getStrokeWidth(e.lineStyle.markerProperties.shape)}).style("stroke-opacity",1).style("stroke",function(e){return e.lineStyle.markerProperties.color}).style("fill",function(e){return e.lineStyle.markerProperties.color}),t.exit().remove();var t=s.selectAll(n.lineClassAndSelector.selector),r=[];t.each(function(e,t){r[t]=e.selected,e.selected=-1<a.indexOf(e.lineIndex)}).style("stroke-opacity",function(e,t){return ae.ColumnUtil.getFillOpacity(e.selected,!1,i,i&&!r[t])}),s.selectAll(se.MarkerLineClassSelector.selector).style("opacity",function(e){return ae.ColumnUtil.getFillOpacity(!1,!1,i,!1)});function o(e,t){return ae.ColumnUtil.getFillOpacity(e.selected||-1<a.indexOf(e.lineIndex),!1,i,i&&!r[e.lineIndex],null!=t?re.convertTransparencyToOpacity(t):void 0)}t=s.select(se.UncertaintySelector.selector);return t.selectAll(se.UncertaintyAreas.selector).each(function(e){var t=e.uncertainty.band.transparency,i=d3.select(this);i.selectAll(se.UncertaintyArea.selector).style("fill-opacity",o(e,t)),i.selectAll(se.UncertaintyLines.selector).style("stroke-opacity",o(e,t))}),t.selectAll(se.UncertaintyBars.selector).style("fill-opacity",function(e){return o(e)}).style("stroke-opacity",function(e){return o(e)}),t.selectAll(se.UncertaintyMarker.selector).style("opacity",function(e){return o(e.seriesData)}),e}},se.updateFocusElement=function(e,t,r,o){var i=r.xAxisProperties.scale,a=r.yAxisProperties.scale,s=r.y2AxisProperties&&r.y2AxisProperties.scale,n=r.data.isScalar,l=r.horizontalOffset,c=oe.hasFlag(r.lineType,16),u=d.isInternetExplorerOrEdge(),t=e.selectAll(se.FocusElementSelector.selector).data(t?[t]:[]),u=t.enter().append(se.CircleElementName).attr("class",se.FocusElementSelector.class).attr("tabindex",0).attr("focusable",!0).attr("role","option").classed(ae.SetFocusRingClassName,!u).merge(t);return u.attr("aria-label",function(t){if(se.isAnomaly(t))return o.getLocalizedString("Anomaly_ScreenReader_Hint");var e=t,i=!1;se.hasAnomalies(r.data)&&(a=r.data.anomalyDetections[0].anomaliesCategoryIndex,i=_.some(a,function(e){return e===t.categoryIndex}));var a=ae.tooltipUtils.formatTooltipInfo(e.tooltipInfo),e=e.uncertainty;return e&&(e.upperTooltip&&(a+=" "+ae.tooltipUtils.formatTooltipInfo([e.upperTooltip])),e.lowerTooltip&&(a+=" "+ae.tooltipUtils.formatTooltipInfo([e.lowerTooltip]))),i&&(a+=" "+o.getLocalizedString("AnomalyPoint_ScreenReader_Hint")),a}).attr("cx",function(e){return i(se.getXValue(e,n))+l||0}).attr("cy",function(e){if(se.isAnomaly(e)){var t=r.data.anomalyDetections[0].markerShapeSize;return ae.AnomalyDetectionCartesianRenderer.getAnomalyYPosition(e,a,t)}return e.isY2?s(e.value):a(c?e.stackedValue:e.value)}).attr("r",function(e){if(se.isAnomaly(e)){var t=r.data.anomalyDetections[0].markerShapeSize;return ae.AnomalyDetectionCartesianRenderer.getAnomalySize(t)}t=e.lineStyle.markerProperties;return t.showMarker?t.size*ae.MarkerRenderer.sizeRatio:e.lineStyle.strokeWidth/2+se.TooltipCircleRadiusExtra}).style("fill","none"),t.exit().remove(),u},se.getMarkerXPositionCalc=function(e,t,i,a){return(t(se.getXValue(e,i.data.isScalar))+i.horizontalOffset)*i.scale.x+a},se.getMarkerXPosition=function(e,t,i,a){var r=t.xAxisProperties.scale,i=i.node().getBoundingClientRect().left,e=_.find(e.data,function(e){return e&&e.categoryIndex===a});return Math.floor(se.getMarkerXPositionCalc(e,r,t,i))},se.getMarkerOutlinesForSeries=function(e,t,i){var a=e.data,i=i.node().getBoundingClientRect(),r=i.left,o=i.top,s=t.xAxisProperties.scale,n=t.yAxisProperties.scale,i=t.data.lineStyle.markerProperties.size*t.scale.x,l=Math.max(i+1.2*i,10)*t.scale.x;l%2==0&&++l;for(var c=[],u=0,d=a;u<d.length;u++){var h=d[u];h&&c.push({x:Math.floor(se.getMarkerXPositionCalc(h,s,t,r)-l/2),y:Math.floor(n(h.value)*t.scale.y-l/2+o),width:l,height:l,type:0})}return[{id:e.key,outlines:c}]},se.onLineSubSelection=function(e,t,i,a,r,o,s,n,l){var c,u=ae.InteractivityUtils.getPositionOfLastInputEvent(),t=r.getCategoryIndexFromSeriesAndPointX(e,t,!0),t=se.getMarkerXPosition(e,s,n,t),s=se.getMarkerOutlinesForSeries(e,s,n),n=null===(n=e.identity)||void 0===n?void 0:n.getSelectorsByColumn(),e=e.lineStyle.markerProperties.showMarker&&Math.abs(t-u.x)<=e.lineStyle.markerProperties.size/2?(c="markers",o.getLocalizedString("MiniToolbar_Markers",e.seriesName)):(c="lines",o.getLocalizedString("MiniToolbar_Line",e.seriesName)),a={x:a.clientX,y:a.clientY},s=i.createVisualSubSelectionForSingleObject({objectName:c,subSelectionType:3,displayName:e,showUI:l,selectorsByColumn:n,selectionOrigin:a,customOutlines:s});i.subSelect(s)},se.prototype.getFirstElement=function(t,e){if(void 0===e&&(e=!1),null==t)return{element:this.mainGraphicsContext.select(se.FocusElementSelector.selector).node()};var i,a=e?_.findLast:_.find;if(a(this.data.series,function(e){return i=a(e.data,function(e){return e&&e.categoryIndex===t&&null!=e.value})}),i&&this.scrolledData&&-1===this.scrolledData.categories.indexOf(i.categoryValue))return{element:null,targetCategoryIndex:i.categoryIndex,targetSeriesIndex:i.seriesIndex};if(i)return this.focusedDatum=i,{element:se.updateFocusElement(this.mainGraphicsContext,i,this.buildViewModel(0),this.host).node(),targetCategoryIndex:t,targetSeriesIndex:i.seriesIndex};e=e?this.data.series.length-1:0;return{element:null,targetCategoryIndex:t,targetSeriesIndex:e}},se.prototype.getNextDataPoint=function(t,e,i){var a=this.focusedDatum;switch(i){case ae.DataDirection.NextCategory:case ae.DataDirection.PreviousCategory:var r=this.data.series[e];a=r?(r=r.data,o=_.findIndex(r,function(e){return e&&e.categoryIndex===t}),this.pickNextAvailableIndex(r,o,e,i)):void 0;break;case ae.DataDirection.NextSeries:case ae.DataDirection.PreviousSeries:var o=_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})});a=this.pickNextAvailableIndex(o,e,t,i)}if(a)return this.scrolledData&&-1===this.scrolledData.categories.indexOf(a.categoryValue)?{element:null,targetCategoryIndex:a.categoryIndex,targetSeriesIndex:a.seriesIndex}:(this.focusedDatum=a,{element:se.updateFocusElement(this.mainGraphicsContext,a,this.buildViewModel(0),this.host).node(),targetCategoryIndex:a.categoryIndex,targetSeriesIndex:a.seriesIndex});var s=i===ae.DataDirection.NextSeries||i===ae.DataDirection.NextCategory?1:-1,n=this.data.categories.length;t=this.incrementIndex(t,s,n);n=e;return i!==ae.DataDirection.NextSeries&&i!==ae.DataDirection.PreviousSeries||(n=s<0?this.data.series.length-1:0),{element:null,targetCategoryIndex:t,targetSeriesIndex:n}},se.prototype.pickNextAvailableIndex=function(e,t,i,a){var r=a===ae.DataDirection.NextCategory||a===ae.DataDirection.PreviousCategory?this.rollToNextSeries:this.rollToNextCategory,o=a===ae.DataDirection.NextSeries||a===ae.DataDirection.NextCategory?1:-1,s=t;do{if((s+=o)>=e.length||s<0)return r.call(this,i,a)}while(s!==t&&(!e[s]||null==e[s].value));return e[s]},se.prototype.rollToNextSeries=function(e,t){t===ae.DataDirection.PreviousCategory||ae.DataDirection.NextCategory;var i=t===ae.DataDirection.PreviousCategory?-1:1,a=t===ae.DataDirection.PreviousCategory?_.findLast:_.find,t=this.data.series.length;return e=this.incrementIndex(e,i,t),a(this.data.series[e].data,function(e){return e&&null!=e.value})},se.prototype.rollToNextCategory=function(t,e){e===ae.DataDirection.PreviousSeries||ae.DataDirection.NextSeries;var i=e===ae.DataDirection.PreviousSeries?-1:1,a=e===ae.DataDirection.PreviousSeries?_.findLast:_.find,e=this.data.categories.length;t=this.incrementIndex(t,i,e);e=_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})});return a(e,function(e){return e&&null!=e.value})||a(e,function(e){return!!e})},se.prototype.incrementIndex=function(e,t,i){return i<=(e+=t)?e=0:e<0&&(e=i-1),e},se.renderOld=function(e,t,i,a,r,o,s,n,l){var c=this,u=e.data;if(u){var d=e.margin,h=e.currentViewport,p=h.height-(d.top+d.bottom),g=e.xAxisProperties.scale,y=e.yAxisProperties.scale,m=e.y2AxisProperties&&e.y2AxisProperties.scale,v=u.isScalar,f=e.animationDuration;n.shouldDisableAnimations()&&(f=0);var S,x=h.width-(d.left+d.right),d=h.height-(d.top+d.bottom),b=i&&i.hasSelection(),C=function(e){return(e.isY2?m:y)(e.value)},w=oe.hasFlag(e.lineType,16)||oe.hasFlag(e.lineType,2),i=w||u.lineStyle.shadeArea||_.some(u.series,function(e){return e.lineStyle.shadeArea});i&&(S=d3.area().x(function(e){return g(se.getXValue(e,v))}).y0(p).y1(C).defined(function(e){return null!==e.value}));var D=d3.line().x(function(e){return g(se.getXValue(e,v))}).y(C).defined(function(e){return!!e&&null!==e.value});oe.hasFlag(e.lineType,4)&&(D.curve(d3.curveBasis),S&&S.curve(d3.curveBasis));p=e.horizontalOffset;t.mainGraphicsContext.attr("transform",ae.SVGUtil.translate(p,0)),t.mainGraphicsSVG.attr("height",d).attr("width",x),t.hoverLineContext.attr("transform",ae.SVGUtil.translate(p,0)),i?((A=t.mainGraphicsContext.selectAll(se.CategoryAreaSelector.selector).data(_.filter(u.series,function(e){return w||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append("g").classed(se.CategoryAreaSelector.class,!0).append(se.PathElementName),t.mainGraphicsContext.selectAll(se.CategoryAreaSelector.selector).select(se.PathElementName).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return S(e.data)}).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return b&&!e.selected?c.AreaTransparencyReductionFactor*(1-u.areaTransparency/100):1-u.areaTransparency/100}),A.exit().remove()):t.mainGraphicsContext.selectAll(se.CategoryAreaSelector.selector).remove();var i=t.mainGraphicsContext.selectAll(se.CategorySelector.selector).data(u.series,function(e){return e.identity.getKey()}),A=i.enter().append("g").classed(se.CategorySelector.class,!0);A.append(se.PathElementName),A.selectAll(se.CategoryValuePoint.selector).data(function(e){return e.data}).enter().append(se.CircleElementName).classed(se.CategoryValuePoint.class,!0);A=A.merge(i);i.exit().remove(),o&&!t.dragHandle&&(M=d,t.dragHandle=t.hoverLineContext.append("circle").attr("cx",0).attr("cy",M).attr("r","6px").classed("drag-handle",!0));for(var P=A.data().length;t.selectionCircles.length<P;){var L=t.hoverLineContext.append(se.CircleElementName).classed(se.CircleClassName,!0).attr("r",u.lineStyle.strokeWidth/2+se.CircleRadiusExtra).style("opacity",0);t.selectionCircles.push(L)}for(;t.selectionCircles.length>P;)t.selectionCircles.pop().remove();d=t.mainGraphicsContext.selectAll(se.CategorySelector.selector);d.select(se.PathElementName).classed(e.lineClassAndSelector.class,!0).style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return ae.ColumnUtil.getFillOpacity(e.selected,!1,b,b)}).style("stroke-width",u.lineStyle.strokeWidth).style("stroke-linejoin",u.lineStyle.lineJoin).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return D(e.data)}),n.ensureMarkers(t.svgDefs,_.map(e.data.series,function(e){return e.lineStyle.markerProperties}));var M=t.mainGraphicsContext.selectAll(se.MarkerLineClassSelector.selector).data(_.filter(u.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()}),A=M.enter().append(se.PathElementName).classed(se.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",ae.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(M).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return D(e.data)}).style("opacity",function(e){return ae.ColumnUtil.getFillOpacity(e.selected,!1,b,!1)}).style("pointer-events","none");n.renderMarkers(A),M.exit().remove();var V,F,T=this,d=d.selectAll(se.CategoryValuePoint.selector),f=d.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return ae.ColumnUtil.getFillOpacity(e.selected,!1,b,!1)}).transition().duration(f).attrs({cx:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?g(T.getXValue(e,v)):0},cy:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?C(e):0},r:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?u.lineStyle.strokeWidth/2+se.CircleRadiusExtra:0}});o&&se.hasDataPoint(u.series)&&(V=d.size(),F=0,f.on("end",function(){++F===V&&r.selectColumn(ae.CartesianHelper.findMaxCategoryIndex(u.series),!0)}));var I,k=null;if(u.dataLabelsSettings.show)for(var k=[],O=0,N=u.series.length;O<N;O++)Array.prototype.push.apply(k,u.series[O].data);return i.exit().remove(),u.dataLabelsSettings.show&&(I=se.createLabelDataPoints(e,l)),null==k?null:{dataPoints:k,behaviorOptions:null,labelDataPoints:null,labelsAreNumeric:null,labelDataPointGroups:I,animateLabels:!s}}},se.getLeftmostPathPointFromSeriesData=function(e,a){return(a?_.findLast:_.find)(e.data,function(e,t,i){t=a?i[t-1]:i[t+1];return null!=e&&null!=e.value&&null!=t&&null!=t.value})},se.getSeriesTooltipInfo=function(e,t){var i;if(!e)return null;var a=e.dataPoints;if(_.isEmpty(a))return null;var r="#000000",o=!_.isEmpty(a)&&a[0].seriesDisplayName,s=[],n=[],l=0,c=e.legendMarkerRendering,u=c!==ae.legendMarkerRendering.markerOnly&&c!==ae.legendMarkerRendering.markerCircleDefault,d=a[0].additionalTooltipItems;if(a.every(function(e){return _.isEqual(e.additionalTooltipItems,d)})){for(var h in a){var p,g=a[h];if(10<=l)break;null!=g.value&&(p=g.measure,null!==(i=g.uncertaintyTooltipItems)&&void 0!==i&&i.rangeTooltip&&(p=g.uncertaintyTooltipItems.rangeTooltip.value),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.seriesName||g.measureDisplayName,value:p,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),n.push(+h),l++)}if(e.hasUncertainty&&(s=se.augmentTooltipInfoWithUncertainty(s,a,n,t)),!_.isEmpty(d))for(var y=0,m=d;y<m.length;y++){var v=m[y];if(10<=l)break;s.push({color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:ae.markerShape.none}),l++}}else for(var f=0,S=a;f<S.length;f++){g=S[f];if(10<=l)break;if(null!=g.value&&(o&&(s.push({header:g.category,subheader:g.multiple,displayName:g.seriesDisplayName,value:g.seriesName,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.measureDisplayName,value:g.measure,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++,!_.isEmpty(g.additionalTooltipItems)))for(var x=0,b=g.additionalTooltipItems;x<b.length;x++){v=b[x];if(10<=l)break;s.push({header:g.category,subheader:g.multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:ae.markerShape.none}),l++}}if(!_.isEmpty(e.additionalTooltipItems))for(var C=0,w=e.additionalTooltipItems;C<w.length;C++){v=w[C];if(10<=l)break;s.push({header:a[0].category,subheader:a[0].multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:ae.markerShape.none}),l++}return 0===s.length?null:s},se.augmentTooltipInfoWithUncertainty=function(e,t,i,a){e.length,i.length;for(var r,o=[],s=1/0,n=-1,l=0,c=i.length;l<c;l++)(h=t[i[l]]).uncertaintyTooltipItems&&(h.isY2?(r=Math.abs(h.value-a.y2.point))<a.y2.threshold?o.push(l):r<s&&(s=r,n=l):((r=Math.abs(h.value-a.y.point))<a.y.threshold&&o.push(l),r<s&&(s=r,n=l)));for(var u=[],l=0,c=i.length;l<c;l++){var d,h=t[i[l]],p=e[l];_.includes(o,l)||n===l?((d=h.uncertaintyTooltipItems).upperTooltip&&u.push(__assign({header:h.category,subheader:h.multiple},d.upperTooltip)),u.push(p),d.lowerTooltip&&u.push(d.lowerTooltip)):u.push(p)}return u},se.prototype.getTooltipInfoForPoint=function(e,t){var i,a=e.data,r=this.getCategoryIndexFromSeriesAndPointX(a,t,!0,e.context);if(i=a&&a.data&&a.data.length?_.find(a.data,function(e){return e&&e.categoryIndex===r}):i)return i.tooltipInfo},se.isDataPointData=function(e){return e&&null!=e.categoryIndex},se.isForecastPoint=function(e){return e&&null!=e.points},se.prototype.getCategoryIndexFromTooltipEvent=function(e,t){e=e.data;if(!se.isForecastPoint(e))return se.isDataPointData(e)?e.categoryIndex:this.getCategoryIndexFromSeriesAndPointX(e,t,!1)},se.prototype.getCategoryIndexFromSeriesAndPointX=function(e,t,i,a){var r=0,o=this.data.categoryData,s=this.xAxisProperties.scale;return e&&!_.isEmpty(e.data)&&this.xAxisProperties&&(t=this.adjustPathXCoordinate(t,a),a=this.data.isScalar&&s.range()[1]<s.range()[0],(a=se.getLeftmostPathPointFromSeriesData(e,a))&&(r=s(se.getXValue(a,this.data.isScalar))+this.getXOfFirstCategory()),i&&(o=_.map(e.data,function(e){return ae.CartesianHelper.extractCategoryFromDataPoint(e)}))),se.findCategoryIndex({pointX:t,offsetX:r,categoryData:o,currentViewport:this.currentViewport,scaleDetector:this.scaleDetector,scale:s,categoryThickness:this.xAxisProperties.categoryThickness,isScalar:this.data.isScalar},this.featureSwitches)},se.prototype.getYValueFromTooltipEvent=function(e,t){var i=null===(a=this.yAxisProperties)||void 0===a?void 0:a.scale,a=null===(r=this.y2AxisProperties)||void 0===r?void 0:r.scale,r=this.currentViewport.scale;N.Double.equalWithPrecision(r,1,1e-5)||(e/=r),t.classList.contains(se.TooltipOverlaySelector.class)||t.classList.contains(se.lineChartSVGClassName)||(e+=t.getBBox().y);var o,t={};return i&&(o=i.domain(),t.y={point:i.invert(e),threshold:.1*(o[1]-o[0])}),a&&(o=a.domain(),t.y2={point:a.invert(e),threshold:.1*(o[1]-o[0])}),t},se.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.isScalar},se.prototype.getSupportedCategoryAxisType=function(){var t,e=!1,i=this.dataView&&this.dataView.categorical?this.dataView.categorical.categories:void 0;return(e=!_.isEmpty(i)?i.some(function(e){if(e.source&&e.source.type){t=e.source.type;e=ae.ScalarUtils.getScalarKeys(e);return!w.isOrdinal(t)||e&&!_.isEmpty(e.values)}}):e)?ae.axisType.both:ae.axisType.categorical},se.prototype.getPreferredPlotArea=function(e,t,i,a){return ae.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a=void 0===a?0:a)},se.prototype.getAvailableWidth=function(){var e=this.currentViewport.width-(this.margin.left+this.margin.right);return Math.max(0,e)},se.prototype.getAvailableHeight=function(){var e=this.currentViewport.height-(this.margin.top+this.margin.bottom);return Math.max(0,e)},se.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++){var s=e[r];a[r]=N.Prototype.inherit(s);for(var n=[],l=i,c=i+t;l<c;l++)n.push(s.data[l]);a[r].data=n}return a},se.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.xAxisProperties.scale;if(ae.D3Helper.isScaleBand(e))return e.bandwidth()/2}return 0},se.hasDataPoint=function(e){if(0===e.length)return!1;for(var t=0,i=e.length;t<i;t++)if(0<e[t].data.length)return!0;return!1},se.getXValue=function(e,t){return t?e.categoryValue:e.categoryIndex},se.shouldDrawCircle=function(e,t){var i=e.data[t];if(null==i||null===i.value)return!1;i=e.data[t-1],i=null==i||null===i.value,t=e.data[t+1],t=null==t||null===t.value;return i&&t},se.prototype.getHoverLineDataForCategory=function(e){var t=this.getChartX(e)+this.getXOfFirstCategory(),i=this.createTooltipData(e);if(i){e=i.dataPoints;return 0<i.dataPoints.length&&this.setHoverLineForTooltip(t),this.setDotsForTooltip(t,e,this.data.lineStyle.strokeWidth/2+se.TooltipCircleRadiusExtra),i}},se.prototype.getHoverLineIdentities=function(t,e){var i=null===(a=null===(o=this.data)||void 0===o?void 0:o.categoryIdentities)||void 0===a?void 0:a[t],a=null===(o=null===(r=this.data)||void 0===r?void 0:r.multiplesCategoryIdentities)||void 0===o?void 0:o[t],r=[],o=_.find(null!=e?e:[],function(e){return(null==e?void 0:e.categoryIndex)===t}),e=null==o?void 0:o.identity;return e&&(a.exclude=((o={})[1]=!0,o),i.exclude=((o={})[1]=!0,o),e.exclude=((o={})[0]=!0,o),r.push(e)),(a||i)&&r.push(null!=a?a:i),r},se.prototype.setHoverLineForTooltip=function(e){this.hoverLine.attr("x1",e=e||0).attr("x2",e).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1)},se.prototype.clearHoverLine=function(){this.hoverLine.style("opacity",ae.SVGUtil.AlmostZero),this.hoverLineContext.selectAll(se.HoverLineCircleDot.selector).remove()},se.prototype.setDotsForTooltip=function(e,t,i){var a=this;void 0===i&&(i=3);var r=oe.hasFlag(this.lineType,16)?function(e){return a.yAxisProperties.scale(e.stackedValue)}:function(e){return(e.isY2?a.y2AxisProperties:a.yAxisProperties).scale(e.value)},t=this.hoverLineContext.selectAll(se.HoverLineCircleDot.selector).data(_.filter(t,function(e){return e.showDot}));t.enter().append(se.CircleElementName).classed(se.HoverLineCircleDot.class,!0).merge(t).filter(function(e){return null!=e.value}).attr("fill",function(e){return e.color}).attr("r",i).attr("cx",e).attr("cy",r),t.exit().remove()},se.prototype.selectColumn=function(e,t){!(t=void 0!==t&&t)&&this.lastInteractiveSelectedColumnIndex===e||(this.lastInteractiveSelectedColumnIndex=e,t=this.getChartX(e),this.setHoverLine(t,e),(e=this.createLegendDataPoints(e))&&this.cartesianHost.updateLegend(e))},se.prototype.setHoverLine=function(r,o){this.hoverLine.attr("x1",r).attr("x2",r).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1);var s=this;this.mainGraphicsContext.selectAll(se.CategorySelector.selector).selectAll(se.PathElementName).each(function(e){var t=this,i=e.color,a=s.selectionCircles[e.lineIndex];a&&a.attrs({cx:r,cy:function(){var e=d3.select(t).node();return s.getPosition(r,e).y}}).styles({opacity:function(){return _.some(e.data,function(e){return!!e&&e.categoryIndex===o})?1:0},fill:i}),s.dragHandle&&s.dragHandle.attr("cx",r)})},se.prototype.getChartX=function(e){var t=0;this.data.isScalar?0<=e&&e<this.data.categoryData.length&&(t=Math.max(0,this.xAxisProperties.scale(this.data.categoryData[e].categoryValue))):t=Math.max(0,this.xAxisProperties.scale(e));e=Math.max.apply(Math,N.visuals.AxisHelper.extent(this.xAxisProperties.scale)),t=Math.min(t,e);return isNaN(t)?0:t},se.findCategoryIndex=function(e,t){var i=e.pointX,a=e.offsetX,r=e.categoryData,o=e.scale,t=t.removeScaleDetector?e.currentViewport.scale:e.scaleDetector.getScale().x;N.Double.equalWithPrecision(t,1,1e-5)||(i/=t),a&&(i+=a);t=N.visuals.AxisHelper.invertScale(o,i,0,0,void 0).value;if(e.isScalar){var s=w.findClosestXAxisIndex(t,r,o);return 0<=s?r[s].categoryIndex:-1}if(r[t]&&!r[t].hasData){for(var n=-1,l=t;0<l&&-1===n&&r[--l].hasData;)n=l;for(var c=-1,u=t,d=r.length-1;u<d&&-1===c&&r[++u].hasData;)c=u;a=Math.abs(n-t),s=Math.abs(c-t);a<s?t=n:s<a?t=c:a===s&&(t=o(t)+e.categoryThickness/2<i?c:n)}return t},se.prototype.getPosition=function(e,t){for(var i,a,r=0,o=t.getTotalLength();;){if(i=t.getPointAtLength(a=r+o>>1),ae.SVGUtil.ensureValidSVGPoint(i),(a===o||a===r)&&i.x!==e)break;if(i.x>e)o=a;else{if(!(i.x<e))break;r=a}}return i},se.prototype.createTooltipData=function(e){var t=this.data;if(t&&0!==t.series.length&&t.categories&&t.categoryData){var i=[];t.categoryData.length,t.categories.length;for(var a,r=t.categoryData[e],o=!1,s=t.multipleDisplayName,n=ae.lineChartProps.general.formatString,l=0,c=t.series;l<c.length;l++){var u,d,h=(g=c[l]).data,p=void 0;this.data.isScalar?r&&(p=h.filter(function(e){return e.categoryValue===r.categoryValue})[0]):p=h[e],null!=(v=p&&p.value)&&(u=ae.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels),d=g.lineStyle.markerProperties,h=this.getDefaultMarkerShape(t.defaultToCircle),f={color:ae.Markers.resolveMarkerColor(d,g.color,t.legendMarkerRendering,t.matchLineColor),category:u.value,multiple:s,measureDisplayName:g.seriesName,measure:ae.valueFormatter.format(v,p.labelFormatString||ae.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:p.stackedValue,uncertaintyTooltipItems:p.uncertainty,showDot:!d.showMarker,markerShape:ae.Markers.resolveMarkerShape(d,t.legendMarkerRendering,h),lineStyle:g.lineStyle.style,lineColor:g.color,isY2:p.isY2},o=o||!!p.uncertainty,t.hasDynamicSeries?(f.seriesDisplayName=t.seriesDisplayName,f.seriesName=g.seriesName,f.additionalTooltipItems=p.additionalTooltipItems):a=a||p.additionalTooltipItems,i.push(f))}if(!_.isEmpty(t.forecastLines)&&r)for(var g=_.head(t.series),y=0,m=t.forecastLines;y<m.length;y++){var v,f,S=m[y],x=_(S.points).filter(function(e){return e.point.x===r.categoryValue}).first();null!=(v=x&&x.point.y)&&(f={color:S.lineColor.solid.color,category:ae.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels).value,multiple:s,measureDisplayName:S.displayName,measure:ae.valueFormatter.format(v,ae.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:void 0,additionalTooltipItems:[{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Upper"),value:ae.valueFormatter.format(x.upperBound.y,ae.valueFormatter.getFormatString(g.yCol,n))},{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Lower"),value:ae.valueFormatter.format(x.lowerBound.y,ae.valueFormatter.getFormatString(g.yCol,n))}],showDot:!0,markerShape:ae.markerShape.circle,lineStyle:void 0,lineColor:void 0},i.push(f))}return{dataPoints:i,additionalTooltipItems:a,legendMarkerRendering:t.legendMarkerRendering,hasUncertainty:o}}},se.prototype.createLegendDataPoints=function(e){var t=this.data;if(t&&t.series&&!(t.series.length<1)){var i,a=[],r=t.categoryData[e];this.isInteractiveChart&&r&&(this.data.isScalar?(i=r.categoryValue,w.isDateTime(this.xAxisProperties.axisType)&&(i=N.FeatureSwitchedDate.fromTimeValue(this.featureSwitches.utcDates,i))):i=ae.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar,this.featureSwitches));for(var o=ae.lineChartProps.general.formatString,s=0,n=t.series.length;s<n;s++){var l=t.series[s],c=l.data,u=void 0;if(this.isInteractiveChart){var d=void 0;if(this.data.isScalar){if(r)for(var h=r.categoryValue,p=0,g=c;p<g.length;p++){var y=g[p];if(y.categoryValue===h){d=y;break}}}else d=c[e];u=d&&d.value}c=ae.converterHelper.getFormattedLegendLabel(l.yCol,this.dataView.categorical.values,o);a.push({color:l.color,icon:ae.LegendIcon.Line,label:c,category:ae.valueFormatter.format(i,ae.valueFormatter.getFormatString(l.xCol,o)),measure:ae.valueFormatter.format(u,ae.valueFormatter.getFormatString(l.yCol,o)),identity:l.identity,selected:l.selected,index:s})}var m=this.dataView&&this.dataView.categorical?this.dataView.categorical.values:null,v=m&&m.source?m.source.displayName:"",m=ae.Legend.getDefaultLegendData(this.style);return m.title=v,m.dataPoints=a,m.grouped=t.hasDynamicSeries,m}},se.createLabelDataPoints=function(m,v){for(var f,S,x=m.xAxisProperties.scale,b=m.yAxisProperties.scale,C=m.y2AxisProperties&&m.y2AxisProperties.scale,e=m.data,c=e.series,u=e.dataLabelsSettings,w=ae.DataLabelViewModel.createColumnFormatterCacheManager(),D=oe.hasFlag(m.lineType,16),d=[],A=e.isScalar,t=function(e,t){S=c[e];var g=100===(f=S.labelSettings||u).labelDensity,i=ae.DataLabelRenderer.getNumberOfLabelsToRender(m.currentViewport.width,f.labelDensity,h.minimumLabelsToRender,ae.MinMaxLabelDataPointSorter.estimatedLabelWidth),a=!g&&A?i:S.data.length;if(!f.show)return d[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";var i=S.isY2?m.y2AxisProperties:m.yAxisProperties,y=ae.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,f),r=S.data,o=[];if(!_.isEmpty(r))for(var s=0,n=r.length;s<n;s++){var l=r[s];null!=l&&null!=l.value&&(l=function(e,t,i){var a=t.labelFormatString,r=w.getOrCreate(a,f,y.units,y.getPrecision(!!a,e.type)),o=ae.DataLabelRenderer.getLabelFormattedText(r.format(t.value)),s=f.fontProperties,n=ae.FontProperties.toTextProperties(s,o),l=N.TextMeasurementService.measureSvgTextWidth(n)+ae.DataLabelViewModel.LabelDensityPadding,c=N.TextMeasurementService.estimateSvgTextHeight(n,!0),u=!1,d=m.horizontalOffset,a=e.isY2?C:b,n=null!==(r=t.labelFill)&&void 0!==r?r:s.color;if(D){var h=Math.max(t.stackedValue-t.value,a.domain()[0]),r=m.currentViewport.width,p=void 0;switch(f&&f.position){case ae.labelPosition.insideCenter:p=[1];break;case ae.labelPosition.insideEnd:p=[4];break;default:ae.labelPosition.auto;p=se.validStackedLabelPositions}h={rect:{left:x(se.getXValue(t,A))+d-r/2,top:a(Math.max(t.stackedValue,t.stackedValue-t.value)),width:r,height:Math.abs(a(t.stackedValue)-a(h))},orientation:0<=t.value?1:2,validPositions:p},u=!0}else{e=e.lineStyle.markerProperties,p=void 0;switch(f&&f.position){case ae.labelPosition.above:p=[1];break;case ae.labelPosition.under:p=[2];break;default:ae.labelPosition.auto;p=g?[1]:se.getValidLabelPositions(S,i)}h={point:{x:x(se.getXValue(t,A))+d,y:a(t.value)},radius:e.showMarker?e.size:0,validPositions:p}}return{isPreferred:!1,text:o,textSize:{width:l,height:c},outsideFill:null!=n?n:ae.ColorHelper.getThemeColor(v,ae.DataLabelViewModel.DefaultLabelColorName),insideFill:n&&D?n:ae.ColorHelper.getThemeColor(v,ae.DataLabelViewModel.DefaultInsideLabelColorName),parentType:u?1:0,parentShape:h,fontProperties:s,identity:t.identity,key:t.key,hasBackground:f.enableBackground,backgroundColor:f.backgroundColor,backgroundTransparency:f.backgroundTransparency}}(S,l,s),o.push(l))}d[e]={labelDataPoints:o,maxNumberOfLabels:a}},h=this,i=0,a=c.length;i<a;i++)t(i);return new ae.MinMaxLabelDataPointSorter({unsortedLabelDataPointGroups:d,series:c,viewport:m.currentViewport,yScale:b,y2Scale:C}).getSortedDataLabels()},se.createSeriesLabelDataPoints=function(e,f,S,x){for(var b,C,t=e.xAxisProperties.scale,w=e.yAxisProperties.scale,D=e.y2AxisProperties&&e.y2AxisProperties.scale,i=e.data,A=i.series,P=i.seriesLabelSetings,a=e.margin,L=e.currentViewport,M=oe.hasFlag(e.lineType,16),V=[],F=i.isScalar,T=N.TextMeasurementService.estimateSvgTextHeight(ae.DataLabelRenderer.LabelTextProperties),I=L.width-(a.left+a.right),k=t.domain()[0],O=t.domain()[1],r=function(e,t){var l=(C=A[e]).isY2?D:w,i=l.domain()[0],a=l.domain()[1];if(!(b=C.seriesSettings||P)||!b.show)return V[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";function r(e,t){var i=e.seriesName,a=b.fontProperties,r=ae.FontProperties.toTextProperties(a,i),o=N.TextMeasurementService.measureSvgTextWidth(r),s=N.TextMeasurementService.estimateSvgTextHeight(r,!0),n=e.lineStyle.markerProperties,e=[512];return t.value||(t.value=0),n={point:{x:S,y:l(M?t.stackedValue:t.value)},radius:n.showMarker?n.size:0,validPositions:e},e=!1,d&&(e=1<ae.DataLabelRenderer.checkWordBreak(i,r,u,L.height-(c+T+h),void 0,!0,!0).length),{isPreferred:!1,text:i,textSize:{width:o,height:s},outsideFill:b.seriesColor||ae.ColorHelper.getThemeColor(f,ae.DataLabelViewModel.DefaultLabelColorName),insideFill:b.seriesColor&&M?b.seriesColor:ae.ColorHelper.getThemeColor(f,ae.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:n,fontProperties:a,identity:t.identity,key:t.key,wordBreak:e,hasBackground:b.enableBackground,backgroundColor:b.backgroundColor,backgroundTransparency:b.backgroundTransparency}}var c=b?b.fontProperties.size.px:0,u=b?b.seriesMaximumWidth/100*I:0,d=!!b&&!!b.seriesWordWrap,h=(L.height-T-c)/2,o=C.data,s=[],n=0,p=o.length;if(!_.isEmpty(o)&&C.seriesName){var g=x?_.last(_.compact(o)):_.first(_.compact(o));if(F){for(n=0;n<p;n++){var y=o[n];if(null!=y&&null!=y.value&&y){y=se.getXValue(y,F);if(x?O<y:k<y){var m,v,y=-1;x&&0<=n-1?y=n-1:x||(y=n),0<=y&&(null!=(y=o[y])&&(i<=(m=M?y.stackedValue:y.value)&&m<=a)&&(v=r(C,y),s.push(v)));break}}}g&&n===o.length&&(v=r(C,g),s.push(v))}else g&&(i<=(m=M?g.stackedValue:g.value)&&m<=a)&&(v=r(C,g),s.push(v))}V[e]={labelDataPoints:s,maxNumberOfLabels:1}},o=0,s=A.length;o<s;o++)r(o);return V},se.createTotalLabelDataPoints=function(e,t){for(var i,a,r,o,s,n,l,c,u,d=ae.CartesianHelper.getFirstMetadataColumn(e.data.valuesMetadata),h=ae.valueFormatter.getFormatString(d,ae.columnChartProps.general.formatString),p=e.xAxisProperties.scale,g=e.yAxisProperties.scale,y=e.data,m=ae.DataLabelViewModel.createColumnFormatterCacheManager(),v=[],f=y.totalLabelsSettings,S=y.isScalar,x=e.horizontalOffset,d=e.yAxisProperties,b=ae.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(d,f),C=[],w=0;w<y.totals.length;w++){var D=y.totals[w];!D||0!==(D=D.net)&&(i=D,a=w,u=r=n=u=c=l=n=s=o=r=void 0,r=m.getOrCreate(h,f,b.units,f.precision),o=ae.DataLabelRenderer.getLabelFormattedText(r.format(i)),s=f.fontProperties,n=ae.FontProperties.toTextProperties(s,o),l=N.TextMeasurementService.measureSvgTextWidth(n),c=N.TextMeasurementService.estimateSvgTextHeight(n,!0),u=y.totals[a],n=null!==(r=u.labelFill)&&void 0!==r?r:s.color,a=0<i?u.positive:u.negative,r={value:a,stackedValue:a,categoryIndex:u.categoryIndex,categoryValue:u.categoryValue,labelSettings:void 0,key:void 0,identity:void 0,lineStyle:void 0,seriesIndex:void 0,selected:!1},u=e.currentViewport.width,D={isPreferred:!(u={left:p(se.getXValue(r,S))+x-u/2,top:g(a),width:u,height:0}),text:o,textSize:{width:l,height:c},outsideFill:null!=n?n:ae.ColorHelper.getThemeColor(t,ae.DataLabelViewModel.DefaultLabelColorName),insideFill:null!=n?n:ae.ColorHelper.getThemeColor(t,ae.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:u,orientation:0<=i?1:2,validPositions:[16]},identity:void 0,fontProperties:s,hasBackground:f.enableBackground,backgroundColor:f.backgroundColor,backgroundTransparency:f.backgroundTransparency},C.push(D))}return v.push({labelDataPoints:C,maxNumberOfLabels:2*y.totals.length}),v},se.createUncertaintyLabels=function(n,p,g){for(var y,m,e=n.data,l=e.series,v=ae.DataLabelViewModel.createColumnFormatterCacheManager(),f=n.xAxisProperties.scale,S=e.isScalar,x=n.horizontalOffset,c=[],t=function(e,t){var i=(y=l[e]).uncertainty;if(!i||!i.renderUncertainty||!i.labels.show)return c[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";m=i.labels;for(var i=y.isY2?n.y2AxisProperties:n.yAxisProperties,u=ae.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,m),d=i.scale,h=m.fontProperties,a=[],r=0,o=y.data;r<o.length;r++){var s=o[r];null!=s&&null!=s.value&&null!=s.uncertainty&&(s=function(e){for(var t=[],i=ae.UncertaintyHelper.formatUncertaintyByErrorFormat(e.value,e.uncertainty,m.errorFormat),a=[i.lower,i.upper],r=0;r<2;r++){var o,s,n=a[r],l=1===r,c=l?e.uncertainty.upper:e.uncertainty.lower;null!=c&&(s=void 0,s=m.errorFormat===ae.errorFormat.relativePercentage?ae.UncertaintyHelper.formatUncertaintyRelativePercentage(n,g):(o=e.labelFormatString,o=v.getOrCreate(o,m,u.units,u.getPrecision(!!o,y.type)),ae.DataLabelRenderer.getLabelFormattedText(o.format(n))),n=ae.FontProperties.toTextProperties(h,s),l={isPreferred:!1,text:s,textSize:{width:N.TextMeasurementService.measureSvgTextWidth(n)+ae.DataLabelViewModel.LabelDensityPadding,height:N.TextMeasurementService.estimateSvgTextHeight(n,!0)},outsideFill:h.color||ae.ColorHelper.getThemeColor(p,ae.DataLabelViewModel.DefaultLabelColorName),insideFill:h.color||ae.ColorHelper.getThemeColor(p,ae.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:f(se.getXValue(e,S))+x,y:d(c)},radius:0,validPositions:[l?1:2]},identity:void 0,fontProperties:h,hasBackground:m.enableBackground,backgroundColor:m.backgroundColor,backgroundTransparency:m.backgroundTransparency},t.push(l))}return t}(s),_.isEmpty(s)||a.push.apply(a,s))}c[e]={labelDataPoints:a,maxNumberOfLabels:100}},i=0,a=l.length;i<a;i++)t(i);return c},se.prototype.adjustPathXCoordinate=function(e,t){return jsCommon.BrowserUtils.isFirefox()&&null!=t&&(this.pathXAdjustment=this.getPathXAdjustmentForFirefox(t)),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&(this.pathXAdjustment=se.interactivityStrokeWidth/2),t=this.featureSwitches.removeScaleDetector?this.currentViewport.scale:this.scaleDetector.getScale().x,N.Double.equalWithPrecision(t,1,1e-5)?e-=this.pathXAdjustment:e-=this.pathXAdjustment*t,e},se.prototype.getPathXAdjustmentForFirefox=function(e){var t=e.getBoundingClientRect(),i=ae.SVGUtil.tryGetBBox(e);if(0<i.height&&0<i.width){e=this.featureSwitches.removeScaleDetector?this.currentViewport.scale:this.scaleDetector.getScale().x;return(t.width/e-i.width)/2}},se.getValidLabelPositions=function(e,t){var i=e.data,a=i.length,r=i[t].value,o=i[t-1]&&i[t-1].value,e=i[t+1]&&i[t+1].value,i=1,s=1;if(null==o?i=0:r<o?i=3:o<r&&(i=2),null===e?s=0:r<e?s=3:e<r&&(s=2),0===t)return 3!==s?[1,2]:[2,1];if(t===a-1)return 3!==i?[1,2]:[2,1];switch(i){case 0:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[2,1,4,8];case 2:return[1,2,4,8]}case 1:switch(s){case 0:case 1:return[1,2,8,4];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 3:switch(s){case 0:return[2,1,8,4];case 1:return[2,1,4,8];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 2:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:case 2:return[1,2,8,4]}}},se.prototype.getCartesianVisualCapabilities=function(){var e=this.data,t=e&&!e.hasDynamicSeries&&this.hasSingleSeriesPerValueAxis(e),t=!oe.hasFlag(this.lineType,16)||t;return{supportsHierarchicalCategoryAxis:!0,axesCapabilities:{categoryAxis:{domainAggregateRole:ae.LineChartRoles.Category,supportedDomainAggregates:e&&e.isScalar?e.scalarKeyCount?1:3:0},valueAxis:{domainAggregateRole:ae.LineChartRoles.Y,supportedDomainAggregates:t?3:1},secondaryValueAxis:this.haveY2Data()||this.isComboChart?{domainAggregateRole:ae.LineChartRoles.Y2,supportedDomainAggregates:t?3:1}:void 0}}},se.prototype.hasSingleSeriesPerValueAxis=function(e){if(!e||_.isEmpty(e.valuesMetadata))return!1;for(var t=!1,i=!1,a=0,r=e.valuesMetadata;a<r.length;a++){var o,s=r[a].roles;for(o in s)if(s[o]){if(o===ae.LineChartRoles.Y){if(t)return!1;t=!0}if(o===ae.LineChartRoles.Y2){if(i)return!1;i=!0}}}return!0},se.prototype.getStaticSeriesRole=function(){return this.isComboChart?ae.LineChartRoles.Y2:ae.LineChartRoles.Y},se.prototype.haveY2Data=function(){return this.data&&this.data.series&&_.some(this.data.series,function(e){return e&&e.isY2})},se.prototype.calculateCustomLegend=function(){if(!this.dataView)return ae.Legend.getDefaultLegendData(this.style);var e=this.data,t=this.getDefaultMarkerShape(e.defaultToCircle);return ae.Legend.buildSeriesLegendData({dataView:this.dataView,allowLegendWithNoSeries:this.isComboChart,showByDefault:!0,staticSeriesRoleNames:this.isComboChart?["Y2"]:["Y","Y2"],style:this.style,ignoreDefaultColor:this.isComboChart,ignoreDefaultCategoryColor:!0,lineAndMarkerOptions:{renderLineStyle:!0,legendMarkerRendering:e.legendMarkerRendering,matchSeriesColor:e.matchLineColor,defaultMarkerShape:t},featureSwitches:this.featureSwitches})},se.prototype.enumerateCustomLegend=function(e){e=__assign(__assign({},this.customizeLegendFormattingModelOptions(e)),{enumeration:e.enumeration});ae.Legend.enumerate(e,this.featureSwitches)},se.prototype.customizeLegendFormattingModelOptions=function(e){var t=this.originalData,i=t.legendMarkerRendering,a=this.featureSwitches.removeDefaultToCircleToggle&&i===ae.legendMarkerRendering.markerCircleDefault;return __assign(__assign({},e),{legendMarkerRendering:i,matchLineColor:i===ae.legendMarkerRendering.markerOnly||a?t.matchLineColor:void 0,defaultToCircle:i===ae.legendMarkerRendering.markerOnly?t.defaultToCircle:void 0})},se.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},se.chartTypeSupportsExplicitDots=function(e){return!e},se.prototype.getTelemetryInformation=function(){var e,t={};if(_.isEmpty(null===(e=this.data)||void 0===e?void 0:e.anomalyDetections)||(t.AnomalyDetections=!0),!_.isEmpty(t))return t},se.prototype.getDefaultMarkerShape=function(e){return!this.featureSwitches.removeDefaultToCircleToggle&&e?ae.markerShape.circle:ae.markerShape.longDash},se.prototype.getValidDataPointIndices=function(a){for(var r=[],e=0,t=a.categoryData;e<t.length;e++)!function(t){if(t&&a.categoryIdentities[t.categoryIndex])for(var e=0;e<a.series.length;e++){var i=_.findIndex(a.series[e].data,function(e){return e.categoryIndex===t.categoryIndex});if(0<=i){r.push({categoryIndex:t.categoryIndex,seriesIndex:e,dataPointIndex:i});break}}}(t[e]);return r},se.prototype.getCategoryColorsOptions=function(i,e,t,a){var r=e.map(function(e){return ae.CategoryLevelUtils.concatenateCategoryLevels(i.categoryData[e.categoryIndex].hierarchyCategoryLevels).value});return{colorProps:{showAllDataPoints:ae.lineChartObjectProps.dataPoint.showAllDataPoints,fill:ae.lineChartObjectProps.dataPoint.fill},featureSwitches:this.featureSwitches,groupBuilder:t,hostService:this.host,options:{dataView:this.dataView,style:this.style,categories:_.map(e,function(e,t){return{color:i.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:i.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:i.hasDynamicSeries?1:3,noDefaultFillColor:a,multipleRole:i.multipleIdentity?ae.LineChartRoles.Rows:void 0}}},se.ClassName="lineChart",se.MainGraphicsContextClassName="mainGraphicsContext",se.lineChartSVGClassName="lineChartSVG",se.CategorySelector=e("cat"),se.CategoryValuePoint=e("dot"),se.CategoryPointSelector=e("point"),se.CategoryAreaSelector=e("catArea"),se.HoverLineCircleDot=e("circle-item"),se.UncertaintySelector=e("uncertainty"),se.UncertaintyAreas=e("uncertainty-areas"),se.UncertaintyArea=e("uncertainty-area"),se.UncertaintyLines=e("uncertainty-lines"),se.UncertaintyLine=e("uncertainty-line"),se.UncertaintyBars=e("uncertainty-bars"),se.UncertaintyBar=e("uncertainty-bar"),se.UncertaintyMarkers=e("uncertainty-markers"),se.UncertaintyMarker=e("uncertainty-marker"),se.LineClassSelector=e("line"),se.MarkerLineClassSelector=e("marker-line"),se.InteractivityLineClassSelector=e("interactivity-line"),se.TooltipOverlaySelector=e("tooltip-overlay"),se.SelectedMarkerLineClassSelector=e("selected-markers"),se.FocusElementSelector=e("focus-element"),se.RenderOrderableElements=[se.CategoryAreaSelector,se.UncertaintySelector,se.LineClassSelector,se.MarkerLineClassSelector,se.InteractivityLineClassSelector,se.CategorySelector,se.SelectedMarkerLineClassSelector,se.FocusElementSelector],se.PointRadiusExtra=4,se.CircleRadiusExtra=3,se.TooltipCircleRadiusExtra=2,se.PathElementName="path",se.CircleElementName="circle",se.CircleClassName="selection-circle",se.LineElementName="line",se.ScalarOuterPadding=10,se.interactivityStrokeWidth=10,se.minimumLabelsToRender=4,se.DefaultAreaTransparency=60,se.AreaTransparencyReductionFactor=.4,se.defaultLineStrokeWidth=2,se.validStackedLabelPositions=[1,4],se);function se(e){var t=this;this.pathXAdjustment=0,this.deferDragMoveOperation=jsCommon.DeferUtility.deferUntilNextFrame(function(){var e;t.lastDragMoveXPosition&&t.data&&t.margin&&(e=se.findCategoryIndex({pointX:t.lastDragMoveXPosition-t.margin.left,offsetX:0,categoryData:t.data.categoryData,currentViewport:t.currentViewport,scaleDetector:t.scaleDetector,scale:t.xAxisProperties.scale,categoryThickness:t.xAxisProperties.categoryThickness,isScalar:t.data.isScalar},t.featureSwitches),t.selectColumn(e),t.lastDragMoveXPosition=void 0)}),this.isScrollable=e.isScrollable||!1,this.tooltipsEnabledOnHost=e.tooltipsEnabled,this.lineType=e.chartType||1,this.interactivityService=e.featureSwitches.onObjectFormatting?void 0:e.interactivityService,this.lineClassAndSelector=se.LineClassSelector,this.featureSwitches=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory,se.areaTransparencyEnabled=e.featureSwitches.areaChartTransparency}ae.LineChart=o;var n=(Object.defineProperty(l.prototype,"usingHoverLine",{get:function(){return this.showHoverLine},enumerable:!1,configurable:!0}),l.prototype.getTooltipOverlayElement=function(){if(this.showHoverLine)return this.tooltipOverlay},l.prototype.applyTooltips=function(e,t,i){!this.tooltipOverlay||e.binnedLineSamplingApplied&&e.hasDynamicSeries?this.applyPointTooltip(e,t,i):(e.isComboChart,this.applyHoverLineTooltip(e,t,i))},l.prototype.removeTooltips=function(e,t){this.removePointTooltip(e),this.removeHoverLineTooltip(t)},l.prototype.applyHoverLineTooltip=function(e,a,r){this.tooltipOverlay,this.tooltipOverlay&&(this.showHoverLine||this.removePointTooltip(e),this.tooltipOverlay.attrs({x:0,width:e.width,height:e.height}),this.tooltipService.addTooltip(this.mainGraphicsSVG,function(e){var t,i=e.elementCoordinates[0],i=a.getCategoryIndexFromTooltipEvent(e,i),i=r.getHoverLineDataForCategory(i);return i&&i.hasUncertainty&&(t=e.elementCoordinates[1],t=a.getYValueFromTooltipEvent(t,e.context)),o.getSeriesTooltipInfo(i,t)},function(e){return l.getCategoryIdentityForHoverLineTooltipEvent(a,r,e)},!0),this.mainGraphicsSVG.on("mouseout.hoverline",function(){return r.clearHoverLine()}),this.mainGraphicsSVG.on("touchmove.hoverline",function(){return r.clearHoverLine()}),this.showHoverLine=!0)},l.prototype.removeHoverLineTooltip=function(e){e.clearHoverLine(),this.tooltipService.removeTooltips(this.mainGraphicsSVG),this.mainGraphicsSVG.on(".hoverline",null),this.showHoverLine=!1},l.prototype.applyPointTooltip=function(e,i,t){this.showHoverLine&&this.removeHoverLineTooltip(t);var a=e.isComboChart?function(e){return l.getCategoryIdentityForHoverLineTooltipEvent(i,t,e)}:function(e){return e.data&&[e.data.identity]};e.interactivityLines,this.tooltipService.addTooltip(e.interactivityLines,function(e){var t=e.elementCoordinates[0];return i.getTooltipInfoForPoint(e,t)},a,!0),e.dots,this.tooltipService.addTooltip(e.dots,function(e){return e.data&&e.data.tooltipInfo},a,!0),e.explicitDots&&this.tooltipService.addTooltip(e.explicitDots,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&[e.data.identity]},!0),this.showHoverLine=!1},l.prototype.removePointTooltip=function(e){e.interactivityLines&&this.tooltipService.removeTooltips(e.interactivityLines),e.dots&&this.tooltipService.removeTooltips(e.dots),e.explicitDots&&this.tooltipService.removeTooltips(e.explicitDots)},l.getCategoryIdentityForHoverLineTooltipEvent=function(e,t,i){if(i){if(i.data&&o.isForecastPoint(i.data))return null;var a=i.elementCoordinates[0],a=e.getCategoryIndexFromTooltipEvent(i,a);return t.getHoverLineIdentities(a,null===(i=i.data)||void 0===i?void 0:i.data)}},l);function l(e,t,i){this.tooltipService=e,this.mainGraphicsSVG=t,i&&(this.tooltipOverlay=t.append("rect").classed(o.TooltipOverlaySelector.class,!0)),this.showHoverLine=!1}var ne=(t.prototype.queryRegion=function(e){var t=this,i=[],a=e.dataSpace;return i=this.isScalar||this.hasCategories&&void 0!==a.left&&void 0!==a.right?_.filter(this.dataPoints,function(e){return N.Double.lessOrEqualWithPrecision(a.left.value,t.isScalar?e.categoryValue:e.categoryIndex)&&N.Double.lessOrEqualWithPrecision(t.isScalar?e.categoryValue:e.categoryIndex,a.right.value)&&N.Double.lessOrEqualWithPrecision(t.getBottom(a,e),e.value)&&N.Double.lessOrEqualWithPrecision(e.value,t.getTop(a,e))}):i},t.prototype.getBottom=function(e,t){return(t.isY2||this.isComboChart&&e.bottom2?e.bottom2:e.bottom).value},t.prototype.getTop=function(e,t){return(t.isY2||this.isComboChart&&e.top2?e.top2:e.top).value},t);function t(e){this.dataPoints=e.dataPoints,this.isComboChart=e.isComboChart,this.isScalar=e.isScalar,this.hasCategories=e.hasCategories}ae.LineChartHitTester=ne}(N.visuals||(N.visuals={}))}(powerbi=powerbi||{}),function(e){!function(h){var p=jsCommon.BrowserUtils,n=jsCommon.DOMConstants.KeyDictionary,g=jsCommon.DOMConstants.mouseClickEventName,e=(t.prototype.create=function(){return new i},t);function t(){}h.LineChartWebBehaviorFactory=e;var i=(y.prototype.bindEvents=function(n,l,e,t){var r=this,i=n.interactivityLines,a=this.dots=n.dots;this.areas=n.areas;var o=n.tooltipOverlay,s=n.root,c=n.onSelecting;this.anomalies=n.anomalies,this.areaTransparency=n.areaTransparency,this.anomalyNavigationHelper=n.anomalyNavigationHelper;var u=n.focusMarker;this.selectedMarkersCallback=n.selectedMarkersCallback,this.hitTester=n.hitTester;function d(e){return r.getPointX(e)}t?(this.unbindEventsFormatMode(n),i.on(g,function(e){m(n,d(this),e,l.getSubSelectionHelper(),!1)}),i.on("contextmenu",function(e){m(n,d(this),e,l.getSubSelectionHelper(),!0)})):(i.on(g,function(e,t){var i,a,r,o;i=n,a=l,r=d(this),e=e,o=i.getCategoryIndex(e,r,!0),(r=_.find(e.data,function(e){return e&&e.categoryIndex===o}))?h.InteractivityUtils.handleSelection(r,a):(i={selected:e.selected,identity:e.identity,specificIdentity:i.categoryIdentities[o]},h.InteractivityUtils.handleSelection(i,a))}),i.on("contextmenu",function(e,t){var i,a,r,o,s;i=n,a=l,r=d(this),o=e,e=d3.event,p.isCtrlOrMeta(e)||(e.preventDefault(),h.EventBubblingUtil.markAsHandled(e),e=h.InteractivityUtils.getPositionOfLastInputEvent(),s=i.getCategoryIndex(o,r,!0),(r=_.find(o.data,function(e){return e&&e.categoryIndex===s}))?a.handleContextMenu(r,e):a.handleContextMenu({selected:o.selected,identity:o.identity,specificIdentity:i.categoryIdentities[s]},e))}),h.InteractivityUtils.registerStandardInteractivityHandlers(a,l),h.InteractivityUtils.registerClearCatcherShortcut(s,l),u&&(u.on(g,function(e){e=h.InteractivityUtils.isSelectableDataPointContainer(e)?e.data:e;h.InteractivityUtils.handleSelection(e,l)}),u.on("keydown.select",function(t){var e,i=d3.event,a=i.keyCode;32!==a&&13!==a||(y.isAnomaly(t)?(e=r.anomalies.filter(function(e){return e.isAnomaly&&e===t}),h.AnomalyDetectionCartesianRenderer.handleSelectedAnomaly(e.node(),t,c)):(e=h.InteractivityUtils.isSelectableDataPointContainer(t)?t.data:t,h.InteractivityUtils.handleSelection(e,l)),i.preventDefault(),i.stopPropagation())},!0),h.InteractivityUtils.registerStandardContextMenuHandler(u,l)),o&&(_.isEmpty(n.categoryIdentities)?o.on(g,function(){p.isCtrlOrMeta(d3.event)||l.handleClearSelection()}):(o.on(g,function(){var e=n.getCategoryIndex(void 0,d(this),!1),e={selected:!1,identity:void 0,specificIdentity:n.categoryIdentities[e]};h.InteractivityUtils.handleSelection(e,l)}),o.on("contextmenu",function(){var e,t=d3.event;p.isCtrlOrMeta(t)||(t.preventDefault(),h.EventBubblingUtil.markAsHandled(t),e=h.InteractivityUtils.getPositionOfLastInputEvent(),t=n.getCategoryIndex(void 0,d(this),!1),l.handleContextMenu({selected:!1,identity:void 0,specificIdentity:n.categoryIdentities[t]},e))})))),e&&(o=e.dataPointNavigationManager,e=e.pointSourceKey,o.isEmpty(e)||("0"!==s.attr("tabindex")&&!s.classed(h.managedTabIndexElement.class)||this.registerEnterPlotAreaHandler(s,o,e),u&&this.registerDataPointNavigationHandler(u,o,e)))},y.prototype.unbindEventsFormatMode=function(e){var t=e.focusMarker;t&&(t.on(g,null),t.on("keydown.select",null),h.InteractivityUtils.removeStandardContextMenuHandler(t)),h.InteractivityUtils.removeStandardInteractivityHandlers(e.dots)},y.prototype.registerEnterPlotAreaHandler=function(a,r,o){var s=this;a.on("keydown.enterPlotArea",function(){var e,t=d3.event,i=t.keyCode;i===n.F1&&t.ctrlKey?(t.preventDefault(),t.stopPropagation(),(e=s.anomalyNavigationHelper.getFirstElement(0))&&s.renderFocus(e.element)):13===i?(t.preventDefault(),t.stopPropagation(),r.goToFirstElement(o)):27===i&&t.target!==a.node()&&(t.preventDefault(),t.stopPropagation(),t=a.node(),s.renderFocus(t))})},y.prototype.registerDataPointNavigationHandler=function(e,r,o){var s=this;e.on("keydown.dataPoint",function(e){var i=d3.event,a=i.keyCode;(9===a||37===a||39===a||38===a||40===a||a===n.F1&&p.isCtrlOrMeta(i))&&h.InteractivityUtils.tryToSelectD3Target(function(e){i.preventDefault(),i.stopPropagation();var t=h.InteractivityUtils.isNavigableDataPointContainer(e)?e.data:e;y.isAnomaly(t)?s.handleAnomalyKeyDownEvent(t.categoryIndex,t.seriesIndex,a,p.isCtrlOrMeta(i),r,o):a===n.F1&&p.isCtrlOrMeta(i)?(e=s.anomalyNavigationHelper.getFirstElement(t.categoryIndex))&&s.renderFocus(e.element):r.handleKeyDownEvent(o,t.categoryIndex,t.seriesIndex,a,i.shiftKey)},void 0)},!0)},y.isAnomaly=function(e){return e.isAnomaly},y.prototype.handleAnomalyKeyDownEvent=function(e,t,i,a,r,o){var s;switch(i){case 37:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,h.DataDirection.PreviousCategory),void this.renderFocus(s.element);case 39:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,h.DataDirection.NextCategory),void this.renderFocus(s.element);case n.F1:return void(a&&(0<e?r.handleKeyDownEvent(o,e-1,t,39,!1):r.goToFirstElement(o)));default:return}},y.prototype.renderSelection=function(t){var i=this;this.dots.style("fill-opacity",function(e){return e.lineStyle.markerProperties.showMarker?0:h.ColumnUtil.getFillOpacity(e.selected,!1,t,!1)}),this.areas&&this.areas.style("fill-opacity",function(e){return t&&!e.selected?h.LineChart.AreaTransparencyReductionFactor*(1-i.areaTransparency/100):1-i.areaTransparency/100}),this.selectedMarkersCallback&&this.selectedMarkersCallback(t)},y.prototype.renderFocus=function(e){e&&p.focus(e)},y.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},y.prototype.getLassoSelectDirectionMode=function(){return 1},y.prototype.getPointX=function(e){for(var t,i=d3.event;t=i.sourceEvent;)i=t;var a=e.getBoundingClientRect();return i.clientX-a.left-e.clientLeft},y);function y(){}function m(e,t,i,a,r){var o=d3.event;e.onLineSubSelection(i,t,a,o,r),h.EventBubblingUtil.markAsHandled(o)}h.LineChartWebBehavior=i}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(x){!function(S){var e=jsCommon.CssConstants.createClassAndSelector,n=x.data.createDataViewScopeIdentity,i=x.data.DataViewConcatenateCategoricalColumns,l=x.data.ScopeIdentityExtractor,e=(c.prototype.initData=function(e){this.style=e.style,this.element=e.element,this.host=e.host,this.featureSwitches=e.featureSwitches,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend},c.prototype.initRenderer=function(e){var t=this;this.rendererInitialized,this.svg=e.svg,this.interactivityService&&(this.playControl=new a(this.element,function(e){return t.moveToFrameAndRender(e)},this.isMobileChart),this.playControl.onPlay(function(){return t.play()})),this.rendererInitialized=!0},c.prototype.isRendererInitialized=function(){return this.rendererInitialized},c.prototype.setData=function(e,t){if(e){if(this.ridiculousFlagForPersistProperties&&e.metadata)return this.ridiculousFlagForPersistProperties=!1,this.playData;e.matrix||e.categorical?this.playData=u.converter(e,t,this.style):this.playData=u.getDefaultPlayData()}else this.playData=u.getDefaultPlayData();return this.lastViewport=void 0,this.playData},c.prototype.render=function(e,t,i,a){var r=this.playData,o=!this.lastViewport||this.lastViewport.height!==i.height||this.lastViewport.width!==i.width;if(this.lastViewport=i,o&&this.stop(),r){var s={data:this.playData,viewModel:t,viewport:i};this.interactivityService&&(t=r.currentViewModel,this.interactivityService.applySelectionStateToData(t.dataPoints)),this.updateCallout(i,a),this.playControl&&o&&this.playControl.rebuild(r,i,this.playControlWidth);r=r.allViewModels.map(function(e){return e.dataPoints});return{allDataPoints:_.flatten(r),viewModel:s}}},c.prototype.updateCallout=function(e,t){var i=this.playData,a=i.frameData,r=i.currentFrameIndex,o=e.height,i=o-t.top-t.bottom,e=e.width,t=e-t.left-t.right,s=0,o=Math.min(o,1.3*e),e=Math.max(12,Math.round(o/7)),e=Math.min(e,70),o=[];r<a.length&&0<=r&&(r={fontSize:jsCommon.PixelConverter.toString(e),text:a[r].text||"",fontFamily:S.Font.Family.regular.css},(s=x.TextMeasurementService.estimateSvgTextHeight(r)-x.TextMeasurementService.estimateSvgTextBaselineDelta(r))<i&&(i=t-2*c.calloutOffsetMultiplier*s,o=[x.TextMeasurementService.getTailoredTextOrDefault(r,i)]));o=this.svg.selectAll(c.PlayCallout.selector).data(o);o.enter().append("text").classed(c.PlayCallout.class,!0).merge(o).text(function(e){return e}).attrs({x:t-c.calloutOffsetMultiplier*s,y:function(){return s}}).styles({"font-size":e+"px","text-anchor":"end"}),o.exit().remove()},c.prototype.play=function(){var e,t=this.playData;this.isPlaying?this.stop():this.playControl&&(this.isPlaying=!0,this.playControl.play(),null!=(e=this.playControl.getCurrentIndex())&&((e=Math.round(e))>=t.allViewModels.length-1?t.currentFrameIndex=-1:t.currentFrameIndex=e-1,this.playNextFrame(t)))},c.prototype.playNextFrame=function(e,t,i){var a,r,o=this;this.isPlaying?(a=e.currentFrameIndex+1,null!=t&&null!=i&&(a=Math.abs(i-t+1),t=a),a<e.allViewModels.length&&-1<a?((r=this.host.tooltips())&&r.hide({immediately:!0,isTouchEvent:!1}),e.currentFrameIndex=a,e.currentViewModel=e.allViewModels[a],this.renderDelegate(e.currentViewModel),this.playControl.setFrame(a),a<e.allViewModels.length&&window.setTimeout(function(){o.playNextFrame(e,t,i)},u.FrameStepDuration)):this.stop()):this.stop()},c.prototype.stop=function(){this.playControl&&this.playControl.pause(),this.isPlaying=!1},c.prototype.remove=function(){this.playControl&&this.playControl.remove(),d3.selectAll(c.PlayCallout.selector).remove()},c.prototype.setRenderFunction=function(e){this.renderDelegate=e},c.prototype.getCartesianExtents=function(e,t){return this.playData&&!_.isEmpty(this.playData.allViewModels)&&!_.isEmpty(this.playData.frameData)&&u.getMinMaxForAllFrames(this.playData,t)||e},c.prototype.setPlayControlPosition=function(e){var t;this.playControl&&((t=this.playControl.getContainer()).css("left",e.left?e.left+"px":""),t.css("top",e.top?e.top+"px":""),t.css("width",e.width?e.width+"px":""),this.playControlWidth=e.width)},c.prototype.moveToFrameAndRender=function(e){var t=this.playData;this.isPlaying=!0,t&&0<=e&&e<t.allViewModels.length&&e!==t.currentFrameIndex&&(t.currentFrameIndex=e,e=t.allViewModels[e],t.currentViewModel=e,this.renderDelegate(e)),this.isPlaying=!1},c.prototype.isCurrentlyPlaying=function(){return this.isPlaying},c.prototype.enumerateDataPoints=function(e,t,i,a){var r=_.filter(i.metadata.columns,function(e){return e.roles[S.scatterRoleNames.category]}),o=0<r.length&&r[r.length-1].queryName,r=_.filter(i.metadata.columns,function(e){return e.roles[S.scatterRoleNames.series]}),s=0<r.length&&r[0].queryName;t.hasDynamicSeries?x.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:t.dataPointSeries[e.seriesIndex].name,identity:new S.SelectionId({data:__spreadArray([],e.identity.getSelectorsByColumn().dataMap[s]||[])},!1)}})},this.featureSwitches):x.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:i,style:a,categories:_.map(t.dataPoints,function(e){var t=e.identity.getSelectorsByColumn().dataMap[o],t=l.getKeyValuePairs(t[0].expr);return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:new S.SelectionId({data:__spreadArray([x.data.DataViewRoleWildcard.fromRoles([S.scatterRoleNames.play])],_.map(t,function(e){return n(e)}))},!1)}}),fillInstanceKind:3},this.featureSwitches)},c.PlayCallout=e("play-callout"),c.calloutOffsetMultiplier=.3,c);function c(e){e&&(this.interactivityService=e.interactivityService)}S.PlayAxis=e;var u,a=(d.prototype.getContainer=function(){return this.playAxisContainer},d.prototype.remove=function(){this.playAxisContainer&&this.playAxisContainer.remove()},d.prototype.pause=function(){this.playButton.removeClass("pause").addClass("play")},d.prototype.play=function(){this.playButton.removeClass("play").addClass("pause")},d.prototype.getCurrentIndex=function(){if(this.noUiSlider)return Number(this.noUiSlider.get())},d.prototype.onPlay=function(e){this.playButtonCircle.off("click"),this.playButtonCircle.on("click",e)},d.prototype.setFrame=function(e){this.noUiSlider.set([e])},d.prototype.rebuild=function(e,t,i){var a=this;this.noUiSlider&&this.noUiSlider.destroy();var r=e.labelData,o=d.calucalateSliderSize(r,i),i=this.getContainer();o.marginLeft>d.SliderMarginLeft&&(i.css("padding-left",o.marginLeft-d.SliderMarginLeft+"px"),i.css("box-sizing","border-box"));e=this.updateSliderControl(e,o.width),o=d.adjustWidthRegardingLastItem(r,e,o.width);this.slider.css("width",o+"px"),this.noUiSlider.on("slide",function(){var e=a.getCurrentIndex();a.renderDelegate(e)}),this.noUiSlider.on("update",function(){return $(".noUi-target").removeClass("noUi-state-tap")})},d.prototype.updateSliderControl=function(i,e){var t=i.labelData,a=this.slider.get(0),r=i.frameData.length,o={start:r<=1?1:i.currentFrameIndex,step:1,range:{min:0,max:r<=1?1:r-1},animationDuration:u.FrameStepDuration},s=null,n=0;return 1<r&&(n=(t=d.createPipsFilterFn(i,e,t)).skipStep,s={mode:"steps",density:Math.ceil(100/r),format:{to:function(e){return i.frameData[e].escapedText},from:function(t){return _.findIndex(i.frameData,function(e){return e.escapedText===t})}},filter:t.filter}),o.pips=s,noUiSlider.create(a,o),this.noUiSlider=a.noUiSlider,n},d.createPipsFilterFn=function(e,t,i){var a=_.max(_.map(i.labelInfo,function(e){return e.labelWidth})),r=1,o=1,t=a/(1<e.frameData.length?t/(e.frameData.length-1):t);1.25<t?(o=Math.ceil(t),r=2):(1<t||i.anyWordBreaks)&&(r=2);return{filter:function(e,t){return e%o==0?r:0},skipStep:o}},d.adjustWidthRegardingLastItem=function(e,t,i){if(_.isEmpty(e.labelInfo)||e.labelInfo.length<=1)return i;var a=e.labelInfo.length,t=Math.floor((a-1)/t)*t;if(0<(a=e.labelInfo[t].labelWidth/2-(i+d.SliderMarginRight-i/a*(1+t)))){t=d.SliderMaxMargin-d.SliderMarginRight;return i-(a=t<a?t:a)}return i},d.prototype.createSliderDOM=function(e){this.playAxisContainer=$('<div class="play-axis-container"></div>').appendTo(e).css("height",d.PlayControlHeight+"px"),this.playButtonCircle=$('<div class="button-container"></div>').appendTo(this.playAxisContainer),this.isMobileChart&&this.playButtonCircle.addClass("mobile-button-container"),this.playButton=$('<div class="play"></div>').appendTo(this.playButtonCircle),this.slider=$('<div class="sliders"></div>').attr("drag-resize-disabled","true").attr("rtl",("rtl"===document.dir).toString()).appendTo(this.playAxisContainer)},d.calucalateSliderSize=function(e,t){var i=0;!_.isEmpty(e.labelInfo)&&1<e.labelInfo.length&&(i=_.head(e.labelInfo).labelWidth/2);i=Math.max(i,d.SliderMarginLeft),i=Math.min(d.SliderMaxMargin,i);return{width:Math.max(t-i-d.SliderMarginRight,1),marginLeft:i}},d.SliderMarginLeft=44,d.SliderMarginRight=20,d.SliderMaxMargin=100,d.PlayControlHeight=80,d);function d(e,t,i){this.isMobileChart=i,this.createSliderDOM(e),this.renderDelegate=t}!function(e){e.FrameStepDuration=800;var t=750;function f(e,t){e=t.convertFrame(e);return i.concatenateCategoryColumnsForVisual(e.metadata,S.StandardObjectPropertyIdentifiers.formatString,S.cartesianRoleNames.category,e.categorical)}e.AnimationEase="linear",e.ClassName="playChart",e.getFrameAnimationDuration=function(){return t},e.setFrameAnimationDuration=function(e){t=e},e.convertFrame=f,e.converter=function(e,t,i){var a=e.metadata,i=(S.DataLabelViewModel.getDefaultPointLabelSettings(i,"smallLightLabel"),u={},(l=a)&&l.objects&&(l=l.objects,u.currentFrameIndex=x.DataViewObjects.getValue(l,S.scatterChartProps.currentFrameIndex.index,null)),u),r=[],o=[],s=S.DataViewMultipleReader.create(e,S.StandardObjectPropertyIdentifiers.formatString),a=s.getFrameCount(),n=s.getSubtotals();if(s.hasFrames()){var l=s.getFrameSourceColumns(),c=l&&l[0],u=S.valueFormatter.getFormatString(c,S.scatterChartProps.general.formatString),d=void 0;d=c.type.numeric?(l=null===(e=s.getFrameNode(a-1))||void 0===e?void 0:e.value,e=null===(e=s.getFrameNode(0))||void 0===e?void 0:e.value,e=Math.abs(l-e),S.valueFormatter.create({format:u,value:e,value2:0,columnType:c.type})):S.valueFormatter.createDefaultFormatter(u,!0);for(var h=0,p=a;h<p;h++){var g,y,m,v=s.getFrameNode(h);v.isSubtotal||(g=d.format(v.value),y=$("<div></div>").text(g).html(),o.push({escapedText:y,text:g}),m=t(f(h,s),{label:y,column:c,identity:v.identity,value:v.value,formattedValue:g},n),r.push(m))}}else m=t(f(0,s),void 0,n),r.push(m);return i.currentFrameIndex=o.length-1,{allViewModels:r,currentViewModel:m,frameData:o,currentFrameIndex:i.currentFrameIndex,labelData:function(e,t){for(var i={fontFamily:S.Font.Family.regular.css,fontSize:jsCommon.PixelConverter.toString(14)},a=[],r=!1,o=0,s=e;o<s.length;o++){var n=s[o],l=jsCommon.WordBreaker.getMaxWordWidth(n.escapedText,x.TextMeasurementService.measureSvgTextWidth,i);r=r||jsCommon.WordBreaker.hasBreakers(n.escapedText)||-1<n.escapedText.indexOf("-"),a.push({label:n.escapedText,labelWidth:l})}return{labelInfo:a,anyWordBreaks:r,labelFieldName:t&&t.displayName}}(o,c)}},e.getDefaultPlayData=function(){return{frameData:[],allViewModels:[],currentFrameIndex:0,currentViewModel:void 0,labelData:{anyWordBreaks:!1,labelInfo:[]}}},e.getMinMaxForAllFrames=function(e,t){var i={},a=!1;if(e.allViewModels&&0<e.allViewModels.length)for(var r=0,o=e.allViewModels.length;r<o;r++){var s=e.allViewModels[r];_.isEmpty(s.dataPoints)||(a=!0,s=t(s),i={minY:d3.min([s.minY,i.minY]),maxY:d3.max([s.maxY,i.maxY]),minX:d3.min([s.minX,i.minX]),maxX:d3.max([s.maxX,i.maxX]),formatStringX:s.formatStringX||i.formatStringX,formatStringY:s.formatStringY||i.formatStringY})}return a?i:null},e.isDataViewPlayable=function(e,t){return void 0===t&&(t="Play"),(e=e.matrix&&e.matrix.rows&&e.matrix.rows.levels&&e.matrix.rows.levels[0]&&e.matrix.rows.levels[0].sources&&e.matrix.rows.levels[0].sources[0]&&e.matrix.rows.levels[0].sources[0].roles)&&e[t]},e.renderTraceLines=function(e,t,i){e=_.filter(e,function(e){return e.selected}),e=_.uniqBy(e,function(e){return e.identity.getKey()}),t.render(e,i)}}(u=S.PlayChart||(S.PlayChart={}))}(x.visuals||(x.visuals={}))}(powerbi=powerbi||{}),function(o){var u;function t(e){this.maxDataValue=Number.MIN_VALUE,this.newDataInterval=0,this.duration=3e5,this.featureSwitches=e.featureSwitches}u=o.visuals||(o.visuals={}),t.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.data={series:[],dataLabelsSettings:u.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:u.LineStyle.getDefault()}},t.prototype.initRenderer=function(e){this.animator=e.animator;e=e.svg;e.classed("realTimeLineChart",!0).classed("cartesianChart",!0);e=this.mainGraphicsSVG=e.append("svg");e.classed("mainGraphicsSVG",!0),this.mainGraphicsContext=e.append("g").classed("mainGraphicsContext",!0)},t.prototype.setData=function(e){var t,i;this.data||(this.data={series:[],dataLabelsSettings:u.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:u.LineStyle.getDefault()}),_.isEmpty(e)||(t=_.head(e)).categorical&&((i=u.CartesianHelper.getCategoryAxisProperties(t.metadata).duration)&&(this.duration=i),e=t.categorical,this.removeOldData(),i=e.categories,e=o.ValueType.fromDescriptor({text:!0}),i&&0<i.length&&i[0].source&&i[0].source.type&&(e=i[0].source.type),e=u.ScalarUtils.canHaveScalarAxis(t.metadata?t.metadata.objects:null,u.lineChartProps.categoryAxis.axisType,e),e=u.LineChart.converter({dataView:t,style:this.style,isScalar:e,featureSwitches:this.featureSwitches}),this.mergeNewData(e),this.removeOldData(this.newDataInterval))},t.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||!_.isEmpty(this.data.series))},t.prototype.calculateAxesProperties=function(e){return this.currentViewport=e.viewport,this.margin=e.margin,this.newAxisData&&(this.axisData=this.newAxisData),this.newAxisData=this.createAxisData(e),this.axisData||(this.axisData=this.newAxisData),[this.xAxisProperties,this.yAxisProperties]},t.prototype.getAxesDomains=function(e,t){var i={},a=this.data;if(!a)return i;var r=this.truncateSeries();return _.isEmpty(r)||(!t.categoryAxis||(a=u.AxisHelper.createDomain(r,a.categoryMetadata?a.categoryMetadata.type:o.ValueType.fromDescriptor({text:!0}),!0,[u.AxisHelper.createScalarDomainOptions([this.getMinData()+this.newDataInterval,void 0],0,[!0,void 0])]))&&(u.AxisHelper.assertScalarDomain(a),i.categoryAxis=a),t.valueAxis&&(i.valueAxis=u.AxisHelper.createValueDomain(r))),i},t.prototype.setAxesLayout=function(e){},t.prototype.overrideXScale=function(e){this.xAxisProperties=e},t.prototype.render=function(e,t){if(!this.containsEmptySeries())return this.renderLines(),this.animator&&this.animator.refreshLastUpdate(),{dataPoints:[],behaviorOptions:{},labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:[],animateLabels:!1}},t.prototype.onClearSelection=function(){},t.prototype.createAxisData=function(e){var t,i=this,a=this.data;if(a){this.containsEmptySeries()||(t=a.series[0].yCol);var r=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!0}),o=e.viewport,s=o.width,n=u.AxisHelper.hasForcedDomain(e.categoryAxisOptions.includeDomain),l=this.xAxisProperties=u.AxisHelper.createAxis({pixelSpan:s,dataDomain:r.categoryAxis,axisZoom:void 0,metaDataColumn:a.categoryMetadata,formatString:u.valueFormatter.getFormatString(a.categoryMetadata,u.columnChartProps.general.formatString),outerPadding:10,isCategoryAxis:!0,isScalar:!0,isVertical:!1,categoryThickness:null,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return u.CartesianHelper.lookupXValue(a,e,t,!0,i.featureSwitches)},scaleType:u.axisScale.linear,logAxisScale:!1,margin:e.margin,preventNice:n,featureSwitches:this.featureSwitches}),c=this.margin,n=u.AxisHelper.hasForcedDomain(e.valueAxisOptions.includeDomain),n=this.yAxisProperties=u.AxisHelper.createAxis({pixelSpan:o.height-c.top-c.bottom,dataDomain:r.valueAxis,axisZoom:void 0,metaDataColumn:t,formatString:u.valueFormatter.getFormatString(t,u.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:u.axisScale.linear,logAxisScale:!1,margin:e.margin,preventNice:n,featureSwitches:this.featureSwitches});return n.axis.tickSize(-s),{x:l,y1:n}}},t.prototype.truncateSeries=function(){var a=this.getMinData(),e=this.data.series;return e?_.map(e,function(e,t){(e=o.Prototype.inherit(e)).data=o.Prototype.inherit(e.data);var i=0;return 0<_.findIndex(e.data,function(e){return e&&e.categoryValue>=a})&&i++,e.data=e.data.slice(i),e}):[]},t.prototype.removeOldData=function(e){if(void 0===e&&(e=0),!this.containsEmptySeries()){for(var t=this.getMinData(e),i=this.data,a=0,r=i.series;a<r.length;a++){var o=r[a],s=_.findIndex(o.data,function(e){return e&&e.categoryValue>t});0<s&&(o.data=o.data.slice(s))}e=_.findIndex(i.categoryData,function(e){return e&&e.categoryValue>t});0<e&&(i.categoryData=this.data.categoryData.slice(e),i.categories=this.data.categories.slice(e))}},t.prototype.mergeNewData=function(e){if(this.containsEmptySeries())return this.data=e,void(this.maxDataValue=this.getMaxData());this.data.series=t.mergeSeries(this.data.series,e.series,this.maxDataValue),t.mergeCategories(this.data,e,this.maxDataValue);e=this.getMaxData();this.newDataInterval=this.maxDataValue&&e?e-this.maxDataValue:0,this.maxDataValue=e},t.prototype.getMaxData=function(){for(var e=0,t=0,i=this.data.series;t<i.length;t++){var a=i[t];a.data.length&&(e=Math.max(_.last(a.data).categoryValue,e))}return e},t.prototype.getMinData=function(e){return this.maxDataValue-this.duration-1.5*(e=void 0===e?0:e)},t.prototype.renderLines=function(){var i=this.axisData.x.scale,a=this.axisData.y1.scale,e=this.currentViewport,t=this.margin,r=e.height-t.top-t.bottom,e=e.width-t.left-t.right,t=i(i.domain()[0]+this.newDataInterval)-i(i.domain()[0]),o=d3.line().x(function(e,t){return i(e.categoryValue)}).y(function(e,t){return a(e.value)});this.mainGraphicsSVG.attrs({x:0,height:r,width:e}),this.mainGraphicsContext.attr("transform",u.SVGUtil.translate(0,0));e=this.mainGraphicsContext.selectAll(".line").data(this.data.series,function(e){return e.identity.getKey()});e.enter().append("path").classed("line",!0).merge(e).style("stroke",function(e){return e.color}).attr("d",function(e){return o(e.data)}),e.exit().remove(),this.animator&&this.animator.animate({mainGraphicsContext:this.mainGraphicsContext,interactivityService:null,xTranslation:t})},t.prototype.containsEmptySeries=function(){return!this.data||_.isEmpty(this.data.series)},t.mergeCategories=function(e,t,i){var a=t.categories,a=_.findIndex(a,function(e){return e&&e.categoryValue>i});-1<a?(e.categories=e.categories.concat(t.categories.slice(a)),e.categoryData=e.categoryData.concat(t.categoryData.slice(a))):(e.categories=t.categories,e.categoryData=t.categoryData)},t.mergeSeries=function(e,t,i){for(var a=[],r=0,o=t;r<o.length;r++){var s=o[r],n=_.find(e,function(e){return e.identity.equals(s.identity)});if(n){a.push(n);for(var l=0,c=s.data;l<c.length;l++){var u=c[l];u.categoryValue>i&&n.data.push(u)}}else a.push(s)}return a},t.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},t.prototype.getStaticSeriesRole=function(){return"Y"},u.RealTimeLineChart=t}(powerbi=powerbi||{}),function(e){!function(o){var t,e=(t=o.BaseAnimator,__extends(i,t),i.prototype.refreshLastUpdate=function(){this.lastUpdateTime=Date.now()},i.prototype.getDuration=function(){if(this.lastUpdateTime){var e=Math.min(Date.now()-this.lastUpdateTime,250);return Math.max(this.animationDuration,e)}return this.animationDuration},i.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},i.prototype.animate=function(a){var e=a.mainGraphicsContext,t=this.getDuration();return e.transition().duration(t).ease(this.getEasing()).attrTween("transform",function(e,t,i){return function(e){return o.SVGUtil.translate(-a.xTranslation*e,0)}}),{failed:!1}},i);function i(e){e=t.call(this,e)||this;return e.lastUpdateTime=null,e}o.RealTimeLineChartAnimator=e;var a,e=(a=o.BaseAnimator,__extends(r,a),r.prototype.animate=function(e){var t={failed:!0,shapes:null},i=e.viewModel,a=this.previousViewModel;return i.categories.length*i.series.length>o.AnimatorCommon.MaxDataPointsToAnimate||(a&&(t=this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS)),this.previousViewModel=i),t},r.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},r.prototype.animateDefaultShapes=function(t,e,i,a){var r=e.selectAll(a.selector).data(function(e){return e.data},function(e){return e.key}),e=r.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}).merge(r);return e.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return o.ColumnUtil.getFillOpacity(e.selected,e.highlight,!1,t.hasHighlights)}).transition().ease(this.getEasing()).duration(this.animationDuration).attrs(i.shapeLayout),r.exit().remove(),{failed:!1,shapes:e}},r);function r(e){return a.call(this,e)||this}o.DashboardColumnChartAnimator=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(ee){var te;(te=ee.visuals||(ee.visuals={})).scatterChartConverterModuleFactory=function(){var e=ee.data,n=ee.visuals,z=n.AxisHelper,l=n.cartesianChartProps,c=ee.visuals.CartesianHelper,j=n.CategoricalLazyTooltipBuilder,g=ee.visuals.ColorHelper,u=n.columnChartProps,f=e.DataRoleHelper,E=n.DataViewConcatenateUtil,W=ee.DataViewObjects,G=n.ForegroundColorName,Y=n.FormattingStrategies,S=n.GradientUtils,x=n.DataLabelViewModel,b=n.Legend,X=n.ScatterChart,K=n.scatterChartProps,Z=n.scatterRoleNames,q=n.SelectionIdBuilder,d=n.shapeUtil,$=n.valueFormatter;function t(e,t,i,a){return t.useMatrixDV?function(e,t,i){if(e&&e.matrix&&(0!==_.size(e.matrix.valueSources)||0!==_.size(e.matrix.rows.levels))){var a=t.interactivityService,r=x.getDefaultPointLabelSettings(t.style,"smallLightLabel"),o=C(e,r,!0,t.style),s=function(e,t){var i,a,r,o=e.matrix,s=o.valueSources,n=!1,l=!1,c=[_.findIndex(s,function(e){return f.hasRole(e,"X")})],u=_.findIndex(s,function(e){return f.hasRole(e,"Y")}),d=_.findIndex(s,function(e){return f.hasRole(e,"Size")}),h="",p="";0<=c[0]?(i=s[c[0]],h=i.displayName):(m=v(o.rows,Z.x))&&(i=m.column,c=m.levelSourceIndices,h=i.displayName,n=!0);0<=u?(a=s[u],p=a.displayName):(m=v(o.rows,Z.y))&&(a=m.column,u=m.levelSourceIndices[0],p=a.displayName,l=!0);0<=d&&(r=s[d]);var g,y=_.find(o.rows.levels,function(e){return!_.isEmpty(e.sources)&&f.hasRole(e.sources[0],Z.series)});y?g=o.rows.root:(y=_.find(o.columns.levels,function(e){return!_.isEmpty(e.sources)&&f.hasRole(e.sources[0],Z.series)}))&&(g=o.columns.root);var e=!1,m=!1;i&&(s=i.type,e=_.size(c)<=1&&!(!s.integer&&!s.numeric),m=t.categoryAxisType===ee.visuals.axisType.categorical||!e);(n||l)&&_.find(o.rows.levels,function(e){return f.hasRole(e.sources[0],Z.category)});o=n?_.find(o.rows.levels,function(e){return f.hasRole(e.sources[0],Z.x)}):l?_.find(o.rows.levels,function(e){return f.hasRole(e.sources[0],Z.y)}):_.find(o.rows.levels,function(e){return f.hasRole(e.sources[0],Z.category)});return{idx:{x:c,y:u,size:d},cols:{x:i,y:a,size:r},axesLabels:{x:h,y:p},xGroupMetadata:n?{isCategoricalAxis:m,isScalarType:e}:void 0,yGroupMetadata:l?{isCategoricalAxis:!1,isScalarType:!0}:void 0,seriesLevel:y,seriesNode:g,categoryLevel:o,treatNullsAsZero:{x:t.xValuesTreatNullsAsZero,y:t.yValuesTreatNullsAsZero}}}(e,o),n={min:Number.MAX_VALUE,max:Number.MIN_VALUE},l=s.cols.size;l&&l.aggregates&&(n={min:l.aggregates.minLocal||l.aggregates.min,max:l.aggregates.maxLocal||l.aggregates.max});for(var c=e.matrix.valueSources,u=[],d=0;d<c.length;d++)f.hasRole(c[d],"Tooltips")&&u.push(d);var h={colorHelper:g.create(t.style,K.dataPoint.fill,o.defaultDataPointColor,o.fill),metadata:s,hasDynamicSeries:f.hasRoleInDataView(e,"Series"),tooltipsEnabled:t.tooltipsEnabled,sizeRange:n,dataLabelSettings:r,playFrameInfo:i,tooltipValuesIndices:u,gradientIndex:_.findIndex(c,function(e){return f.hasRole(e,"Gradient")}),objProps:o,categoryMap:{},categoryMapNextIndex:0,categoryIdentities:[]},p=function(e,t){var i=[],a=e.matrix;if(!a.rows.root||0===_.size(a.rows.root.children))return{series:i};var r,o=t.metadata,s=o.seriesLevel,n=o.categoryLevel,l=o.seriesNode,c=-1!==o.idx.size?a.valueSources[o.idx.size]:void 0;if(l){for(var u=0;u<l.children.length;u++){var d=l.children[u];if(!d.isSubtotal){var h=t.colorHelper.getColorForSeriesValue(d.objects,l.childIdentityFields,d.value,G),p=[];_.size(s.sources);for(var g=s.sources[0],y=0,m=d.levelValues;y<m.length;y++){var v=m[y];p.push({expr:g.expr,formattedValue:$.format(v.value,g.format),value:v.value,identity:d.identity})}var f=(new q).withColumnIdentity(d.identity,g.queryName,p).createSelectionId(),S=void 0;S=t.objProps.markerShapeShowAllSeries?ee.DataViewObjects.getValue(d.objects,K.bubbles.markerShape,t.objProps.markerShape):t.objProps.markerShape;var x=$.format(d.value,ee.DataViewObjects.getValue(g.objects,K.general.formatString)),b={identityKey:d.identity&&d.identity.key||"",dataPoints:[],hasSize:!!c,fill:h,identity:f,markerShape:S,name:x};i.push(b);var C={currentSeries:d,currentSeriesColor:h,seriesShape:S,seriesIndex:u};b.dataPoints=L(e,C,t),n||0!==_.size(b.dataPoints)||(x=M(void 0,g),S={category:d,categoryMetadataColumns:[g],categoryIdentityFields:d.childIdentityFields,currentSeries:d,currentSeriesMetadata:g,currentSeriesColor:h,categoryFormatter:x,valueColumnIds:Q(t.metadata),seriesShape:S,currentSeriesIndex:u},(S=V(e,S,t))&&b.dataPoints.push(S))}}var w=e.matrix.rows.root.children;(D=_.find(w,function(e){return e.isSubtotal}))&&(r=P(o,D))}else{var D,A;n?(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,G),b={identityKey:"",dataPoints:[],hasSize:!!c,fill:h,markerShape:t.objProps.markerShape},i.push(b),C={currentSeries:a.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},b.dataPoints=L(e,C,t),w=e.matrix.rows.root.children,(D=_.find(w,function(e){return e.isSubtotal}))&&(r=P(t.metadata,D))):(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,G),A={identityKey:"",dataPoints:[],hasSize:!!c,fill:h},i.push(A),C={currentSeries:a.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},A.dataPoints=L(e,C,t),(A=t.metadata).xGroupMetadata||A.yGroupMetadata||(r=P(A,e.matrix.rows.root.children[0])))}return{series:i,xSubtotal:r&&r.xSubtotal,ySubtotal:r&&r.ySubtotal}}(e,h),l=_.reduce(p.series,function(e,t){return e.concat(t.dataPoints)},[]);t=h.hasDynamicSeries?(i={dataView:e,colorHelper:h.colorHelper,style:t.style,formatStringProp:null,showByDefault:!0,markerShapePropIdentifier:K.bubbles.markerShape,markerShowSeriesPropIdentifier:K.bubbles.showSeries},(e=h.metadata.xGroupMetadata)&&e.isCategoricalAxis?b.buildFromFirstMatrixColumnLevel(i):b.buildFromFirstMatrixRowLevel(i)):b.getDefaultLegendData(t.style),a&&(a.applySelectionStateToData(l),a.applySelectionStateToData(t.dataPoints));a=!!(s.xGroupMetadata||s.yGroupMetadata||s.categoryLevel);return{xCol:s.cols.x,yCol:s.cols.y,hasCategory:a,hasSize:!!s.cols.size,dataPoints:l,dataPointSeries:p.series,legendData:t,axesLabels:s.axesLabels,categoryIdentities:h.categoryIdentities,size:s.cols.size,sizeRange:n,dataLabelsSettings:r,hasDynamicSeries:h.hasDynamicSeries,fillPoint:o.fillPoint,fillPointStyle:o.fillPointStyle,colorBorder:o.colorBorder,colorByCategory:o.colorByCategory,multiplier:o.bubbleSizeMultiplier,xSubtotal:p.xSubtotal,ySubtotal:p.ySubtotal,plotAreaShadingSettings:o.plotAreaShadingSettings,ratioLineSettings:o.ratioLineSettings,markerShape:o.markerShape,dataVolume:o.dataVolume,xGroupMetadata:s.xGroupMetadata,yGroupMetadata:s.yGroupMetadata,treatNullsAsZero:s.treatNullsAsZero}}}(e,t,i):e.categorical&&e.categorical.values?function(e,t,i,a){var r,o,s=ee.data.createDataViewCategoricalReaderAdvanced(e,{colorOptions:{valueRole:"Size",visualStyle:t.style},formatStringProp:K.general.formatString}),n=t.style,l=t.interactivityService,c=t.categoryAxisProperties,u=t.valueAxisProperties,d=e.categorical,h=S.getGradientValueColumn(d);o=d.categories&&0<d.categories.length?(r=d.categories[0].values,$.create({format:$.getFormatString(d.categories[0].source,K.general.formatString),value:r[0],value2:r[r.length-1],columnType:s.data.getCategoryType("Category")})):(r=[null],$.createDefaultFormatter(null));var p=d.values,g=!!p.source,y=p.grouped(),m=(p.source,function(e){var t,i,a,r=f.getMeasureIndexOfRole(e,"X"),o=f.getMeasureIndexOfRole(e,"Y"),s=f.getMeasureIndexOfRole(e,"Size"),n="",l="";e&&e.length&&(e=e[0],0<=r&&(t=e.values[r].source,n=e.values[r].source.displayName),0<=o&&(i=e.values[o].source,l=e.values[o].source.displayName),0<=s&&(a=e.values[s].source));return{idx:{x:[r],y:o,size:s},cols:{x:t,y:i,size:a},axesLabels:{x:n,y:l}}}(y)),v=x.getDefaultPointLabelSettings(n,"smallLightLabel"),y=function(e,t){var i={};e&&e.forEach(function(e){e=X.getMeasureValue(t,e.values),e=z.getRangeForColumn(e);(null==i.min||i.min>e.min)&&(i.min=e.min),(null==i.max||i.max<e.max)&&(i.max=e.max)});return i}(y,m.idx.size),n=C(e,v,!1,n),h=function(p,g,e,y,m,v,f,S,x,b,C,w){var D,A,P=p.data.hasValues("X"),L=p.data.hasValues("Y"),M=y.categories;if(!P&&!L)return[];var t=[],i=e.idx,V=K.general.formatString,F=g.source,a=g.grouped();_.size(i.x);for(var T=_.isEmpty(M)?null:M[0],r=p.objects.getStaticObjects(),o=W.getValue(r,K.bubbles.markerShape,te.markerShape.circle),I=Q(e),k=0,s=a.length;k<s;k++){var O=a[k],n=O.values,N=X.getMeasureValue(_.first(i.x),n),R=X.getMeasureValue(i.y,n),B=X.getMeasureValue(i.size,n),l=void 0;f&&(l=p.colors.createBySeries(k,void 0,G));var H=void 0;H=p.data.hasSeries()&&W.getValue(r,K.bubbles.showSeries,!0)?W.getValue(p.objects.getSeriesDataObjects(k),K.bubbles.markerShape,o):o;var n=p.identities.createForSeries(k,[Z.size]),U={identityKey:O&&O.identity&&O.identity.key||"",dataPoints:[],hasSize:!(!B||!B.values),fill:l,identity:n,markerShape:H,name:f?$.format(p.data.getSeriesName(k),p.objects.getSeriesFormatString()):void 0};t.push(U);for(var c=0,u=m.length;c<u;c++)!function(e){var t=m[e],i=P?z.normalizeNonFiniteNumber(p.data.getValue(Z.x,e,k)):0,a=L?z.normalizeNonFiniteNumber(p.data.getValue(Z.y,e,k)):0,r=P?p.data.getFormatString(Z.x,e,k):void 0,o=L?p.data.getFormatString(Z.y,e,k):void 0,s=z.normalizeNonFiniteNumber(p.data.getValue("Size",e,k));if(null==i||null==a)return;var n=void 0,n=b&&!f?p.colors.createByCategory(e,G):p.colors.createBySeries(k,e,G),l=void 0,c=null!==(D=y.originalCategories)&&void 0!==D?D:[T],u=q.builder().withCategory(c,e,null===(A=null==T?void 0:T.source)||void 0===A?void 0:A.queryName,!0).withSeries(g,O,!0).withMeasures(I);C?(l=u.clone(),d={expr:C.column.expr,formattedValue:C.formattedValue,identity:C.identity,value:C.value},l.withColumnIdentity(C.identity,C.column.queryName,[d])):l=u;var c=l.createSelectionId(),d=u?u.createSelectionId():c,h=new j(p.columns,V);w&&(l=Y.defaultFormatter(V),u=Y.fallbackBasedOnType(V),h.withColumnValueByIndex(T,e,!0,l),f&&h.withColumnValue(F,O.name,void 0,!0,l),h.withColumnValueByIndex(N,e,!1,u).withColumnValueByIndex(R,e,!1,u).withColumnValueByIndex(B,e,!1,u).withColumnValueByIndex(x,e,!1,u),C&&h.withValue(C.column.displayName,C.label),h.withAllValuesForRole("Tooltips",e,k,!1,u));e={x:i,y:a,xFormatString:r,yFormatString:o,size:s,radius:{sizeMeasure:B,index:e},fill:n,formattedCategory:X.createLazyFormattedCategory(v,null!=M?t:O.name),selected:!1,identity:c,renderIdentity:d,tooltipInfo:function(){return h.getTooltipItems()},labelFill:S.fontProperties.color,markerShape:H,categoryIndex:e,seriesIndex:k};U.dataPoints.push(e)}(c)}return t}(s,p,m,d,r,o,g,v,h,n.colorByCategory,i,t.tooltipsEnabled),i=_.reduce(h,function(e,t){return e.concat(t.dataPoints)},[]);t=g?b.buildSeriesLegendData({dataView:e,style:t.style,showByDefault:!0,simpleMarkerProp:K.bubbles.markerShape}):b.getDefaultLegendData();c&&null!==c.showAxisTitle&&!1===c.showAxisTitle&&(m.axesLabels.x=null);u&&null!==u.showAxisTitle&&!1===u.showAxisTitle&&(m.axesLabels.y=null);l&&(l.applySelectionStateToData(i),l.applySelectionStateToData(t.dataPoints));s=s.data.hasCategories();return{xCol:m.cols.x,yCol:m.cols.y,hasCategory:s,hasSize:!!m.cols.size,dataPoints:i,dataPointSeries:h,legendData:t,axesLabels:m.axesLabels,size:m.cols.size,sizeRange:y,dataLabelsSettings:v,hasDynamicSeries:g,fillPoint:n.fillPoint,fillPointStyle:n.fillPointStyle,colorBorder:n.colorBorder,colorByCategory:n.colorByCategory,multiplier:n.bubbleSizeMultiplier,xSubtotal:a&&a[Z.x],ySubtotal:a&&a[Z.y],plotAreaShadingSettings:n.plotAreaShadingSettings,ratioLineSettings:n.ratioLineSettings,markerShape:n.markerShape,dataVolume:n.dataVolume}}(e,t,i,a):void 0}function P(e,t){var i;e.xGroupMetadata||e.yGroupMetadata;var a=e.idx.x,e=e.idx.y;_.size(a);var r,a=_.first(a);return{xSubtotal:i=-1!==a?z.normalizeNonFiniteNumber(t.values[a].value):i,ySubtotal:r=-1!==e?z.normalizeNonFiniteNumber(t.values[e].value):r}}function L(e,t,i){var a=[],r=t.currentSeries,o=i.metadata.seriesLevel?i.metadata.seriesLevel.sources[0]:void 0,s=Q(i.metadata),n=function(e,t,i){var a,r=i.metadata.seriesLevel?i.metadata.seriesLevel.sources[0]:void 0,o=t.currentSeries,t=$.createDefaultFormatter(null);{var s;i.metadata.xGroupMetadata&&i.metadata.xGroupMetadata.isCategoricalAxis?(s=e.matrix.rows,a=s.root.children,s=s.levels[0].sources,t=M(a[0],s[0])):o.children?(a=o.children,s=0<e.matrix.rows.levels.length?e.matrix.rows.levels[a[0].level].sources:void 0,r&&(t=M(a[0],s[0]))):r&&f.hasRole(r,"Category")&&(t=M((a=[o])[0],(s=[r])[0]))}return{categories:a,categoryMetadataColumns:s,formatter:t}}(e,t,i);if(_.isEmpty(n.categories))return a;for(var l=0,c=n.categories;l<c.length;l++){var u=V(e,{category:c[l],categoryMetadataColumns:n.categoryMetadataColumns,categoryIdentityFields:r.childIdentityFields,currentSeries:r,currentSeriesMetadata:o,currentSeriesColor:t.currentSeriesColor,categoryFormatter:n.formatter,valueColumnIds:s,seriesShape:t.seriesShape,currentSeriesIndex:t.seriesIndex},i);u&&a.push(u)}return a}function M(e,t){var i;return e?(i=e.levelValues,$.create({format:$.getFormatString(t,K.general.formatString),value:i[0],value2:i[_.size(e.values)-1],columnType:null})):$.createDefaultFormatter(null)}function V(e,l,t){if(!l.category.isSubtotal){var i,a=t.metadata,r=e.matrix,o=a.idx.x,s=a.idx.y,n=a.idx.size,c=_.size(r.valueSources),u=a.xGroupMetadata,d=a.yGroupMetadata,h=_.first(o),e=0,p=K.general.formatString;u||-1===h||(e=z.normalizeNonFiniteNumber(l.category.values[h].value),e=a.treatNullsAsZero&&a.treatNullsAsZero.x&&null==e?0:e,i=W.getValue(l.category.values[h].objects,p));e=null==e?null:[e];u&&(e=_.map(o,function(e){return l.category.levelValues[e].value}));var g,y,m,o=0,v=a.xGroupMetadata&&a.xGroupMetadata.isCategoricalAxis;if(d||-1===s?d&&(o=l.category.levelValues[s].value):(P=J(v,l,c,s),o=z.normalizeNonFiniteNumber(l.category.values[P].value),o=a.treatNullsAsZero&&a.treatNullsAsZero.y&&null==o?0:o,g=W.getValue(l.category.values[P].objects,p)),null!=e&&null!=o){-1!==n&&(P=J(v,l,c,n),y=z.normalizeNonFiniteNumber(l.category.values[P].value),m=W.getValue(l.category.values[P].objects,p));n=q.builder();if(!_.isEmpty(l.categoryMetadataColumns)){for(var f=_.last(l.categoryMetadataColumns),S=[],x=0,b=l.category.levelValues;x<b.length;x++){var C=b[x],w=l.categoryMetadataColumns[C.levelSourceIndex];S.push({expr:w.expr,formattedValue:$.format(C.value,w.format),value:C.value,identity:l.category.identity})}n.withColumnIdentity(l.category.identity,f.queryName,S)}if(l.currentSeriesMetadata){for(var S=[],D=0,A=l.currentSeries.levelValues;D<A.length;D++){C=A[D];S.push({expr:l.currentSeriesMetadata.expr,formattedValue:$.format(C.value,l.currentSeriesMetadata.format),value:C.value,identity:l.currentSeries.identity})}n.withColumnIdentity(l.currentSeries.identity,l.currentSeriesMetadata.queryName,S)}_.isEmpty(l.valueColumnIds)||n.withMeasures(l.valueColumnIds),t.playFrameInfo&&(U=t.playFrameInfo,L=n.clone(),S={expr:U.column.expr,formattedValue:U.formattedValue,identity:U.identity,value:U.value},n.withColumnIdentity(U.identity,U.column.queryName,[S]));var P=n.createSelectionId(),f=L?L.createSelectionId():P,n=t.sizeRange;n.min>y&&(n.min=y),n.max<y&&(n.max=y);var L=l.currentSeriesColor;t.hasDynamicSeries||(t.objProps.colorByCategory?L=t.colorHelper.getColorForSeriesValue(l.category.objects,l.categoryIdentityFields,l.category.value,G):l.category.objects&&(I=null!=t.metadata.cols.size?t.metadata.cols.size.queryName:"",L=t.colorHelper.getColorForMeasure(l.category.objects,I,G)));var M=Y.defaultFormatter(p),n=function(){var e=l.category.levelValues,t=l.currentSeries.value;return t=e?1<_.size(e)?E.concatenateValues(_.map(e,function(e,t){return M(e.value,l.categoryMetadataColumns[t])})):e[0].value:t},V=new ee.visuals.LazyTooltipBuilder;if(t.tooltipsEnabled){var F=Y.fallbackBasedOnType(p),T=l.category.levelValues,I=1<_.size(l.categoryMetadataColumns);u||d||(I?V.withMultipleColumnAndValues(l.categoryMetadataColumns,_.map(T,function(e){return e.value}),!0,M):T&&V.withColumnValue(_.head(l.categoryMetadataColumns),T[0].value,void 0,!0,M)),t.hasDynamicSeries&&V.withColumnValue(l.currentSeriesMetadata,l.currentSeries.value,void 0,!0,M),u&&t.metadata.xGroupMetadata.isCategoricalAxis?V.withMultipleColumnAndValues(l.categoryMetadataColumns,e,!0,M):V.withColumnValue(a.cols.x,e[0],i,!1,F),V.withColumnValue(a.cols.y,o,g,!1,F).withColumnValue(a.cols.size,y,m,!1,F);var T=t.gradientIndex,k=r.valueSources;0<=T&&(B=W.getValue(l.category.values[T].objects,p),V.withColumnValue(k[T],l.category.values[T].value,B,!1,F)),(U=t.playFrameInfo)&&V.withValue(U.column.displayName,U.label);for(var O=0,N=t.tooltipValuesIndices;O<N.length;O++){var R=N[O],B=W.getValue(l.category.values[R].objects,p),H=J(v,l,c,R);V.withColumnValue(k[R],l.category.values[H].value,B,!1,F)}}var r=1<_.size(e)?e.join(" "):e[0],T=v?r:n(),U=t.categoryMap,e=String(T),T=U[e];return void 0===T&&(U[e]=T=t.categoryMapNextIndex,t.categoryMapNextIndex=T+1,(e=t.categoryIdentities)&&(e[T]=function(){var e=q.builder();if(!_.isEmpty(l.categoryMetadataColumns))for(var t=0,i=l.categoryMetadataColumns;t<i.length;t++){for(var a=i[t],r=[],o=0,s=l.category.levelValues;o<s.length;o++){var n=s[o];r.push({expr:a.expr,formattedValue:$.format(n.value,a.format),value:n.value,identity:l.category.identity})}e.withColumnIdentity(l.category.identity,a.queryName,r)}return e.withMeasures(l.valueColumnIds).createSelectionId()})),{x:r,y:o,size:y,radius:{sizeMeasure:null,index:-1,value:y},fill:L,xFormatString:i,yFormatString:g,formattedCategory:X.createLazyFormattedLazyValue(l.categoryFormatter,n),selected:!1,identity:P,renderIdentity:f,tooltipInfo:function(){return V.getTooltipItems()},labelFill:t.dataLabelSettings.fontProperties.color,markerShape:l.seriesShape,categoryIndex:T,seriesIndex:l.currentSeriesIndex||0}}}}function J(e,t,i,a){return e&&null!=t.currentSeriesIndex?t.currentSeriesIndex*i+a:a}function C(e,t,i,a){var r={};e&&e.metadata&&e.metadata.objects&&(r=e.metadata.objects);var o={};o.defaultDataPointColor=ee.DataViewObjects.getFillColor(r,u.dataPoint.defaultColor),o.fill=ee.DataViewObjects.getFillColor(r,u.dataPoint.fill);var s=r.categoryLabels;s&&t&&x.updateLabelSettingsFromLabelsObject(s,t,void 0,a);t=!1,t=i?e&&S.hasGradientRoleInMatrix(e.matrix):e&&S.hasGradientRole(e.categorical);o.fillPoint=ee.DataViewObjects.getValue(r,K.fillPoint.show,t),o.fillPointStyle=ee.DataViewObjects.getValue(r,K.fillPoint.style,n.fillStyle.fillOnly),o.colorBorder=ee.DataViewObjects.getValue(r,K.colorBorder.show,!1),o.colorByCategory=ee.DataViewObjects.getValue(r,K.colorByCategory.show,!1),o.bubbleSizeMultiplier=d.getBubbleSizeMultiplier(ee.DataViewObjects.getValue(r,K.bubbles.bubbleSize)),o.markerShape=ee.DataViewObjects.getValue(r,K.bubbles.markerShape,te.markerShape.circle),o.markerShapeShowAllSeries=W.getValue(r,K.bubbles.showSeries,!0);t=g.create(a);o.plotAreaShadingSettings={show:ee.DataViewObjects.getValue(r,K.plotAreaShading.show,X.DefaultPlotAreaShadingSettings.show),upperShadingColor:h(t,r,K.plotAreaShading.upperShadingColor,X.DefaultPlotAreaShadingSettings.upperShadingColor),lowerShadingColor:h(t,r,K.plotAreaShading.lowerShadingColor,X.DefaultPlotAreaShadingSettings.lowerShadingColor),transparency:ee.DataViewObjects.getValue(r,K.plotAreaShading.transparency,X.DefaultPlotAreaShadingSettings.transparency)};a=c.getDefaultScatterRatioLineSettings(a);return o.ratioLineSettings={show:ee.DataViewObjects.getValue(r,K.ratioLine.show,a.show),lineColor:h(t,r,K.ratioLine.lineColor,a.lineColor),transparency:ee.DataViewObjects.getValue(r,K.ratioLine.transparency,a.transparency),style:ee.DataViewObjects.getValue(r,K.ratioLine.style,a.style)},o.dataVolume=ee.DataViewObjects.getValue(r,K.general.dataVolume,X.DefaultDataVolume),o.categoryAxisType=ee.DataViewObjects.getValue(r,l.categoryAxis.axisType),o.xValuesTreatNullsAsZero=ee.DataViewObjects.getValue(r,K.categoryAxis.treatNullsAsZero,!1),o.yValuesTreatNullsAsZero=ee.DataViewObjects.getValue(r,K.valueAxis.treatNullsAsZero,!1),o}function h(e,t,i,a){return{solid:{color:e.getColorForPropertyWithDefaultColor(t,i,a?a.solid.color:void 0)}}}function v(e,t){for(var i=0,a=e.levels.length;i<a;i++){var r=e.levels[i],o=_.chain(r.sources).map(function(e,t){return{levelSource:e,index:t}}).filter(function(e){return f.hasRole(e.levelSource,t)}).map(function(e){return e.index}).value();if(!_.isEmpty(o))return{levelIndex:i,levelSourceIndices:o,column:r.sources[_.first(o)]}}}function Q(e){var t=[],i=e.cols;return!e.xGroupMetadata&&i.x&&t.push(i.x.queryName),!e.yGroupMetadata&&i.y&&t.push(i.y.queryName),i.size&&t.push(i.size.queryName),t}return{scatterConverter:t}}}(powerbi=powerbi||{}),function(k){var r=k.visuals.D3Helper;k.scatterChartRendererModuleFactory=function(){var e=k.visuals,P=e.CartesianHelper,t=jsCommon.CssConstants.createClassAndSelector,d=k.visuals.DataDirection,s=e.LineStyle,L=e.PlayChart,M=e.ScatterChart,u=k.visuals.SetFocusRingClassName,V=e.SVGUtil,h=t("scatterMarker"),l=t("mainGraphicsContext"),p=t("scatterMarkerSeriesGroup"),n=t("plotAreaShadingLayer"),c=t("upperShadingArea"),g=t("lowerShadingArea"),y=t("ratioLineLayer"),m=t("ratioLine"),F=(v.prototype.init=function(e,t,i,a,r,o,s,n){this.axisGraphicsContext=e,this.mainGraphicsG=e.append("g").classed(l.class,!0),i&&(this.mainGraphicsBackgroundRect=this.mainGraphicsG.append("rect").classed("backgroundRect",!0).attrs({width:"100%",height:"100%"})),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.tooltipsEnabled=a,this.tooltipService=r,this.eventManager=n,this.mainGraphicsContext.attr("stroke-width","1"),o&&(o=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable","true").attr("aria-label",s.getLocalizedString("Visual_Plot")).classed(u,!o))},v.prototype.markersHaveChanged=function(e){var t=_.map(e.data.dataPointSeries,function(e){return e.markerShape}),i=this.previousMarkers;if(!i)return this.previousMarkers=t,!1;for(var a=0,r=Math.min(t.length,i.length);a<r;a++)if(t[a]!==i[a])return this.previousMarkers=t,!0;return this.previousMarkers=t,!1},v.prototype.render=function(e,t,i,a){var r=e.plotArea,o=jsCommon.BrowserUtils.isInternetExplorerOrEdge();return this.mainGraphicsContext.attrs({width:r.width,height:r.height}).classed(u,!o&&!!t),this.drawRatioLine(e,a),this.drawShadedBackground(e),t=e.suppressDataPointRendering?this.removeScatterMarkers():0<e.animationDuration&&!this.markersHaveChanged(e)?this.drawScatterMarkers(e,t):this.drawScatterMarkersNoAnimation(e,e.drawBubbles,t),e.drawBubbles&&t.order(),this.tooltipsEnabled&&this.tooltipService.addTooltip(this.mainGraphicsContext,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),V.flushAllD3TransitionsIfNeeded(e.animationOptions),this.numSeries=e.data.dataPointSeries.length,this.scatterChartDataPoints=e.allData.dataPoints,{dataPointsSelection:t,eventGroup:this.mainGraphicsG,data:e.data,fillMarkers:e.fillMarkers,root:this.mainGraphicsContext,visualInstanceId:i.instanceId,eventManager:this.eventManager}},v.prototype.getNextDataPoint=function(t,i,e){var a,r=this.mainGraphicsContext.selectAll(h.selector),o=this.scatterChartDataPoints,s=t,n=i;switch(e){case d.PreviousCategory:case d.NextCategory:var l=e===d.PreviousCategory?-1:1,c=_.sortBy(_.filter(o,function(e){return e.seriesIndex===i}),"categoryIndex"),u=l+_.findIndex(c,function(e){return e.categoryIndex===t});u>=c.length||u<0?(a=this.rollToNextSeries(o,i,e),s=a[0],n=a[1]):s=c[u].categoryIndex;break;case d.PreviousSeries:case d.NextSeries:l=e===d.PreviousSeries?-1:1,c=_.sortBy(_.filter(o,function(e){return e.categoryIndex===t}),"seriesIndex");u=l+_.findIndex(c,function(e){return e.seriesIndex===i}),n=u>=c.length||u<0?(l=this.rollToNextCategory(o,t,e),s=l[0],l[1]):c[u].seriesIndex}return{element:r.filter(function(e,t){return e.seriesIndex===n&&e.categoryIndex===s}).node(),targetCategoryIndex:s}},v.prototype.rollToNextSeries=function(e,t,i){i===d.PreviousCategory||d.NextCategory;for(var a,r=i===d.PreviousCategory?-1:1,i=i===d.PreviousCategory?_.last:_.first;_.isEmpty(a);)(t+=r)>=this.numSeries?t=0:t<0&&(t=this.numSeries-1),a=_.sortBy(_.filter(e,function(e){return e.seriesIndex===t}),function(e){return e.categoryIndex});return[i(a).categoryIndex,t]},v.prototype.rollToNextCategory=function(e,t,i){i===d.PreviousSeries||d.NextSeries;for(var a,r=d3.max(e,function(e){return e.categoryIndex})+1,o=i===d.PreviousSeries?-1:1,i=i===d.PreviousSeries?_.last:_.first;_.isEmpty(a);)r<=(t+=o)?t=0:t<0&&(t=r-1),a=_.sortBy(_.filter(e,function(e){return e.categoryIndex===t}),function(e){return e.seriesIndex});i=i(a).seriesIndex;return[t,i]},v.prototype.getFirstElement=function(){return{element:this.mainGraphicsContext.selectAll(h.selector).node()}},v.prototype.createTraceLineRenderer=function(e){return new i(e,this.mainGraphicsContext,this.tooltipsEnabled,this.tooltipService)},v.prototype.drawShadedBackground=function(e){var t,i,a,r=e.data.plotAreaShadingSettings||M.DefaultPlotAreaShadingSettings,o=this.axisGraphicsContext.select(n.selector);r.show&&e.supportsPlotAreaSymmetryShading?((o=o.empty()?this.axisGraphicsContext.insert("svg",":first-child").classed(n.class,!0).style("pointer-events","none"):o).attrs({height:e.plotArea.height,width:e.plotArea.width}),t=e.xAxisProperties.scale,a=e.yAxisProperties.scale,i=t.domain(),e=a.domain(),a=[{x:t((e=[Math.min(i[0],e[0]),Math.max(i[1],e[1])])[0]),y:a(e[0])},{x:t(e[1]),y:a(e[1])}],e=r.show?[[{x:a[0].x,y:a[0].y},{x:a[0].x,y:a[1].y}],[{x:a[1].x,y:a[1].y},{x:a[1].x,y:a[1].y}]]:[],this.drawArea(c,o,e,r.upperShadingColor,r.transparency),a=r.show?[[{x:a[0].x,y:a[0].y},{x:a[0].x,y:a[0].y}],[{x:a[1].x,y:a[0].y},{x:a[1].x,y:a[1].y}]]:[],this.drawArea(g,o,a,r.lowerShadingColor,r.transparency)):o.empty()||o.remove()},v.prototype.drawRatioLine=function(e,t){var i,a,r,o,s,n,l=e.data.ratioLineSettings||P.getDefaultScatterRatioLineSettings(t),c=this.axisGraphicsContext.select(y.selector);l.show?((c=c.empty()?this.axisGraphicsContext.append("svg").classed(y.class,!0):c).attrs({height:e.plotArea.height,width:e.plotArea.width}),i=e.xAxisProperties.scale,a=e.yAxisProperties.scale,r=i.domain(),o=a.domain(),s=e.data.xSubtotal,n=e.data.ySubtotal,t=[],l.show&&_.isFinite(s)&&_.isFinite(n)&&(0!==s&&0!==n?(e=n/s,t=[{x:i(r[0]),y:a(r[0]*e)},{x:i(r[1]),y:a(r[1]*e)}]):0!==n?t=[{x:i(0),y:a(o[0])},{x:i(0),y:a(o[1])}]:0!==s&&(t=[{x:i(r[0]),y:a(0)},{x:i(r[1]),y:a(0)}])),this.drawLine(m,c,t,l)):c.empty()||c.remove()},v.prototype.removeScatterMarkers=function(){return this.mainGraphicsContext.selectAll(p.selector).remove(),this.mainGraphicsContext.selectAll(h.selector)},v.getXOfFirstCategory=function(e){if(e.hasCategoricalAxis){e=e.xAxisProperties.scale;if(r.isScaleBand(e))return e.bandwidth()/2}return 0},v.prototype.drawScatterMarkers=function(i,e){var a=i.data,r=i.xAxisProperties.scale,o=i.yAxisProperties.scale,s=i.hasCategoricalAxis,n=v.getXOfFirstCategory(i),t=[{identityKey:"",dataPoints:a.dataPoints}],l=this.mainGraphicsContext.selectAll(p.selector).data(t,function(e){return e.identityKey}),t=l.enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(p.class,!0).merge(l);l.exit().remove();l=t.selectAll(h.selector).data(function(e){return e.dataPoints},function(e){return e.renderIdentity.getKey()}),t=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),e=l.enter().append("path").classed(h.class,!0).classed(u,!t&&!!e).style("opacity",0).attrs({transform:function(e){return V.translate(r(s?e.categoryIndex:e.x)+n,o(e.y))},tabindex:e?0:null,focusable:!!e||null,role:"option","aria-selected":function(e){return e.selected}}).merge(l);return e.styles({"stroke-opacity":function(e){return M.getMarkerStrokeOpacity(null!=e.size,a.colorBorder,i.hasSelection,e.selected)},stroke:function(e){return M.getStrokeFill(e,a.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return M.getMarkerFillOpacity(null!=e.size,i.fillMarkers,i.hasSelection,e.selected)}}).transition().ease(i.easeType).duration(i.animationDuration).style("opacity",1).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,a.sizeRange,i.plotArea,a.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=a.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=r(s?e.categoryIndex:e.x)+n,i=o(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=i,e.geometry.markerShape=a.markerShape,V.translate(t,i)}}),l.exit().transition().ease(i.easeType).duration(i.animationDuration).style("opacity",0).attr("r",0).remove(),e},v.prototype.drawScatterMarkersNoAnimation=function(a,e,r){var o=a.data,s=a.xAxisProperties.scale,n=a.yAxisProperties.scale,l=a.hasCategoricalAxis,c=v.getXOfFirstCategory(a),t=(e=e?(t=[{identityKey:"",dataPoints:o.dataPoints}],this.mainGraphicsContext.selectAll(p.selector).data(t,function(e){return e.identityKey})):this.mainGraphicsContext.selectAll(p.selector).data(o.dataPointSeries,function(e){return e.identityKey})).enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(p.class,!0).merge(e);return e.exit().remove(),t.each(function(e){var t=M.getSeriesStyle(e.hasSize,o.colorBorder,a.hasSelection,a.fillMarkers,e.fill),i=d3.select(this);f(this,t);i=i.selectAll(h.selector).data(e.dataPoints,function(e){return e.renderIdentity.getKey()});i.interrupt();e=i.enter().append("path").classed(h.class,!0).merge(i);i.exit().remove(),e.each(function(e){e=M.getMarkerStyle(e,o.colorBorder,a.hasSelection,a.fillMarkers);!function(e,t){if(t)for(var i in e)e[i]===t[i]&&(e[i]=null)}(e,t),f(this,e)});i=jsCommon.BrowserUtils.isInternetExplorerOrEdge();e.classed(u,!i&&!!r).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,o.sizeRange,a.plotArea,o.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=o.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=s(l?e.categoryIndex:e.x)+c,i=n(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=i,e.geometry.markerShape=o.markerShape,V.translate(t,i)},tabindex:r?0:null,focusable:!!r||null,role:"option","aria-selected":function(e){return e.selected}}).style("opacity",null)}),this.mainGraphicsContext.selectAll(h.selector)},v.prototype.drawLine=function(e,t,i,a){var r={};r.stroke=a.lineColor.solid.color,r["stroke-width"]=2,r["stroke-opacity"]=(100-a.transparency)/100,r["stroke-dasharray"]=s.getStrokeDashArrayFromLineStyle(a.style),r["stroke-linecap"]=s.getStrokeLineCapFromLineStyle(a.style),r.fill="none",r["stroke-width"]="3px";var o=d3.line().x(function(e){return e.x}).y(function(e){return e.y}),i=t.selectAll(e.selector).data([i]);return i.enter().append("path").classed(e.class,!0).merge(i).attr("d",function(e){return o(e)}).styles(r),i.exit().remove(),t},v.prototype.drawArea=function(e,t,i,a,r){var o=d3.area().x0(function(e){return e[0].x}).y0(function(e){return e[0].y}).x1(function(e){return e[1].x}).y1(function(e){return e[1].y}),i=t.selectAll(e.selector).data([i]);i.enter().append("path").classed(e.class,!0).merge(i).attr("d",function(e){return o(e)}).styles({fill:a.solid.color,"fill-opacity":(100-r)/100}),i.exit().remove()},v);function v(){}var T=t("traceLine"),I=t("traceBubble"),i=(a.prototype.remove=function(){this.element.selectAll(T.selector).remove(),this.element.selectAll(I.selector).remove()},a.prototype.render=function(a,e){var t=this.viewModel,i=t.data.currentViewModel,r=t.viewModel,o=[];if(_.isEmpty(a)||r.suppressDataPointRendering)this.remove();else{for(var s=t.data.currentFrameIndex,n=[],l=0,c=a.length;l<c;l++){o[l]=[],n[l]=!1;for(var u=0,d=t.data.allViewModels.length;u<d&&u<=s;u++){var h=_.find(t.data.allViewModels[u].dataPoints,function(e,t){var i=a[l];return i.renderIdentity?e.renderIdentity.getKey()===i.renderIdentity.getKey():e.identity.getKey()===a[l].identity.getKey()});null!=h&&(h.frameIndex=u,o[l].push(h),u===s&&(n[l]=!0))}}var p=r.xAxisProperties.scale,g=r.yAxisProperties.scale,y=d3.line().x(function(e){return p(e.x)}).y(function(e){return g(e.y)}).defined(function(e){return null!==e.x&&null!==e.y}),m=this.element.selectAll(T.selector).data(a,function(e){return e.renderIdentity.getKey()}),v=m.enter().append("path").classed(T.class,!0).merge(m),f=[],S=[],x=!1;v.each(function(e,t){var i=this.hasAttribute("d")?this.getTotalLength():0;f.push(i);var a=$("<svg><path></path></svg>"),a=$("path",a);a.attr("d",y(o[t]));a=0<o[t].length?a.get()[0].getTotalLength():0;S.push(a),x=x||a<i}),x?e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).attr("stroke-dashoffset",function(e,t){return f[t]-S[t]}).transition().ease(d3.easeLinear).duration(1).delay(0).style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return S[t]+" "+S[t]},"stroke-dashoffset":0}):v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return S[t]+" "+S[t]},"stroke-dashoffset":0}):(v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return S[t]+" "+S[t]},"stroke-dashoffset":function(e,t){return S[t]-f[t]}}),(e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()):v).attr("stroke-dashoffset",0)),m.exit().remove();for(var b=F.getXOfFirstCategory(r),C=r.hasCategoricalAxis,w=[],D=0;D<o.length;D++)var A=o[D],A=n[D]?A.slice(0,A.length-1):A,w=w.concat(A);v=this.element.selectAll(I.selector).data(w,function(e){return e.renderIdentity.getKey()+e.x+e.y+e.size}),m=v.enter().append("path").style("opacity",0).classed(I.class,!0).merge(v);m.attrs({d:function(e){return k.visuals.Markers.getPathWithRadius(e.markerShape,P.getBubbleRadius(e.radius,r.data.sizeRange,r.plotArea,r.data.multiplier))},transform:function(e){return V.translate(p(C?e.categoryIndex:e.x)+b,g(e.y))}}).styles({"stroke-opacity":function(e){return M.getBubbleOpacity(e,!0)},stroke:function(e){return M.getStrokeFill(e,i.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return null!=e.size?.2+e.frameIndex/s*.6:0}}).transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",1),v.exit().transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",0).remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(m,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),m.sort(function(e,t){return t.size-e.size})}},a);function a(e,t,i,a){this.viewModel=e,this.element=t,this.tooltipsEnabled=i,this.tooltipService=a}function f(e,t){for(var i in t){var a=e.style[i],r=t[i];if(null==r){if(""===a)continue}else if((r=r.toString())===a)continue;e.style[i]=r}}return{create:function(){return new F}}}}(powerbi=powerbi||{}),function(w){!function(b){var y,C,a=jsCommon.Color,e=(m.prototype.initData=function(e){this.dataInitOptions=e,this.style=e.style,this.element=e.element,this.currentViewport=e.viewport,this.hostService=e.host,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},m.prototype.initRenderer=function(e){this.animator=e.animator,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost;var t=this.svg=e.svg;t.classed(m.ClassName+" "+b.PlayChart.ClassName,!0),this.renderer.init(t,e.labelsContext,this.isMobileChart,this.tooltipsEnabled,this.tooltipService,this.interactivityService,this.hostService,e.eventManager),m.DefaultPlotAreaShadingSettings.upperShadingColor={solid:{color:b.ColorHelper.getDataColorByIndex(this.style,3)}},m.DefaultPlotAreaShadingSettings.lowerShadingColor={solid:{color:b.ColorHelper.getDataColorByIndex(this.style,5)}}},m.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},m.createLazyFormattedLazyValue=function(e,t){return new jsCommon.Lazy(function(){return e.format(t())})},m.getMeasureValue=function(e,t){return 0<=e?t[e]:null},m.getDefaultData=function(e){return{xCol:void 0,yCol:void 0,hasCategory:void 0,dataPoints:[],dataPointSeries:[],legendData:b.Legend.getDefaultLegendData(e),axesLabels:{x:"",y:""},sizeRange:{min:void 0,max:void 0},dataLabelsSettings:b.DataLabelViewModel.getDefaultPointLabelSettings(e,"smallLightLabel"),hasDynamicSeries:!1,plotAreaShadingSettings:m.DefaultPlotAreaShadingSettings,ratioLineSettings:b.CartesianHelper.getDefaultScatterRatioLineSettings(e),markerShape:b.markerShape.circle,dataVolume:m.DefaultDataVolume,multiplier:b.shapeUtil.MinBubbleMultiplier}},m.prototype.renderAtFrame=function(e){this.data=this.originalData=e,this.viewModelAdapterFactory&&this.originalData&&(e=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=e.getData()),this.cartesianVisualHost.triggerRender(!1)},m.prototype.setData=function(e){var a,r,t,i=this;this.data=m.getDefaultData(this.style),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&this.playAxis.stop(),0<e.length?(t=e[0]||e[1])&&(this.categoryAxisProperties=b.CartesianHelper.getCategoryAxisProperties(t.metadata,!0),this.valueAxisProperties=b.CartesianHelper.getValueAxisProperties(t.metadata,!0),this.dataView=t,a={viewport:this.currentViewport,colors:this.colors,interactivityService:this.interactivityService,categoryAxisProperties:this.categoryAxisProperties,valueAxisProperties:this.valueAxisProperties,style:this.style,tooltipsEnabled:this.tooltipsEnabled,useMatrixDV:!0},r=b.scatterChartConverterModuleFactory(),b.PlayChart.isDataViewPlayable(t)?(this.playAxis||(this.playAxis=new b.PlayAxis({interactivityService:this.interactivityService,isScrollable:!1,featureSwitches:{}}),this.dataView&&b.PlayChart.isDataViewPlayable(this.dataView)&&(this.playAxis,this.playAxis.initData(this.dataInitOptions))),a.useMatrixDV=!1,e=this.playAxis.setData(t,function(e,t,i){return r.scatterConverter(e,a,t,i)}),this.mergeSizeRanges(e),this.data=e.currentViewModel,this.playAxis.setRenderFunction(function(e){return i.renderAtFrame(e)})):(this.playAxis&&(this.playAxis.remove(),this.playAxis=null),(t=r.scatterConverter(t,a))&&(this.data=t))):this.playAxis&&(this.playAxis.remove(),this.playAxis=null),this.originalData=this.data},m.prototype.mergeSizeRanges=function(e){if(e&&e.currentViewModel){for(var t=e.currentViewModel.sizeRange,i=0,a=e.allViewModels;i<a.length;i++){var r=a[i].sizeRange;null!=r.min&&(t.min=Math.min(t.min,r.min)),null!=r.max&&(t.max=Math.max(t.max,r.max))}for(var o=0,s=e.allViewModels;o<s.length;o++)s[o].sizeRange=t}},m.prototype.calculateCustomLegend=function(){return this.data&&this.data.legendData},m.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},m.prototype.enumerateObjectInstances=function(e,t){var i=this.originalData;switch(t.objectName){case"colorByCategory":i&&(i.hasDynamicSeries||e.pushInstance({objectName:"colorByCategory",selector:null,properties:{show:i.colorByCategory}}));break;case"dataPoint":if(this.playAxisDataColorsEnabled&&this.playAxis&&this.dataView){if(!b.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.playAxis.enumerateDataPoints(e,this.data,this.dataView,this.style)}else if(!this.playAxis&&this.dataView&&!b.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.enumerateDataPoints(e);break;case"categoryAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle},objectName:"categoryAxis"}),i.xGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.x)},objectName:"categoryAxis"});break;case"valueAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle},objectName:"valueAxis"}),i.yGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.y)},objectName:"valueAxis"});break;case"categoryLabels":if(this.isXAxisCategorical())return;this.data?b.DataLabelViewModel.enumerateCategoryLabels(e,i.dataLabelsSettings,!0,this.featureSwitches,void 0,void 0,this.style):b.DataLabelViewModel.enumerateCategoryLabels(e,null,!0,this.featureSwitches,void 0,void 0,this.style);break;case"fillPoint":if(i.hasSize)return;e.pushInstance({objectName:"fillPoint",selector:null,properties:{show:i.fillPoint}});break;case"colorBorder":i.hasSize&&e.pushInstance({objectName:"colorBorder",selector:null,properties:{show:i.colorBorder}});break;case"bubbles":m.enumerateBubbles(e,i,this.dataView);break;case"plotAreaShading":this.isPlotSymettryShadingSupported()?e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{show:i.plotAreaShadingSettings.show,upperShadingColor:i.plotAreaShadingSettings.upperShadingColor,lowerShadingColor:i.plotAreaShadingSettings.lowerShadingColor,transparency:i.plotAreaShadingSettings.transparency}}):e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{},disabledReason:this.hostService.getLocalizedString("Visual_Scatter_SymmetryShadingNotSupported")});break;case"ratioLine":i.xCol&&i.yCol&&i.xCol.isMeasure&&i.yCol.isMeasure&&e.pushInstance({selector:null,objectName:"ratioLine",properties:{show:i.ratioLineSettings.show,lineColor:i.ratioLineSettings.lineColor,transparency:i.ratioLineSettings.transparency,style:i.ratioLineSettings.style}});break;case"general":!i||this.playAxis||this.isXAxisCategorical()||e.pushInstance({selector:null,objectName:"general",properties:{dataVolume:i.dataVolume},validValues:{dataVolume:{numberRange:{min:m.DefaultDataVolume,max:m.MaximumDataVolume}}}})}},m.prototype.resolveFormattingPlaceholder=function(e){if(b.builder.isVisualFormattingSlicePlaceholder(e))return"dataVolume"!==e.name?void 0:this.getDataVolumeSlice()},m.prototype.getDataVolumeSlice=function(){var t=this,e=this.originalData;if(e&&!this.playAxis&&!this.isXAxisCategorical()){var i=b.scatterChartProps.general;return{item:new b.builder.SimpleFormattingSliceBuilder({uidBuilder:new b.builder.FormattingSliceUidBuilder(new b.builder.FormattingGroupUidBuilder(new b.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"dataVolume"),control:new b.builder.NumUpDownBuilder({descriptor:i.dataVolume,value:e.dataVolume,options:{minValue:{type:0,value:m.DefaultDataVolume},maxValue:{type:1,value:m.MaximumDataVolume}}}).build(),localize:function(e){return t.hostService.getLocalizedString(e)}}).withCustomDisplayName("Visual_DataVolumeModern").build(),revertToDefaultDescriptors:[i.dataVolume]}}},m.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&(t.hasDynamicSeries?w.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:b.LegendData.toIEnumerableDataPoints(t.legendData)},this.featureSwitches):w.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3},this.featureSwitches))},m.enumerateBubbles=function(e,t,i){var a;1<t.dataPointSeries.length&&(a=w.DataViewObjects.getValue(i&&i.metadata&&i.metadata.objects,b.scatterChartProps.bubbles.showSeries,!1));i={selector:null,properties:{bubbleSize:b.shapeUtil.invertBubbleSizeMultiplier(t.multiplier),markerShape:t.markerShape},validValues:{bubbleSize:{numberRange:{min:-30,max:100}},markerShape:[b.markerShape.circle,b.markerShape.square,b.markerShape.diamond,b.markerShape.triangle]},objectName:b.scatterChartProps.bubbles.markerShape.objectName};if(null!=a&&(i.properties[b.scatterChartProps.bubbles.showSeries.propertyName]=a),e.pushInstance(i),a)for(var r=0,o=t.dataPointSeries.length;r<o;r++){var s=t.dataPointSeries[r];e.pushContainer({displayName:s.name}),e.pushInstance({selector:w.data.Selector.normalizeSelector(s.identity.getSelector()),properties:{markerShape:s.markerShape},validValues:{markerShape:[b.markerShape.circle,b.markerShape.square,b.markerShape.diamond,b.markerShape.triangle]},objectName:b.scatterChartProps.bubbles.markerShape.objectName}),e.popContainer()}},m.prototype.getMarkersCard=function(t){var r=this,o=this.originalData;if(o&&o.dataPointSeries&&0!==o.dataPointSeries.length){var s=w.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,b.scatterChartProps.bubbles.showSeries,!0),n=function(e){return r.hostService.getLocalizedString(e)},e=[b.scatterChartObjectProps.bubbles.markerShape,b.scatterChartObjectProps.bubbles.bubbleSize,b.scatterChartObjectProps.bubbles.showSeries,b.scatterChartObjectProps.fillPoint.show,b.scatterChartObjectProps.fillPoint.style,b.scatterChartObjectProps.dataPoint.fill,b.scatterChartObjectProps.dataPoint.showAllDataPoints,b.scatterChartObjectProps.dataPoint.defaultColor,b.scatterChartObjectProps.colorByCategory.show,b.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,b.scatterChartObjectProps.categoryAxis.innerPadding,b.scatterChartObjectProps.colorBorder.show],e=new b.builder.FormattingCardBuilder(new b.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",e,n),l={styleProps:{markerShape:b.scatterChartObjectProps.bubbles.markerShape,markerSize:b.scatterChartObjectProps.bubbles.bubbleSize,fillPointShow:b.scatterChartObjectProps.fillPoint.show,fillPointStyle:b.scatterChartObjectProps.fillPoint.style,showSeries:b.scatterChartObjectProps.bubbles.showSeries,colorBorder:b.scatterChartObjectProps.colorBorder.show},style:{markerShape:o.markerShape,fillPointShow:o.fillPoint,fillPointStyle:o.fillPointStyle,markerSize:b.shapeUtil.invertBubbleSizeMultiplier(o.multiplier),showSeries:s,colorBorder:o.colorBorder},selector:null,hasSize:o.hasSize,showSeries:s};return e.addGroup("applySettingsTo",function(e){e.withContainerDisabled(!s).withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",n("All"),function(e){var t;b.MarkerProperties.addScatterChartMarkersFormattingContainers(l,e,r.featureSwitches),s||(t=[b.scatterChartObjectProps.bubbles.markerShape],e.addSimpleSlice("showSeriesLink",function(){return new b.builder.SeriesDialogLinkBuilder({descriptor:b.scatterChartObjectProps.bubbles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<o.dataPointSeries.length)for(var t=0,i=o.dataPointSeries;t<i.length;t++){var a=i[t];l=__assign(__assign({},l),{style:__assign(__assign({},l.style),{markerShape:a.markerShape}),selector:w.data.Selector.normalizeSelector(a.identity.getSelector())}),e.addContainerItem(a.name,a.name,function(e){return b.MarkerProperties.addScatterChartMarkersFormattingContainers(l,e,r.featureSwitches)})}})}),e.addGroup("colors",function(e){if(e.withDisplayName("Generic_Color"),o.hasDynamicSeries||e.addSimpleSlice("colorByCategory",new b.builder.ToggleSwitchBuilder({descriptor:__assign(__assign({},b.scatterChartObjectProps.colorByCategory.show),{selector:null}),value:o.colorByCategory}).build(),function(e){return e.withCustomDisplayName("Visual_ColorByCategory")}),o.hasDynamicSeries){var t={groupBuilder:e,dataPoints:b.LegendData.toIEnumerableDataPoints(o.legendData),seriesColorProps:b.scatterChartObjectProps.dataPoint,localize:n,featureSwitches:r.featureSwitches};return w.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t)}e={groupBuilder:e,colorProps:b.columnChartProps.dataPoint,featureSwitches:r.featureSwitches,hostService:r.hostService,options:{dataView:r.dataView,style:r.style,categories:_.map(o.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3}};w.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(e)}),this.isXAxisCategorical()&&e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new b.builder.SliderBuilder({descriptor:b.scatterChartObjectProps.categoryAxis.innerPadding,value:100*t.categoryAxisData.innerPadding,localize:n,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new b.builder.NumUpDownBuilder({descriptor:b.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,value:Math.round(100*t.categoryAxisData.maxMarginFactor),options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()}},m.prototype.getCategoryLabelsCard=function(){var t=this;if(!this.isXAxisCategorical()){var e=b.scatterChartObjectProps.categoryLabels,i=__assign(__assign({},e),{fontFamily:e.fontFamily,fontSize:e.fontSize,show:e.show}),e=this.data?this.data.dataLabelsSettings:null;return b.DataLabelViewModel.getCategoryLabelsCard({cardName:"Visual_CategoryLabel",dataLabelSettings:e,isShowCategory:void 0,localize:function(e){return t.hostService.getLocalizedString(e)},props:i,revertToDefaultProps:b.scatterChartObjectProps.categoryLabels,showBackground:!0,showValueColor:!0,style:this.style,featureSwitches:this.featureSwitches})}},m.prototype.customizeFormattingCard=function(e){var t;return b.builder.isPlaceholder(e)||("categoryAxis"===e.uid&&(t=this.getCustomizedCategoryAxisCard(e)),"valueAxis"===e.uid&&(t=this.getCustomizedValueAxisCard(e))),t},m.prototype.getCustomizedCategoryAxisCard=function(e){var i=this,a=__spreadArray([],e.groups);return a.forEach(function(e,t){b.builder.isPlaceholder(e)||"categoryAxis-valuesScalar"===e.uid&&(a[t]=i.getNewValuesGroup(e,!0))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors),[b.scatterChartProps.categoryAxis.treatNullsAsZero]),groups:a})},m.prototype.getCustomizedValueAxisCard=function(e){var i=this,a=__spreadArray([],e.groups);return a.forEach(function(e,t){b.builder.isPlaceholder(e)||"valueAxis-values"===e.uid&&(a[t]=i.getNewValuesGroup(e,!1))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors),[b.scatterChartProps.valueAxis.treatNullsAsZero]),groups:a})},m.prototype.getNewValuesGroup=function(e,t){var i=__spreadArray([],e.slices),a=b.builder.FormattingUidBuilder.fromGroup(e),t=this.getShowBlankValuesSlice(a,t);return t&&i.push(t),__assign(__assign({},e),{slices:i})},m.prototype.getShowBlankValuesSlice=function(e,t){var i=this,a=this.originalData,r=t?a.xGroupMetadata:a.yGroupMetadata,o=(t?b.scatterChartProps.categoryAxis:b.scatterChartProps.valueAxis).treatNullsAsZero,a=t?!(!a.treatNullsAsZero||!a.treatNullsAsZero.x):!(!a.treatNullsAsZero||!a.treatNullsAsZero.y);if(!r){a={type:"ToggleSwitch",properties:{descriptor:__assign(__assign({},o),{selector:null}),value:a}};return new b.builder.SimpleFormattingSliceBuilder({control:a,localize:function(e){return i.hostService.getLocalizedString(e)},uidBuilder:e.withSlice("showblankvalues")}).build()}},m.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getMarkersCard(e)},function(){return t.getCategoryLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:2}},m.prototype.supportsTrendLine=function(){var e=this.data;return!(!e||this.isXAxisCategorical()||this.playAxis)&&(!e.hasSize&&(e.hasCategory||e.hasDynamicSeries)&&!!e.xCol&&!!e.yCol)},m.prototype.supportsStaticReferenceLines=function(){return this.data&&!this.isXAxisCategorical()},m.prototype.getAxisLocationForRole=function(e){return"X"===e?0:1},m.getExtents=function(e){var t={},i=e.dataPoints;if(_.isEmpty(i))return{minY:0,maxY:0,formatStringY:void 0,minX:0,maxX:0,formatStringX:void 0};var a=!!e.xGroupMetadata,e=a&&e.xGroupMetadata.isCategoricalAxis;return e||(t.minX=d3.min(i,function(e){return e.x}),t.maxX=d3.max(i,function(e){return e.x}),t.formatStringX=_.first(i).xFormatString),a&&!e&&(i=_.filter(i,function(e){return null!=e.x})),t.minY=d3.min(i,function(e){return e.y}),t.maxY=d3.max(i,function(e){return e.y}),t.formatStringY=null===(i=_.first(i))||void 0===i?void 0:i.yFormatString,t},m.prototype.calculateAxesProperties=function(e){var t=this.currentViewport=e.viewport;this.viewModelAdapterFactory&&this.originalData&&(c=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=c.getData());var i=this.data,a=e.margin;this.currentViewport=t,this.margin=a;var r=t.width-(a.left+a.right),o=t.height-(a.top+a.bottom),s={minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10};this.playAxis?(s=this.playAxis.getCartesianExtents(s,m.getExtents),this.playAxisControlLayout=e.playAxisControlLayout):_.isEmpty(i.dataPoints)||(s=m.getExtents(i));var n,l=e.categoryAxisOptions,c=this.isXAxisCategorical(),t=this.getAxesDomains(!1,{categoryAxis:!c,valueAxis:!0});c?u=_.uniq(_.map(i.dataPoints,function(e){return e.categoryIndex})):(u=(n=b.AxisHelper.mergeScalarAxisDomains(l.includeDomain,b.AxisHelper.createScalarDomainOptions(t.categoryAxis,0)))&&n.domain,n=b.AxisHelper.hasForcedDomain(n));var u,l={pixelSpan:r,dataDomain:u,axisZoom:e.axisZoom,zeroScalarDomain:[-1,1],metaDataColumn:i.xCol,formatString:s.formatStringX||b.valueFormatter.getFormatString(i.xCol,b.scatterChartProps.general.formatString),outerPadding:0,isScalar:!c,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:l.scaleType,logAxisScale:l.logAxisScale,axisDisplayUnits:l.displayUnits,axisPrecision:l.precision,margin:a,preventNice:n,invertAxis:l.invertAxis,featureSwitches:this.featureSwitches};c&&(u=this.getCategoryLayout(u,e),l.outerPadding=u.outerPaddingRatio,l.categoryThickness=u.categoryThickness,l.innerPaddingRatio=u.innerPaddingRatio,l.outerPaddingRatio=u.outerPaddingRatio,l.getValueFn=function(t,e){return _.find(i.dataPoints,function(e){return e.categoryIndex===t}).formattedCategory.getValue()}),this.xAxisProperties=b.AxisHelper.createAxis(l),this.xAxisProperties.axis.tickSizeInner(-o).tickSizeOuter(0),this.xAxisProperties.axisLabel=this.data.axesLabels.x,c&&(this.xAxisProperties.categoryIdentities=i.categoryIdentities);l=e.valueAxisOptions,c=b.AxisHelper.mergeScalarAxisDomains(l.includeDomain,b.AxisHelper.createScalarDomainOptions(t.valueAxis,0)),t=b.AxisHelper.hasForcedDomain(c);return this.yAxisProperties=b.AxisHelper.createAxis({pixelSpan:o,dataDomain:c&&c.domain,axisZoom:e.axisZoom,zeroScalarDomain:[-1,1],metaDataColumn:i.yCol,formatString:s.formatStringY||b.valueFormatter.getFormatString(i.yCol,b.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:l.scaleType,logAxisScale:l.logAxisScale,axisDisplayUnits:l.displayUnits,axisPrecision:l.precision,margin:a,preventNice:t,invertAxis:l.invertAxis,featureSwitches:this.featureSwitches}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},m.prototype.getAxesDomains=function(e,t){var i={},a=this.data;if(!a)return i;var r={minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10};return this.playAxis?r=this.playAxis.getCartesianExtents(r,m.getExtents):_.isEmpty(a.dataPoints)||(r=m.getExtents(a)),t.categoryAxis&&!this.isXAxisCategorical()&&(i.categoryAxis=[r.minX,r.maxX]),t.valueAxis&&(i.valueAxis=[r.minY,r.maxY]),i},m.prototype.setAxesLayout=function(e){},m.prototype.getCategoryLayout=function(e,t){var i=this.data,a=this.currentViewport.width-(this.margin.left+this.margin.right),r=_.size(_.uniqBy(i.dataPoints,function(e){return e.categoryIndex})),o=b.CartesianHelper.getCategoryAxisProperties(this.dataView.metadata),i=b.CartesianHelper.getPreferredCategoryWidth(o),o=this.isXAxisCategorical();return b.CartesianChartLayout.getLayout(void 0,{availableWidth:a,categoryCount:r,preferredCategoryWidth:i,domain:e,isScalar:!o,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})},m.prototype.getPreferredPlotArea=function(e,t,i,a){return b.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a=void 0===a?0:a)},m.prototype.setFilteredData=function(i,a){var e;this.isXAxisCategorical()&&((e=this.data=w.Prototype.inherit(this.originalData)).dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=i&&e.categoryIndex<a}),e.dataPointSeries=_.map(e.dataPointSeries,function(e){var t=w.Prototype.inherit(e),e=_.filter(e.dataPoints,function(e){return e.categoryIndex>=i&&e.categoryIndex<a});return t.dataPoints=e,t}))},m.prototype.overrideXScale=function(e){this.xAxisProperties=e},m.prototype.shouldSuppressAnimation=function(){return this.data&&this.data.dataPoints&&this.data.dataPoints.length>m.NoAnimationThreshold},m.prototype.render=function(e,t){if(this.data){this.playAxis&&!this.playAxis.isRendererInitialized()&&this.playAxis.initRenderer({svg:this.svg});var i=this.data,a=this.margin,r=this.currentViewport,o=this.interactivityService&&this.interactivityService.hasSelection(),s={width:r.width-(a.left+a.right),height:r.height-(a.top+a.bottom)},n=b.AnimatorCommon.GetAnimationDuration(this.animator,e);this.playAxis&&this.playAxis.isCurrentlyPlaying()&&(this.isMobileChart||0<n)&&(n=b.PlayChart.getFrameAnimationDuration());var l=this.playAxis?d3.easeLinear:d3.easeCubicInOut,c=this.data.hasSize,u=this.featureSwitches.fillPointStyle?i.fillPointStyle===b.fillStyle.fillOnly:i.fillPoint,d=!c&&u,u=1===t&&i.dataPoints&&i.dataPoints.length>m.NoRenderResizeThreshold,t=this.isXAxisCategorical(),u={data:i,allData:this.originalData,drawBubbles:c,isPlay:!!this.playAxis,hasCategoricalAxis:t,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,plotArea:s,hasSelection:o,animationDuration:n,animationOptions:this.animationOptions,fillMarkers:d,easeType:l,suppressDataPointRendering:u,supportsPlotAreaSymmetryShading:this.isPlotSymettryShadingSupported()};c&&!t&&(g=i.dataPoints.sort(m.sortBubbles),u.data=w.Prototype.inherit(u.data),u.data.dataPoints=g);c=[];(i.dataLabelsSettings&&i.dataLabelsSettings.show||i.dataLabelsSettings.showCategory)&&(c=y.createLabelDataPoints(u,this.style));var h,p,g=this.renderer.render(u,this.interactivityService,this.hostService,this.style);return g.hitTester=new v({dataPoints:g.data.dataPoints,margin:this.margin}),this.isMobileChart&&(g={data:g.data,dataPointsSelection:g.dataPointsSelection,eventGroup:g.eventGroup,root:g.root,host:this.cartesianVisualHost,mobileRoot:this.svg,visualDataInitOptions:this.dataInitOptions,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,background:d3.select(this.element.get(0)),visualInstanceId:g.visualInstanceId,eventManager:g.eventManager}),this.playAxis&&(this.playAxisControlLayout,this.playAxis.setPlayControlPosition(this.playAxisControlLayout),h=this.playAxis.render(e,u,r,a),this.interactivityService&&(a={traceLineRenderer:this.renderer.createTraceLineRenderer(h.viewModel)},o&&b.PlayChart.renderTraceLines(h.allDataPoints,a.traceLineRenderer,!e),g.playOptions=a)),this.interactivityService&&(p=b.DataPointNavigationStrategy.SeriesFirst,t?p=b.DataPointNavigationStrategy.CategoryFirst:this.data.hasDynamicSeries||(p=b.DataPointNavigationStrategy.CategoryOnly),p={navigationStrategy:p,helper:this.renderer}),{dataPoints:h?h.allDataPoints:i.dataPoints,behaviorOptions:g,navigationOptions:p,labelDataPoints:c,labelsAreNumeric:!1,animateLabels:!0}}},m.getStrokeFill=function(e,t){if(null!=e.size&&t){t=a.parseColorString(e.fill);return t?a.hexString(a.darken(t,m.StrokeDarkenColorValue)):e.fill}return e.fill},m.getMarkerFillOpacity=function(e,t,i,a){return e||t?i&&!a?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity:0},m.getMarkerStrokeOpacity=function(e,t,i,a){return e&&t?1:i&&!a?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity},m.getMarkerStrokeFill=function(e,t,i){if(e&&t){t=a.parseColorString(i);return t?a.hexString(a.darken(t,m.StrokeDarkenColorValue)):i}return i},m.getMarkerStyle=function(e,t,i,a){return{"stroke-opacity":m.getMarkerStrokeOpacity(null!=e.size,t,i,e.selected),stroke:m.getMarkerStrokeFill(null!=e.size,t,e.fill),fill:e.fill,"fill-opacity":m.getMarkerFillOpacity(null!=e.size,a,i,e.selected)}},m.getSeriesStyle=function(e,t,i,a,r){return{"stroke-opacity":m.getMarkerStrokeOpacity(e,t,i,!1),stroke:null,fill:r,"fill-opacity":m.getMarkerFillOpacity(e,a,i,!1)}},m.getBubbleOpacity=function(e,t){return t&&!e.selected?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity},m.prototype.getCategoryValueType=function(){var e=this.data.xCol;return b.AxisHelper.getCategoryValueType(e)},m.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},m.prototype.getSupportedCategoryAxisType=function(){return this.data.xGroupMetadata?this.data.xGroupMetadata.isScalarType?b.axisType.both:b.axisType.categorical:b.axisType.scalar},m.prototype.getVisualCategoryAxisIsScalar=function(){return!this.isXAxisCategorical()},m.sortBubbles=function(e,t){if(e.radius.sizeMeasure){var i=t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index];if(0!=i)return i}else if(null!=e.radius.value)return t.radius.value-e.radius.value;return t.identity.getKey().localeCompare(e.identity.getKey())},m.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},m.prototype.getStaticSeriesRole=function(){},m.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},m.prototype.isXAxisCategorical=function(){var e;return null===(e=null===(e=this.data)||void 0===e?void 0:e.xGroupMetadata)||void 0===e?void 0:e.isCategoricalAxis},m.prototype.isPlotSymettryShadingSupported=function(){var e,t;return this.featureSwitches.logAxisScale?!this.isXAxisCategorical()&&!0!==(null===(e=this.valueAxisProperties)||void 0===e?void 0:e.logAxisScale)&&(!1===(null===(e=this.categoryAxisProperties)||void 0===e?void 0:e.logAxisScale)||null==(null===(e=this.categoryAxisProperties)||void 0===e?void 0:e.logAxisScale)&&(null===(e=this.categoryAxisProperties)||void 0===e?void 0:e.axisScale)!==w.visuals.axisScale.log):!this.isXAxisCategorical()&&(null===(t=this.valueAxisProperties)||void 0===t?void 0:t.axisScale)!==w.visuals.axisScale.log&&(null===(t=this.categoryAxisProperties)||void 0===t?void 0:t.axisScale)!==w.visuals.axisScale.log},m.DefaultBubbleOpacity=.85,m.DimmedBubbleOpacity=.4,m.StrokeDarkenColorValue=63.75,m.ClassName="scatterChart",m.NoAnimationThreshold=1e3,m.NoRenderResizeThreshold=1e3,m.DefaultDataVolume=3500,m.MaximumDataVolume=1e4,m.DefaultPlotAreaShadingSettings={show:!1,upperShadingColor:null,lowerShadingColor:null,transparency:70},m);function m(e){e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.playAxisDataColorsEnabled=e.featureSwitches.playAxisDataColors,this.viewModelAdapterFactory=e.viewModelAdapterFactory,this.isScrollable=e.isScrollable),this.renderer=w.scatterChartRendererModuleFactory().create()}b.ScatterChart=e,y=y||{},C=[2,1,8,4,16,32,64,128],y.createLabelDataPoints=function(e,t){for(var i,a,r,o,s=e.xAxisProperties.scale,n=e.yAxisProperties.scale,l=e.data.sizeRange,c=e.data.multiplier,u=[],d=e.data.dataPoints,h=e.data.dataLabelsSettings,p=(a=(i=e).plotArea.width,r=i.plotArea.height,o=new b.Point(a/2,r/2),r=function(e,t){var i=[],e=e/4,t=t/4;return i.push(new b.Point(e,t)),i.push(new b.Point(3*e,t)),i.push(new b.Point(e,3*t)),i.push(new b.Point(3*e,3*t)),i}(a,r),function(e,t,i){for(var a=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],r=[],o=i.xAxisProperties.scale,s=i.yAxisProperties.scale,n=0,l=i.data.dataPoints;n<l.length;n++){var c=l[n],u=o(c.x),d=s(c.y),h=function(e,t,i){if(e>i.x&&t<=i.y)return 0;if(e<=i.x&&t<=i.y)return 1;return e<=i.x&&t>i.y?2:3}(u,d,e);i.drawBubbles?r[h]||(r[h]=c.identity):(d=function(e,t,i,a){return Math.sqrt((e-i)*(e-i)+(t-a)*(t-a))}(t[h].x,t[h].y,u,d))<a[h]&&(r[h]=c.identity,a[h]=d)}for(var p=[],g=0,y=r;g<y.length;g++){var m=y[g];m&&p.push(m.getKey())}return p}(o,r,i)),g=0,y=d;g<y.length;g++){var m=y[g],v=m.formattedCategory.getValue(),f=h.fontProperties,S=b.FontProperties.toTextProperties(f,v),x=w.TextMeasurementService.measureSvgTextWidth(S),S=w.TextMeasurementService.estimateSvgTextHeight(S);u.push({isPreferred:!!p&&function(e,t){for(var i=0,a=t;i<a.length;i++){var r=a[i];if(0===e.localeCompare(r))return!0}return!1}(m.identity.getKey(),p),text:v,textSize:{width:x,height:S},outsideFill:f.color||b.ColorHelper.getThemeColor(t,b.DataLabelViewModel.DefaultLabelColorName),insideFill:b.ColorHelper.getThemeColor(t,b.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:s(m.x),y:n(m.y)},radius:b.CartesianHelper.getBubbleRadius(m.radius,l,e.plotArea,c),validPositions:C},identity:m.renderIdentity,fontProperties:f,hasBackground:h.enableBackground,backgroundColor:h.backgroundColor,backgroundTransparency:h.backgroundTransparency})}return u};var v=(t.prototype.queryRegion=function(e){var i=this,a=b.extractBoundingRectFromLasso(e,!1);return this.adjustPositionRelativeToRoot(a),_.filter(this.dataPoints,function(e){if(void 0===e.size)return i.isPointInRect(a,e.geometry);var t=void 0;switch(e.geometry.markerShape){case b.markerShape.circle:t=b.shapes.Polygon.circleRectangleOverlap(a,{x:e.geometry.x,y:e.geometry.y},e.geometry.size);break;case b.markerShape.square:t=i.isSquareMarkerIntersect(e.geometry,a);break;case b.markerShape.diamond:t=i.isDiamondMarkerIntersect(e.geometry,a);break;case b.markerShape.triangle:t=i.isTriangleMarkerIntersect(e.geometry,a);break;default:t=!1}return t})},t.prototype.isSquareMarkerIntersect=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return b.shapes.Rect.overlappingRange(e.left,e.right,t.left,t.right)&&b.shapes.Rect.overlappingRange(e.top,e.bottom,t.top,t.bottom)},t.prototype.isDiamondMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var i=[{x:e.x-e.size,y:e.y},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y},{x:e.x,y:e.y+e.size}],a=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[a[0],a[1]],[a[1],a[2]],[a[3],a[2]],[a[0],a[3]]],o=0,s=[[i[0],i[1]],[i[1],i[2]],[i[0],i[3]],[i[3],i[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(b.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.isPointInRect=function(e,t){return w.Double.lessOrEqualWithPrecision(e.left,t.x)&&w.Double.lessOrEqualWithPrecision(t.x,e.right)&&w.Double.lessOrEqualWithPrecision(e.top,t.y)&&w.Double.lessOrEqualWithPrecision(t.y,e.bottom)},t.prototype.isLassoInShape=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return b.shapes.Rect.overlappingRange(t.left,t.right,e.left,e.right)&&b.shapes.Rect.overlappingRange(t.top,t.bottom,e.top,e.bottom)},t.prototype.isTriangleMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var i=[{x:e.x-e.size,y:e.y+e.size},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y+e.size}],a=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[a[0],a[1]],[a[1],a[2]],[a[3],a[2]],[a[0],a[3]]],o=0,s=[[i[0],i[1]],[i[1],i[2]],[i[0],i[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(b.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.adjustPositionRelativeToRoot=function(e){e.left-=this.margin.left,e.top-=this.margin.top,e.right-=this.margin.left,e.bottom-=this.margin.top},t);function t(e){this.dataPoints=e.dataPoints,this.margin=e.margin}b.ScatterChartHitTester=v}(w.visuals||(w.visuals={}))}(powerbi=powerbi||{}),function(e){!function(c){var a=jsCommon.BrowserUtils,e=jsCommon.CssConstants.createClassAndSelector,t=jsCommon.PerfTimer,i=(r.prototype.create=function(){return new o},r);function r(){}c.ScatterChartWebBehaviorFactory=i;var o=(s.prototype.bindEvents=function(e,t,i){var a=this.bubbles=e.dataPointsSelection,r=e.data,o=e.eventGroup;!this.playOptions||!this.playOptions.traceLineRenderer||e.playOptions&&e.playOptions.traceLineRenderer||this.playOptions.traceLineRenderer.remove(),this.playOptions=e.playOptions,this.shouldEnableFill=e.fillMarkers,this.colorBorder=r.colorBorder,this.hitTester=e.hitTester;var s,n,l=this.rootSelection=e.root,r=this.visualInstanceId=e.visualInstanceId;i&&(s=i.dataPointNavigationManager,n=i.pointSourceKey),c.InteractivityUtils.appendUseElementForFocus(l,r,n),this.selectionHandler=t,o?c.InteractivityUtils.registerGroupInteractivityHandlers(e.eventManager,o,t):c.InteractivityUtils.registerStandardInteractivityHandlers(a,t),s&&(s.isEmpty(n)||(c.InteractivityUtils.registerEnterPlotAreaHandler(l,s,n),c.InteractivityUtils.registerDataPointNavigationHandler(l,s,n),c.InteractivityUtils.registerClearCatcherShortcut(l,t)))},s.prototype.renderSelection=function(t){var e,i,a=this.shouldEnableFill,r=this.colorBorder;this.bubbles.styles({"fill-opacity":function(e){return c.ScatterChart.getMarkerFillOpacity(null!=e.size,a,t,e.selected)},"stroke-opacity":function(e){return c.ScatterChart.getMarkerStrokeOpacity(null!=e.size,r,t,e.selected)}}),this.playOptions&&this.bubbles&&(e=this.bubbles.filter(function(e){return e.selected}).data(),i=this.playOptions.traceLineRenderer,e&&0<e.length&&null!=i?i.render(e,!0):i.remove())},s.prototype.renderFocus=function(e){var t,i=c.CurrentFocusDataPointId+"-"+this.visualInstanceId;this.rootSelection.select("#"+i).attr("id",null),e&&(this.bubbles.attr("aria-label",null),(t=d3.select(e).datum())&&e.setAttribute("aria-label",c.tooltipUtils.formatTooltipInfo(t.tooltipInfo())),e.setAttribute("id",i),a.focus(e))},s.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},s.prototype.getLassoSelectDirectionMode=function(){return 1},s);function s(){}c.ScatterChartWebBehavior=o;n.prototype.create=function(){return new l},i=n;function n(){}c.ScatterChartMobileBehaviorFactory=i;var l=(u.prototype.bindEvents=function(e,t,i){this.setOptions(e),e.visualDataInitOptions&&e.visualDataInitOptions.interactivity.isInteractiveLegend&&(this.makeDataPointsSelectable(e.dataPointsSelection),this.makeRootSelectable(e.mobileRoot),this.makeDragable(e.mobileRoot),this.disableDefaultTouchInteractions(e.mobileRoot),this.selectRoot())},u.prototype.renderSelection=function(e){},u.prototype.setSelectionHandler=function(e){},u.prototype.makeDataPointsSelectable=function(){for(var i=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var a=0,r=e.length;a<r;a++)e[a].on("click",function(e,t){i.select(t)})},u.prototype.makeRootSelectable=function(e){var i=this;e.on("click",function(e,t){i.selectRoot()})},u.prototype.makeDragable=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var a=0,r=e.length;a<r;a++){var o=e[a],s=d3.drag().on("drag",function(e){t.drag(0)}).on("end",function(e){t.drag(1)});o.call(s)}},u.prototype.disableDefaultTouchInteractions=function(e){e.style("touch-action","none")},u.prototype.setOptions=function(e){this.data=e.data,this.mainGraphicsContext=e.root,this.xAxisProperties=e.xAxisProperties,this.yAxisProperties=e.yAxisProperties,this.host=e.host},u.prototype.select=function(e){this.selectDotByIndex(e)},u.prototype.selectRoot=function(){var e=t.start("selectRoot");this.onClick(),e()},u.prototype.drag=function(e){switch(e){case 0:this.onDrag();break;case 1:this.onClick()}},u.prototype.onDrag=function(){var e=this.getMouseCoordinates();this.moveCrosshairToXY(e.x,e.y);e=this.findClosestDotIndex(e.x,e.y);this.selectDot(e),this.updateLegend(e)},u.prototype.onClick=function(){var e=this.getMouseCoordinates(),e=this.findClosestDotIndex(e.x,e.y);-1!==e&&this.selectDotByIndex(e)},u.prototype.getMouseCoordinates=function(){var e=this.mainGraphicsContext,t=0;a=(a=parseInt(e.attr("height"),10))||0;try{var i=d3.mouse(e.node()),t=i[0],a=i[1]}catch(e){}return{x:t,y:a}},u.prototype.selectDotByIndex=function(e){this.selectDot(e),this.moveCrosshairToIndexDot(e),this.updateLegend(e)},u.prototype.selectDot=function(a){var r=this,e=this.mainGraphicsContext;e.selectAll(u.ScatterMarker.selector).classed("selected",!1).classed("notSelected",!0),e.selectAll(u.ScatterMarker.selector).filter(function(e,t){var i=r.data.dataPoints;i.length,i.length;i=i[a];return e.x===i.x&&e.y===i.y}).classed("selected",!0).classed("notSelected",!1)},u.prototype.moveCrosshairToIndexDot=function(e){var t=this.data.dataPoints,i=this.mainGraphicsContext;t.length,t.length;var a=this.xAxisProperties.scale(t[e].x),r=this.yAxisProperties.scale(t[e].y);null==this.crosshair?(t=+i.attr("width"),e=+i.attr("height"),this.crosshair=this.drawCrosshair(i,a,r,t,e),this.crosshairHorizontal=this.crosshair.select(u.Horizontal.selector),this.crosshairVertical=this.crosshair.select(u.Vertical.selector)):this.moveCrosshairToXY(a,r)},u.prototype.moveCrosshairToXY=function(e,t){this.crosshairHorizontal.attrs({y1:t,y2:t}),this.crosshairVertical.attrs({x1:e,x2:e})},u.prototype.drawCrosshair=function(e,t,i,a,r){e=e.append("g");return e.classed(u.CrosshairClassName,!0),e.append("line").classed(u.Horizontal.class,!0).attrs({x1:0,x2:a,y1:i,y2:i}),e.append("line").classed(u.Vertical.class,!0).attrs({x1:t,x2:t,y1:r,y2:0}),e},u.prototype.findClosestDotIndex=function(e,t){var i,a=-1,r=Number.MAX_VALUE,o=this.data.dataPoints,s=this.xAxisProperties.scale,n=this.yAxisProperties.scale;for(i in o){var l=o[i],c=s(l.x)-e,l=n(l.y)-t,l=c*c+l*l;(r===Number.MAX_VALUE||r&&l<r)&&(a=i,r=l)}return a},u.prototype.updateLegend=function(e){var t;null!=this.lastDotIndex&&this.lastDotIndex===e||(t=this.createLegendDataPoints(e),this.host.updateLegend(t),this.lastDotIndex=e)},u.prototype.createLegendDataPoints=function(e){var t=c.scatterChartProps.general.formatString,i=[],a=this.data;a.dataPoints.length,a.dataPoints.length;var r=a.dataPoints[e],o=c.valueFormatter.format(null),s=o,n=a.legendData;n.dataPoints;var l=n.dataPoints,n=r.formattedCategory.getValue();n!==o?(s=n,null!=r&&null!=r.radius&&null!=r.radius.sizeMeasure&&(s+="; "+c.valueFormatter.format(r.radius.sizeMeasure.source.groupName))):null!=r.radius.sizeMeasure?s=c.valueFormatter.format(r.radius.sizeMeasure.source.groupName):0<l.length&&l.length>=e&&l[e].label!==o&&(s=l[e].label),null!=a.xCol&&i.push({category:s,color:r.fill,identity:c.SelectionIdBuilder.builder().withMeasure(a.xCol.queryName).createSelectionId(),selected:r.selected,icon:c.LegendIcon.Box,label:c.valueFormatter.format(this.data.axesLabels.x),measure:c.valueFormatter.format(r.x,c.valueFormatter.getFormatString(a.xCol,t)),iconOnlyOnLabel:!0,index:0}),null!=a.yCol&&i.push({category:s,color:r.fill,identity:c.SelectionIdBuilder.builder().withMeasure(a.yCol.queryName).createSelectionId(),selected:r.selected,icon:c.LegendIcon.Box,label:c.valueFormatter.format(a.axesLabels.y),measure:c.valueFormatter.format(r.y,c.valueFormatter.getFormatString(a.yCol,t)),iconOnlyOnLabel:!0,index:1}),null!=a.size&&i.push({category:s,color:r.fill,identity:c.SelectionIdBuilder.builder().withMeasure(a.size.queryName).createSelectionId(),selected:r.selected,icon:c.LegendIcon.Box,label:c.valueFormatter.format(a.size.displayName),measure:c.valueFormatter.format(r.radius.sizeMeasure&&r.radius.sizeMeasure.values[r.radius.index]||r.radius.value,c.valueFormatter.getFormatString(a.size,t)),iconOnlyOnLabel:!0,index:2});t=c.Legend.getDefaultLegendData();return t.dataPoints=i,t},u.CrosshairClassName="crosshair",u.ScatterMarker=e("scatterMarker"),u.Horizontal=e("horizontal"),u.Vertical=e("vertical"),u);function u(){}c.ScatterChartMobileBehavior=l}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(F){var T,d,e,t,y,m;function I(e){this.isScrollable=e.isScrollable,this.tooltipsEnabled=null==e.tooltipsEnabled||e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.featureSwitch=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory}T=F.visuals||(F.visuals={}),d=T.builder,e=jsCommon.CssConstants.createClassAndSelector,t=T.labelPosition,y=jsCommon.Lazy,m=jsCommon.StringExtensions,I.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostServices=e.host,this.tooltipService=e.services.tooltips,this.animationOptions=e.animation},I.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(I.WaterfallClassName,!0),this.mainGraphicsSVG=this.svg.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVG.append("g").classed(I.MainGraphicsContextClassName,!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,role:"listbox","aria-multiselectable":!0,"aria-label":this.hostServices.getLocalizedString("Visual_Plot")}).classed(T.SetFocusRingClassName,!e))},I.converter=function(e){var t=e.dataView;if(t)return t.categorical?I.categoricalConverter(e):t.matrix?F.waterfallConverterModuleFactory().matrixConverter(e):void 0},I.categoricalConverter=function(e){var l,t=e.dataView,c=e.hostServices,u=e.dataLabelSettings,d=e.sentimentColors,i=e.interactivityService,h=e.tooltipsEnabled,p=I.formatStringProp,g=F.data.createDataViewCategoricalReaderAdvanced(t,{formatStringProp:p}),y=g.data,a=F.DataViewObjects.getValue(g.objects.getStaticObjects(),T.cartesianChartProps.valueAxis.totalsEnabled,I.DefaultTotalsEnabled);y.hasValues("Breakdown")&&(a=I.DefaultTotalsEnabled);var m,r,o=t.categorical.categories||[],s=c.getLocalizedString(I.TotalLabel),n=I.createLegend(d,c,g.objects.getStaticObjects(),e.style,void 0,a),v={current:0,min:0,max:0,formatString:void 0},f=[],S=[],x=[],b=[];if(y.hasValues("Tooltips")&&(m=g.columns.getAllValueMetadataColumnsForRole("Tooltips",void 0)),y.hasValues("Y")){var C=(b=[g.columns.getValueMetadataColumn("Y")])[0].format;if(_.isEmpty(o))var w=y.getValue("Y",0),v={current:w,max:w,min:0,formatString:y.getFormatString("Y",0)};else{var D=o[0],A=D.source;(S=D.values.slice()).push(s);for(var P=null!==(V=t.categorical.originalCategories)&&void 0!==V?V:[D],L=0,M=y.getCategoryCount();L<M;L++)!function(e){var t=S[e],i=y.getValue("Y",e)||0,a=y.getFormatString("Y",e);void 0!==a&&void 0===C&&(C=a);var r,o=T.SelectionIdBuilder.builder().withCategory(P,e,null===(l=null==D?void 0:D.source)||void 0===l?void 0:l.queryName,!0).withMeasure(b[0].queryName,g.columns.getValueColumn("Y"),e).createSelectionId(),s=void 0;h&&(s=I.createCategoryTooltip(A?[A]:null,b[0],[t],i,a,p),r=y.getAllValuesForRole("Tooltips",e),n=y.getAllFormatStringsForRole("Tooltips",e),r&&m&&I.appendTooltipMeasures(r,n,s,m,p,c));var n=T.DataLabelUtil.determineDataLabelFillColor(u.fontProperties.color,g,e);f.push(I.createDataPoint(i,v.current,d,t,e,o,s,n,a||C,0)),x[e]=function(){return T.CartesianHelper.getCategoryIdentity(e,D)},v=I.getNewPositionContext(v,i)}(L)}o=void 0;h&&(o=I.createCategoryTooltip(A?[A]:null,b[0],[s],v.current,void 0,p));var V=T.SelectionId.createNull();a&&f.push(I.createDataPoint(v.current,0,d,s,y.getCategoryCount(),V,o,u.fontProperties.color,C,1,{text:!0}))}i&&i.applySelectionStateToData(f),e.style.isHighContrast&&(r={visible:!0,color:T.ColorHelper.getThemeColor(e.style,T.ForegroundColorName),width:T.CartesianHelper.defaultLineStrokeWidth});t=T.CartesianHelper.getCategoryAxisProperties(t.metadata,void 0),t=T.CartesianHelper.getPreferredCategoryWidth(t);return{series:[{data:f,type:!_.isEmpty(b)&&b[0].type}],categories:S,categoryIdentities:x,categoryMetadata:A,preferredCategoryWidth:t,valuesMetadata:b,legend:n,hasHighlights:!1,positionMin:v.min,positionMax:v.max,dataLabelsSettings:u,sentimentColors:d,strokeSettings:r}},I.createDataPoint=function(e,t,i,a,r,o,s,n,l,c,u){i=1===c||2===c?i.totalFill:3===c?i.otherFill:0<e?i.increaseFill:i.decreaseFill;return{value:e,position:t,color:i.solid.color,categoryValue:a,categoryIndex:r,identity:o,seriesIndex:0,selected:!1,highlight:!1,key:o.getKey(),tooltipInfo:s&&function(){return s.getTooltipItems()},labelFill:n,labelFormatString:l,type:F.ValueType.fromDescriptor(u),barType:c}},I.createCategoryTooltip=function(i,e,t,a,r,o){var s=new T.LazyTooltipBuilder;return _.isEmpty(i)||s.withLazyValue(new y(function(){return{displayName:_.map(i,function(e){return e.displayName}).join(" "),value:_.map(t,function(e,t){return T.converterHelper.formatFromMetadataColumn(e,i[t],o)}).join(" ")}})),null!=a&&e&&s.withLazyValue(new y(function(){return{displayName:e.displayName,value:T.converterHelper.formatFromMetadataColumn(a,e,o,!1,r)}})),s},I.appendTooltipMeasures=function(s,n,l,c,u,d,h,p,g){if(!_.isEmpty(s)&&!_.isEmpty(c))for(var e=0;e<s.length;e++)!function(e){var t,i,a,r,o;null!=s[e]&&c[e]&&(t=c[e].displayName,i=T.converterHelper.formatFromMetadataColumn(s[e],c[e],u,!1,null==n?void 0:n[e]),_.isEmpty(h)?l.withLazyValue(new y(function(){return{displayName:t,value:i}})):(a=s[e],r=h[e],_.isNumber(a)&&_.isNumber(r)?(t=m.format(d.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),t),i=I.createPercentTooltipValue(i,a,r),l.withLazyValue(new y(function(){return{displayName:t,value:i}}))):(null!=r&&(o=T.converterHelper.formatFromMetadataColumn(r,c[e],u,!1),l.withLazyValue(new y(function(){return{displayName:g+" "+t,value:o}}))),null!=a&&l.withLazyValue(new y(function(){return{displayName:p+" "+t,value:i}})))))}(e)},I.createPercentTooltipValue=function(e,t,i){if(!i)return e;t/=Math.abs(i),i=T.valueFormatter.getLocalizedString("Percentage");return e+" ("+T.valueFormatter.format(t,i)+")"},I.createLegend=function(e,t,i,a,r,o){var s=e.increaseFill.solid.color,n=e.decreaseFill.solid.color,l=e.totalFill.solid.color,c=e.otherFill.solid.color,u=t.getLocalizedString(I.TotalLabel),d=t.getLocalizedString(I.IncreaseLabel),e=t.getLocalizedString(I.DecreaseLabel),t=t.getLocalizedString(I.OtherLabel),n=[{label:d,color:s,icon:T.LegendIcon.Box,identity:T.SelectionIdBuilder.builder().withMeasure("increase").createSelectionId(),selected:!1,index:0},{label:e,color:n,icon:T.LegendIcon.Box,identity:T.SelectionIdBuilder.builder().withMeasure("decrease").createSelectionId(),selected:!1,index:1}];return o&&n.push({label:u,color:l,icon:T.LegendIcon.Box,identity:T.SelectionIdBuilder.builder().withMeasure("total").createSelectionId(),selected:!1,index:2}),r&&n.splice(2,0,{label:t,color:c,icon:T.LegendIcon.Box,identity:T.SelectionIdBuilder.builder().withMeasure("other").createSelectionId(),selected:!1,index:3}),T.LegendData.create(i,n,!0,"",!1,a)},I.getNewPositionContext=function(e,t){t=e.current+t;return{current:t,min:Math.min(e.min,t),max:Math.max(e.max,t)}},I.getDefaultWaterfallLabelSettings=function(e,t,i,a){void 0===t&&(t=!1);a=T.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",labelColor:i,fontSize:a}).fontProperties;return{show:t,labelOrientation:1,position:T.labelPosition.auto,displayUnits:0,precision:T.DataLabelViewModel.defaultLabelPrecision,fontProperties:a,enableBackground:!1,bold:!1,italic:!1,underline:!1}},I.doesDataLabelFitInShape=function(e,t,i){if(null==e||null===e.value)return!1;var a={text:i.labelText(e),fontFamily:T.DataLabelViewModel.LabelTextProperties.fontFamily,fontSize:T.DataLabelViewModel.LabelTextProperties.fontSize,fontWeight:T.DataLabelViewModel.LabelTextProperties.fontWeight};if(0<T.CartesianHelper.getRectTop(t.scale,e.position,e.value)-T.DataLabelViewModel.labelMargin)return!0;var r=F.TextMeasurementService.measureSvgTextWidth(a),a=F.TextMeasurementService.estimateSvgTextHeight(a),i=i.categoryWidth,e=Math.abs(T.AxisHelper.diffScaled(t.scale,Math.max(0,Math.abs(e.value)),0));return!(i<r||e<a)},I.prototype.setData=function(e){var t,i=this.getSentimentColorsFromObjects(null),a=I.DefaultBreakdowns,r=0<e.length?e[0]:void 0;this.data=this.originalData={series:[{data:[]}],categories:[],valuesMetadata:[],legend:T.Legend.getDefaultLegendData(this.style),hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,positionMax:0,positionMin:0,dataLabelsSettings:I.getDefaultWaterfallLabelSettings(this.style,!1,void 0),sentimentColors:i,axesLabels:{x:null,y:null},numberOfBreakdowns:a,totalBreakdownCategories:0},r&&((this.dataView=r).metadata&&r.metadata.objects&&((e=(t=r.metadata.objects).labels)&&T.DataLabelViewModel.updateLabelSettingsFromLabelsObject(e,this.data.dataLabelsSettings,!0,this.style),i=this.getSentimentColorsFromObjects(t),a=F.DataViewObjects.getValue(t,T.waterfallChartProps.breakdown.maxBreakdowns,I.DefaultBreakdowns)),(r.categorical||r.matrix)&&(this.data=this.originalData=I.converter({dataView:r,style:this.style,hostServices:this.hostServices,dataLabelSettings:this.data.dataLabelsSettings,sentimentColors:i,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,numberOfBreakdowns:a})))},I.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getSentimentColorCard(e.categoryAxisData)},function(){return t.getBreakdownCard()},function(){return t.getLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:3}},I.prototype.getSentimentColorCard=function(t){function i(e){return a.hostServices.getLocalizedString(e)}var a=this,r=T.waterfallChartPropsNew.sentimentColors,o=this.originalData,s=o.sentimentColors,n=T.waterfallChartPropsNew.valueAxis.totalsEnabled,e=T.waterfallChartPropsNew.categoryAxis,l=e.innerPadding,c=e.preferredCategoryWidth,u=this.yAxisProperties.totalsEnabled,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("sentimentColors"),"Role_DisplayName_Columns",__assign(__assign({},r),{totalsEnabledProp:n,innerPaddingProp:l,preferredCategoryWidthProp:c}),i);return e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors").addSimpleSlice("increaseFill",function(){var e={value:s.increaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.increaseFill,value:e}).build()}).addSimpleSlice("decreaseFill",function(){var e={value:s.decreaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.decreaseFill,value:e}).build()}).addSimpleSlice("otherFill",function(){var e={value:s.otherFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.otherFill,value:e}).build()},function(e){return e.withDisabled(!o.isBreakdown).withCustomDescription("Visual_Waterfall_Breakdown_OtherDescription")}),a.featureSwitch.waterfallTotals&&!o.isBreakdown&&e.addSimpleSlice("totalsEnabled",new d.ToggleSwitchBuilder({descriptor:n,value:u}).build(),function(e){return e.withCustomDisplayName("Visual_Axis_Total_Column")}),u&&e.addSimpleSlice("totalFill",function(){var e={value:s.totalFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.totalFill,value:e}).build()})}),e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new d.SliderBuilder({descriptor:l,value:100*t.innerPadding,localize:i,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new d.SliderBuilder({descriptor:c,value:Math.round(100*t.maxMarginFactor),localize:i,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()},I.prototype.getBreakdownCard=function(){function t(e){return i.hostServices.getLocalizedString(e)}var i=this,a=this.originalData,r=T.waterfallChartPropsNew.breakdown,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("breakdown"),"Visual_Waterfall_Breakdown",r,t);return a.isBreakdown?e.addGroup("breakdown",function(e){e.addSimpleSlice("maxBreakdowns",new d.SliderBuilder({descriptor:r.maxBreakdowns,value:a.numberOfBreakdowns,localize:t,options:{minValue:{type:0,value:I.MinimumBreakdowns},maxValue:{type:1,value:Math.min(I.MaximumBreakdowns,a.totalBreakdownCategories)}}}).build(),function(e){return e.withCustomDisplayName("Visual_Waterfall_MaximumBreakdown")})}):e.withDisabled(!0,"Visual_BreakdownCard_DisabledReason"),e.build()},I.prototype.getLabelsCard=function(){var t=this,e=T.waterfallChartPropsNew.labels,i=this.originalData,a=this.data.dataLabelsSettings,r={dataLabelsSettings:i.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:a.enableBackground,backgroundColor:a.backgroundColor,backgroundTransparency:a.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0};a.position&&r.positionObject.indexOf(a.position)<0&&(a.position=I.AutoLabelPosition);i={cardBuilder:new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",e,function(e){return t.hostServices.getLocalizedString(e)}),dataLabelsProps:e,featureSwitches:this.featureSwitch,hostServices:this.hostServices,options:r,individualSelector:T.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitch,hasCategories:!!_.first(i.categories),hasDynamicSeries:!1})};return T.DataLabelViewModel.getDataLabelsFormattingModel(i)},I.prototype.enumerateObjectInstances=function(e,t){var i=this.originalData;switch(t.objectName){case"sentimentColors":this.enumerateSentimentColors(e);break;case"labels":var a=this.data.dataLabelsSettings,a={enumeration:e,dataLabelsSettings:i.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:a.enableBackground,backgroundColor:a.backgroundColor,backgroundTransparency:a.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0};T.DataLabelViewModel.enumerateDataLabels(a,this.featureSwitch);break;case T.waterfallChartProps.breakdown.maxBreakdowns.objectName:this.enumerateBreakdown(e)}},I.prototype.enumerateSentimentColors=function(e){var t=this.originalData,i=t.sentimentColors,a=this.yAxisProperties.totalsEnabled,r={increaseFill:i.increaseFill,decreaseFill:i.decreaseFill};t.isBreakdown&&(r.otherFill=i.otherFill),a&&(r.totalFill=i.totalFill),e.pushInstance({selector:null,properties:r,objectName:"sentimentColors"})},I.prototype.enumerateBreakdown=function(e){var t=this.originalData;t.isBreakdown&&e.pushInstance({selector:null,properties:{maxBreakdowns:t.numberOfBreakdowns},validValues:{maxBreakdowns:{numberRange:{min:I.MinimumBreakdowns,max:Math.min(I.MaximumBreakdowns,t.totalBreakdownCategories)}}},objectName:T.waterfallChartProps.breakdown.maxBreakdowns.objectName})},I.prototype.calculateCustomLegend=function(){return this.data.legend},I.prototype.hasLegend=function(){return!0},I.createClippedDataIfOverflowed=function(e,t){var i=e,a=e.series[0].data;return e&&t<a.length&&((i=F.Prototype.inherit(e)).series=[{data:a.slice(0,t)}],i.categories=e.categories.slice(0,t)),i},I.prototype.calculateAxesProperties=function(e){var t=this;this.currentViewport=e.viewport,this.viewModelAdapterFactory&&this.originalData&&(n=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=n.getData()),this.margin=e.margin;var i=this.clippedData=this.data,a=i.series,r=i.categories.length,o=this.getPreferredPlotArea(!1,r,T.CartesianHelper.MinOrdinalRectThickness,e.outerPaddingRatio),s=i?i.preferredCategoryWidth:null,n=T.CartesianChartLayout.getLayout(null,{availableWidth:o.width,categoryCount:r,preferredCategoryWidth:s,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:e.innerPaddingRatio});this.isScrollable||(i=this.clippedData=I.createClippedDataIfOverflowed(i,n.categoryCount));var r=this.getAxesDomains(!1,{valueAxis:!0}),s=I.getXAxisCreationOptions(i,o.width,n,e,this.featureSwitch),r=I.getYAxisCreationOptions(i,o.height,r.valueAxis,e,this.featureSwitch),s=this.xAxisProperties=T.AxisHelper.createAxis(s),l=this.yAxisProperties=T.AxisHelper.createAxis(r);this.xAxisProperties.outerPaddingRatio=n.outerPaddingRatio,i.categoryIdentities&&(this.xAxisProperties.categoryIdentities=i.categoryIdentities);var e=this.xAxisProperties.categoryThickness*(1-e.innerPaddingRatio),c=T.DataLabelViewModel.createColumnFormatterCacheManager(),u=i.dataLabelsSettings,d=T.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(l,u);return this.layout={categoryCount:n.categoryCount,categoryThickness:n.categoryThickness,isScalar:n.isScalar,outerPaddingRatio:n.outerPaddingRatio,categoryWidth:e,labelText:function(e){var t=a[e.seriesIndex].type,t=c.getOrCreate(e.labelFormatString,u,d.units,d.getPrecision(!!e.labelFormatString,t));return T.DataLabelViewModel.getLabelTailoredText({label:t.format(e.value)})},labelLayout:T.CartesianHelper.getLabelLayoutXYForWaterfall(s,e,l,r.dataDomain),filter:function(e){return I.doesDataLabelFitInShape(e,l,t.layout)},style:{fill:function(e){return e.isLabelInside?T.ColorHelper.getThemeColor(t.style,T.DataLabelViewModel.DefaultInsideLabelColorName):e.labelFill}}},[s,l]},I.prototype.getAxesDomains=function(e,t){var i={},a=this.clippedData||this.data;return a&&t.valueAxis&&(i.valueAxis=[a.positionMin,a.positionMax]),i},I.prototype.setAxesLayout=function(e){},I.lookupXValue=function(e,t,i,a){var r=e.series[0].data;return t===r.length-1?r[t].categoryValue:T.CartesianHelper.lookupXValue(e,t,r[t].type||i,!1,a)},I.getXAxisCreationOptions=function(i,e,t,a,r){var o=T.AxisHelper.getCategoryValueType(i.categoryMetadata),s=a.categoryAxisOptions,n=T.AxisHelper.createDomain(i.series,o,!1,[s.includeDomain]),l=t.categoryThickness,c=l*t.outerPaddingRatio,o=T.AxisHelper.hasForcedDomain(s.includeDomain);return{pixelSpan:e,dataDomain:n,axisZoom:void 0,metaDataColumn:i.categoryMetadata,formatString:T.valueFormatter.getFormatString(i.categoryMetadata,I.formatStringProp),isScalar:!1,outerPadding:c,categoryThickness:l,getValueFn:function(e,t){return I.lookupXValue(i,e,t,r)},forcedTickCount:a.forcedTickCount,isCategoryAxis:!0,axisDisplayUnits:s.displayUnits,axisPrecision:s.precision,outerPaddingRatio:t.outerPaddingRatio,preventNice:o,innerPaddingRatio:a.innerPaddingRatio,featureSwitches:r}},I.getYAxisCreationOptions=function(e,t,i,a,r){var o=a.valueAxisOptions,s=T.AxisHelper.mergeScalarAxisDomains(o.includeDomain,T.AxisHelper.createScalarDomainOptions(i,0)),i=T.AxisHelper.hasForcedDomain(s);return{pixelSpan:t,dataDomain:s&&s.domain,axisZoom:void 0,zeroScalarDomain:[0,1],isScalar:!0,isVertical:!0,metaDataColumn:e.valuesMetadata,formatString:T.valueFormatter.getFormatString(e.valuesMetadata[0],I.formatStringProp),outerPadding:0,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,axisDisplayUnits:o.displayUnits,axisPrecision:o.precision,outerPaddingRatio:0,preventNice:i,invertAxis:o.invertAxis,totalsEnabled:o.totalsEnabled,featureSwitches:r}},I.prototype.getPreferredPlotArea=function(e,t,i,a){return T.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a)},I.prototype.getVisualCategoryAxisIsScalar=function(){return!1},I.prototype.overrideXScale=function(e){this.xAxisProperties=e},I.prototype.setFilteredData=function(e,t){var i=this.clippedData=F.Prototype.inherit(this.data);return i.series=[{data:i.series[0].data.slice(e,t)}],i.categories=i.categories.slice(e,t),i},I.prototype.createRects=function(e){var t=this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).data(e,function(e){return e.key}),e=t.enter().append("rect").attr("class",function(e){return I.CategoryValueClasses.class.concat(e.highlight?"highlight":"")}).merge(t);return t.exit().remove(),e},I.prototype.createConnectors=function(e){var t=this.mainGraphicsContext.selectAll(I.WaterfallConnectorClasses.selector).data(e.slice(0,e.length-1),function(e){return e.key}),e=t.enter().append("line").classed(I.WaterfallConnectorClasses.class,!0).merge(t);return t.exit().remove(),e},I.prototype.render=function(e){var t=this,i=this.clippedData.series[0].data,a=this.createRects(i),r=this.createConnectors(i),i=this.clippedData.strokeSettings;this.tooltipsEnabled&&this.tooltipService.addTooltip(a,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]});var o=this.interactivityService&&this.interactivityService.hasSelection(),s=this.xAxisProperties.scale,n=this.yAxisProperties.scale,l=n.domain()[0],c=this.yAxisProperties.invertAxis;this.mainGraphicsSVG.attr("height",this.getAvailableHeight()).attr("width",this.getAvailableWidth()),i&&i.visible&&this.mainGraphicsSVG.style("stroke",i.color).style("stroke-width",i.width),a.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return 1===e.barType?T.ColumnUtil.DefaultOpacity:T.ColumnUtil.getFillOpacity(e.selected,e.highlight,o,t.data.hasHighlights)}).attr("width",this.layout.categoryWidth).attr("x",function(e){return s(e.categoryIndex)}).attr("y",function(e){if(c){var t=0,t=e.position<l?Math.abs(n(l)-n(e.value)):Math.abs(n(e.position)-n(e.position+e.value));return T.CartesianHelper.getRectTop(n,e.position,e.value)-t}return T.CartesianHelper.getRectTop(n,e.position,e.value)}).attr("height",function(e){return e.position<l?Math.abs(n(l)-n(e.value)):Math.abs(n(e.position)-n(e.position+e.value))}),this.interactivityService&&(h=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),a.attrs({tabindex:0,focusable:!0,"aria-label":function(e){return T.tooltipUtils.formatTooltipInfo(e.tooltipInfo())},role:"option","aria-selected":function(e){return e.selected}}).classed(T.SetFocusRingClassName,!h)),r.style("stroke",T.ColorHelper.getThemeColor(this.style,I.DefaultWaterfallConnectorColorName)).attrs({x1:function(e){return s(e.categoryIndex)},y1:function(e){return n(e.position+e.value)},x2:function(e){return s(e.categoryIndex+1)+t.layout.categoryWidth},y2:function(e){return n(e.position+e.value)}});var u,d,h=this.data.dataLabelsSettings,r=[];return(h&&h.show||h.showCategory)&&(r=this.createLabelDataPoints()),this.interactivityService&&(d={navigationStrategy:T.DataPointNavigationStrategy.CategoryOnly,helper:this},u={root:this.mainGraphicsContext,bars:a,isBreakdown:this.data.isBreakdown}),T.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:this.data.series[0].data,behaviorOptions:u,navigationOptions:d,labelDataPoints:r,labelsAreNumeric:!0,labelOrientation:h.labelOrientation,animateLabels:!e}},I.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},I.prototype.getSupportedCategoryAxisType=function(){return T.axisType.categorical},I.prototype.getFirstElement=function(){if(_.isEmpty(this.clippedData.series)||_.isEmpty(this.clippedData.series[0].data))return{element:null};var e=this.clippedData.series[0].data[0].categoryIndex;return{element:this.getHTMLElementFromCategoryIndex(e)}},I.prototype.getNextDataPoint=function(e,t,i){var a,r=e;do{switch(i){case T.DataDirection.NextCategory:(e+=1)>=this.data.categories.length&&(e=0);break;case T.DataDirection.PreviousCategory:--e<0&&(e=this.data.categories.length-1);break;case T.DataDirection.NextSeries:case T.DataDirection.PreviousSeries:}}while((a=this.data.series[t].data[e])&&0===a.value&&r!==e);return{element:this.getHTMLElementFromCategoryIndex(e),targetCategoryIndex:e}},I.prototype.getHTMLElementFromCategoryIndex=function(t){return this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).filter(function(e){return e.categoryIndex===t}).node()},I.prototype.getAvailableWidth=function(){return this.currentViewport.width-(this.margin.left+this.margin.right)},I.prototype.getAvailableHeight=function(){return this.currentViewport.height-(this.margin.top+this.margin.bottom)},I.prototype.getSentimentColorsFromObjects=function(e){var t=T.ColorHelper.create(this.style);return{increaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,T.waterfallChartProps.sentimentColors.increaseFill,T.ColorHelper.getSentimentColor(this.style,"good"))}},decreaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,T.waterfallChartProps.sentimentColors.decreaseFill,T.ColorHelper.getSentimentColor(this.style,"bad"))}},totalFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,T.waterfallChartProps.sentimentColors.totalFill,T.ColorHelper.getDataColorByIndex(this.style,0))}},otherFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,T.waterfallChartProps.sentimentColors.otherFill,T.ColorHelper.getSentimentColor(this.style,"neutral"))}}}},I.prototype.createLabelDataPoints=function(){for(var e=[],t=this.data,i=this.xAxisProperties.scale,a=this.yAxisProperties.scale,r=this.yAxisProperties.invertAxis,o=a(0),s=t.series,n=T.DataLabelViewModel.createColumnFormatterCacheManager(),l=t.dataLabelsSettings,c=T.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,l),u=0,d=s;u<d.length;u++)for(var h=d[u],p=0,g=h.data;p<g.length;p++){var y=g[p],m={left:i(y.categoryIndex),top:r?T.CartesianHelper.getRectTopInverted(a,y.position,y.value):T.CartesianHelper.getRectTop(a,y.position,y.value),width:this.layout.categoryWidth,height:Math.abs(o-a(Math.abs(y.value)))},v=y.labelFormatString,f=n.getOrCreate(v,this.data.dataLabelsSettings,c.units,c.getPrecision(!!v,h.type)),S=T.DataLabelRenderer.getLabelFormattedText(f.format(y.value)),x=l.fontProperties,b=T.FontProperties.toTextProperties(x,S),v=F.TextMeasurementService.measureSvgTextWidth(b),f=F.TextMeasurementService.estimateSvgTextHeight(b,!0),b=this.getValidPositions(l.position,y.value);e.push({isPreferred:!0,text:S,textSize:{width:v,height:f},outsideFill:null!==(f=y.labelFill)&&void 0!==f?f:T.ColorHelper.getThemeColor(this.style,T.DataLabelViewModel.DefaultLabelColorName),insideFill:T.ColorHelper.getThemeColor(this.style,T.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:m,orientation:0<=y.value?r?2:1:r?1:2,validPositions:b},fontProperties:x,identity:void 0,hasBackground:l.enableBackground,backgroundColor:l.backgroundColor,backgroundTransparency:l.backgroundTransparency})}return e},I.prototype.getValidPositions=function(e,t){if(0===t)return I.validZeroLabelPosition;switch(e){case T.labelPosition.insideEnd:return[4];case T.labelPosition.insideCenter:return[1];case T.labelPosition.insideBase:return[2];case T.labelPosition.outsideEnd:return[16];default:return I.validLabelPositionsAuto}},I.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},I.prototype.getStaticSeriesRole=function(){},I.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},I.formatStringProp={objectName:"general",propertyName:"formatString"},I.WaterfallClassName="waterfallChart",I.MainGraphicsContextClassName="mainGraphicsContext",I.IncreaseLabel="Increase",I.DecreaseLabel="Decrease",I.TotalLabel="Waterfall_TotalLabel",I.OtherLabel="Waterfall_OtherLabel",I.CategoryValueClasses=e("column"),I.WaterfallConnectorClasses=e("waterfall-connector"),I.AutoLabelPosition="Auto",I.DefaultWaterfallConnectorColorName="foregroundNeutralTertiary",I.MinimumBreakdowns=1,I.MaximumBreakdowns=20,I.DefaultBreakdowns=5,I.DefaultTotalsEnabled=!0,I.validLabelPositionsOptions=[I.AutoLabelPosition,t.outsideEnd,t.insideEnd,t.insideCenter,t.insideBase],I.validLabelPositionsAuto=[16,4,1,2],I.validZeroLabelPosition=[16,8],t=I,T.WaterfallChart=t}(powerbi=powerbi||{}),function(e){!function(n){var l=jsCommon.BrowserUtils,e=(t.prototype.create=function(){return new i},t);function t(){}n.WaterfallChartWebBehaviorFactory=e;var i=(a.prototype.bindEvents=function(a,r,e){var t,i,o=this,s=this.bars=a.bars;e&&(t=e.dataPointNavigationManager,i=e.pointSourceKey,t.isEmpty(i)||(e=a.root,n.InteractivityUtils.registerEnterPlotAreaHandler(e,t,i),n.InteractivityUtils.registerDataPointNavigationHandler(e,t,i),n.InteractivityUtils.registerClearCatcherShortcut(e,r))),s.on("click",function(e){return o.handleSelection(e,r,a.isBreakdown)}).on("keydown",function(e){var t=d3.event,i=t.keyCode;32!==i&&13!==i||(t.preventDefault(),t.stopPropagation(),o.handleSelection(e,r,a.isBreakdown))}),s.on("contextmenu",function(e){var t=d3.event;l.isCtrlOrMeta(t)||(t.preventDefault(),n.EventBubblingUtil.markAsHandled(t),1!==e.barType&&(t=n.InteractivityUtils.getPositionOfLastInputEvent(),r.handleContextMenu(e,t)))})},a.prototype.renderSelection=function(t){this.bars.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)}).style("stroke-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})},a.prototype.renderFocus=function(e){e&&l.focus(e)},a.prototype.handleSelection=function(e,t,i){var a,r;1!==e.barType&&(a=n.InteractivityUtils.getPositionOfLastInputEvent(),r=void 0,r=i?0:jsCommon.SelectionUtility.getMultiSelectMode(d3.event),t.handleSelection(e,r,a))},a);function a(){}n.WaterfallChartWebBehavior=i}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),define("CartesianVisuals/cartesianModule",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createScatterChartMobileBehaviorFactory=t.createDashboardColumnChartAnimator=t.createRealTimeLineChartAnimator=t.createWaterfallChartWebBehaviorFactory=t.createScatterChartWebBehaviorFactory=t.createLineChartWebBehaviorFactory=t.createDataDotChartWebBehaviorFactory=t.createColumnChartWebBehaviorFactory=t.createCartesianChartBehaviorFactory=t.createWebColumnChartAnimator=t.createCartesianChart=void 0;var i=powerbi.visuals,a=i.CartesianChart,r=i.CartesianChartBehaviorFactory,o=i.ColumnChartWebBehaviorFactory,s=i.DashboardColumnChartAnimator,n=i.DataDotChartWebBehaviorFactory,l=i.LineChartWebBehaviorFactory,c=i.RealTimeLineChartAnimator,u=i.ScatterChartMobileBehaviorFactory,d=i.ScatterChartWebBehaviorFactory,h=i.WaterfallChartWebBehaviorFactory,p=i.WebColumnChartAnimator;t.createCartesianChart=function(e){return new a(e)},t.createWebColumnChartAnimator=function(e){return new p(e)},t.createCartesianChartBehaviorFactory=function(e,t){return new r(e,t)},t.createColumnChartWebBehaviorFactory=function(){return new o},t.createDataDotChartWebBehaviorFactory=function(){return new n},t.createLineChartWebBehaviorFactory=function(){return new l},t.createScatterChartWebBehaviorFactory=function(){return new d},t.createWaterfallChartWebBehaviorFactory=function(){return new h},t.createRealTimeLineChartAnimator=function(e){return new c(e)},t.createDashboardColumnChartAnimator=function(e){return new s(e)},t.createScatterChartMobileBehaviorFactory=function(){return new u}}),function(v){var f,e;function S(e,t){var i=[],a=[],r=[];return f.ReferenceLineHelper.gatherDomainExtents(e,i,a,r,t),[{min:d3.min(i),max:d3.max(i)},{min:d3.min(a),max:d3.max(a)},{min:d3.min(r),max:d3.max(r)}]}function x(e){var t=e.x,i={tickLabels:t.labelFontProperties,title:t.titleFontProperties},t=e.y,t={tickLabels:t.labelFontProperties,title:t.titleFontProperties},e=e.y2;return{x:i,y:t,y2:{tickLabels:e.labelFontProperties,title:e.titleFontProperties}}}function b(e,t){var i={x:e.x.showAxisTitle,y:e.y.showAxisTitle,y2:e.y2.showAxisTitle};return i=t?t.updateShowAxisTitles(i,e):i}f=v.visuals||(v.visuals={}),(e=f.CartesianAxesLayoutBuilder||(f.CartesianAxesLayoutBuilder={})).build=function(e,t,i,a,r,o,s,n,l,c,u,d,h){var p=v.Prototype.inherit(f.SvgCartesianAxes.AxisPadding),g=b(e,u),y=function(e,t){t=f.ComboChart.isComboChart(t);return f.CartesianChartLayout.shouldRenderAxis(e,t)}(e,a),m=x(e),e=(a=S(i,f.CartesianChart.getCategoryValueType(o)))[0],i=a[1],a=a[2],u=null==u?void 0:u.skipMergingValueAxisDomains();return r.negotiateAxes({layers:o,parentViewport:s,padding:p,playAxisControlLayout:n,showAxisTitles:g,shouldRenderAxis:y,axesFontProperties:m,interactivityRightMargin:(c=c,(t=t)&&t.isInteractiveLegend&&!c?f.INTERACTIVITY_RIGHT_MARGIN:0),calculatePlotArea:l,skipMergeValueAxes:u,ensureXDomain:e,ensureYDomain:i,ensureY2Domain:a,rotateXTickLabels90:d,featureSwitches:h})},e.getMinimumDomainExtents=S,e.getAxesFontProperties=x,e.showAxisTitles=b}(powerbi=powerbi||{}),function(e){var y,m;function t(e){var t=(this.settings=e).axes,i=e.data,a=e.container,e=e.featureSwitches;this.svgAxes=new y.SvgCartesianAxes(t),this.svgAxes.init(a,i),this.navigationHelper=new y.CartesianChartNavigationHelper,this.featureSwitches=e}y=e.visuals||(e.visuals={}),m=e.visuals.controls.SvgScrollbar,t.prototype.destroy=function(){this.scrollableAxes&&this.scrollableAxes.destroy(),this.svgScrollbar&&this.svgScrollbar.remove(),this.scrollableAxes=void 0,this.svgScrollbar=void 0},t.prototype.update=function(e,t){this.svgScrollbar&&this.svgScrollbar.updateScrollbarOptions(t),this.svgAxes.update(e)},t.prototype.render=function(e,t,a,i,r,o,s,n,l){var c=this,u=y.CartesianAxesLayoutBuilder.getAxesFontProperties(e);if(this.options=s,!l&&((l=y.CartesianAxesLayoutBuilder.build(e,this.settings.interactivity,i,this.settings.type,this.settings.axes,a,r,s.playAxesRect,this.settings.calculatePlotArea,s.trimOrdinalDataOnOverflow,t,void 0,this.featureSwitches)).plotArea.width<1||l.plotArea.height<1))return l;if(!this.settings.suppressBrush||!(r.height<1||r.width<1)){a.forEach(function(e,t){var i;0!==t&&l.axes.y2?i=2:(i=1)===a.length&&l.axes.y2&&(i|=2),e.setAxesLayout({layout:l,trimOrdinalDataOnOverflow:s.trimOrdinalDataOnOverflow,axisType:i})}),t&&t.render(l,e);var d=l.axes.x.isCategoryAxis?l.axes.x:l.axes.y1;s.categoryLoadMoreDataHandler&&s.categoryLoadMoreDataHandler.setScale(d.scale);var h,p=function(e,t,i,a,r){return c.renderAxes(e,t,i,s.animationDuration,s.ease,u,o,s.isHierarchicalAxis,n,a,r)},g=s.supportsScrolling;return!this.svgScrollbar&&!this.scrollableAxes||this.svgScrollbar&&this.scrollableAxes,g?(this.svgScrollbar||(i=(h=this.settings).container,r=h.onExtentUpdate,t=h.axes,d=h.animateCategoryAxis,h=h.animateValueAxis,this.svgScrollbar=new m({scrollbarWidth:y.ScrollableAxes.ScrollbarWidth,onExtentUpdate:r}),this.scrollableAxes=new y.ScrollableAxes(t,this.svgScrollbar,d,h),this.svgScrollbar.init(i)),this.scrollableAxes.render(l,a,s.suppressAnimations,p,s.isHierarchicalAxis,s.preserveScrollPosition,s.categoryLoadMoreDataHandler,this.settings.suppressBrush,this.settings.type,e.hasY2Role)):(this.svgScrollbar&&(this.svgScrollbar.remove(),this.scrollableAxes.destroy(),this.svgScrollbar=void 0,this.scrollableAxes=void 0),p(a,l,s.suppressAnimations,this.settings.animateCategoryAxis,this.settings.animateValueAxis,s.isHierarchicalAxis)),this.navigationHelper.updateScrollCallbacks(g?s.navigationScrollCallbacks:void 0),this.eventsBoundForAxesLayout!==l&&(this.bindScrollWheelEvents(l,this.settings.container),this.bindTouchEvents(l,this.settings.container),this.eventsBoundForAxesLayout=l),l}},t.prototype.renderAxes=function(e,t,i,a,r,o,s,n,l,c,u){r=this.svgAxes.renderAxes({axesLayout:t,duration:a,axesFontProperties:o,animateCategoryAxis:c,animateValueAxis:u,easing:r,shouldRenderGridLinesOnly:this.options.shouldRenderGridLinesOnly,disableKeyboardNavigation:this.options.disableKeyboardNavigation,useManagedTabIndex:l,featureSwitches:this.featureSwitches});r&&r.navigationOptions&&this.settings.behavior&&(l=r.navigationOptions,this.navigationHelper.clearNavigationLayers(),this.navigationHelper.addNavigationLayer(l.helper),l={isAxis:!0,navigationOptions:{helper:this.navigationHelper,navigationStrategy:l.navigationStrategy,disabled:this.options.disableKeyboardNavigation},pointSourceKey:"cartesian-axis"+(this.settings.multipleId||""),isHierarchicalAxis:n},this.navigationHelper.getPendingFocusElement&&(l.navigationOptions.focusElement=this.navigationHelper.getPendingFocusElement()),this.settings.interactivityService.bind(r.dataPoints,this.settings.behavior,r.behaviorOptions,l),this.settings.behavior.renderSelection(this.settings.interactivityService.hasSelection())),s(e,t,i,c,c,n)},t.prototype.getLayerContainer=function(){return this.svgAxes.getScrollableRegion()},t.prototype.getDataLabelContainers=function(){return this.svgAxes.getLabelsContainers()},t.prototype.getSeriesLabelContainers=function(){return this.svgAxes.getSeriesLabelsContainers()},t.prototype.setExtent=function(e){this.scrollableAxes&&this.scrollableAxes.setExtent(e)},t.prototype.scrollDelta=function(e){this.scrollableAxes&&this.scrollableAxes.scrollDelta(e)},t.prototype.scrollTo=function(e){this.scrollableAxes&&this.scrollableAxes.scrollTo(e)},t.prototype.shouldScrollTo=function(e){return!!this.scrollableAxes&&this.scrollableAxes.shouldScrollTo(e)},t.prototype.scrollBy=function(e){this.scrollableAxes&&this.scrollableAxes.scrollBy(e)},t.prototype.clearRenderingTimeout=function(){this.scrollableAxes&&this.scrollableAxes.clearRenderingTimeout()},t.prototype.bindTouchEvents=function(r,e){var o=this,s={x:0,y:0};this.settings.eventManager.on(e.node(),"touchstart",function(){var e;0===o.options.viewMode&&(r.isXScrollBarVisible||r.isYScrollBarVisible)&&(e=d3.event.changedTouches[0],s.x=e.pageX,s.y=e.pageY)}),this.settings.eventManager.on(e.node(),"touchmove",function(){var e,t,i,a=o.settings.hostServices&&o.settings.hostServices.tooltips();0!==o.options.viewMode||!r.isXScrollBarVisible&&!r.isYScrollBarVisible||a&&a.isTouchScreenOptimizedEnabled()&&a.visible()||(o.settings.tooltipService.hide(),t=(e=d3.event).changedTouches[0],i=s.x-t.pageX,a=s.y-t.pageY,a=r.isXScrollBarVisible?i:a,o.settings.onScroll?o.settings.onScroll(a):o.scrollableAxes&&o.scrollableAxes.scrollDelta(a),s.x=t.pageX,s.y=t.pageY,e.preventDefault())})},t.prototype.bindScrollWheelEvents=function(a,e){var r=this;this.settings.eventManager.on(e.node(),"wheel",function(){if(a.isXScrollBarVisible||a.isYScrollBarVisible){r.settings.tooltipService.hide();var e=d3.event,t=e.deltaX,i=e.deltaY,i=Math.abs(t)>Math.abs(i)?t:i;if(r.settings.onScroll){if(r.options.isSmallMultiples&&!e.shiftKey)return;r.settings.onScroll(i)}else r.scrollableAxes.scrollDelta(i);e.preventDefault()}})},y.CartesianAxesRenderer=t}(powerbi=powerbi||{}),function(T){var I,k,O;function N(){}function a(i,e,t,a){var r=I.CartesianChart.getLayerDataViews(e);if(_.isEmpty(t))return!1;a=null==a?t:[t[a]];return _.every(a,function(e,t){return!r[t]||i(e)})}I=T.visuals||(T.visuals={}),k=I.AxisDataModel.AxesData,N.prototype.convert=function(e){var t=e.dataViews,i=e.layers,a=e.layerStyle,r=e.categoryAxisTitleOnByDefault,o=e.valueAxisTitleOnByDefault,s=e.chartType,n=e.hasDataChanged,l={scrollbarWidth:I.ScrollableAxes.ScrollbarWidth},c=[],u=[],d=I.CartesianChart.getLayerDataViews(t),h=_.filter(t,I.ForecastHelper.isDataViewForForecast),p=[],g=1<i.length&&!!(t[0]&&t[0].categorical&&t[0].categorical.values),y=a.colorPalette.dataColors;y.clearPreferredScale();for(var m=_.filter(t,I.TrendLineHelper.isDataViewForRegression),v=new I.VisualWarningBuilder,f=_.filter(t,I.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection),S=0,x=i.length;S<x;S++){var b=d[S],C=i[S],w=b?[b]:[];null!=h[S]&&w.push(h[S]),null!=f[S]&&w.push(f[S]),i[S].setData(w,e.multipleInfo);C=function(e,t,i,a,r){var o,s,n=0;e.calculateCustomLegend&&(o=e.calculateCustomLegend(),n=o?o.dataPoints.length:0);t&&n<=1&&(s=I.Legend.buildSeriesLegendData({dataView:t,showByDefault:!0,staticSeriesRoleNames:[e.getStaticSeriesRole()],style:i,allowLegendWithNoSeries:a},function(e){return 3===e||5===e||4===e||6===e||8===e||7===e||10===e}(r)));return!e.calculateCustomLegend||n<=1&&s&&s.isGradientLegend?s:o}(C,b,a,g,s);C&&p.push(C),u.push.apply(u,I.CartesianChart.getDataBoundReferenceLines(b,i[S],a,e.featureSwitches)||[]),!N.supportsTrendLines(t,i,S)||(C=m[S])&&(b=I.TrendLineHelper.readDataView(C,b,0<S,a),c.push.apply(c,b||[])),1<x&&y.rotateScale()}var D,A,P,L,M,V=1<p.length?I.Legend.mergeLegendData(p):1===p.length?p[0]:I.Legend.getDefaultLegendData(a),F=I.AxisZoom.converter(_.head(t));return _.isEmpty(t)?M=k.createDefault(a):(D=t[0],A=t[1],P=!1,(L=D.metadata)&&D.categorical&&!_.isEmpty(D.categorical.categories)&&(P=!!I.ScalarUtils.getScalarKeys(D.categorical.categories[0])),P=I.CartesianHelper.getCategoryAxisProperties(L,P||r),r=I.CartesianHelper.getValueAxisProperties(L,o),L=I.CartesianHelper.getValueAxisProperties(L,o,"y2Axis"),o=N.getDefaultLineChartSeriesLabelSettings(),o={valueAxisProperties:r,y2AxisProperties:L,categoryAxisProperties:P,isYCategorical:I.CartesianChart.shouldYAxisBeCategorical(s),isValueAxisDisabled:!N.supportsValueAxis(t,i),isScatter:10===s,isComboChart:I.ComboChart.isComboChart(s),style:a,hasY2Role:T.data.DataRoleHelper.hasRoleInDataView(D,"Y2")||A&&T.data.DataRoleHelper.hasRoleInDataView(A,"Y2"),forceShowY2:F.show&&F.showOnValueSecAxis||!_.isEmpty(e.multipleInfo)&&I.ComboChart.isComboChart(s),show:(N.isLineComboChart(s)?i[0].getSeriesSettings():o).show,seriesMaximumWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(i):o).seriesMaximumWidth,seriesPosition:(N.isLineComboChart(s)?i[0].getSeriesSettings():o).seriesPosition,isLineComboChart:N.isLineComboChart(s),defaultSeriesWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(i):o).defaultSeriesWidth},M=new k(o),n&&function(e,t,i,a,r,o){{var s;e&&0<e.length&&((s=e[0].metadata)&&(a=O.supportsStaticReferenceLines(e,a),t.push.apply(t,function(e,t,i,a,r){var o=I.ColorHelper.getDataColorByIndex(t,0,I.ForegroundColorName),s=[];i&&(i=T.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.xAxisRefLineObjectName),s.push.apply(s,I.ReferenceLineHelper.readDataView(i,o,I.ReferenceLineHelper.xAxisRefLineObjectName,0,t,r,a,void 0)||[]));e=T.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.y1AxisRefLineObjectName);return s.push.apply(s,I.ReferenceLineHelper.readDataView(e,o,I.ReferenceLineHelper.y1AxisRefLineObjectName,1,t,r)||[]),s}(s,i,a,r,o)||[])))}}(t,u,a,i,e.chartType,e.featureSwitches)),{legendData:V,trendLines:c,referenceLines:u,axesData:M,warningObjectCollection:v,showIcon:!1,scrollbarOptions:l,zoomData:F}},N.getDefaultLineChartSeriesLabelSettings=function(){var e=I.DataLabelViewModel.getDefaultLabelSettings({labelColor:"#FFF",textClassName:"smallLightLabel"}).fontProperties;return{seriesColor:"#FFF",seriesPosition:I.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,show:!1}},N.isLineComboChart=function(e){return 0===e||11===e||14===e||15===e||1===e||2===e},N.getMaximumSeriesSettings=function(e){if(1<e.length){var t=e[0].getSeriesSettings(),i=e[1].getSeriesSettings(),a=t.seriesMaximumWidth;return i.seriesMaximumWidth<a?t:i}return e[0].getSeriesSettings()},N.supportsTrendLines=function(e,t,i){return a(function(e){return e.supportsTrendLine&&e.supportsTrendLine()},e,t,i)},N.supportsValueAxis=function(e,t,i){return a(function(e){e=e.getCartesianVisualCapabilities().supportsValueAxis;return void 0===e||e},e,t,i)},N.supportsDataBoundReferenceLines=function(e,t,i){return a(function(e){return!e.isStacked||!e.isStacked()},e,t,i)},N.supportsStaticReferenceLines=function(e,t,i){return a(function(e){return!e.supportsStaticReferenceLines||e.supportsStaticReferenceLines()},e,t,i)},O=N,I.CartesianChartConverter=O}(powerbi=powerbi||{}),function(f){!function(l){var e=(t.prototype.init=function(e,t,i,a,r,o,s,n){this.initOptions=e,this.tooltipService=t,this.legend=i,this.axesData=a,this.interactivityService=r,this.layerStyle=o,this.rowLoadMoreDataHandler=s,this.eventManager=n},t.prototype.create=function(e){var t=new a(this.options,this.behaviorFactory,this.featureSwitches,this.axes,this.type,this.isPlayAxis,this.axesData,this.scrollOnRowsEnabled,this.adapterFactory);return t.init(e,this.initOptions,this.tooltipService,this.legend,this.interactivityService,this.layerStyle,this.rowLoadMoreDataHandler,this.eventManager),t},t);function t(e,t,i,a,r,o,s,n){this.options=e,this.behaviorFactory=t,this.featureSwitches=i,this.axes=a,this.type=r,this.isPlayAxis=o,this.scrollOnRowsEnabled=s,this.adapterFactory=n}l.CartesianChartLayoutBuilder=e;var o=(i.prototype.render=function(e,t,i){var a,r;this.shouldRender()&&(r=(a=this.data).position||l.LegendPosition.Top,this.legend.setPosition(r),1!==a.dataPoints.length||a.grouped||((a=f.Prototype.inherit(a)).dataPoints=[]),this.legend.drawLegend(a,this.viewport,e,t,i))},i.prototype.shouldRender=function(){return!(this.interactivity&&this.interactivity.isInteractiveLegend)},i.prototype.getMargin=function(){return this.legend.getMargins()},i.prototype.getPosition=function(){return this.legend.getPosition()},i.prototype.adjustChartArea=function(e){l.Legend.positionChartArea(e,this.legend)},i.prototype.isRenderedLeftOrRight=function(){return this.legend.isVisible()&&l.Legend.isLeftOrRight(this.legend.getPosition())},i);function i(e,t,i,a){this.legend=e,this.data=t,this.viewport=i,this.interactivity=a}l.CartesianLegendRender=o;var a=(v.prototype.init=function(e,t,i,a,r,o,s,n){this.options=t,this.tooltipService=i,this.legend=a,this.interactivityService=r,this.layerStyle=o,this.element=e,this.rowLoadMoreDataHandler=s,this.eventManager=n,this.hostServices=t.host,this.gridContainer=$(document.createElement("div")).appendTo(this.element),this.gridContainer.addClass(v.GridContainerClassName),this.behavior=null===(s=this.behaviorFactory)||void 0===s?void 0:s.create(),this.visibilityHelper=f.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,v.IconClassName);n=d3.select(this.element.get(0)),s=this.chartAreaSvg=n.append("svg");s.classed(v.ClassName,!0),s.attr("name",this.getCartesianChartName()),s.style("position","absolute"),this.featureSwitches.removeScaleDetector||(n=n.append("svg").styles({position:"absolute",visibility:"hidden"}),this.svgScaleDetector=new l.SVGScaleDetector(n)),this.behavior&&(this.clearCatcher=l.appendClearCatcher(s),this.axisBehavior=new l.AxisBehavior),this.viewMode=t.host.getViewMode()},v.prototype.getCartesianChartName=function(){switch(this.type){case 0:return this.hostServices.getLocalizedString("LineChart_ToolTip");case 1:return this.hostServices.getLocalizedString("AreaChart_ToolTip");case 2:return this.hostServices.getLocalizedString("StackedAreaChart_ToolTip");case 3:return this.hostServices.getLocalizedString("ClusteredColumnChart_ToolTip");case 4:return this.hostServices.getLocalizedString("ColumnChart_ToolTip");case 5:return this.hostServices.getLocalizedString("ClusteredBarChart_ToolTip");case 6:return this.hostServices.getLocalizedString("BarChart_ToolTip");case 7:return this.hostServices.getLocalizedString("HundredPercentStackedBarChart_ToolTip");case 8:return this.hostServices.getLocalizedString("HundredPercentStackedColumnChart_ToolTip");case 9:return this.hostServices.getLocalizedString("RibbonChart_ToolTip");case 10:return this.hostServices.getLocalizedString("ScatterChart_ToolTip");case 11:return this.hostServices.getLocalizedString("ComboChart_ToolTip");case 13:return this.hostServices.getLocalizedString("WaterfallChart_ToolTip");case 14:return this.hostServices.getLocalizedString("LineClusteredColumnComboChart_ToolTip");case 15:return this.hostServices.getLocalizedString("LineStackedColumnComboChart_ToolTip");case 16:return this.hostServices.getLocalizedString("DataDotClusteredColumnComboChart_ToolTip");case 17:return this.hostServices.getLocalizedString("DataDotStackedColumnComboChart_ToolTip");case 18:return this.hostServices.getLocalizedString("LineChart_ToolTip");case 19:return this.hostServices.getLocalizedString("Histogram_Tooltip")}return this.hostServices.getLocalizedString("Chart")},v.prototype.render=function(s,n,l,c,u,d,h,p,g,y,m){return __awaiter(this,void 0,f.Promise,function(){var t,i,a,r,o;return __generator(this,function(e){switch(e.label){case 0:return(this.cartesianSmallMultipleFactory=s,this.featureSwitches.removeScaleDetector||this.svgScaleDetector.recalculate(),this.viewportScale=n.scale,s.clearRenderingTimeout(),t=s.getCoreMultiple(),i=t.getData())?(this.axesData=i.axesData,o=this.renderLegend(i.legendData,n,p,this.featureSwitches,y),a=o[0],r=o[1],this.chartAreaViewport={height:n.height-a.height,width:n.width-a.width,scale:n.scale},o=u.renderContainers(this.chartAreaViewport,this.axesData,this.isPlayAxis()?v.PlayAxisBottomMargin:0,this.featureSwitches),this.legendRenderer.adjustChartArea(u.context),this.positionChartArea(a,r,this.isPlayAxis(),o),o=this.calculatePlayAxisControlLayout(this.chartAreaViewport,a,this.legendRenderer.getPosition(),o),s.isSmallMultiples()?[3,1]:(this.cartesianSmallMultiplesLayout&&(this.cartesianSmallMultiplesLayout.destroy(),this.cartesianSmallMultiplesLayout=void 0),this.setGridContainerVisibility(!1),2&t.getState()||t.initRenderer(this.buildPlotAreaLayout(!1)),this.renderMultiple({multiple:t,viewport:n,background:c,axisZoom:u,chartAreaViewport:this.chartAreaViewport,chartAreaMargins:this.chartAreaMargins,renderedViewport:this.renderedPlotArea,playAxisControlLayout:o,suppressAnimations:h,resizeMode:m,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,isSharedAxis:!1,isHierarchicalAxis:p,preserveScrollPosition:g,supportsScrolling:!0,formatMode:y}),[3,3])):[2];case 1:return this.setGridContainerVisibility(!0),this.adjustGridContainer(this.chartAreaViewport),this.cartesianSmallMultiplesLayout=this.cartesianSmallMultiplesLayout||this.createSmallMultiplesLayout(),[4,this.cartesianSmallMultiplesLayout.render({viewport:this.chartAreaViewport,axisRendererSettings:this.getAxisRendererSettings(this.chartAreaSvg,!0,!1),cartesianSmallMultipleFactory:s,axesData:this.axesData,animationSettings:this.getAnimationOptions(!0),background:c,playAxisControlLayout:o,suppressAnimations:!0,resizeMode:m,isHierarchicalAxis:p,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,warnings:i.warningObjectCollection})];case 2:e.sent(),e.label=3;case 3:return[2]}})})},v.prototype.setGridContainerVisibility=function(e){this.gridContainer.css("display",e?"":"none")},v.prototype.scrollRowsTo=function(e){this.cartesianSmallMultiplesLayout,this.cartesianSmallMultiplesLayout.scrollRowsTo(e)},v.prototype.destroy=function(){this.cartesianSmallMultiplesLayout&&this.cartesianSmallMultiplesLayout.destroy()},v.prototype.positionChartArea=function(e,t,i,a){this.chartAreaMargins=v.getEmptyMargins(),l.Legend.isLeft(t)&&(this.chartAreaMargins.left=e.width),l.Legend.isTop(t)&&(this.chartAreaMargins.top=e.height),i&&(this.chartAreaViewport.height-=v.PlayAxisBottomMargin),a&&(this.chartAreaViewport.height-=a.top+a.bottom,this.chartAreaViewport.width-=a.left+a.right,this.chartAreaMargins.left=(this.chartAreaMargins.left||0)+a.left,this.chartAreaMargins.top=(this.chartAreaMargins.top||0)+a.top),this.chartAreaSvg.attrs({width:this.chartAreaViewport.width,height:this.chartAreaViewport.height}).styles({"margin-top":this.chartAreaMargins.top?this.chartAreaMargins.top+"px":null,"margin-left":this.chartAreaMargins.left?this.chartAreaMargins.left+"px":null})},v.prototype.createSmallMultiplesLayout=function(){var t=this;return new l.CartesianSmallMultipleLayout(this.gridContainer,this.interactivityService,this.featureSwitches,function(e){return t.hostServices.getLocalizedString(e)},this.rowLoadMoreDataHandler,this.scrollOnRowsEnabled,this.behaviorFactory,this.layerStyle,this.viewMode,this.buildPlotAreaLayout.bind(this),this.renderMultiple.bind(this),this.adapterFactory,this.hostServices.instanceId,this.eventManager)},v.prototype.adjustGridContainer=function(e){this.gridContainer.css({width:e.width,height:e.height}),this.legendRenderer.adjustChartArea(d3.select(this.gridContainer.get(0)))},v.prototype.getVisibleMultiples=function(){return this.cartesianSmallMultiplesLayout?this.cartesianSmallMultiplesLayout.getVisibleMultiples():{startIndex:0,endIndex:1}},v.prototype.renderMultiple=function(e){var t=this,i=this.cartesianSmallMultipleFactory.isSmallMultiples(),a=this.featureSwitches&&this.featureSwitches.cartesianMultiplesAccessibility,r={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}},i={background:e.background,axisZoom:e.axisZoom,labelAnimationOptions:this.getLabelAnimationOptions(e.suppressAnimations),axesAnimationOptions:this.getAnimationOptions(e.suppressAnimations),renderedPlotArea:e.renderedViewport,viewport:e.viewport,chartAreaViewport:e.chartAreaViewport,chartAreaMargins:e.chartAreaMargins,layerStyle:this.layerStyle,suppressAnimations:e.suppressAnimations,playAxisControlLayout:e.playAxisControlLayout,resizeMode:e.resizeMode,viewMode:this.viewMode,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,categoryLoadMoreDataHandler:e.categoryLoadMoreDataHandler,shouldRenderGridLinesOnly:!1,isSmallMultiples:i,multipleId:e.multiple.index.toString(),isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:e.preserveScrollPosition,supportsScrolling:e.supportsScrolling,disableKeyboardNavigation:i&&!a,navigationScrollCallbacks:r,formatMode:e.formatMode};e.isSharedAxis&&v.adjustOptionsForSharedAxis(i,e.viewport,e.axesLayout);a=e.multiple.getData(),r=e.multiple.getRenderer();r.axesRenderer.update(a.axesData,a.scrollbarOptions),r.render(e.multiple.layers,a,e.renderedViewport,i,this.viewportScale),this.noLabelsCanBeRendered=r.noLabelsCanBeRendered,this.renderedPlotArea=r.renderedPlotArea},v.prototype.scrollTo=function(e){this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollTo(e):this.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},v.prototype.shouldScrollTo=function(e){return this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.shouldScrollTo(e):this.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},v.prototype.scrollBy=function(e){this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollBy(e):this.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},v.prototype.getLabelAnimationOptions=function(e){e=this.getAnimationOptions(e);return{duration:this.isPlayAxis()?l.PlayChart.getFrameAnimationDuration():e.duration,ease:this.isPlayAxis()?l.D3Helper.easeCompat(l.PlayChart.AnimationEase):e.ease}},v.prototype.getAnimationOptions=function(e){return{ease:this.animator&&this.animator.getEasing(),duration:l.AnimatorCommon.GetAnimationDuration(this.animator,e)}},v.prototype.calculatePlotArea=function(e){if(this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()){var t=this.cartesianSmallMultiplesLayout.calculatePlotArea(e);return{width:t.width,height:t.height,scale:e.viewport.scale}}var i=e.viewport,a=e.axesMargins,t={width:i.width-(a.left+a.right),height:i.height-(a.top+a.bottom),scale:i.scale},i=i.width-(a.left+a.right),a=0;null!=e.layerSeriesData.defaultSeriesWidth&&(i=100*e.layerSeriesData.defaultSeriesWidth/i,a=Math.min(Math.max(1,i),50),e.layerSeriesData.seriesMaximumWidth=a);a=e.layerSeriesData.seriesMaximumWidth/100;return e&&e.showSeriesLabels&&(t.width=t.width-a*t.width),t},v.adjustOptionsForSharedAxis=function(e,t,i){i.viewport=t,i.shouldRenderAxis.x=!1,i.shouldRenderAxis.y=!1,i.shouldRenderAxis.y2=!1,i.margin=i.axesOverflow,e.axesLayout=i,e.shouldRenderGridLinesOnly=!0},v.getEmptyMargins=function(){return{top:0,bottom:0,left:0,right:0}},v.prototype.getAxisRendererSettings=function(e,t,i){var a=this,e={axes:this.axes,container:e,type:this.type,data:this.axesData,interactivity:this.options.interactivity,interactivityService:this.interactivityService,behavior:this.axisBehavior,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis,calculatePlotArea:function(e){return a.calculatePlotArea(e)},hostServices:this.hostServices,tooltipService:this.tooltipService,eventManager:this.eventManager,featureSwitches:this.featureSwitches};return t&&(e.onScroll=function(e){return a.cartesianSmallMultiplesLayout.onScroll(e)},e.onExtentUpdate=function(e){return a.cartesianSmallMultiplesLayout.onExtentUpdate(e)},e.suppressBrush=i),e.data.useManagedTabIndex=!1,e},v.prototype.calculatePlayAxisControlLayout=function(e,t,i,a){var r;return this.isPlayAxis()&&(r=(null==a?void 0:a.left)||0,a=(null==a?void 0:a.bottom)||0,r={left:l.Legend.isLeft(i)?t.width:0,top:l.Legend.isTop(i)?t.height+e.height+a:e.height+a,height:v.PlayAxisBottomMargin,width:e.width+r}),r},v.addCartesianChartContainer=function(e,t){var i=d3.select(e.get(0)),e=i.select("svg");e.empty()&&((e=i.append("svg")).classed(v.ClassName,!0),e.style("position","absolute"));i=l.appendClearCatcher(e);return t&&e.attrs({width:t.width,height:t.height}),{element:e,clearCatcher:i}},v.prototype.renderLegend=function(e,t,i,a,r){return this.legendRenderer=new o(this.legend,e,t,this.options.interactivity),this.legendRenderer.render(i,a,r),[this.legendRenderer.getMargin(),this.legendRenderer.getPosition()]},v.prototype.buildPlotAreaLayout=function(e,t,i,a,r){var o=this.getAxisRendererSettings(t||this.chartAreaSvg,e,e&&this.isSharedAxis),o=new l.CartesianAxesRenderer(o);return new l.CartesianPlotAreaLayout(this.visibilityHelper,t||this.chartAreaSvg,o,a||this.element,this.type,this.hostServices,r||this.behavior,this.interactivityService,this.isLabelInteractivityEnabled,i||this.clearCatcher,this.animator,this.dataPointLassoSelect&&!e,this.viewportScale,this.featureSwitches)},v.shouldRenderAxis=function(e,t){return{x:e.x.show,y:e.y.show,y2:e.y2.show||t&&!1!==e.y2.show}},v.getPreferredPlotArea=function(e,t,i,a,r,o,s){o={height:i.height-(o=o||{top:0,right:0,bottom:0,left:0}).top-o.bottom,width:i.width-o.left-o.right};return!r&&a&&(s=v.getPreferredCategorySpan(e,t,s),o.width=Math.max(s,o.width)),o},v.getPreferredCategorySpan=function(e,t,i){return t*e+t*(i||0)*2},v.getLayout=function(e,t){var i=t.categoryCount,a=t.availableWidth,r=!!t.isScalar,o=!!t.isScrollable,s=v.getCategoryWidth(e?e.series:null,t),n=v.getCustomizedCategoryWidthInfo(s,t),e=n.categoryWidth,s=n.outerPaddingRatio,n=f.Double.floorWithPrecision((a-e*s*2)/e),n=Math.min(n,i);return r||n<i&&o||(s=Math.max(0,(a-e*n)/2/e),s=f.Double.equalWithPrecision(s,0)?0:s),{categoryCount:n=!r&&o?i:n,categoryThickness:e,outerPaddingRatio:s,innerPaddingRatio:t.innerPaddingRatio,isScalar:r}},v.getCustomizedCategoryWidthInfo=function(e,t){var i=e,a=t.categoryCount,r=t.availableWidth,o=t.isScalar,s=t.preferredCategoryWidth,t=t.outerPaddingRatio;if(o||null==s||s<e)return{categoryWidth:i,outerPaddingRatio:t};e=Math.floor((r-s*t*2)/s);return{categoryWidth:i=e<=0?r/(1+2*t):e<a?(t=(r-s*e)/(2*s),s):Math.min(s,r),outerPaddingRatio:t}},v.getCategoryWidth=function(e,t){var i,a=t.categoryCount,r=t.availableWidth,o=t.domain,s=t.isScalar,n=t.trimOrdinalDataOnOverflow,t=t.outerPaddingRatio;return a<2?i=r*(1-t):s&&o&&1<o.length?(i=r*((e=v.getMinInterval(e))/(o[o.length-1]-o[0]+e*t*2)),i=Math.max(i,l.CartesianChart.MinScalarRectThickness)):(i=r/(a+2*t),n&&(i=Math.max(i,l.CartesianHelper.MinOrdinalRectThickness))),i=Math.min(i,r/(3+2*t)),!s&&3<=a&&n?Math.max(i,l.CartesianHelper.MinOrdinalRectThickness):i},v.getMinInterval=function(e){var t=Number.MAX_VALUE;if(0<e.length)for(var i=e[0].data.filter(function(e){return!e.highlight}),a=0,r=i.length-1;a<r;a++){var o=i[a+1].categoryValue,s=i[a].categoryValue;_.isNumber(o),_.isNumber(s),t=Math.min(t,Math.abs(o-s))}return t},v.ClassName="cartesianChart",v.IconClassName="cartesianChartResponsiveIcon",v.GridContainerClassName="cartesian-grid-container",v.PlayAxisBottomMargin=80,v);function v(e,t,i,a,r,o,s,n,l){this.behaviorFactory=t,this.featureSwitches=i,this.axes=a,this.type=r,this.isPlayAxis=o,this.axesData=s,this.scrollOnRowsEnabled=n,this.adapterFactory=l,this.animateCategoryAxis=!1,this.animateValueAxis=!1,this.isSharedAxis=!0,e&&(this.viewMode=0,this.isLabelInteractivityEnabled=e.isLabelInteractivityEnabled,this.dataPointLassoSelect=this.featureSwitches.dataPointLassoSelect&&e.dataPointLassoSelect,this.animator=e.animator,this.animateCategoryAxis=e.animateCategoryAxis,this.animateValueAxis=e.animateValueAxis)}l.CartesianChartLayout=a}(f.visuals||(f.visuals={}))}(powerbi=powerbi||{}),function(e){var c;(function(r){r.getFontOnlyTextSubSelectionStyles=function(e,t,i,a,r,o){return __assign({type:1},s(e,t,i,a,r,o=void 0===o?null:o))},r.getFontOnlyNumericTextSubSelectionStyles=function(e,t,i,a,r,o){return __assign({type:2},s(e,t,i,a,r,o=void 0===o?null:o))},r.getAxisTitleSubSelectionStyles=function(e,t){var i=n(e),e=l(e,"title");return r.getFontOnlyTextSubSelectionStyles(i,e,e+"-font",e+"-color",t)},r.getAxisValuesSubSelectionStyles=function(e,t,i){var a=o(e,t),t=n(e),a=l(e,e&&a?"valuesScalar":"values");return r.getFontOnlyNumericTextSubSelectionStyles(t,a,a+"-font",a+"-color",i)},r.getAxisTitleSubSelectionShortcuts=function(e,t,i){var a=[{type:0},{type:1,destinationUids:[{cardUid:n(e),groupUid:l(e,"title")}],label:i.getLocalizedString("Format_AxisTitle")}];return o(e,t)&&a.splice(1,0,{type:2,sourceUid:"axisZoom-default-"+(e?"categoryAxis":"valueAxis"),relatedToggledSourceUids:["Visual-axisZoom"],enabledLabel:i.getLocalizedString("Format_AddZoomSlider"),disabledLabel:""}),a},r.getAxisValuesSubSelectionShortcuts=function(e,t,i,a){var r=o(e,t),t=[{type:1,destinationUids:[{cardUid:n(e),groupUid:l(e,e&&r?"valuesScalar":"values")}],label:a.getLocalizedString("Format_AxisValues")}];return r||t.unshift({type:4,sortableField:{queryName:"",sortDirection:1},label:a.getLocalizedString("Format_SortAxis")}),e&&i===c.axisType.both&&t.unshift({type:3,sourceUid:l(e,"type")+"-type",label:a.getLocalizedString("Format_Label_AxisType")}),r&&t.unshift({type:2,sourceUid:"axisZoom-default-"+(e?"categoryAxis":"valueAxis"),relatedToggledSourceUids:["Visual-axisZoom"],enabledLabel:a.getLocalizedString("Format_AddZoomSlider"),disabledLabel:""}),t.unshift({type:2,sourceUid:l(e,"title"),enabledLabel:a.getLocalizedString("Format_AddAxisTitle"),disabledLabel:""}),t.unshift({type:0}),t};var s=function(e,t,i,a,r,o){return{font:{reference:__assign({cardUid:e,groupUid:t,sliceUid:i},o?{selector:o}:{}),label:r.getLocalizedString("Font")},fontColor:{reference:__assign({cardUid:e,groupUid:t,sliceUid:a},o?{selector:o}:{}),label:r.getLocalizedString("Visual_FontColor")}}},o=function(e,t){return!e||t},n=function(e){return e?"Visual-categoryAxis":"Visual-valueAxis"},l=function(e,t){return e?"categoryAxis-"+t:"valueAxis-"+t}})((c=e.visuals||(e.visuals={})).CartesianChartOnObjectUtil||(c.CartesianChartOnObjectUtil={}))}(powerbi=powerbi||{}),function(f){var P;function e(e,t,i,a,r,o,s,n,l,c,u,d,h,p){this.visibilityHelper=e,this.chartAreaSvg=t,this.axesRenderer=i,this.element=a,this.type=r,this.hostServices=o,this.behavior=s,this.interactivityService=n,this.isLabelInteractivityEnabled=l,this.clearCatcher=c,this.animator=u,this.dataPointLassoSelect=d,this.initialViewportScale=h,this.featureSwitches=p,this.dataPointNavigationHelper=new P.CartesianChartNavigationHelper,this.dataPointLassoSelect&&(this.plotLassoManager=new P.PlotAreaLassoManager(!1),this.plotLassoManager.init([i.getLayerContainer(),c],t,this.hostServices,this.featureSwitches),this.lassoSelectionBehavior=new P.LassoSelectionBehavior(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.initialViewportScale))}P=f.visuals||(f.visuals={}),e.prototype.attachToElement=function(e,t){this.element=e;var i=this.chartAreaSvg;i.attrs({width:t.width,height:t.height}),i.node().parentElement!==e.get(0)&&e.append(i.node())},e.prototype.render=function(e,t,i,a,r){this.options=a,this.renderedPlotArea=i,this.cartesianData=t,this.layers=e,this.plotLassoManager&&this.plotLassoManager.setUiScale(r),this.cartesianData&&(this.cartesianData.showIcon?this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon,viewport:this.options.viewport}):(this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon}),this.renderCartesianChart()))},e.prototype.destroy=function(){this.axesRenderer.destroy(),this.chartAreaSvg.html(null),P.visualBackgroundHelper.removeBackgroundImage(this.element)},e.prototype.renderCartesianChart=function(){var a=this,r=this.options,e=!this.renderedPlotArea||this.renderedPlotArea.height!==r.chartAreaViewport.height||this.renderedPlotArea.width!==r.chartAreaViewport.width;this.renderedPlotArea=r.chartAreaViewport;e=__assign(__assign({},r),{suppressAnimations:r.suppressAnimations||e,playAxesRect:r.playAxisControlLayout,animationDuration:r.axesAnimationOptions.duration,ease:r.axesAnimationOptions.ease,supportsScrolling:r.supportsScrolling});this.axesRenderer.render(this.cartesianData.axesData,this.options.axisZoom,this.layers,this.cartesianData.referenceLines,this.options.chartAreaViewport,function(e,t,i){return a.renderPlotArea(e,t,i,r.resizeMode,a.options.disableKeyboardNavigation)},e,void 0,this.options.axesLayout),this.dataPointNavigationHelper.updateScrollCallbacks(r.supportsScrolling?r.navigationScrollCallbacks:void 0)},e.prototype.getPlotAreaRect=function(e){return{left:e.margin.left+this.options.chartAreaMargins.left,top:e.margin.top+this.options.chartAreaMargins.top,width:e.plotArea.width,height:e.plotArea.height}},e.prototype.renderBackgroundImage=function(e){P.visualBackgroundHelper.renderBackgroundImage(this.options.background,this.element,e)},e.prototype.renderPlotArea=function(e,t,i,a,r){i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});var o=this.getPlotAreaRect(t);this.renderBackgroundImage(o),this.renderReferenceLines(t),this.renderLayers(e,t,i,a,r),this.renderTrendLines(t)},e.prototype.renderTrendLines=function(e){var t=this.axesRenderer.getLayerContainer();P.TrendLineHelper.render(this.cartesianData.trendLines,t,e.axes,e.plotArea)},e.prototype.renderReferenceLines=function(e){e={graphicContext:this.axesRenderer.getLayerContainer(),axes:e.axes,viewport:e.plotArea,referenceLines:this.cartesianData.referenceLines};P.ReferenceLineHelper.render(e)},e.prototype.getReferenceLineLabels=function(e,t){t={axes:e,viewport:t,referenceLines:this.cartesianData.referenceLines,hostServices:this.hostServices,style:this.options.layerStyle};return P.ReferenceLineHelper.createLabelDataPoint(t)},e.prototype.renderDataLabels=function(e,t,i,a,r,o){var s,n,l,c,u,d=this.axesRenderer.getDataLabelContainers(),h=d.foreground,p=d.background,g=[];this.behavior?(s=(c=this.options).formatMode,n=c.labelAnimationOptions,l=this.animator,d=P.DataLabelRenderer.getDataLabelLayoutOptions(this.type),g=new f.LabelLayout(d).layout(e,i),c=void 0,c=l&&!a&&o?P.DataLabelRenderer.animateLabelsAndBackgrounds({labelContext:h,dataLabels:g,duration:n.duration,numeric:t,easeType:n.ease,backgroundContext:p}):P.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:h,dataLabels:g,numeric:t,backgroundContext:p}),d.allowLeaderLines&&(d=_.filter(g,function(e){return null!=e.leaderLinePoints&&!_.isEmpty(e.leaderLinePoints)&&null!=e.identity}),P.DataLabelRenderer.drawLabelLeaderLines(h,d,function(e){return e.identity.getKey()})),this.interactivityService&&(this.isLabelInteractivityEnabled||s)&&(c={labelItems:c},this.interactivityService.bind(g,new P.LabelsBehavior,c,{isLabels:!0,pointSourceKey:"data-labels",formatMode:s}))):(g=new f.LabelLayout({maximumOffset:P.DataLabelViewModel.maxLabelOffset,startingOffset:P.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}).layout(e,i),P.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:h,dataLabels:g,numeric:t,backgroundContext:p}));for(var y=0,m=e;y<m.length;y++){var v=m[y];if(!_.isEmpty(v.labelDataPoints)){u=!0;break}}return!_.isEmpty(g)||!u},e.prototype.renderSeriesLabels=function(e,t,i,a){var r,o=this.axesRenderer.getSeriesLabelContainers(),s=o.seriesForeground,n=o.seriesBackground,l=new f.LabelLayout({maximumOffset:P.DataLabelViewModel.maxLabelOffset,startingOffset:P.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}),c=!!i&&!!i.seriesWordWrap,o=i?i.fontProperties.size.px:0,u=l.layout(e,t),a=i?i.seriesMaximumWidth/100*a:0,i=i&&i.seriesPosition===P.labelSeriesPosition.right?1:0;P.DataLabelRenderer.drawSeriesLabelsAndBackgrounds({labelContext:s,dataLabels:u,backgroundContext:n,availableWidth:a,position:i,seriesWordWrap:c,plotArea:t,seriesFontSize:o});for(var d=0,h=e;d<h.length;d++){var p=h[d];if(!_.isEmpty(p.labelDataPoints)){r=!0;break}}return!_.isEmpty(u)||!r},e.prototype.renderLayers=function(e,t,i,a,r){var o,s,n,l=[],c=[],u=[],d=[],h=!0,p=t.axes,g=t.plotArea;i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});for(var y=!0,m=0,v=e;m<v.length;m++){var f=v[m].render(i,a,this.options.formatMode);if(f){if(f.animateLabels||(y=!1),this.behavior&&(u=u.concat(f.dataPoints),d.push(f.behaviorOptions),f.navigationOptions&&(o?o.navigationOptions.navigationStrategy=P.DataPointNavigationStrategy.CategoryFirst:(o={pointSourceKey:"cartesian-layer "+(this.options.multipleId||""),navigationOptions:{navigationStrategy:f.navigationOptions.navigationStrategy,helper:this.dataPointNavigationHelper,disabled:r}},this.dataPointNavigationHelper.clearNavigationLayers()),o.isHierarchicalAxis=this.options.isHierarchicalAxis,this.dataPointNavigationHelper.addNavigationLayer(f.navigationOptions.helper))),f.labelDataPointGroups)for(var S=0,x=f.labelDataPointGroups;S<x.length;S++)(C=x[S])&&l.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(C.labelDataPoints||[]),maxNumberOfLabels:C.maxNumberOfLabels,labelOrientation:C.isTotal?1:f.labelOrientation});else{var b=f.labelDataPoints||[];l.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(b),maxNumberOfLabels:b.length,labelOrientation:f.labelOrientation})}if(f.labelDataPointSeriesGroups)for(var C,w=0,D=f.labelDataPointSeriesGroups;w<D.length;w++)(C=D[w])&&c.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(C.labelDataPoints||[]),maxNumberOfLabels:C.maxNumberOfLabels,labelOrientation:C.isTotal?1:f.labelOrientation});h=h&&f.labelsAreNumeric,this.lassoSelectionBehavior&&(void 0!==f.categorySubRangeCount&&(void 0===s?s=f.categorySubRangeCount:f.categorySubRangeCount),void 0!==f.verticalCategoryAxis&&(void 0===n?n=f.verticalCategoryAxis:f.verticalCategoryAxis))}}var A=this.getReferenceLineLabels(p,g);_.isEmpty(A)||l.unshift({labelDataPoints:A,maxNumberOfLabels:A.length}),this.noLabelsCanBeRendered=!this.renderDataLabels(l,h,g,i,P.ComboChart.isComboChart(this.type),y);p=P.CartesianChartConverter.isLineComboChart(this.type)?P.CartesianChartConverter.getMaximumSeriesSettings(e):P.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings(),A=t.viewport,e=t.margin,e=A.width-(e.left+e.right);this.noSeriesLabelsCanBeRendered=!this.renderSeriesLabels(c,g,p,e),this.dataPointNavigationHelper.getPendingFocusElement&&o&&(o.navigationOptions.focusElement=this.dataPointNavigationHelper.getPendingFocusElement()),this.interactivityService&&(t={layerOptions:d,clearCatcher:this.clearCatcher,root:this.chartAreaSvg,axesLayout:t,categorySubRangeCount:s,verticalCategoryAxis:n},this.interactivityService.bind(u,this.behavior,t,o))},P.CartesianPlotAreaLayout=e}(powerbi=powerbi||{}),function(n){var l;function e(e,t){this.disableKeyboardNavigation=e,this.switchAxisPosition=t,this.axesRenderersByPosition=((t={})[2]=[],t[0]=[],t[1]=[],t)}l=n.visuals||(n.visuals={}),e.prototype.update=function(e,t,i,a,r,o,s){this.settings=e,this.renderOptions=i;i=(this.coreMultiple=t).getData(),t=t.layers;return this.layout=l.CartesianAxesLayoutBuilder.build(i.axesData,this.settings.interactivity,i.referenceLines,this.settings.type,this.settings.axes,t,a,this.renderOptions.playAxesRect,this.settings.calculatePlotArea,this.renderOptions.trimOrdinalDataOnOverflow,void 0,!0,s),this.clearUnusedRenderers(r,o,this.layout.shouldRenderAxis),this.layout},e.prototype.clearUnusedRenderers=function(e,t,i){e=i.x||this.layout.isXScrollBarVisible?e:0,this.destroyUnusedRenderers(e,2);var a=i.y||this.layout.isYScrollBarVisible?t:0,e=this.switchAxisPosition?this.settings.data.y.switchAxisPosition?l.yAxisPosition.right:l.yAxisPosition.left:this.settings.data.y.position,e=this.shouldRenderYAxis(0,e)?0:1;this.destroyUnusedRenderers(a,e);t=i.y2||this.layout.isYScrollBarVisible?t:0;this.destroyUnusedRenderers(t,0==e?1:0)},e.prototype.destroyUnusedRenderers=function(e,t){var i=this.axesRenderersByPosition[t];_.isEmpty(i)||i.length<=e||(i.slice(e,i.length).forEach(function(e){return e.destroy()}),this.axesRenderersByPosition[t]=i.slice(0,e))},e.prototype.calculateAxesLayout=function(){var e=_.cloneDeep(this.layout);n.Prototype.copyPrototypeDeep(this.layout,e);var t=e.axes;return t.x.scale=t.x.scale.copy(),t.y1.scale=t.y1.scale.copy(),t.y2&&(t.y2.scale=t.y2.scale.copy()),e},e.prototype.renderAxes=function(e){var t,i,a,r,o;e.viewport.height<1||e.viewport.width<1||(o=l.CartesianChartLayout.addCartesianChartContainer(e.element,e.viewport),t=this.coreMultiple.getData(),i=__assign(__assign({},this.renderOptions),{supportsScrolling:this.shouldSupportScrolling(t,e.position),disableKeyboardNavigation:this.disableKeyboardNavigation}),a=this.getAxesRenderer(o.element,e.position,e.index,t,e.useManagedTabIndex),r=this.coreMultiple.layers,o=this.updateAxesLayoutByPosition(e.position,e.viewport),a.render(t.axesData,void 0,r,t.referenceLines,e.viewport,function(){},i,this.useManagedTabIndex(),o))},e.prototype.scrollDelta=function(t,e){this.updateScrollState(function(e){return e.scrollDelta(t)},e)},e.prototype.scrollTo=function(t,e){this.updateScrollState(function(e){return e.scrollTo(t)},e)},e.prototype.scrollBy=function(t,e){this.updateScrollState(function(e){return e.scrollBy(t)},e)},e.prototype.updateScrollbarExtent=function(t,e){this.updateScrollState(function(e){return e.setExtent(t)},e)},e.prototype.updateScrollState=function(i,a){var e=this.coreMultiple.getData(),r=this.getScrollablePosition(e),e=this.axesRenderersByPosition[r];2!==r&&_.isEmpty(a)||_.isEmpty(e)||e.forEach(function(e,t){2!==r&&(t<a.startIndex||t>a.endIndex)||i(e)})},e.prototype.updateAxesLayoutByPosition=function(e,t){var i=this.calculateAxesLayout();if(i.viewport=this.adjustViewportForScroll(t,i.scrollHandleMargins),i.preferredPlotArea={width:0,height:0},2===e)return i.margin=this.getMarginByPosition(i.margin,e,i.axesOverflow),i.shouldRenderAxis.y=!1,i.shouldRenderAxis.y2=!1,i.axisLabels.y=null,i.axisLabels.y2=null,i.plotArea.height=0,i;t=this.switchAxisPosition?this.settings.data.y.switchAxisPosition?l.yAxisPosition.right:l.yAxisPosition.left:this.settings.data.y.position,t=this.shouldRenderYAxis(e,t);return i.plotArea.width=0,t?(i.margin=this.getMarginByPosition(i.margin,e,i.axesOverflow),i.axisLabels.x=null,i.axisLabels.y2=null,i.shouldRenderAxis.x=!1,i.shouldRenderAxis.y2=!1):(i.shouldRenderAxis.x=!1,i.shouldRenderAxis.y=!1,i.axisLabels.x=null,i.axisLabels.y=null,i.margin=this.getMarginByPosition(i.margin,e,i.axesOverflow)),i},e.prototype.destroy=function(){var i=this;this.executeActionByPosition(this.axesRenderersByPosition,function(e,t){_.isEmpty(e)||(e.forEach(function(e){return e.destroy()}),i.axesRenderersByPosition[t]=[])})},e.prototype.executeActionByPosition=function(e,t){for(var i in this.axesRenderersByPosition){i=i;t(e[i],i)}},e.prototype.clearRenderingTimeout=function(){this.executeActionByPosition(this.axesRenderersByPosition,function(e){_.isEmpty(e)||e.forEach(function(e){return e.clearRenderingTimeout()})})},e.prototype.shouldRenderYAxis=function(e,t){return 0===e&&t===l.yAxisPosition.left||1===e&&t===l.yAxisPosition.right},e.prototype.getMarginByPosition=function(e,t,i){i=n.Prototype.inherit(i);return 2===t?(i.bottom=e.bottom,i.top=0):(i.left=0,(i.right=0)===t?i.left=e.left:1===t&&(i.right=e.right)),i},e.prototype.getScrollablePosition=function(e){var t=e.axesData,i=this.layout,e=!1;return(this.switchAxisPosition&&t.y&&t.y.switchAxisPosition||t.y&&t.y.position===l.yAxisPosition.right)&&(e=!0),i.isYScrollBarVisible?e?1:0:i.isXScrollBarVisible?2:void 0},e.prototype.shouldSupportScrolling=function(e,t){return this.getScrollablePosition(e)===t},e.prototype.getAxesRenderer=function(e,t,i,a,r){var o=$(e.node()),s=o.data("CartesianAxesRenderer");return s?s.update(a.axesData,a.scrollbarOptions):((a=n.Prototype.inherit(this.settings)).container=e,a.multipleId=""+i,a.behavior=new l.AxisBehavior,a.data.useManagedTabIndex=r,this.axesRenderersByPosition[t][i]=s=new l.CartesianAxesRenderer(a),o.data("CartesianAxesRenderer",s)),s},e.prototype.adjustViewportForScroll=function(e,t){return t?{width:e.width-(t.left+t.right),height:e.height-(t.top+t.bottom),scale:e.scale}:e},e.prototype.useManagedTabIndex=function(){return!this.disableKeyboardNavigation&&this.renderOptions.isSmallMultiples},l.CartesianSharedAxisLayout=e}(powerbi=powerbi||{}),function(C){var w,v;function g(e,t,i,a,r,o,s,n,l,c,u,d,h,p){this.container=e,this.interactivityService=t,this.featureSwitches=i,this.getLocalizedString=a,this.behaviorFactory=s,this.layerStyle=n,this.viewMode=l,this.buildPlotAreaLayout=c,this.renderMultiple=u,this.adapterFactory=d,this.visualInstanceId=h,this.isSharedAxis=!0,this.sharedAxisLayout=new w.CartesianSharedAxisLayout(!i.cartesianMultiplesAccessibility,i.switchAxisPosition),this.gridLayout=new w.GridLayout(e,i,function(){return r.loadMoreData()},o,t,p,"multiple"),this.visibilityHelper=C.responsiveVisualUtilModuleFactory().visibilityHelper(e,g.IconClassName)}w=C.visuals||(C.visuals={}),g.prototype.render=function(t){var i=this;this.clearRenderingTimeout();var e=t.cartesianSmallMultipleFactory,a=(this.options=t).cartesianSmallMultipleFactory,r=this.adapterFactory(),o=r.getMultiplesSubheader(t.warnings),s=this.multiplesLayout=r.getMultiplesLayout(t.warnings),n=s.showIcon;if(this.visibilityHelper.updateVisibility({showIcon:n,viewport:t.viewport}),!n){var l={type:s.gridLineType,settings:{color:s.gridLineColor,style:s.gridLineStyle,width:s.gridLineWidth}},r=this.featureSwitches,n=this.getCellPadding(s,r),r=this.getOuterPadding(s,r),r={categoryLoadMoreDataHandler:t.categoryLoadMoreDataHandler,playAxisControlLayout:t.playAxisControlLayout,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,suppressAnimations:t.suppressAnimations,resizeMode:t.resizeMode,rowCount:s.rowCount,columnCount:s.columnCount,getCellBackgroundColor:function(e){return i.getColorFromMultipleObjects(e,w.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor,i.multiplesLayout.backgroundColor)},backgroundTransparency:s.backgroundTransparency,isHierarchicalAxis:t.isHierarchicalAxis,gridLineSettings:l,cellPadding:n,outerPadding:r};return this.cellDimensions&&(this.cellDimensions.maxSubheaderHeight=void 0),this.renderGridLayout(e,t.viewport,function(e){return i.renderGridCell(a,e,t.background,t.playAxisControlLayout,t.suppressAnimations,t.resizeMode,t.trimOrdinalDataOnOverflow,t.categoryLoadMoreDataHandler,t.isHierarchicalAxis,!0,o.labelBold)},function(e){return i.renderGridCellSubheader(e,a,o)},o,r,t.axisRendererSettings.axes.isYAxisCategorical)}},g.prototype.clearRenderingTimeout=function(){this.sharedAxisLayout.clearRenderingTimeout(),this.gridLayout.clearRenderingTimeout()},g.prototype.destroy=function(){this.gridLayout.destroy(),this.sharedAxisLayout.destroy()},g.prototype.onScroll=function(e){this.sharedAxisLayout.scrollDelta(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollDelta(e,this.getVisibleMultiples())},g.prototype.onExtentUpdate=function(e){this.sharedAxisLayout.updateScrollbarExtent(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.updateScrollbarExtent(e,this.getVisibleMultiples())},g.prototype.scrollTo=function(e){this.sharedAxisLayout.scrollTo(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},g.prototype.shouldScrollTo=function(e){return this.options.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},g.prototype.scrollBy=function(e){this.sharedAxisLayout.scrollBy(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},g.prototype.getVisibleMultiples=function(){var e=this.options.cartesianSmallMultipleFactory.getFrameCount(),t=this.gridLayout.getScrollPosition();if(!t)return{startIndex:0,endIndex:0};var i=t.startIndex*this.multiplesLayout.columnCount,t=t.endIndex*this.multiplesLayout.columnCount;return{startIndex:i,endIndex:Math.min(t,e)}},g.prototype.calculatePlotArea=function(e){var t=_.clone(e.axesMargins),i=e.axesMargins,a=e.axesOverflow,t=w.CartesianAxes.adjustAxesMarginsForShared(i,e.scrollHandleMargins,e.willRenderAxis,null!==(i=this.featureSwitches)&&void 0!==i&&i.switchAxisPosition?this.options.axesData.y.switchAxisPosition:this.options.axesData.y.position===w.yAxisPosition.right,e.axes,w.CartesianAxesLayoutBuilder.showAxisTitles(this.options.axesData,void 0));this.gridLayout.updateHeaderMargins(t);var r,t=this.adapterFactory(),t=t?t.getMultiplesSubheader(this.options.warnings):w.CartesianChart.getMultiplesSubheader(this.options.cartesianSmallMultipleFactory.getObjects(),this.layerStyle);t.titleWrap&&(r=this.getFrameDisplayNames());t={titleWrap:t.titleWrap,subheaders:r,subheaderFontProperties:t.fontProperties,subheaderLineHeight:t.height,subheaderMargin:t.margins};return this.cellDimensions=this.gridLayout.calculateCellDimensions(a,t,e),this.cellDimensions.plotAreaViewport},g.prototype.scrollRowsTo=function(e){this.gridLayout,this.gridLayout.scrollTo(e)},g.prototype.getCellPadding=function(e,t){e=t.cartesianMultiplesGridFormatting&&t.cartesianMultiplesGridPadding?{top:e.rowPaddingInner,bottom:0,left:e.columnPaddingInner,right:0}:{top:12,bottom:0,left:12,right:0};return e},g.prototype.getOuterPadding=function(e,t){e=t.cartesianMultiplesGridFormatting&&t.cartesianMultiplesGridPadding?{top:e.rowPaddingOuter,bottom:e.rowPaddingOuter,left:e.columnPaddingOuter,right:e.columnPaddingOuter}:{top:0,bottom:0,left:0,right:0};return e},g.prototype.getFrameDisplayNames=function(){var t=this.getLocalizedString("ListJoin_Separator"),e=this.options.cartesianSmallMultipleFactory.reader.getFrameDisplayNames();return e&&e.map(function(e){return e.join(t)})},g.prototype.renderGridLayout=function(y,m,v,f,S,x,b){return __awaiter(this,void 0,C.Promise,function(){var t,i,a,r,o,s,n,l,c,u,d,h,p,g=this;return __generator(this,function(e){return t=this.getAxesRenderOptions(x),h=y.getFrameCount(),i=y.getCoreMultiple(),a=y.getShouldResetRowMultipleScrollPosition(),r=x.rowCount,o=x.columnCount,s=x.getCellBackgroundColor,p=x.backgroundTransparency,n=x.cellPadding,l=x.outerPadding,c=S.height,d=S.margins,u=S.show,d=c+d.top+d.bottom,p={rowCount:r,columnCount:o,viewport:m,renderCell:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return v(t),[2,new C.Promise(function(e){return e()})]})})},renderCellSubheader:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return f(t),[2,new C.Promise(function(e){return e()})]})})},cellCount:h,headerMargins:w.CartesianChartLayout.getEmptyMargins(),renderHeader:function(){},subheaderShow:u,subheaderHeight:this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||d,subheaderLineHeight:S.height,subheaderPosition:1!==S.vertical?0:1,shouldResetScrollPosition:a,cellPadding:n,outerPadding:l,scrollPadding:5,getCellBackgroundColor:s,backgroundTransparency:p,gridLineSettings:x.gridLineSettings,getAllCells:function(){return y.multiples},manageTabIndexOnRowHeaderFooter:b,boldedSubheaders:S.labelBold},this.isSharedAxis&&(this.gridLayout.update(p),h=Math.ceil(h/o),this.sharedAxisLayout.update(this.options.axisRendererSettings,i,t,m,o,Math.max(h,r),this.featureSwitches),p.renderHeader=function(e){return g.sharedAxisLayout.renderAxes(e)},p.headerMargins=this.cellDimensions.headerMargins,p.subheaderHeight=this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||d),this.gridLayout.update(p),p=_.map(y.multiples,function(e){return e.getDataPoint()}),[2,this.gridLayout.render(this.cellDimensions,p,"multiples",this.visualInstanceId)]})})},g.prototype.renderGridCellSubheader=function(e,t,i){var a=e.element,r=e.index,o=e.viewport;if(!_.isUndefined(r)){var s=1===i.horizontal?"center":2===i.horizontal?"right":"left",n=this.getSubheaderFontProperties(r,i.fontProperties);a.css(w.FontProperties.toHTMLStyle(n)),a.css({padding:i.margins.top+"px "+i.margins.right+"px "+i.margins.bottom+"px "+i.margins.left+"px ","text-align":s});var l=this.getLocalizedString("ListJoin_Separator"),s=this.options.cartesianSmallMultipleFactory.reader.getDisplayNameForFrame(r),l=s&&s.join(""+l);if(a.attr("title",l),a.attr("id",this.visualInstanceId+"-"+r),a.empty(),i.titleWrap&&(this.cellDimensions&&this.cellDimensions.maxSubheaderHeight)>i.height+i.margins.top+i.margins.bottom)for(var n=w.FontProperties.toTextProperties(n),o=o.width,c=jsCommon.WordBreaker.splitByWidth(l,n,C.TextMeasurementService.measureSvgTextWidth,o,w.GridLayoutSubheaderMaxLines,null,!0),u=0;u<c.length;u++){var d=c[u],d=$("<div/>").text(d);u===c.length-1&&d.addClass("truncate"),a.append(d)}else a.text(l);this.interactivityService&&(t=t.get(r),this.featureSwitches.cartesianMultiplesAccessibility?(r=a.closest(w.GridLayoutSelectors.Cell.selector),e.styleSubheader(r,t,i.labelBold)):v.styleSubheader(a,t,i.labelBold))}},g.prototype.getSubheaderFontProperties=function(e,t){e=this.getColorFromMultipleObjects(e,{objectName:w.SmallMultiplesUtils.SubheaderObjectName,propertyName:"fontColor"});return null==e?t:w.FontProperties.inherit(t,{color:e})},g.prototype.getColorFromMultipleObjects=function(e,t,i){if(null!=e){e=null===(e=this.options.cartesianSmallMultipleFactory.reader.getFrameNode(e))||void 0===e?void 0:e.objects;if(e){t=C.DataViewObjects.getFillColor(e,t);if(t)return t}}return i},g.prototype.getAxesRenderOptions=function(e){var t=this,i={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}};return __assign(__assign({},e),{animationDuration:this.options.animationSettings.duration,ease:this.options.animationSettings.ease,playAxesRect:e.playAxisControlLayout,viewMode:this.viewMode,isSmallMultiples:!0,isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:!0,navigationScrollCallbacks:i})},g.prototype.renderGridCell=function(e,t,i,a,r,o,s,n,l,c,u){var d,h,p,g=this,y=t.viewport,m=e.get(t.index);2&m.getState()?m.getRenderer().attachToElement(t.element,t.viewport):(h=(d=w.CartesianChartLayout.addCartesianChartContainer(t.element,y)).element,p=null===(p=this.behaviorFactory)||void 0===p?void 0:p.create(),m.initRenderer(this.buildPlotAreaLayout(!0,h,d.clearCatcher,t.element,p))),this.interactivityService&&(p=t.element.closest(w.GridLayoutSelectors.Cell.selector),this.featureSwitches.cartesianMultiplesAccessibility?t.bindDataToGridCell(p,m,"multiple"):(v.attachMultipleInfoToGridCell(p,m),this.scheduledCellInteractivityUpdate||(this.scheduledCellInteractivityUpdate=setTimeout(function(){g.scheduledCellInteractivityUpdate=void 0,v.bindMultipleGridCells(g.container,e,g.interactivityService,u)})))),this.renderMultiple({multiple:m,viewport:y,background:i,axisZoom:void 0,chartAreaViewport:y,chartAreaMargins:w.CartesianChartLayout.getEmptyMargins(),renderedViewport:y,playAxisControlLayout:a,suppressAnimations:r,resizeMode:o,trimOrdinalDataOnOverflow:s,categoryLoadMoreDataHandler:n,isSharedAxis:!0,isHierarchicalAxis:l,preserveScrollPosition:c,supportsScrolling:!0,axesLayout:this.sharedAxisLayout.calculateAxesLayout()})},g.IconClassName="cartesianChartResponsiveIcon",w.CartesianSmallMultipleLayout=g,function(e){var a="multiple";e.attachMultipleInfoToGridCell=function(e,t){t&&e.data(a,t)},e.bindMultipleGridCells=function(e,t,i,a){i.bind(_.map(t.multiples,function(e){return e.getDataPoint()}),new r,{gridContainer:d3.select(e.get(0)),cells:e.find(w.GridLayoutSelectors.Body.selector+" "+w.GridLayoutSelectors.Cell.selector),multiples:t,boldedSubheaders:a},{pointSourceKey:"multiples",useSelectableDataPointForHasSelection:!0})};var r=(o.prototype.bindEvents=function(e,t,i){this.$cells=e.cells,this.boldedSubheaders=e.boldedSubheaders,this.$cells.each(function(){var e=$(this).data(a);e&&d3.select(this).select(w.GridLayoutSelectors.SubHeader.selector).on("click",function(){return w.InteractivityUtils.handleSelection(e.getDataPoint(),t)})}),e.gridContainer.on("click.selection",function(){w.InteractivityUtils.handleClearSelection(t,o.isValidClickTarget)})},o.prototype.renderSelection=function(e){var i=this.boldedSubheaders;this.$cells.each(function(){var e=$(this),t=e.data(a);t&&s(e,t,i)})},o.isValidClickTarget=function(e){var t=e.target;return!_.some(["scroll-bar","scroll-element_outer","scroll-element_track",w.GridLayoutSelectors.SubHeader.class],function(e){return t.classList.contains(e)})},o);function o(){}function s(e,t,i){i||d3.select(e.get(0)).select(w.GridLayoutSelectors.SubHeader.selector).style("font-weight",t.isSelected()?"700":"normal")}e.styleSubheader=s}(v=v||{})}(powerbi=powerbi||{}),function(w){!function(c){var x=w.data.createDataViewScopeIdentity,b=w.data.DataViewMatrixUtils,a=jsCommon.Lazy,C=w.data.SQExprBuilder,e=(t.prototype.ensureValueGroupAtSeriesIndex=function(e,t,i){var a;return e[t]||(a=this.getValueGroupName(i),a={identity:this.getSeriesIdentity(i),values:[],objects:this.getSeriesObjects(i),name:a},e[t]=a),e[t]},t);function t(){}var i,n=(__extends(r,i=e),r.prototype.setSource=function(e){e.source=this.matrix.columns.levels[0].sources[0]},r.prototype.getSeriesGroups=function(e,t){return e&&_.map(e,function(e){return _.isEmpty(e.children)?1:e.children.length})},r.prototype.getSeriesDataPoints=function(e){var t=this.matrix.columns.root;return _.filter(t.children,function(e){return!e.isSubtotal})},r.prototype.getValueGroupName=function(e){return e.value||e.levelValues&&e.levelValues[0].value},r.prototype.getSeriesObjects=function(e){return e.objects},r.prototype.getSeriesIdentity=function(e){return e.identity},r.prototype.getSeriesSourceColumn=function(e,t){return void 0===t&&(t=null),_.create(e,{groupName:t})},r.prototype.createValueColumnForMeasure=function(e,t,i,a,r){return t[r]||(a={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(i,a),objects:void 0},t[r]=a),t[r]},r);function r(e){var t=i.call(this)||this;return t.matrix=e,t}var o,l=(__extends(s,o=e),s.prototype.setSource=function(e){},s.prototype.getSeriesGroups=function(e,t){return t?[t]:[]},s.prototype.getSeriesDataPoints=function(e){return e},s.prototype.getValueGroupName=function(e){return e.displayName},s.prototype.getSeriesObjects=function(e){return e.objects},s.prototype.getSeriesIdentity=function(e){},s.prototype.getSeriesSourceColumn=function(e,t){return e},s.prototype.createValueColumnForMeasure=function(e,t,i,a,r){return t[r]||(a={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(i,a),objects:[]},t[r]=a),t[r]},s);function s(e){return o.call(this)||this}u.create=function(e,t){return new u(e,t)},u.prototype.getObjects=function(){return this.objects},u.prototype.getFrameDisplayNames=function(){return this._frameDisplayNames.getValue()},u.prototype.hasFrames=function(){var e=this.matrix.rows;return this.matrix&&0<this.frameCount&&!_.isEmpty(e.levels)&&!!this.getFrameSourceColumns()},u.prototype.getFrameCount=function(){return this.frameCount},u.prototype.getFrameSourceColumns=function(){return this.matrix.rows.levels[0].sources},u.prototype.getFrameNode=function(e){return this.matrix.rows.root.children[e]},u.prototype.getValueSources=function(e){if(e){e=this.hasCategories?1:0,e=this.matrix.rows.levels[e];return b.getScopedValueSources(e)}return this.matrix.valueSources},u.prototype.buildCategoricals=function(e,y,m,t,i){var v=this,e=this.matrix.rows.root.children[e];e.isSubtotal;var f=[];i.forEach(function(e,t){return f[t]={shouldReadScopedValues:!e&&v.hasSeries}});var S=i.map(function(e){return new(v.hasSeries&&e?n:l)(v.matrix)});f.forEach(function(e){e.allValueSources=v.getValueSources(e.shouldReadScopedValues)});for(var a=0;a<S.length;a++){var r=this.findUniqueFilteredValueSourcesAndIndices(f[a].allValueSources,t&&t[a]),o=r[0],r=r[1];f[a].requiredValueSources=o,f[a].requiredValueSourcesIndices=r,S[a].setSource(y[a].values);o=S[a].getSeriesDataPoints(o);f[a].seriesNodes=o;r=S[a].getSeriesGroups(o,r.length);f[a].seriesGroups=r,f[a].valueGroups=Array(r.length)}e=this.hasCategories?e.children:[e];b.forEachLeafNode(e,function(t,e,i){var a;if(!t.isSubtotal){v.hasCategories&&function(e,t){_.every(e,function(e){return 1===e.levelValues.length})&&e.length===t.length||1===e.length&&(e[0].levelValues.length,t.length);var i,a,r=_.last(e).objects,o=e[0];if(1<e.length){(a=new Array(e.length))[0]=o.levelValues[0].value;for(var s=o.identity.expr,n=1,l=e.length;n<l;n++)o=e[n],a[n]=o.levelValues[0].value,s=C.and(s,o.identity.expr);i=x(s)}else i=o.identity,a=_.map(o.levelValues,function(e){return e.value});for(var c=0,u=t.length;c<u;c++)t[c].identity.push(i),t[c].objects.push(r),t[c].values.push(a[c])}(i,m);for(var r=f.map(function(e){return e.shouldReadScopedValues?b.getNodeScopedValues(t):t.values}),o=0;o<f.length;o++)for(var s=f[o],n=0;n<s.seriesGroups.length;n++){for(var l=s.seriesNodes&&s.seriesNodes[n],c=s.seriesGroups[n],u=S[o].ensureValueGroupAtSeriesIndex(s.valueGroups,n,l),d=[],h=0;h<c;h++){var p=n*c+h,g=S[o].createValueColumnForMeasure(l,y[o].values,s.requiredValueSources[s.shouldReadScopedValues?p:h],u.name,p);v.hasSeries||(p=s.requiredValueSourcesIndices[p]);p=null===(a=null==r?void 0:r[o])||void 0===a?void 0:a[p];_.isEmpty(s.requiredValueSources)||v.readValues(p,g,e),d.push(g)}u.values=d}}});for(var s=this.hasSeries&&this.hasCategories&&_.isEmpty(f.filter(function(e){return!_.isEmpty(e.requiredValueSources)})),a=0;a<y.length;a++)w.data.DataViewTransform.setGrouped(y[a].values,f[a].valueGroups),_.isEmpty(f[a].requiredValueSources)&&(i[a]?s||(y[a].values=void 0):y[a]=void 0)},u.prototype.findUniqueFilteredValueSourcesAndIndices=function(i,a){if(_.isEmpty(i))return[[],[]];for(var r=[],o=[],s={},e=0;e<i.length;e++)!function(e){var t=i[e];!_.isEmpty(a)&&!_.some(a,function(e){return t.roles[e]})||s[t.queryName]||(r.push(e),o.push(t),s[t.queryName]=!0)}(e);return[o,r]},u.prototype.readCategories=function(){var e=this.matrix.rows;if(e.levels.length<=1||2===e.levels.length&&1<=e.levels[1].sources.length||2<=e.levels.length&&_.every(e.levels,function(e){return 1===e.sources.length}),this.hasCategories){e=[];return this.fillCategoriesMetadata(e),e}},u.prototype.fillCategoriesMetadata=function(e){this.hasCategories;for(var t=this.matrix.rows.levels,i=1;i<t.length;i++)for(var a=0,r=t[i].sources;a<r.length;a++){var o=r[a];e.push({source:o,values:[],identity:[],objects:[]})}},u.prototype.convertComboFrame=function(e){var t=c.ComboChart.getRoleGroups();return this.convertFrameInternal(e,t)},u.prototype.createEmptyCategorical=function(e){var t;return(t=e.values).push.apply(t,(t=this.matrix.valueSources,(_.isEmpty(t)?[]:_.map(t,function(e){return{identity:void 0,values:[],source:e,objects:[]}}))||[])),{metadata:this.sourceDataView.metadata,categorical:e}},u.prototype.convertFrame=function(e){return this.convertFrameInternal(e)[0]},u.prototype.checkValueRolesInList=function(e,t){for(var i=0,a=t;i<a.length;i++){var r=function(t){if(_.some(e,function(e){return t.roles[e]}))return{value:!0}}(a[i]);if("object"==typeof r)return r.value}return!1},u.prototype.validateValueRoles=function(e){var t;_.isEmpty(e)||(this.checkValueRolesInList(e,this.matrix.valueSources),(t=this.getValueSources(!0))&&this.checkValueRolesInList(e,t))},u.prototype.isForColumnValues=function(e){var t=c.ComboChart.getRoleGroups()[0];return _.isEmpty(e)||0<_.intersection(e,t).length},u.prototype.convertFrameInternal=function(e,t){var i,a=this,r=[],o=this.matrix,s=[];_.isEmpty(t)?s.push(!0):t.forEach(function(e){a.validateValueRoles(e),s.push(a.isForColumnValues(e))}),_.size(null===(i=null==o?void 0:o.rows)||void 0===i?void 0:i.levels);for(var n=[],l=_.isEmpty(t)?1:t.length,c=0;c<l;c++)n.push({categories:void 0,values:w.data.DataViewTransform.createValueColumns()});if(!this.hasCategories){for(var u=[],d=!0,c=0;c<n.length;c++)if(s[c]){if(!_.isEmpty(o.valueSources)&&this.hasRowChildren){d=!1;break}!this.hasSeries&&1!==n.length||(u[c]=this.createEmptyCategorical(n[c]))}else if(!_.isEmpty(this.getValueSources(this.hasSeries))){d=!1;break}if(d)return u}var h=this.readCategories();this.buildCategoricals(e,n,h,t,s);for(var p=0,g=n;p<g.length;p++){var y=g[p];y&&(y.categories=h,r.push({metadata:this.sourceDataView.metadata,categorical:y}))}return r},u.prototype.readValues=function(e,t,i){t.values||(t.values=[]),e?(t.values[i]=null==e.value?null:e.value,void 0!==e.highlight&&(t.highlights||(t.highlights=[]),t.highlights[i]=e.highlight),void 0!==e.objects&&(t.objects||(t.objects=[]),t.objects[i]=e.objects),void 0!==e.highlightObjects&&(t.highlightObjects||(t.highlightObjects=[]),t.highlightObjects[i]=e.highlightObjects)):t.values[i]=null},u.prototype.getDisplayNameFromAllFrames=function(){for(var e=new Array(this.frameCount),t=0;t<this.frameCount;t++){var i=this.getDisplayNameForFrame(t);e[t]=i}return e},u.prototype.getDisplayNameForFrame=function(e){var a=this,r=this.getFrameNode(e),e=this.getFrameSourceColumns(),o=new Array(e.length);return e.forEach(function(e,t){r.levelValues;var i=r.levelValues&&r.levelValues[t].value,e=new c.valueFormatter.VariantValueFormatter({column:e,formatStringPropId:a.formatStringPropId,nullsAreBlank:!0,trailingZeroes:!0});o[t]=e.format(i)}),o},u.prototype.getSubtotals=function(){var e=_.find(this.matrix.rows.root.children,function(e){return e.isSubtotal});if(e){for(var t=_.size(e.values),i=_.size(this.matrix.valueSources),a=t-i,r={},o=0;o<i;o++){var s,n=this.matrix.valueSources[o].roles,l=c.AxisHelper.normalizeNonFiniteNumber(e.values[a+o].value);for(s in n)r[s]=l}return r}},u.prototype.getTopLevelAggregates=function(e){for(var t={},i=0,a=this.sourceDataView.metadata.columns;i<a.length;i++){var r=a[i];if(r.roles&&r.aggregates)for(var o=0,s=e;o<s.length;o++){var n=s[o];r.roles[n]&&(t[n]=t[n]||[]).push(r.aggregates)}}return _.isEmpty(t)?void 0:t},e=u;function u(e,t){var i=this;this.sourceDataView=e,this.formatStringPropId=t,e&&e.metadata&&e.matrix,this.matrix=e.matrix;t=this.matrix.rows.root.children;this.hasRowChildren=!_.isEmpty(t),this.hasColChildren=!_.isEmpty(this.matrix.columns.root.children),this.hasSeries=this.hasColChildren&&!_.isEmpty(this.matrix.columns.levels)&&_.every(this.matrix.columns.levels[0].sources,function(e){return!e.isMeasure}),this.hasCategories=1<this.matrix.rows.levels.length&&this.hasRowChildren,this.objects=e.metadata.objects,this.frameCount=function(e){e=e.rows;return e.root.children?_.filter(e.root.children,function(e){return!e.isSubtotal}).length:0}(this.matrix),this._frameDisplayNames=new a(function(){return i.getDisplayNameFromAllFrames()})}c.DataViewMultipleReader=e}(w.visuals||(w.visuals={}))}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importCartesianChartsModule=function(){}}(es6=es6||{}),function(Ie){var ke;function e(e){this.options=e}ke=Ie.visuals||(Ie.visuals={}),e.prototype.convert=function(){var A,c,P=this.options,e=this.options,L=e.dataView,u=e.style,d=e.interactivityService,M=e.shouldCalculateStacked,V=e.isComboChart,t=e.forecastDataView,i=e.anomalyDetectionDataView,a=e.supportsTotalLabels,r=e.tooltipsEnabled,F=void 0===r||r,T=e.featureSwitches,r=ke.CartesianHelper.getCategoryAxisProperties(L.metadata),I=ke.CartesianHelper.isScalar(P.isScalar,r),k=L.categorical,e=ke.CartesianHelper.getScalarKeyinfo(k,I),O=e.category,N=e.useScalarKeys,R=e.scalarKeys;N&&((c=Ie.Prototype.inherit(O.source)).type={dateTime:!0});var B,H,o,s,n,U=ke.lineChartProps.general.formatString,e=ke.AxisHelper.getCategoryValueType(O.source,I),z=ke.AxisHelper.isDateTime(e),j=O.values,E=[],W=[],G=[],h=[],Y=k.values,X=!(!Y||!Y.source),p=ke.LineChart.getDefaultLineChartLabelSettings(u,P.isComboChart),K=ke.ColorHelper.create(u),Z=this.options.multipleInfo;Z&&(B=_.first(Z.sources).metadata.queryName,H=Z.sources.map(function(e){return ke.buildValueDetailsForColumnValue(e.metadata,e.value,Z.identity)}),o=(new ke.SelectionIdBuilder).withColumnIdentity(Z.identity,B,H).createSelectionId(),s=ke.FormattingStrategies.defaultFormatter(U),n=ke.DataViewConcatenateUtil.concatenateValues(_.map(Z.sources,function(e){return s(e.value,e.metadata)})));var q,$=!(Z&&Z.isCoreMultiple),J=V?["Y2"]:["Y","Y2"],Q=Ie.data.createDataViewCategoricalReaderAdvanced(L,{staticSeriesRoleNames:J,colorOptions:{visualStyle:u,valueRole:J[0],ignoreDefaultColor:P.isComboChart,ignoreDefaultCategoryColor:!0},formatStringProp:U,errorRangeProp:ke.ErrorObjectProps.errorRange});L.metadata&&L.metadata.objects&&(m=(q=L.metadata.objects).labels,ke.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(m,p,void 0,u,V));var ee,te,e=Ie.DataViewObjects.getValue(q,ke.lineChartProps.lineStyles.showMarker,!1),l=__assign(__assign({},p),{show:!1});a&&L.metadata&&L.metadata.objects&&((y=L.metadata.objects.totals)&&ke.DataLabelViewModel.updateLabelSettingsFromLabelsObject(y,l,!1,u,V)),Y&&(ee=Y.grouped()),M&&(te=Y&&0<Y.length?_.times(Y[0].values.length,function(){return 0}):[]);var g,y=!1,ie=Q.data,ae=Q.columns,re=ie.hasCategories()?ie.getCategoryCount():1,oe=ie.getSeriesCount(),se=Q.objects.getStaticObjects(),ne=ke.LineStyle.readFromStaticObjects(se,e,u),e=Ie.DataViewObjects.getValue(se,ke.lineChartProps.dataPoint.transparency,ke.LineChart.DefaultAreaTransparency),le=ae.getAllValueMetadataColumnsForRole(J[0]);2===J.length&&(le=__spreadArray(__spreadArray([],le||[]),ae.getAllValueMetadataColumnsForRole(J[1])||[]));var ce,ue=[],de=[],he=[];i&&I&&!M&&!V&&(ce=ke.AnomalyDetectionVisualPlugin.readDataView(i,L,u,U)).length;var pe=this.getSeriesName(Q,J),ge=ke.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings();if(_.some(J,function(e){return ie.hasValues(e)})){var ye=Q.columns.getSeriesCount(J[0]),y=!0,me=!1;null==g&&(g=X?ke.converterHelper.formatFromMetadataColumn(ie.getSeriesDisplayName(),ae.getSeriesMetadataColumn(),U):void 0);var m,ve=0,ge=ke.LineChart.getDefaultLineChartSeriesLabelSettings(u);L.metadata&&L.metadata.objects&&(m=(q=L.metadata.objects).seriesLabels,ke.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(m,ge,u,V),Te=ke.LineChart.getDefaultLineChartSeriesWidthSettings(ge.fontProperties,pe),ge.defaultSeriesWidth=ge.defaultSeriesWidth?Te:null,ge.seriesMaximumWidth=ge.defaultSeriesWidth?Te:ge.seriesMaximumWidth);for(var v=function(){ye<=ve&&(me=!0);var e,t=ae.getValueColumnBySeries(ve),g=ee&&ee[ve],y=he[ve]=t.source,m=[],i=ke.SelectionIdBuilder.builder().withSeries(Y,g,!0).withMeasure(y.queryName).createSelectionId(),v=i.getKey(),a=Q.colors.createBySeries(ve,void 0,ke.ForegroundColorName),r=u.isHighContrast?ke.ColorHelper.getThemeColor(u,ke.BackgroundColorName):a,o=void 0,s=void 0;(Q.data.hasSeries()||V)&&(n=void 0,e=(n=V&&!Q.data.hasSeries()?Q.objects.getValueMetadataObjectsBySeries(ve):Q.objects.getSeriesDataObjects(ve))&&n.labels,n=n&&n.seriesLabels,e&&(o=Ie.Prototype.inherit(p),ke.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(e,o,void 0,u,V)),n&&(s=Ie.Prototype.inherit(ge),ke.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(n,s,u,V)));var n=y.objects,f=ke.UncertaintyHelper.convertErrorMetadata(n,u,a,ve,__assign(__assign({},p),{show:!1}),{isCombo:V,staticObjects:se}),S=f.hasUncertainty,x=o||p,n=s||ge,b=t.highlights&&0<t.highlights.length,s=Ie.DataViewObjects.getValue(q,ke.lineChartProps.lineStyles.showSeries,!0),C=ke.LineStyle.readFromSeriesObjects(Q,ne,ve,s,u),w=-1,s=_.get(ce,ve),D=void 0;s&&(D=new ke.AnomalyDetectionVisualPlugin.AnomalyTooltipBuilder(P.host,s,y,U));for(var l=0;l<re;l++)!function(i){var e=j[i],t=void 0;t=N?(s=R.values[i])&&s.min:e;var a=ke.AxisHelper.normalizeNonFiniteNumber(b?ie.getHighlightBySeries(i,ve):ie.getValueBySeries(i,ve)),r=b?ie.getHighlightFormatStringBySeries(i,ve):ie.getFormatStringBySeries(i,ve);if(I&&(null==t||null==a))return;if(z&&null!=e&&!(e instanceof Date))return;if(w++,null==a&&0<ve)return;var o=void 0;S&&(o=ke.UncertaintyHelper.convertCategoricalDataPoint(ie,i,ve,a));var s,n=void 0,l=void 0,c=void 0;F&&(n=[],Z&&(s=new ke.LazyTooltipBuilder,e=ke.FormattingStrategies.defaultFormatter(U),s.withMultipleColumnAndValues(Z.sources.map(function(e){return e.metadata}),Z.sources.map(function(e){return e.value}),!0,e),n.push.apply(n,s.getTooltipItems())),O.source&&(c=ke.CategoryLevelUtils.getCategoryLevels(L.categorical.categories,i,U),d=ke.CategoryLevelUtils.concatenateCategoryLevels(c),n.push({displayName:d.displayName,value:d.value})),d=function(e){return ke.converterHelper.formatFromMetadataColumn(e,y,U,!1,r)},X&&(O.source&&O.source===Y.source||n.push({displayName:Y.source.displayName,value:ke.converterHelper.formatFromMetadataColumn(ee[ve].name,Y.source,U)})),null!=a&&(p=f.tooltips,S&&p.show&&p.format===ke.errorFormat.range?(void 0===(u=ke.UncertaintyHelper.getTooltipItems(o,a,f,d,P.host,{overrideDisplayName:y.displayName}))||u.length,_.isEmpty(u)?n.push({displayName:y.displayName,value:d(a)}):n.push(u[0])):n.push({displayName:y.displayName,value:d(a)})),S&&(V&&f.tooltips.format!==ke.errorFormat.range?n.push.apply(n,ke.UncertaintyHelper.getTooltipItems(o,a,f,d,P.host,{hideMarker:!0})):ke.UncertaintyHelper.setTooltipItems(o,a,f,d,P.host)),ke.TooltipBuilder.addTooltipMeasures(Q,l=[],i,X?ve:void 0,U),(p=null==D?void 0:D.getTooltipItems(i,r))&&l.push.apply(l,p),l=_.isEmpty(l)?void 0:l);var u=new ke.SelectionIdBuilder,d=ae.getCategoryColumn("Category"),h=null!==(A=k.originalCategories)&&void 0!==A?A:[O];ie.hasCategories()&&(u=u.withCategory(h,i,null===(A=null==d?void 0:d.source)||void 0===A?void 0:A.queryName,!0)),X&&(u=u.withSeries(Y,g,!0));var p=(u=Z?u.withColumnIdentity(Z.identity,B,H):u).withMeasure(y.queryName,ae.getValueColumn(me?J[1]:J[0],ve),i).createSelectionId(),d=O&&!_.isEmpty(O.identity)&&O.identity[i]?O.identity[i].key:i;de[i]||(de[i]={positive:0,negative:0,net:0,categoryValue:fe.convertCategoryValue(t,z,N,T),categoryIndex:i});u=Math.abs(a);isNaN(u)||(a<0?(de[i].net-=u,de[i].net<de[i].negative&&(de[i].negative=de[i].net)):(de[i].net+=u,de[i].net>de[i].positive&&(de[i].positive=de[i].net)));u=ke.DataLabelUtil.determineDataLabelFillColor(x.fontProperties.color,Q,i,ve),l={categoryValue:fe.convertCategoryValue(t,z,N,T),value:a,categoryIndex:i,seriesIndex:ve,tooltipInfo:n,selected:!1,identity:p,key:JSON.stringify({series:v,category:d}),labelFill:u,labelFormatString:r||y.format,labelSettings:x,uncertainty:o,additionalTooltipItems:l,hierarchyCategoryLevels:c,lineStyle:C,isY2:me};M&&(te[i]+=a,l.stackedValue=te[i]);c=ke.lineChartProps.dataPoint.fill,a=O.objects&&O.objects[i];a&&K.hasColorForProperty(a,c)&&(l.pointColor=K.getColorForProperty(a,c,void 0)),m[w]=l,E[i]||(E[i]=ke.CartesianHelper.extractCategoryFromDataPoint(l)),E[i]&&!E[i].hasData&&(E[i].hasData=null!=l.value);c=function(e){var t=(new ke.SelectionIdBuilder).withCategory(h,i,null===(t=null==O?void 0:O.source)||void 0===t?void 0:t.queryName,!0);return X||1!==oe||t.withMeasure(y.queryName),e&&Z&&t.withColumnIdentity(Z.identity,B,H),t};ie.hasCategories()&&(W[i]||(l=c(!1),W[i]=l.createSelectionId()),G[i]||(c=c(!0),G[i]=c.createSelectionId()))}(l);s=_.findIndex(le,y);-1!==s&&(ue[s]?ue[s].usedInSeriesIndices.push(ve):ue[s]={metadataColumn:y,usedInSeriesIndices:[ve],valueSelector:(new ke.SelectionIdBuilder).withMeasure(y.queryName,t).createSelectionId()}),d&&d.applySelectionStateToData(_.filter(m,function(e){return null!=e})),(0<m.length||!$)&&h.push({seriesName:pe[ve],key:v,lineIndex:ve,color:a,areaColor:r,xCol:N?c:O.source,yCol:y,data:m,identity:i,selected:!1,uncertainty:f,labelSettings:o,seriesSettings:n,type:y.type,lineStyle:C,isY2:me})},fe=this;ve<oe;ve++)v();if(M&&P.host&&P.tooltipsEnabled&&l.show)for(var f=P.host.getLocalizedString("Visual_Total"),S=[],x=0;x<oe;x++)if(h[x])for(var b=h[x].data,C=he[x],w=0;w<b.length;w++){var D,Se=h[x].data[w];Se&&(D=void 0,Ae=Se.categoryIndex,de[Ae].labelFill=ke.DataLabelUtil.determineTotalLabelFillColor(l.fontProperties.color,Q,Ae,x),S[Ae]||(S[Ae]={net:{displayName:f,value:ke.converterHelper.formatFromMetadataColumn(de[Ae].net,C,U,!1)}}),D=S[Ae].net,h[x].data[w].tooltipInfo||(h[x].data[w].tooltipInfo=[]),h[x].data[w].tooltipInfo.push(D),h[x].data[w].additionalTooltipItems||(h[x].data[w].additionalTooltipItems=[]),h[x].data[w].additionalTooltipItems.push(D))}}if(t&&I&&!M&&!V)for(var xe=ke.ForecastHelper.readDataView(t,L,u),be=_.last(E),Ce=0,we=xe;Ce<we.length;Ce++)for(var De=we[Ce],Ae=be.categoryIndex,Pe=0,Le=De.points;Pe<Le.length;Pe++){var Me=Le[Pe];Me.point.x=this.convertCategoryValue(Me.point.x,z,N,T),Me.upperBound.x=this.convertCategoryValue(Me.upperBound.x,z,N,T),Me.lowerBound.x=this.convertCategoryValue(Me.lowerBound.x,z,N,T);var Ve,Fe=Me.point.x;Fe<=be.categoryValue||(Ae++,Ve=ke.CategoryLevelUtils.getCategoryLevels(L.categorical.categories,Ae,U),E[Ae]||(E[Ae]={categoryIndex:Ae,categoryValue:Fe,hasData:null!=Me.point.y,hierarchyCategoryLevels:Ve}),W[Ae]||(W[Ae]=null),G[Ae]||(G[Ae]=null))}var Te=!1,t=L.metadata&&L.metadata.dataReduction;t&&t.categorical&&(t.categorical.metadata&&t.categorical.metadata.binnedLineSample||t.categorical.categories&&t.categorical.categories.binnedLineSample||t.categorical.values&&t.categorical.values.binnedLineSample)&&(Te=!0);r=ke.CartesianHelper.getCategoryAxisProperties(L.metadata),r=ke.CartesianHelper.getPreferredCategoryWidth(r);return d&&d.applySelectionStateToData(h),{series:h,totals:de,forecastLines:xe,anomalyDetections:ce,isScalar:I,dataLabelsSettings:p,totalLabelsSettings:l,seriesLabelSetings:ge,hasDynamicSeries:X,hasY2Role:Ie.data.DataRoleHelper.hasRoleInDataView(L,"Y2"),categoryMetadata:O.source,valuesMetadata:le,valuesMetadataBySeries:ue,preferredCategoryWidth:r,scalarMetadata:c,scalarKeyCount:N?R.values.length:void 0,categories:j,categoryData:E,seriesDisplayName:g,hasValues:y,categoryIdentities:W,multiplesCategoryIdentities:G,lineStyle:ne,binnedLineSamplingApplied:Te,legendMarkerRendering:Ie.DataViewObjects.getValue(se,ke.lineChartProps.legend.legendMarkerRendering,null!=T&&T.removeDefaultToCircleToggle?ke.legendMarkerRendering.markerCircleDefault:ke.legendMarkerRendering.markerOnly),matchLineColor:Ie.DataViewObjects.getValue(se,ke.lineChartProps.legend.matchLineColor,!0),defaultToCircle:Ie.DataViewObjects.getValue(se,ke.lineChartProps.legend.defaultToCircle,!0),isComboChart:V,multipleIdentity:o,multipleDisplayName:n,areaTransparency:e}},e.prototype.getSeriesName=function(e,t){for(var i=[],a=0,r=e.data.getSeriesCount();a<r;a++)e.columns.hasDynamicSeries()?i[a]=ke.valueFormatter.format(e.data.getSeriesName(a),e.objects.getSeriesFormatString(a)):e.columns.hasStaticSeries()?i[a]=e.data.getSeriesName(a):i[a]=e.data.getValueDisplayName(t[0]);return i},e.prototype.convertCategoryValue=function(e,t,i,a){return e&&(t||i)?Ie.FeatureSwitchedDate.getEpochTimeStamp(a.utcDates,e):e},ke.LineChartConverter=e}(powerbi=powerbi||{}),function(e){(e.visuals||(e.visuals={})).initializeCartesianChartsFactoryES6=function(){e.visuals.setCreateCartesianChart(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChart(t)})}),e.visuals.setCreateWebColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWebColumnChartAnimator(t)})}),e.visuals.setCreateRealTimeLineChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createRealTimeLineChartAnimator(t)})}),e.visuals.setCreateDashboardColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDashboardColumnChartAnimator(t)})}),e.visuals.setCreateCartesianChartBehaviorFactory(function(t,i){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChartBehaviorFactory(t,i)})}),e.visuals.setCreateColumnChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createColumnChartWebBehaviorFactory()})}),e.visuals.setCreateDataDotChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDataDotChartWebBehaviorFactory()})}),e.visuals.setCreateLineChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createLineChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartWebBehaviorFactory()})}),e.visuals.setCreateWaterfallChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWaterfallChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartMobileBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartMobileBehaviorFactory()})})}}(powerbi=powerbi||{}),function(Le){Le.waterfallConverterModuleFactory=function(){var r=Le.data,d=Le.visuals,me=d.AxisHelper,ve=d.CartesianHelper,fe=d.ColorHelper,Se=d.converterHelper,xe=r.DataRoleHelper,be=d.ForegroundColorName,h=jsCommon.Lazy,Ce=Le.visuals.SelectionId,we=r.Selector,o=r.SQExprBuilder,p=jsCommon.StringExtensions,De=Le.visuals.WaterfallChart,Ae=Le.visuals.waterfallChartProps;function e(e){var t,i=e.dataView,o=e.hostServices,s=e.dataLabelSettings,n=e.sentimentColors,a=e.interactivityService,l=e.tooltipsEnabled,r=e.numberOfBreakdowns,c=i.matrix,u=!_.isEmpty(c.columns.levels)&&c.columns.levels[0].sources[0],d=!_.isEmpty(c.rows.levels)&&c.rows.levels[0].sources,h=_.findIndex(c.valueSources,function(e){return xe.hasRole(e,"Y")}),p=c.valueSources[h],g=_.filter(c.valueSources,function(e){return xe.hasRole(e,"Tooltips")}),y=[],m=[],v={current:0,min:0,max:0},f=0,S=null===(S=null==i?void 0:i.metadata)||void 0===S?void 0:S.objects,x=!0;if(u||(x=Le.DataViewObjects.getValue(S,Ae.valueAxis.totalsEnabled,!0)),u&&d&&p){xe.hasRole(u,"Breakdown"),_.every(d,function(e){return xe.hasRole(e,"Category")});var b=new Pe(u,d,p),C=p.format,w=o.getLocalizedString("Waterfall_OtherLabel"),D=De.formatStringProp,A=c.rows.root.children,P=c.columns.root.children;if(!_.isEmpty(A)&&!_.isEmpty(P)){var L=A.length,M=P.length,V=0,F=void 0,T=void 0,I=_.size(g)+1;0<L&&(f=_.size(A[0].values)/I-1);for(var r=Math.min(r,f),k=0;k<L;k++){for(var O=void 0,N=A[k],R=0<k?A[k-1]:void 0,B=_.map(N.levelValues,function(e){return e.value}),H=_.map(B,function(e,t){return Se.formatFromMetadataColumn(e,d[t],D)}).join(" "),U=b.splitIdentity(N.identity.expr),z=[],j=_.size(N.values),E=0;E<j;E+=I){for(var W,G=void 0,Y=void 0,X=void 0,K=[],Z=[],q=0;q<I;q++)q===h?(W=N.values[E+q],G=me.normalizeNonFiniteNumber(W.value),X=Le.DataViewObjects.getValue(W.objects,D),O=O||X,Y=R&&me.normalizeNonFiniteNumber(R.values[E+q].value)):(K.push(N.values[E+q].value),Z.push(R&&R.values[E+q].value));z.push({key:E,currentValue:G,previousValue:Y,difference:(G||0)-(Y||0),column:P[E/I],currentTooltipValues:K,previousTooltipValues:Z,formatString:X})}var z=_.sortBy(z,function(e){return-1*Math.abs(e.difference)}),$=_.chain(z).filter(function(e){return!e.column.isSubtotal}).take(r).sortBy(function(e){return-1*e.difference}).value(),J=_.find(z,function(e){return e.column.isSubtotal}),Q=J.currentValue,ee=J.previousValue;if(R){var te=_.sumBy($,function(e){return e.currentValue}),ie=_.sumBy($,function(e){return e.previousValue}),ae=_.chain($).map(function(e){return b.splitIdentity(e.column.identity.expr)}).flatten().value(),re=r+1<M,oe=0,se=void 0,ne=void 0;if(re){var le=Q-te,ce=ee-ie,oe=le-ce,se=b.createBreakdownOtherIdentity(ae,U,T);if(l){for(var ne=b.createBreakdownTooltip(H,F,w,le,ce,oe,D,o),ue=[],de=[],he=0;he<J.currentTooltipValues.length;he++)!function(t){var e=J.currentTooltipValues[t],i=J.previousTooltipValues[t];_.isNumber(e)&&_.isNumber(i)&&(e=e-_.sumBy($,function(e){return e.currentTooltipValues[t]}),i=i-_.sumBy($,function(e){return e.previousTooltipValues[t]}),ue.push(e-i),de.push(i))}(he);De.appendTooltipMeasures(ue,void 0,ne,g,D,o,de,H,F)}}for(var pe=!1,ge=0,ye=$;ge<ye.length;ge++)!function(i){re&&oe>i.difference&&!pe&&(pe=!0,y.push(De.createDataPoint(oe,v.current,n,w,V++,se,ne,s.fontProperties.color,C||O,3,{text:!0})),m.push(w),v=De.getNewPositionContext(v,oe));var e=Se.formatFromMetadataColumn(i.column.value,u,D),t=b.splitIdentity(i.column.identity.expr),a=b.createBreakdownIdentity(U,T,t),r=void 0;l&&(r=b.createBreakdownTooltip(H,F,e,i.currentValue,i.previousValue,i.difference,D,o),t=_.map(i.currentTooltipValues,function(e,t){return _.isNumber(e)?e-i.previousTooltipValues[t]:e}),De.appendTooltipMeasures(t,void 0,r,g,D,o,i.previousTooltipValues,H,F)),y.push(De.createDataPoint(i.difference,v.current,n,e,V++,a,r,s.fontProperties.color,i.formatString||C,0,{text:!0})),m.push(e),v=De.getNewPositionContext(v,i.difference)}(ye[ge]);re&&!pe&&(pe=!0,y.push(De.createDataPoint(oe,v.current,n,w,V++,se,ne,s.fontProperties.color,C||O,3,{text:!0})),m.push(w),v=De.getNewPositionContext(v,oe))}x&&(ce={dataMap:((le={})[d[0].queryName]=[N.identity],le),metadata:[p.queryName]},le=we.convertSelectorsByColumnToSelector(ce),le=new Ce(le,!1,ce),ce=void 0,l&&(ce=De.createCategoryTooltip(d,p,B,Q,void 0,D),De.appendTooltipMeasures(J.currentTooltipValues,void 0,ce,g,D,o)),y.push(De.createDataPoint(Q,0,n,H,V++,le,ce,s.fontProperties.color,C||O,2,{text:!0})),m.push(H)),0===k&&(v={current:Q,max:Q,min:Q}),F=H,T=U}}}a&&a.applySelectionStateToData(y),e.style.isHighContrast&&(t={visible:!0,color:fe.getThemeColor(e.style,be),width:ve.defaultLineStrokeWidth});a=ve.getCategoryAxisProperties(i.metadata,void 0),i=ve.getPreferredCategoryWidth(a),a=_.map(y,function(e){return function(){return e.identity}});return{series:[{data:y,type:p&&p.type}],categories:m,categoryIdentities:a,categoryMetadata:d[0],preferredCategoryWidth:i,valuesMetadata:c.valueSources,legend:De.createLegend(n,o,S,e.style,!0,x),hasHighlights:!1,positionMin:v.min,positionMax:v.max,dataLabelsSettings:s,sentimentColors:n,isBreakdown:!0,numberOfBreakdowns:r,totalBreakdownCategories:f,strokeSettings:t}}var Pe=(t.prototype.splitIdentity=function(e){return r.ScopeIdentityExtractor.getKeyValuePairs(e)},t.prototype.createBreakdownIdentity=function(e,t,i){var i={dataMap:((a={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.inValues(__spreadArray(__spreadArray([],_.map(e,function(e){return e.left})),_.map(i,function(e){return e.left})),[__spreadArray(__spreadArray([],_.map(t,function(e){return e.right})),_.map(i,function(e){return e.right})),__spreadArray(__spreadArray([],_.map(e,function(e){return e.right})),_.map(i,function(e){return e.right}))]))],a),metadata:[this.valueMetadata.queryName]},a=we.convertSelectorsByColumnToSelector(i);return new Ce(a,!1,i)},t.prototype.createBreakdownOtherIdentity=function(e,t,i){var a={dataMap:((a={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.not(o.inValues([this.breakdownMetadata.expr],_.map(e,function(e){return[e.right]}))))],a),metadata:[this.valueMetadata.queryName]};a.dataMap[this.categoryMetadata[0].queryName]=[r.createDataViewScopeIdentity(o.inValues(_.map(t,function(e){return e.left}),[_.map(i,function(e){return e.right}),_.map(t,function(e){return e.right})]))];t=we.convertSelectorsByColumnToSelector(a);return new Ce(t,!1,a)},t.prototype.createBreakdownTooltip=function(e,t,i,a,r,o,s,n){var l,c=this,u=new d.LazyTooltipBuilder;return this.breakdownMetadata&&u.withLazyValue(new h(function(){return{displayName:c.breakdownMetadata.displayName,value:Se.formatFromMetadataColumn(i,c.breakdownMetadata,s)}})),this.valueMetadata&&(null!=r&&u.withLazyValue(new h(function(){return{displayName:t+" "+c.valueMetadata.displayName,value:Se.formatFromMetadataColumn(r,c.valueMetadata,s,!1)}})),null!=a&&u.withLazyValue(new h(function(){return{displayName:e+" "+c.valueMetadata.displayName,value:Se.formatFromMetadataColumn(a,c.valueMetadata,s,!1)}})),null!=o&&(l=Se.formatFromMetadataColumn(o,this.valueMetadata,s,!1),l=De.createPercentTooltipValue(l,o,r),u.withLazyValue(new h(function(){return{displayName:p.format(n.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),c.valueMetadata.displayName),value:l}})))),u},t);function t(e,t,i){this.breakdownMetadata=e,this.categoryMetadata=t,this.valueMetadata=i}return{matrixConverter:e}}}(powerbi=powerbi||{}),function(e){var i;function t(e,t){switch(this.layerType=e){case 5:this.adapter=new i.ColumnChartLayerViewModelAdapter(t);break;case 0:this.adapter=new i.LineChartLayerViewModelAdapter(t);break;case 2:this.adapter=new i.ScatterChartLayerViewModelAdapter(t);break;case 3:this.adapter=new i.WaterfallChartLayerViewModelAdapter(t)}}i=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.adapter.getData()},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){return this.adapter.addWarnings(e)},i.CartesianLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){var i;function t(e){this.smallMultiplesResponsive=e}i=e.visuals||(e.visuals={}),t.prototype.createCartesianAdapter=function(e){return this.isSmallMultiples()?new i.SmallMultiplesCartesianViewModelAdapter(e,this.smallMultiplesOptions,this.smallMultiplesResponsive):new i.CartesianViewModelAdapter(e)},t.prototype.createLayerAdapter=function(e,t){return this.isSmallMultiples()?new i.SmallMultiplesLayerViewModelAdapter(e,t,this.smallMultiplesResponsive):new i.CartesianLayerViewModelAdapter(e,t)},t.prototype.setSmallMultiplesOptions=function(e){this.smallMultiplesOptions=e},t.prototype.createSmallMultiplesAdapter=function(e){if(this.isSmallMultiples())return new i.SmallMultiplesViewModelAdapter(e,this.smallMultiplesResponsive)},t.prototype.isSmallMultiples=function(){return this.smallMultiplesOptions&&this.smallMultiplesOptions.isSmallMultiples},i.ResponsiveCartesianAdapterFactory=t}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.dataView=e.dataView,this.viewport=e.viewport}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 5},e.prototype.addWarnings=function(e){var t,i=this.originalData,a=this.currentData;i&&a&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(i,a),a=this.responsiveFontHelper.getFontSizeLabelWarning(i.totalLabelsSettings,a.totalLabelsSettings),t&&e.addForVisualObject("labels",t),a&&e.addForVisualObject("totals",a))},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var i,a=t.series=o.Prototype.inherit(t.series),r=0;r<a.length;r++)a[r].labelSettings&&((i=a[r]=o.Prototype.inherit(a[r])).labelSettings=o.Prototype.inherit(i.labelSettings),this.updateLabelSettings(e,i.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){var i=t.fontProperties;t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties),i!==t.fontProperties&&(t.labelOverflow=!0)},t.ColumnChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 0},e.prototype.addWarnings=function(e){var t,i=this.originalData,a=this.currentData;i&&a&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(i,a),a=this.responsiveFontHelper.getFontSizeLabelWarning(i.totalLabelsSettings,a.totalLabelsSettings),t&&e.addForVisualObject("labels",t),a&&e.addForVisualObject("totals",a))},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var i,a=t.series=o.Prototype.inherit(t.series),r=0;r<a.length;r++)a[r].labelSettings&&((i=a[r]=o.Prototype.inherit(a[r])).labelSettings=o.Prototype.inherit(i.labelSettings),this.updateLabelSettings(e,i.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties)},t.LineChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(a){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=a.visuals||(a.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 2},e.prototype.addWarnings=function(e){var t=this.originalData,i=this.currentData;t&&i&&((i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,i.dataLabelsSettings))&&e.addForVisualObject("categoryLabels",i))},e.prototype.applyResponsiveChanges=function(e,t){t=a.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=a.Prototype.inherit(t.dataLabelsSettings);var i=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,i)},t.ScatterChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(a){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=a.visuals||(a.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 3},e.prototype.addWarnings=function(e){var t=this.originalData,i=this.currentData;t&&i&&((i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,i.dataLabelsSettings))&&e.addForVisualObject("labels",i))},e.prototype.applyResponsiveChanges=function(e,t){t=a.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=a.Prototype.inherit(t.dataLabelsSettings);var i=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,i)},t.WaterfallChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(e){!function(o){function r(e){var t=e.columns,e=e.rows;return{legendPositionHeight:120+30*e,legendPositionWidth:210+40*t,legendShowHeight:90+30*e,legendShowWidth:90+40*t,removeXAxisTitleHeight:165+30*e,removeXAxisHeight:120+30*e,removeYAxisTitleWidth:210+40*t,removeYAxisWidth:120+40*t}}o.calculateSMCartesianAdapterBreakpoints=r;var e=(t.prototype.getData=function(){var e=this.cartesianData,t=this.smallMultiplesOptions.isSmallMultiples;return this.smallMultiplesResponsive&&t&&o.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,o.cartesianChartProps).responsive?this.applyResponsiveChanges(this.cartesianData,this.smallMultiplesOptions):e},t.prototype.enumerateObjectInstances=function(e,t,i){},t.prototype.getResponsiveSlice=function(e,t,i){},t.prototype.applyResponsiveChanges=function(e,t){var i=o.ViewModelAdapterUtils.cloneData(e),a=r(t),t=t.viewport;return this.applyAxesResponsiveChanges(a,t,i),this.applyLegendResponsiveChanges(a,t,i),this.applyFontSizeReponsiveChanges(t,i),this.isCoreMultiple&&o.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(i,e),i},t.prototype.applyAxesResponsiveChanges=function(e,t,i){var a=t.height,t=t.width;a<e.removeXAxisTitleHeight&&(i.axesData.x.showAxisTitle=!1),a<e.removeXAxisHeight&&(i.axesData.x.show=!1,i.axesData.x.showAxisTitle=!1),t<e.removeYAxisTitleWidth&&(i.axesData.y.showAxisTitle=!1,i.axesData.y2.showAxisTitle=!1),t<e.removeYAxisWidth&&(i.axesData.y.show=!1,i.axesData.y2.show=!1,i.axesData.y.showAxisTitle=!1,i.axesData.y2.showAxisTitle=!1)},t.prototype.applyLegendResponsiveChanges=function(e,t,i){var a,r;i.legendData.show&&(a=t.height,r=t.width,t=i.legendData.position,(a<e.legendPositionHeight||r<e.legendPositionWidth)&&o.Legend.isLeftOrRight(t)&&(i.legendData.position=o.LegendPosition.Top),(a<e.legendShowHeight||r<e.legendShowWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0)},t.prototype.applyFontSizeReponsiveChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},t);function t(e,t,i){this.smallMultiplesOptions=t,this.smallMultiplesResponsive=i,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.isCoreMultiple=e.isCoreMultiple,this.responsiveFontHelper=new o.ResponsiveCartesianFontHelper}o.SmallMultiplesCartesianViewModelAdapter=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(e){function t(e,t,i){this.layerType=e,this.smallMultiplesResponsive=i,this.layerData=t.data}e=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.smallMultiplesResponsive,this.layerData},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){},e.SmallMultiplesLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){!function(n){function o(e,t,i){return e[0],e[1],t[0],t[1],d3.scaleLinear().range(t).domain(e).clamp(!0)(i)}function s(e){var t=e.rowCount,e=e.columnCount;return{showIconHeight:30*e,showIconWidth:40*t,showSubheaderHeight:80+50*t,gridlineRowUpperBreakpoint:120+52*t,gridlineRowLowerBreakpoint:120+32*t,gridlineColumnUpperBreakpoint:120+62*e,gridlineColumnLowerBreakpoint:120+42*e,removeGridLineHeight:32*t,removeGridLineWidth:42*e,paddingRowUpperBreakpoint:120+130*t,paddingRowLowerBreakpoint:120+30*t,paddingColumnUpperBreakpoint:120+140*e,paddingColumnLowerBreakpoint:120+40*e}}n.interpolateValueFromBreakpoints=o,n.calculateSmallMultiplesViewModelAdapterBreakpoints=s;var e=(t.prototype.getMultiplesLayout=function(e){var t=this.multiplesLayout;return this.smallMultiplesResponsive&&n.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,n.cartesianChartProps).responsive?this.applyResponsiveChanges(this.viewport,this.multiplesLayout,e):t},t.prototype.getMultiplesSubheader=function(e){var t=this.multiplesSubheader;return this.smallMultiplesResponsive&&n.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,n.cartesianChartProps).responsive?this.applySubheaderResponsiveChanges(this.viewport,t,e):t},t.prototype.enumerateObjectInstances=function(e,t,i){this.smallMultiplesResponsive&&i&&"general"===e.objectName&&this.enumerateGeneral(t,this.dataView)},t.prototype.enumerateGeneral=function(e,t){t={selector:null,properties:{responsive:n.ViewModelAdapterUtils.getResponsiveVisualProperties(t,n.cartesianChartProps).responsive},objectName:"general"};e.pushInstance(t)},t.prototype.getResponsiveSlice=function(e,t,i){if(t){t=n.cartesianChartProps.general,e=n.ViewModelAdapterUtils.getResponsiveVisualProperties(e,n.cartesianChartProps);return{item:new n.builder.SimpleFormattingSliceBuilder({uidBuilder:new n.builder.FormattingSliceUidBuilder(new n.builder.FormattingGroupUidBuilder(new n.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new n.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:i}).build(),revertToDefaultDescriptors:[t.responsive]}}},t.prototype.applyResponsiveChanges=function(e,t,i){var a=n.ViewModelAdapterUtils.cloneData(t),r=s(a);return this.applyIconResponsiveChanges(r,e,a),this.applyGridlinesResponsiveChanges(r,e,a),this.applyPaddingResponsiveChanges(r,e,a),this.updateResponsiveWarnings(a,t,i),a},t.prototype.applyIconResponsiveChanges=function(e,t,i){(t.height<e.showIconHeight||t.width<e.showIconWidth)&&(i.showIcon=!0)},t.prototype.applyGridlinesResponsiveChanges=function(e,t,i){var a=i.gridLineWidth,r=i.gridLineWidth;null!=i.gridLineWidth&&(t.height<e.removeGridLineHeight||t.width<e.removeGridLineWidth?i.gridLineWidth=0:t.height<=e.gridlineRowLowerBreakpoint||t.width<=e.gridlineColumnLowerBreakpoint?i.gridLineWidth=1:(t.height<e.gridlineRowUpperBreakpoint&&(r=Math.ceil(o([e.gridlineRowUpperBreakpoint,e.gridlineRowLowerBreakpoint],[i.gridLineWidth,1],t.height))),t.width<e.gridlineColumnUpperBreakpoint&&(a=Math.ceil(o([e.gridlineColumnUpperBreakpoint,e.gridlineColumnLowerBreakpoint],[i.gridLineWidth,1],t.width))),i.gridLineWidth=Math.min(a,r)))},t.prototype.applyPaddingResponsiveChanges=function(e,t,i){var a;!i.advancedPaddingOptions&&0===i.gridPadding||(t.height<e.paddingRowUpperBreakpoint&&(a=[e.paddingRowUpperBreakpoint,e.paddingRowLowerBreakpoint],i.rowPaddingOuter=i.rowPaddingOuter&&Math.ceil(o(a,[i.rowPaddingOuter,1],t.height)),i.rowPaddingInner=i.rowPaddingInner&&Math.ceil(o(a,[i.rowPaddingInner,1],t.height))),t.width<e.paddingColumnUpperBreakpoint&&(a=[e.paddingColumnUpperBreakpoint,e.paddingColumnLowerBreakpoint],i.columnPaddingOuter=i.columnPaddingOuter&&Math.ceil(o(a,[i.columnPaddingOuter,1],t.width)),i.columnPaddingInner=i.columnPaddingInner&&Math.ceil(o(a,[i.columnPaddingInner,1],t.width))))},t.prototype.applySubheaderResponsiveChanges=function(e,t,i){var a=n.ViewModelAdapterUtils.cloneData(t),r=s(this.multiplesLayout);return e.height<r.showSubheaderHeight&&(a.show=!1),a.show&&a.fontProperties&&(a.fontProperties=this.responsiveFontHelper.adjustFontSize(e,a.fontProperties),a.height=a.fontProperties.size.px+a.margins.top+a.margins.bottom),this.updateSubheaderResponsiveWarnings(a,t,i),a},t.prototype.updateResponsiveWarnings=function(e,t,i){var a,r=i,o={};for(a in e.showIcon?o.subheader=new n.SmallMultiplesSubheadersNotRenderedWarning:(e.rowPaddingInner===t.rowPaddingInner&&e.rowPaddingOuter===t.rowPaddingOuter&&e.columnPaddingInner===t.columnPaddingInner&&e.columnPaddingOuter===t.columnPaddingOuter||(o.smallMultiplesLayout=new n.SmallMultiplesPaddingSizeWarning),e.gridLineWidth!==t.gridLineWidth&&(o.smallMultiplesLayout=new n.SmallMultiplesGridlinesSizeWarning)),o){var s=o[a];r.addForVisualObject(a,{selector:null,warnings:[s]})}},t.prototype.updateSubheaderResponsiveWarnings=function(e,t,i){var a,r=i,o={};for(a in e.show!==t.show&&(o.subheader=new n.SmallMultiplesSubheadersNotRenderedWarning),_.isEqual(e.fontProperties.size,t.fontProperties.size)||(o.subheader=new n.SmallMultiplesSubheadersFontSizeWarning),o){var s=o[a];r.addForVisualObject(a,{selector:null,warnings:[s]})}},t);function t(e,t){this.smallMultiplesResponsive=t,this.multiplesLayout=e.multiplesLayout,this.multiplesSubheader=e.multiplesSubheader,this.dataView=e.dataView,this.viewport=e.viewport,this.responsiveFontHelper=new n.ResponsiveCartesianFontHelper}n.SmallMultiplesViewModelAdapter=e}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
