"use strict";var powerbi,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,n,s,l){return new(s=s||Promise)(function(i,t){function o(e){try{a(l.next(e))}catch(e){t(e)}}function r(e){try{a(l.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}a((l=l.apply(e,n||[])).next())})},__generator=this&&this.__generator||function(i,o){var r,a,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(n=2&t[0]?a.return:t[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,t[1])).done)return n;switch(a=0,(t=n?[2&t[0],n.value]:t)[0]){case 0:case 1:n=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(n=0<(n=s.trys).length&&n[n.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!n||t[1]>n[0]&&t[1]<n[3])){s.label=t[1];break}if(6===t[0]&&s.label<n[1]){s.label=n[1],n=t;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(t);break}n[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(i,s)}catch(e){t=[6,e],a=0}finally{r=n=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(e){var t,i;t=e.dataServices||(e.dataServices={}),(i=t.constants||(t.constants={})).contentPackDirtyShowNotification="contentPackDirty",i.reportDeletedEventName="reportDeleted",i.onDatasetAddedEventName="onDatasetAdded",i.deleteModelFailedEventName="deleteModelFailed",i.deleteModelStartedEventName="deleteModelStarted",i.onDashboardShallowEditEventName="onDashboardShallowEdit",i.mergeDashboardContainerModelsReportsAndPackagesEventName="mergeDashboardContainerModelsReportsAndPackages",i.updateDashboardContainerEventName="updateDashboardContainer",i.addOrUpdateDashboardEventName="addOrUpdateDashboard",i.samplesContentProviderId=-1,i.initialDashboardContainerLoadingState="#loading#",i.initialDashboardContainerErrorState="#error#",i.initialDashboardContainerReadyEventName="initialDashboardContainerReady",i.CannotDeleteModelPublishedToOrganizationalAppHeader="CannotDeleteModelPublishedToOrganizationalApp",i.seenDashboardsStorageKey="seenSharedDashboards",i.ScopedInstanceProviderName="dataServices",i.dashboardElementName=".dashboard",(t=i.workbook||(i.workbook={})).reloadExcelWorkbookEventName="reloadExcelWorkbook",t.pinClickedEventName="pinClicked",t.editInExcelOnlineClickedEventName="editInExcelOnlineClicked",t.editInExcelClickedEventName="editInExcelClicked",t.calculateWorkbookClickedEventName="calculateWorkbookClicked",t.openWorkbookContextMenuEventName="openWorkbookContextMenu",t.viewWorkbookEventName="viewWorkbook",t.renameWorkbookEventName="renameWorkbook",t.editWorkbookEventName="editWorkbook",t.scheduleRefreshWorkbookEventName="scheduleRefreshWorkbook",t.refreshNowWorkbookEventName="refreshNowWorkbook",t.removeWorkbookEventName="removeWorkbook",t.excelWebAppScriptsLoaded="excelWebAppScriptsLoaded",t.defaultKeepOriginalContentSize=!1,i.SingleValueRealTimeWindow=250,i.MultipleValueRealTimeWindow=6e4,i.RealTimeIntervals=[1,5,10,15,20,25,30,45,60],i.RealTimeDataSourceName="_RealTimeSchema_",i.modelPlaceholderImageUrl="/"+e.getBuild()+"/images/modelPlaceholder.png",(i=i.upgrader||(i.upgrader={})).TileConfigVersion="1.6",i.NoVisualType="No visual type"}(powerbi=powerbi||{}),function(r){!function(t){var e=jsCommon.Utility,i=r.telemetryEventFactory,o=r.telemetry.EventFactories;e?e.generateGuid:Function.prototype;t.TileDataUpdateExceptionEventName="PBI.TileDataUpdateException",t.TileDataUpdateException=o[t.TileDataUpdateExceptionEventName]=function(e){return i({name:t.TileDataUpdateExceptionEventName,info:e,category:r.TelemetryCategory.CriticalError,loggers:t.TileDataUpdateExceptionLoggers})},t.DashboardTileErrorEventName="PBI.Dashboard.TileError",t.DashboardTileError=o[t.DashboardTileErrorEventName]=function(e){return i({name:t.DashboardTileErrorEventName,info:e,category:r.TelemetryCategory.CriticalError,loggers:t.DashboardTileErrorLoggers})}}(r.telemetry||(r.telemetry={}))}(powerbi=powerbi||{}),function(e){var t;t=e.dataServices||(e.dataServices={}),(t=(e=t.contracts||(t.contracts={})).TileType||(e.TileType={}))[t.composite=0]="composite",t[t.iframe=1]="iframe",t[t.image=2]="image",t[t.model=3]="model",t[t.ssrs=4]="ssrs",t[t.workbook=5]="workbook",t[t.report=6]="report",t[t.realTime=8]="realTime",(t=e.EwaNamedItemType||(e.EwaNamedItemType={}))[t.NamedRange=0]="NamedRange",t[t.Parameter=1]="Parameter",t[t.Table=2]="Table",t[t.PivotTable=3]="PivotTable",t[t.Chart=4]="Chart",t[t.WebExtension=5]="WebExtension",(e=e.QueryResultErrorType||(e.QueryResultErrorType={}))[e.PowerBIServiceException=0]="PowerBIServiceException",e[e.DSRException=1]="DSRException"}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).contracts||(e.contracts={})).BuiltInThemeNamesResourceValues={Light:"Light",Dark:"Dark","Color-blind friendly":"Color_Blind_Friendly",Custom:"Custom"},e.createBuiltInThemesFactory=function(){var e={Light:{name:"Light",foreground:"#000000",background:"#EAEAEA",dataColors:["#01B8AA","#374649","#FD625E","#F2C80F","#5F6B6D","#8AD4EB","#FE9666","#A66999"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}},Dark:{name:"Dark",foreground:"#FFFFFF",background:"#484644",dataColors:["#51CFBE","#F55965","#FE9666","#92BEFF","#B577DF","#29B9EF","#3599B8","#DFBFBF"],tableAccent:"#E2A84E",tiles:{background:"#2B2B30",color:"#FFFFFF"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#FFFFFF"}}},{labelColor:{solid:{color:"#CECECE"}}}]}}}},"Color-blind friendly":{name:"Color-blind friendly",background:"#EAEAEA",foreground:"#000000",dataColors:["#074650","#009292","#FE6DB6","#FEB5DA","#480091","#B66DFF","#B5DAFE","#6DB6FF","#914800","#23FD23"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}}};return e}}(powerbi=powerbi||{}),function(e){(e=(e=(e=e.dataServices||(e.dataServices={})).models||(e.models={})).ContentPackItems||(e.ContentPackItems={}))[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.Model=2]="Model",e[e.Workbook=3]="Workbook"}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).models||(e.models={})).AppModelIconColors=["#000","#FFF"],e.AppModelIconBackgroundColors=[{color:"#374649",fontColor:"#FFF"},{color:"#01B8AA",fontColor:"#000"},{color:"#FD625E",fontColor:"#FFF"},{color:"#F2C80F",fontColor:"#000"},{color:"#5F6B6D",fontColor:"#000"},{color:"#8AD4EB",fontColor:"#000"},{color:"#FE9666",fontColor:"#000"},{color:"#A66999",fontColor:"#000"},{color:"#3599B8",fontColor:"#000"},{color:"#DFBFBF",fontColor:"#000"}],e.ServiceAppFallbackColors={color:"#374649",fontColor:"#FFF"},e.AppModelIcons=["financial","emi","group","realtime","image","pc1","paintbrush","world","streaming-data","user","barchart","gauge","globe","piedouble","areachart","comment","visualinteraction","code","shapes","piechart","stackedcolumn","scatter","database","home","insight"]}(powerbi=powerbi||{}),function(a){var n;(function(i){var t=a.common.contracts.ContentTileType,e=jsCommon.Lazy;i.DashboardAsyncLayoutDelayMs=100;var o=(r.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&null!=(e=this.getPermissionsCallback())?e:this.contract&&this.contract.permissions},r.prototype.increaseHitCount=function(){this.hitCount++},Object.defineProperty(r.prototype,"tiles",{get:function(){return this.lazyTiles||(this.lazyTiles=new e(function(){return[]})),this.lazyTiles.getValue()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"folderId",{get:function(){return this.contract.folderId},set:function(e){this.contract.folderId=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canEdit",{get:function(){return n.DashboardUtils.isWriteable(this.contract)&&!(this.gridLayoutService&&this.gridLayoutService.strategy.isLayoutLocked)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"contentTileType",{get:function(){return t.Dashboard},enumerable:!1,configurable:!0}),r.prototype.isFilled=function(){return this.contract.tiles&&this.tiles.length===this.contract.tiles.length},r.prototype.calculateLayout=function(){this.layoutRequired=!1;var e=this.tiles;if(!_.isEmpty(e))for(var t=0,i=e;t<i.length;t++)i[t].calculateLayout()},r.prototype.applyLayout=function(){var e=this.tiles;if(!_.isEmpty(e))for(var t=0,i=e;t<i.length;t++)i[t].applyLayout()},r.prototype.runLayoutIfRequired=function(){this.layoutRequired&&(this.calculateLayout(),this.applyLayout())},r.prototype.scheduleDelayedLayout=function(e){var t=this;void 0===e&&(e=!1),this.layoutRequired||(this.layoutRequired=!0,e||setTimeout(function(){t.layoutRequired&&(t.calculateLayout(),t.applyLayout())},i.DashboardAsyncLayoutDelayMs))},r.prototype.findTile=function(t){return _.find(this.tiles,function(e){return e.id===t})},r.prototype.findTileByObjectIdOrOriginalObjectId=function(t,i){if(t||i)return _.find(this.tiles,function(e){return!_.isEmpty(t)&&e.contract.objectId===t||!_.isEmpty(i)&&e.contract.originalTileObjectId===i})},r.prototype.getTileIndex=function(t){return _.findIndex(this.tiles,function(e){return e.id===t})},r.prototype.getTileContractIndex=function(t){return _.findIndex(this.contract.tiles,function(e){return e.id===t})},r.prototype.getUniquePackageId=function(){var e=this.contract;return e.originalPackageId||(e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0)},r.prototype.hasModel=function(t){return _.some(this.tiles,function(e){return e.contract.modelId===t})},r.prototype.hasOwnerInfo=function(){return!_.isEmpty(this.ownerFullname)||!_.isEmpty(this.ownerMail)},r);function r(e){this.contract=e,this.isEnabled=!0,this.isUsedByContentPack=!1,this.isLoaded=e&&null!=e.tiles,this.hitCount=0,this.lazyTiles=null,this.uniqueId=t.Dashboard+"_"+this.contract.id}i.Dashboard=o})((n=a.dataServices||(a.dataServices={})).models||(n.models={}))}(powerbi=powerbi||{}),function(e){!function(e){function t(e){this.contract=e}e=e.models||(e.models={}),t.prototype.getPermissions=function(){var e;return(e=this.getPermissionsCallback?this.getPermissionsCallback():e)?e:this.contract&&this.contract.permissions},t.prototype.hasUpdate=function(){return this.version&&this.latestVersion&&this.version!==this.latestVersion},e.Package=t}(e.dataServices||(e.dataServices={}))}(powerbi=powerbi||{}),function(e){!function(r){var e,i;function a(e,t){this.datasetInfo=e,this.definition=t}e=r.models||(r.models={}),i=window,Object.defineProperty(a.prototype,"databaseName",{get:function(){return this.datasetInfo.databaseName},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"primaryKey",{get:function(){return this.datasetInfo.resourceKey},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"secondaryKey",{get:function(){return this.datasetInfo.resourceKeySecondary},enumerable:!1,configurable:!0}),a.prototype.getPushUrl=function(){var e=window.tenantId,t=window.apiUri;"https://wabi-staging-us-east-redirect.analysis.windows.net"===i.clusterUri&&(t="https://powerbistagingapi.analysis.windows.net");e="/beta/"+e+"/datasets/"+this.databaseName+"/rows",t=jsCommon.Utility.urlCombine(t,e),e={};return e.key=this.primaryKey,jsCommon.QueryStringUtil.addOrUpdateQueryStringToUrl(t,e)},a.createRealTimeDatasetDefinition=function(e,t,i){i=i.schema(r.constants.RealTimeDataSourceName).entities;i&&i.length;var i=_.head(i),o=[];return _.map(i.properties,function(e){o.push({name:e.displayName,dataType:a.convertToRealTimeDataType(e.type)})}),{name:e,columns:o,mode:t,tableName:i.name}},a.convertToRealTimeDataType=function(e){switch(e.primitiveType){case 3:case 4:return 1;case 7:return 2;case 1:return 0;case 5:return 3}},e.RealTimeModel=a}(e.dataServices||(e.dataServices={}))}(powerbi=powerbi||{}),function(o){var e,t,r,i;function a(e,t,i){void 0===i&&(i=!0);var o=r.call(this)||this;return o.displayWidth=e,o.displayHeight=t,o.ignoreScrollbarWidth=i,o.minNumOfColumns=2,o.isLayoutLocked=!0,o}e=o.dataServices||(o.dataServices={}),t=e.models||(e.models={}),e=o.common.models.DefaultGridLayoutStrategy,i=o.common.directives.InViewport,__extends(a,r=e),a.prototype.calculateDisplayPositions=function(e){r.prototype.calculateDisplayPositions.call(this,e),this.scaleDashboard(e)},a.prototype.scaleDashboard=function(e){var t=this.getDashboardSize(e),e=a.calculateDashboardScaleFactor(t.width,this.displayWidth);e<=0||(e={transform:"scale("+e+")",width:t.width+"px",height:this.displayHeight/e+"px",left:0},$(o.dataServices.constants.dashboardElementName).css(e),i.getRefreshAllHandler()())},a.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),i=this.getMaxRowInLayout(e);t<this.minNumOfColumns&&(t=this.minNumOfColumns);e=o.common.GridLayoutConstants.defaultGridItemSpacing;return{width:t*this.gridWidth+e+this.getScrollbarWidth(),height:i*this.gridHeight+e}},a.calculateDashboardScaleFactor=function(e,t){return t/e},a.prototype.getMaxRowInLayout=function(e){return _.maxBy(_.map(e,function(e){return e.displayRow-1+e.displaySize.rowSpan}))},a.prototype.getMaxColumnInLayout=function(e){return _.maxBy(_.map(e,function(e){return e.displayCol-1+e.displaySize.colSpan}))},a.prototype.getScrollbarWidth=function(){if(null!=this.scrollbarWidth)return this.scrollbarWidth;if(this.ignoreScrollbarWidth)return this.scrollbarWidth=0,this.scrollbarWidth;var e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);var t=document.createElement("div");e.appendChild(t);t=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),this.scrollbarWidth=t<0?0:t/2,this.scrollbarWidth},e=a,t.PhoneLandscapeTileLayoutStrategy=e}(powerbi=powerbi||{}),function(a){var e;(function(e){var i,t=a.dataServices.contracts.TileType;(o=i=e.PhoneTileLayoutConstants||(e.PhoneTileLayoutConstants={})).tileSpacing=12,o.smallTileRowSpan=4,o.defaultTileRowSpan=6,o.mediumTileRowSpan=7,o.largeTileRowSpan=9,o.resizeBuffer=10,o.aspectRatio=.1111;var o=(r.prototype.calculateDisplayPositions=function(e){for(var t=1,i=0,o=a.dataServices.DashboardUtils.orderItems(_.map(e,function(e){return{pos:e.getLayoutPosition(),item:e}}));i<o.length;i++){var r=o[i];r.displayCol=1,r.displayRow=t,this.calculateDisplaySize(r),t+=r.displaySize.rowSpan}this.removeScale()},r.prototype.calculateDisplaySize=function(e){var t=this.getRowSpan(e);e.displaySize={colSpan:1,rowSpan:t}},r.prototype.getRowSpan=function(e){var t=e.gridItem,e=this.tileTypeRowSpanMap[t.type];return e||!t.composite||null!==(t=t.composite)&&(e=this.visualTypeRowSpanMap[t.visual.type]),e||i.defaultTileRowSpan},r.prototype.removeScale=function(){$(a.dataServices.constants.dashboardElementName).removeAttr("style")},r);function r(e){this.isLayoutLocked=!0,this.willOverrideDisplayPosition=!0,this.gridItemSpacing=i.tileSpacing,this.isDynamic=!1,this.tileTypeRowSpanMap={},this.visualTypeRowSpanMap={},this.gridWidth=e-this.gridItemSpacing,this.gridHeight=Math.round(this.gridWidth*i.aspectRatio),this.gridMinWidthOnResize=this.gridWidth-i.resizeBuffer,this.gridMinHeightOnResize=this.gridHeight-i.resizeBuffer,this.gridMaxWidthOnResize=this.gridWidth*a.common.models.gridLayoutConstants.getGridMaxColSpan(),this.gridMaxHeightOnResize=this.gridHeight*a.common.models.gridLayoutConstants.getGridMaxColSpan(),this.tileTypeRowSpanMap[t.report]=i.mediumTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.card.name]=i.smallTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.animatedNumber.name]=i.smallTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.textbox.name]=i.smallTileRowSpan}e.PhonePortraitTileLayoutStrategy=o})((e=a.dataServices||(a.dataServices={})).models||(e.models={}))}(powerbi=powerbi||{}),function(r){!function(e){var i,o;function t(e,t){t=i.call(this,e,t)||this;return t.maxColumnsToDisaply=7,t.minColumnsToDisplay=3,t.portionOfNextColumn=.2,t}e=e.models||(e.models={}),o=r.common.GridLayoutConstants,i=e.PhoneLandscapeTileLayoutStrategy,__extends(t,i),t.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),i=this.getMaxRowInLayout(e);t>this.maxColumnsToDisaply?t=this.maxColumnsToDisaply+this.portionOfNextColumn:t<this.minColumnsToDisplay&&(t=this.minColumnsToDisplay);e=o.defaultGridItemSpacing;return{width:t*this.gridWidth+e,height:i*this.gridHeight+e}},e.TabletTileLayoutStrategy=t}(r.dataServices||(r.dataServices={}))}(powerbi=powerbi||{}),function(l){var c;(function(r){var a=jsCommon.ArrayExtensions,t=l.common.models.CdsaContentTile,n=jsCommon.Lazy,s=l.common.models.Report,o=c.contracts.TileType;function i(e,t){return e.webUri&&e.etagHash?e.webUri+"/_layouts/WopiFrame.aspx?sourcedoc={"+e.etagHash+"}&action="+t:""}r.createDataServiceModelConverter=function(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,f,y,v,T){return new b(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,f,y,v,T)},r.getWorkbookActionUrl=i;var b=(e.prototype.setModelMerger=function(e){this.modelMerger=e},e.prototype.convertCompositeTile=function(e){return this.tileModelConverter.convertCompositeTile(e)},e.prototype.convertTileData=function(e){return this.tileModelConverter.convertTileData(e)},e.prototype.convertDashboard=function(e,t,i,o){var r=this,a=this.convertDashboardShallow(e);return e.tiles&&(a.lazyTiles=new n(function(){return _.map(e.tiles,function(e){return r.convertTile(e,t,i,o)})})),a},e.prototype.convertDashboardShallow=function(e){var t=this,i=new r.Dashboard(e);return i.getPermissionsCallback=function(){return t.permissionService.getDashboardEffectivePermissions(e)},i.dataClassificationId=e.dataClassificationId,i.folderId=e.folderId,this.modelMerger.mergeDashboardShallow(i,e),i},e.prototype.convertIframeTile=function(e){if(!e||e.type!==o.iframe)return null;var t=new r.IframeTileModel(e),i=this.convertTileConfig(e);return this.convertTileLayoutConfig(e),i&&i.iframe&&(t.srcUrl=i.iframe.srcUrl,t.embedCode=i.iframe.embedCode),t.isLoading=r.TileFactory.isTileLoading(e),t},e.prototype.convertImageTile=function(e){if(!e||e.type!==o.image)return null;var t=new r.ImageTileModel(e);return this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.subDisplayText=e.subDisplayText,"number"!=typeof t.contract.reportId||e.config?(t.isStatic=!1,t.imageUrl=this.getImageUrl(e)):(t.isStatic=!0,t.imageUrl=c.constants.modelPlaceholderImageUrl),t.isLoading=r.TileFactory.isTileLoading(e),t},e.prototype.convertContentPackBase=function(e){return this.appModelConverter.convertContentPackBase(e)},e.prototype.convertAppModelBase=function(e){return this.appModelConverter.convertAppModelBase(e)},e.prototype.convertInstalledAppModel=function(e,t){return this.appModelConverter.convertInstalledAppModel(e,t)},e.prototype.convertModel=function(e){return this.datasetModelConverter.convertModel(e)},e.prototype.convertModelTile=function(e){if(!e||e.type!==o.model)return null;var t=new r.ModelTileModel(e);return this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.isLoading=r.TileFactory.isTileLoading(e),t.subDisplayText=e.subDisplayText,t},e.prototype.convertCdsaModel=function(e){var t=this.convertCdsaModelShallow(e);return t.permissions=e.permissions,t.name=e.name,t.displayName=e.displayName,t.description=e.description,t.id=e.id,t},e.prototype.convertCdsaModelShallow=function(e){return new t(e)},e.prototype.convertPackage=function(e){return this.packageModelConverter.convertPackage(e)},e.prototype.convertRealTimeTile=function(e){var t={authenticationService:this.authenticationService,featureSwitchService:this.featureSwitchService,geocoder:this.geocoder,geolocationService:this.geolocationService,localizationService:this.localizationService,moduleLoader:this.moduleLoader,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,themeService:this.themeService,tileModelConverter:this.tileModelConverter,visualHostTooltipService:this.visualHostTooltipService,visualPlugin:this.visualPlugins,visualPluginOps:this.visualPluginOps};return l.dataServices.models.convertRealTimeTile(e,t)},e.prototype.convertReport=function(e){return this.reportModelConverter.convertReport(e)},e.prototype.convertReportTile=function(e){return e&&e.type===o.report?(this.convertTileLayoutConfig(e),new r.ReportTileModel(e)):null},e.prototype.convertSpecificTileShallow=function(e,t){switch(this.convertTileLayoutConfig(e),e.type){case o.composite:var i=this.convertTileConfig(e);i&&i.visualContainer&&(t.composite=new r.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)),t.composite&&(i=c.ContractUtils.getMasterLayoutPosition(e),t.composite.size={rowSpan:i.height,colSpan:i.width},t.composite.isLoading=r.TileFactory.isTileLoading(e));break;case o.iframe:t.iframe=new r.IframeTileModel(e),t.iframe.isLoading=r.TileFactory.isTileLoading(e);break;case o.image:t.image=new r.ImageTileModel(e),t.image.isLoading=r.TileFactory.isTileLoading(e);break;case o.model:t.model=new r.ModelTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case o.ssrs:t.model=new r.SsrsTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case o.workbook:t.workbook=new r.WorkbookTileModel(e,t),t.workbook.isLoading=r.TileFactory.isTileLoading(e);break;case o.report:t.model=new r.ReportTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case o.realTime:this.convertTileConfig(e),t.realTime=new r.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService)}},e.prototype.convertSsrsTile=function(e){if(!e||e.type!==o.ssrs)return null;this.convertTileLayoutConfig(e);var t=new r.SsrsTileModel(e);return e.config&&(t.imageUrl=this.getSsrsImageUrl(e)),t.isLoading=r.TileFactory.isTileLoading(e),t},e.prototype.convertTile=function(e,t,i,o){this.convertTileLayoutConfig(e);var r=this.convertTileShallow(e,t,i);return this.modelMerger.mergeTile(r,e,t,i,o),null==e.reportId||(i=this.getTileReport(e.reportId,i))&&(r.report=r.report||new s(i),this.fillReport(r.report,i)),r},e.prototype.convertTileLayoutConfig=function(e){return this.tileModelConverter.convertTileLayoutConfig(e)},e.prototype.convertTileAction=function(e){var t,i=e.$action;if(!i){if(e.action&&0===e.action.indexOf("{"))try{t=JSON.parse(e.action)}catch(e){}else t={action:e.action};i=e.$action=t}return i},e.prototype.convertTileConfig=function(e){return this.tileModelConverter.convertTileConfig(e)},e.prototype.convertTileShallow=function(e,t,i){this.convertTileLayoutConfig(e);var o=new r.Tile(e,this.localizationService,this.forceOpenCustomLinksInNewTab);return this.modelMerger.mergeTileShallow(o,e,t,i),o},e.prototype.convertWorkbook=function(e){var t=this,i=this.convertWorkbookShallow(e);return e&&(i.id=e.id,i.modelId=e.modelId,i.viewUrl=this.getWorkbookViewUrl(e),i.editUrl=this.getWorkbookEditUrl(e),i.embedUrl=this.getWorkbookEmbedView(e),i.name=e.name,i.displayName=e.displayName,i.description=e.description,i.fileName=e.fileName,i.packageId=e.packageId,i.isNew=e.isNew,i.getPermissionsCallback=function(){return t.permissionService.getWorkbookEffectivePermissions(e)}),i},e.prototype.convertWorkbookShallow=function(e){return new r.Workbook(e)},e.prototype.convertWorkbookTile=function(e,t,i){if(!e||e.type!==o.workbook)return null;this.convertTileLayoutConfig(e);i=new r.WorkbookTileModel(e,i);i.displayText=e.displayText,i.subDisplayText=e.subDisplayText,i.isLoading=r.TileFactory.isTileLoading(e),i.image=e.tileDataBinaryBase64Encoded,e.$config.workbookTile&&e.$config.workbookTile.keepOriginalContentSize?i.keepOriginalContentSize=e.$config.workbookTile.keepOriginalContentSize:i.keepOriginalContentSize=c.constants.workbook.defaultKeepOriginalContentSize;e=e.$config.workbookTile;return t&&(e&&(i.embedUrl=t.embedUrl+"&item="+e.item),t.contract&&(i.webUri=t.contract.webUri)),i},e.prototype.fillDashboardChildren=function(e,t,i,o){var r=this,a=e.contract;e.displayName!==a.displayName&&(e.displayName=a.displayName),a.tiles&&(e.lazyTiles=new n(function(){return a.tiles.map(function(e){return r.convertTile(e,t,i,o)})}))},e.prototype.fillReport=function(e,t){this.reportModelConverter.fillReport(e,t)},e.prototype.getImageUrl=function(e){e=this.convertTileConfig(e);if(e&&e.imageTile)return e.imageTile.imageUrl},e.prototype.getSsrsImageUrl=function(e){e=this.convertTileConfig(e);if(e&&e.ssrsTile)return e.ssrsTile.imageUrl},e.prototype.getTileModel=function(t,e){var i,o;return!e||-1!==(o=a.indexOf(e,function(e){return e&&e.id===t}))&&(i=e[o]),i},e.prototype.getTileReport=function(t,e){var i,o;return!e||-1!==(o=a.indexOf(e,function(e){return e&&e.id===t}))&&(i=e[o]),i},e.prototype.getTileWorkbook=function(t,i,e){var o,r;return!e||-1!==(r=a.indexOf(e,function(e){return e.id===t&&e.packageId===i}))&&(o=e[r]),o},e.prototype.resolveTilePackage=function(t,e){var i;!t.packageId||-1!==(i=a.indexOf(e,function(e){return e.id===t.packageId}))&&(t.tilePackage=e[i])},e.prototype.getWorkbookViewUrl=function(e){return i(e,"view")},e.prototype.getWorkbookEditUrl=function(e){return i(e,"edit")},e.prototype.getWorkbookEmbedView=function(e){return i(e,"embedview")},Object.defineProperty(e.prototype,"forceOpenCustomLinksInNewTab",{get:function(){var t;try{t=this.$injector.get("forceOpenCustomLinksInNewTab")}catch(e){t=!1}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"licenseUIManagerFactory",{get:function(){return this._licenseUIManagerFactory||(this._licenseUIManagerFactory=this.$injector.get("licenseUIManagerFactory")),this._licenseUIManagerFactory},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileModelConverter",{get:function(){return this._tileModelConverter||(this._tileModelConverter=r.createTileModelConverter(this.geolocationService,this.telemetryService,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geocoder,this.promiseFactory,this.moduleLoader,this.tileConfigUpgraderService,this.explorationSerializer,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)),this._tileModelConverter},enumerable:!1,configurable:!0}),e);function e(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,f,y,v,T){this.authenticationService=e,this.explorationSerializer=t,this.featureSwitchService=i,this.geocoder=o,this.geolocationService=r,this.localizationService=a,this.moduleLoader=n,this.permissionService=s,this.promiseFactory=l,this.reportModelConverter=c,this.telemetryService=u,this.themeService=d,this.tileConfigUpgraderService=p,this.visualHostTooltipService=h,this.visualPluginOps=m,this.visualPlugins=g,this.appModelConverter=f,this.$injector=y,this.datasetModelConverter=v,this.packageModelConverter=T}})((c=l.dataServices||(l.dataServices={})).models||(c.models={}))}(powerbi=powerbi||{}),function(t){var n;(function(p){var o=jsCommon.ArrayExtensions,i=jsCommon.Lazy,r=t.common.helpers.UserInfoHelper;p.createDataServiceModelMerger=function(e,t){return new a(e,t)};var a=(e.prototype.mergeDashboard=function(e,t,n,s,l){var c=this,u=this.modelConverter.convertDashboard(t,n,s,l);e.contract=t,e.displayName=u.displayName,e.getPermissionsCallback=function(){return c.permissionService.getDashboardEffectivePermissions(t)},e.contract.modelIds=t.modelIds,e.contract.reportIds=t.reportIds,e.contract.packageIds=t.packageIds,e.contract.workbookIds=t.workbookIds,e.qnaEnabled=t.qnaEnabled,e.gravityEnabled=t.gravityEnabled,e.annotationsEnabled=t.annotationsEnabled,e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup,e.isHidden=t.isHidden;var d=e.tiles;e.lazyTiles=new i(function(){var e=[];if(_.isEmpty(u.tiles))return e;for(var t=_.keyBy(d,function(e){return e&&e.id}),i=0,o=u.tiles;i<o.length;i++){var r=o[i],a=t[r.id];a?(e.push(a),c.mergeTile(a,r.contract,n,s,l)):e.push(r)}return e})},e.prototype.mergeArtifactOwnerInfo=function(e,t){e.ownerFullname=r.getFullName(t.givenName,t.familyName),e.ownerMail=t.emailAddress,t.userObjectId&&(e.ownerUserObjectId=t.userObjectId),t.groupObjectId&&(e.ownerGroupObjectId=t.groupObjectId),e.contract.ownerInfo||(e.contract.ownerInfo=t)},e.prototype.mergeDashboardShallow=function(e,t){var i,o=this;t.displayName&&(e.displayName=t.displayName),void 0!==t.permissions&&(e.getPermissionsCallback=function(){return o.permissionService.getDashboardEffectivePermissions(t)},e.contract.permissions=t.permissions),t.modelIds&&(e.contract.modelIds=t.modelIds),t.reportIds&&(e.contract.reportIds=t.reportIds),t.workbookIds&&(e.contract.workbookIds=t.workbookIds),t.packageIds&&(e.contract.packageIds=t.packageIds),void 0!==t.isStaging&&(e.contract.isStaging=t.isStaging),void 0!==t.qnaEnabled&&(e.qnaEnabled=t.qnaEnabled),void 0!==t.gravityEnabled&&(e.gravityEnabled=t.gravityEnabled),void 0!==t.annotationsEnabled&&(e.annotationsEnabled=t.annotationsEnabled),void 0!==t.isSharedFromSecurityGroup&&(e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup),void 0!==t.isHidden&&(e.isHidden=t.isHidden),void 0!==t.ownerInfo&&(i=t.ownerInfo,this.mergeArtifactOwnerInfo(e,i)),e.sharedTime=t.sharedTime||"/Date(0)/"},e.prototype.mergeDashboardTiles=function(e,t){var i=t.models||[],o=t.reports||[],r=t.workbooks||[],a=t.packages||[],t=e.contract.tiles;if(t)for(var n=0,s=t;n<s.length;n++){var l=s[n];this.modelConverter.resolveTilePackage(l,a)}e=e.tiles;if(e)for(var c=0,u=e;c<u.length;c++){var d=u[c];this.mergeTile(d,d.contract,i,o,r)}},e.prototype.mergeModelContentProviderId=function(e,t){if(e)for(var i=0,o=e;i<o.length;i++){var r=o[i];r.contentProviderId=r.contentProviderId||n.ContractUtils.findContentProviderId(t,r.packageId)}},e.prototype.mergeTileShallow=function(e,t,i,o){this.modelConverter.convertTileLayoutConfig(t),e.contract=t,e.type=t.type,this.mergeTileLayoutConfig(e,t),e.displayText=t.displayText,e.subDisplayText=t.subDisplayText,e.backgroundImageUrl=this.modelConverter.getImageUrl(t),e.errorCode=t.errorCode;o=this.modelConverter.getTileReport(t.reportId,o);t.query&&t.query.modelQuery&&(e.utterance=t.query.modelQuery.utterance),e.action=this.modelConverter.convertTileAction(t),e.config=this.modelConverter.convertTileConfig(t),e.isLoading=p.TileFactory.isTileLoading(t),e.isLocked=p.TileFactory.isTileLocked(t),!t.modelId||(i=this.modelConverter.getTileModel(t.modelId,i))&&(e.vsName=i.vsName,e.dbName=i.dbName),t.reportId&&(e.report=e.report||this.modelConverter.convertReport(o),e.report.id=t.reportId),o&&(this.modelConverter.fillReport(e.report,o),e.action||(e.action={action:"/openReport"})),this.modelConverter.convertSpecificTileShallow(t,e)},e.prototype.mergeTileLayoutConfig=function(e,t){var i;t.$layoutConfig,e.layoutPosition.x&&e.layoutPosition.y&&e.layoutPosition.width&&e.layoutPosition.height||(i=o.extendWithId(t.$layoutConfig.layouts),t=(t=e.gridLayoutContext)?t.getActiveLayout():0,(t=i.withId(t))&&this.mergeLayoutPosition(e.layoutPosition,t.position))},e.prototype.mergeLayoutPosition=function(e,t){t&&(e.x=e.x||t.x,e.y=e.y||t.y,e.width=e.width||t.width,e.height=e.height||t.height)},e.prototype.mergeTile=function(e,t,i,o,r,a){var n=e.composite,s=e.realTime;this.mergeTileShallow(e,t,i,o),e.composite=this.modelConverter.convertCompositeTile(t),n&&e.composite&&(e.composite.setDataLoadEventDelegate(n.dataLoadEventDelegate),e.composite.copyDependencies(n),n instanceof p.SingleVisualCompositeTileModel&&e.composite instanceof p.SingleVisualCompositeTileModel&&this.mergeVisual(e.composite.visual,n.visual),n.tileDataIsVolatile&&n.tileData&&n.tileData.data&&(e.composite.tileData=n.tileData)),e.iframe=this.modelConverter.convertIframeTile(t),e.image=this.modelConverter.convertImageTile(t),e.model=this.modelConverter.convertModelTile(t),e.ssrs=this.modelConverter.convertSsrsTile(t);n=this.modelConverter.convertRealTimeTile(t);if(this.updateTileRealTimeModel(e,s,n),e&&e.reportTile?(n=e.reportTile.exploration,e.reportTile=this.modelConverter.convertReportTile(t),e.reportTile.exploration=n):e.reportTile=this.modelConverter.convertReportTile(t),_.isEmpty(r)||(r=this.modelConverter.getTileWorkbook(t.workbookId,t.packageId,r))&&(l=this.modelConverter.convertWorkbook(r),e.workbook=this.modelConverter.convertWorkbookTile(t,l,e)),o){var l=this.modelConverter.getTileReport(t.reportId,o);l?(e.report=e.report||this.modelConverter.convertReport(l),this.modelConverter.fillReport(e.report,l)):e.report=null,e.contractsReport=this.modelConverter.getTileReport(t.reportId,o)}else if(a){for(var c=void 0,u=0,d=a.length;u<d;u++)if(t.reportId===a[u].id){c=a[u];break}c&&(e.report=e.report||c,this.modelConverter.fillReport(e.report,c.contract),e.contractsReport=c.contract)}t.modelId&&(e.contractsModel=this.modelConverter.getTileModel(t.modelId,i))},e.prototype.mergeWorkbook=function(e,t){var i=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.getPermissionsCallback=function(){return i.permissionService.getWorkbookEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.packageId=t.packageId||e.packageId)},e.prototype.mergeInstalledAppModel=function(e,t,i){i=this.modelConverter.convertInstalledAppModel(t,i);delete i.isFavorite,delete i.isFavoriteDisabled,delete i.favoriteInfo,_.extend(e,i)},e.prototype.updateTileRealTimeModel=function(e,t,i){e.realTime=i,t&&e.realTime&&e.realTime.copyRealTimeModelDependencies(t)},e.prototype.mergeVisual=function(e,t){t.visual&&e.type===t.type&&(e.visual=t.visual),e.viewport=t.viewport},e);function e(e,t){this.modelConverter=e,this.permissionService=t}p.DataServiceModelMerger=a})((n=t.dataServices||(t.dataServices={})).models||(n.models={}))}(powerbi=powerbi||{}),function(l){var m,e,g,f,c,u,y,d,v,T,o;function r(e,t){var i,i=(o=t,function(e,t,i,o,r,a,n,s,l){o&&(e.layoutType=o);i&&(e.elements=i);r&&(e.queryMetadata=r);n&&(e.heading1=n);a&&(e.heading2=a);s&&(e.heading3=s);t&&(e.transform=u.serializeTransformActions(u.serializeDataViewTransformActions(t,l&&l.objects)))}(t={$visualContainer:(i=e).visualContainer,$modelExtensions:i.modelExtensions,themeCollection:l.visualHost.ThemeUtils.cloneThemeCollection(i.themeCollection),dataSourceVariables:i.dataSourceVariables},i.dataTransforms,i.elements,i.tileLayoutType,i.queryMetadata,i.tileFilterDetails,i.tileHeading,i.tileSubDisplay,o),t),o={version:v};return null!=e.realTimeDataWindow?((t=i).dataWindow=e.realTimeDataWindow,o.realTimeVisual=t):o.visualContainer=i,o}function a(e,t){var i=[],e=function(e,t){e=[{id:1,title:t.get("AddWidgetModal_IframeOption_Title"),description:t.get("AddWidgetModal_IframeOption_Description"),iconClass:"pbi-glyph-iframe",template:"<edit-iframe-widget></edit-iframe-widget>",defaultTileContract:{type:T.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:1,name:"webContent"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()},disabled:!e,tooltip:e?void 0:t.get("Dashboard_WebContentTiles_Disabled")},{id:2,title:t.get("Image"),description:t.get("AddWidgetModal_ImageOption_Description"),iconClass:"pbi-glyph-image",template:"<edit-image-widget></edit-image-widget>",defaultTileContract:{type:T.image,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{imageTile:{imageUrl:""},version:"1.0",widget:{id:2,name:"image"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}},{id:3,title:t.get("Textbox"),description:t.get("AddWidgetModal_TextOption_Description"),iconClass:"pbi-glyph-font",template:"<edit-text-widget></edit-text-widget>",defaultTileContract:{type:T.composite,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{version:"1.0",visualContainer:{layoutType:0,$visualContainer:{name:o.generateGuid(),config:{singleVisual:{objects:{},visualType:"textbox"}}},themeCollection:{}},widget:{id:3,name:"textbox"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}},{id:4,title:t.get("AddWidgetModal_VideoOption_Title"),description:t.get("AddWidgetModal_VideoOption_Description"),iconClass:"pbi-glyph-slideshow",template:"<edit-video-widget></edit-video-widget>",defaultTileContract:{type:T.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:4,name:"video"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}}];return{title:t.get("Add_Widgets_Section_Title"),tiles:e}}(e,t);e&&!_.isEmpty(e.tiles)&&i.push(e);(e=[]).push({id:6,title:(t=t).get("Realtime_TileTitle"),description:t.get("Realtime_TileDetails"),iconClass:"pbi-glyph-streaming-data",defaultTileContract:{type:T.realTime,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{realTimeVisual:{dataWindow:null,layoutType:0,$visualContainer:{name:o.generateGuid(),config:{singleVisual:null}},themeCollection:{}},version:"1.0"},$layoutConfig:m.ContractUtils.createMasterLayoutConfig({width:f.gridItemSmallLandscapeColSpan,height:f.gridItemSmallLandscapeRowSpan})}}),e={title:t.get("Add_Realtime_Section_Title"),tiles:e};return _.isEmpty(e.tiles)||i.push(e),_.cloneDeep(i)}function n(e,t,i,o,r){t===T.composite||T.realTime;var a=f.gridItemMediumLandscapeColSpan,n=f.gridItemMediumLandscapeRowSpan;m.TileUtils.getVisualType(e)===l.visuals.plugins.card.name&&(a=f.gridItemSmallLandscapeColSpan,n=f.gridItemSmallLandscapeRowSpan);i=i?{modelQuery:{sq:JSON.stringify(i)}}:null,n=m.ContractUtils.createMasterLayoutConfig({width:a,height:n}),n={id:++g,type:t,query:i,$config:e,tileData:o?function(e){if(void 0!==e)return JSON.stringify(e,function(e,t){return e&&e.charAt&&"$"===e.charAt(0)?void 0:t})}(o.data):null,tileDataSet:o,layoutConfig:JSON.stringify(n),$layoutConfig:n},e=e.visualContainer;return e&&(n.displayText=e.heading1,n.subDisplayText=e.heading3),r&&(n.modelId=r.id),n}m=l.dataServices||(l.dataServices={}),e=m.models||(m.models={}),f=l.common.GridLayoutConstants,c=l.data.services.DataViewObjectSerializer,u=l.data.services.DataViewTransformActionsSerializer,y=l.common.models.gridLayoutConstants,d=l.data.SQExpr,v=m.constants.upgrader.TileConfigVersion,T=m.contracts.TileType,o=jsCommon.Utility,e=e.TileFactory||(e.TileFactory={}),g=100,e.findModel=function(e,t,i){for(var o=0,r=i.length;o<r;o++){var a=i[o];if(a.vsName===e&&a.dbName===t)return a}},e.createCompositeTile=function(e,t,i,o){return n(e,T.composite,t,i,o)},e.createTileConfig=r,e.createTileForPinData=function(e,t,i){return t=r(e,t),e.tileDataType&&(t.tileDataType=e.tileDataType),(i=n(t,null!=e.realTimeDataWindow?T.realTime:T.composite,e.query,e.dataViewSource,i)).publishState=2,e.action&&(i.action=JSON.stringify(e.action)),null!=e.utterance&&(i.query.modelQuery.utterance=e.utterance),e.name&&(i.name=e.name),i.reportId=e.reportId,e.modelId&&(i.modelId=e.modelId),e.packageId&&(i.packageId=e.packageId),i.resourcePackageIds=e.resourcePackageIds,i},e.createNonVisualTileFromExisting=function(e){var t=_.omitBy({id:++g,type:e.type,query:e.query,action:e.action,$config:e.$config,tileData:e.tileData,tileDataSet:e.tileDataSet,publishState:e.publishState,displayText:e.displayText,subDisplayText:e.subDisplayText,modelId:e.modelId,reportId:e.reportId,workbookId:e.workbookId,packageId:e.packageId,name:e.name},function(e){return void 0===e}),e=m.ContractUtils.getMasterLayoutPosition(e),e=m.ContractUtils.createMasterLayoutConfig({height:e.height,width:e.width});return t.$layoutConfig=e,t.layoutConfig=JSON.stringify(e),t},e.createReportTileForExploreData=function(e,t,i,o,r,a,n,s,l,c,u,d){var p,h={version:v};return(s||l)&&(h.reportTile={pod:s,filters:l}),c&&(p={modelQuery:{utterance:c}}),l=2*f.defaultGridWidth,c=2*f.defaultGridHeight,l=u?u/l:2,c=d?d/c:2,0===Math.round(l)&&(l=2),0===Math.round(c)&&(l=2),l=Math.round(f.gridItemMediumLandscapeColSpan*l),c=Math.round(f.gridItemMediumLandscapeRowSpan*c),l=l>y.getGridMaxColSpan()?y.getGridMaxColSpan():l,c=c>y.getGridMaxRowSpan()?y.getGridMaxRowSpan():c,c=m.ContractUtils.createMasterLayoutConfig({width:l,height:c}),{id:++g,type:T.report,displayText:r,subDisplayText:a,action:JSON.stringify(n),reportId:e,sectionId:o,modelId:t,packageId:i,publishState:2,query:p,config:h?JSON.stringify(h):void 0,$config:h,layoutConfig:JSON.stringify(c),$layoutConfig:c}},e.isTileLoading=function(e){return 1===e.publishState},e.isTileLocked=function(e){return 20===e.errorCode},e.getTileGalleryGroups=a,e.getTileTemplate=function(t,e){for(var i=0,o=a(!0,e);i<o.length;i++){var r=o[i],r=_.find(r.tiles,function(e){return e.id===t});if(null!=r)return r.template}return null},e.serializeTileConfig=function(e,t,i,o){if(e){var r,a,n=_.cloneDeep(e),s=n.realTimeVisual||n.visualContainer;return s&&(o?(a=e.realTimeVisual||e.visualContainer,s.visualContainer=t.serializeVisualContainer(a.$visualContainer)):(r=s.$visualContainer.config.singleVisual,(o=l.data.DataViewObjectDefinitions.getValue(r.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0))&&d.isConstant(o)&&o.value&&(s.stylePresetName=o.value),s.visual=r.visualType,s.columnProperties=r.columnProperties,!(o=(a=e.realTimeVisual||e.visualContainer).$visualContainer.config.singleVisual.objects)||(r=i.capabilities(r.visualType))&&r.objects&&(s.objects=c.serializeObjects(o,r.objects)),(a=e.visualContainer&&a.$visualContainer.config.singleVisual.vcObjects)&&(s.vcObjects=c.serializeObjects(a,l.explore.contracts.VisualContainer.CommonObjectDescriptors)),n.visualContainer&&(n.visual=s,delete n.visualContainer),n.version="0.1"),s.$modelExtensions&&(s.modelExtensions=t.serializeModelExtensions(s.$modelExtensions)),delete s.$visualContainer,delete s.$modelExtensions),JSON.stringify(n)}}}(powerbi=powerbi||{}),function(e){var t,i,o,r,a;function n(e){var t=o.call(this,void 0===e?0:e.id,1,void 0===e?0:e.packageId)||this;return t.contract=e,t}t=e.dataServices||(e.dataServices={}),i=t.models||(t.models={}),r=e.common.contracts.ContentTileType,a=jsCommon.EnumExtensions,t=e.common.models.ReportResource,__extends(n,o=t),n.prototype.getPermissions=function(){var e;return(e=this.getPermissionsCallback?this.getPermissionsCallback():e)?e:this.contract&&this.contract.permissions},Object.defineProperty(n.prototype,"contentTileType",{get:function(){return r.Workbook},enumerable:!1,configurable:!0}),n.prototype.isOwner=function(){return a.hasFlag(this.getPermissions(),7)},n.prototype.isPersonalized=function(){var e=this.getPermissions();return a.hasFlag(e,11)&&!a.hasFlag(e,7)},n.prototype.isEditable=function(){var e=this.editUrl;return this.isOwner()&&null!=e&&""!==e},Object.defineProperty(n.prototype,"displayNameWithExtension",{get:function(){var e=jsCommon.FileUtils.getFileExtension(this.contract.sourceFilePath);return this.displayName.concat(".").concat(e)},enumerable:!1,configurable:!0}),t=n,i.Workbook=t}(powerbi=powerbi||{}),function(d){var p;(function(i){var t=d.explore.services.createVisualHostServices,n=d.data.services.DataViewTransformActionsSerializer,o=d.common.models.gridLayoutConstants,r=d.common.helpers.ModelConverterHelper,s=d.data.SQExpr,a=d.explore.util.ThemeUtils,l=d.explore.util.VisualContainerUtils,e=(Object.defineProperty(c.prototype,"type",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"tileData",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"tileDataIsVolatile",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isError",{get:function(){return this._isError},set:function(e){this._isError=e,this.onErrorDelegate&&this.onErrorDelegate()},enumerable:!1,configurable:!0}),c.prototype.isDataStale=function(e){return!1},Object.defineProperty(c.prototype,"heading1",{get:function(){return this.config.heading1||""},enumerable:!1,configurable:!0}),c.prototype.setDependencies=function(e){this.dataProxy=e},c.prototype.setDataLoadEventDelegate=function(e){this.dataLoadEventDelegate=e},c.prototype.copyDependencies=function(e){e.dataProxy&&this.setDependencies(e.dataProxy)},c);function c(e,t,i){this.useSmallPlotArea=!1,this.contract=e,this.visualPluginService=t,this.pluginOps=i}i.CompositeTileModel=e,i.staleDataDeltaInMs=36e5;var g,e=(__extends(u,g=e),Object.defineProperty(u.prototype,"type",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"visual",{get:function(){return this._visual},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"themeCollection",{get:function(){return this._visual&&this._visual.themeCollection},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"heading1",{get:function(){var e,t=this.config.heading1||"";if(!this.visual)return t;var i=this.visual.dataTransforms;i&&(o=i.selects);var o,i=this.visual.data;return i&&(e=i.dataView),!1===this.cachedShow||void 0!==this.cachedHeading||(o=l.evaluateObjectDefinitions(this.themeCollection,this.themeService,this.config.$visualContainer,this.featureSwitchService.featureSwitches,!1,e,o)).dataViewObjects&&(void 0===this.cachedShow&&(this.cachedShow=d.DataViewObjects.getValue(o.dataViewObjects,{objectName:"title",propertyName:"show"},!0)),this.cachedShow&&(null!==(o=d.DataViewObjects.getValue(o.dataViewObjects,{objectName:"title",propertyName:"text"},null))?this.cachedHeading=o:_.isEmpty(t)&&(t=" "))),this.cachedHeading||t},enumerable:!1,configurable:!0}),u.prototype.setThemeName=function(e){this.ensureVisual();var t=this._visual.themeCollection;t.customTheme=t.customTheme||a.getThemeMetadata(e,1),t.customTheme.name=e},u.prototype.isDataStale=function(e){if(!e)return!1;var t=this.contract,t=r.convertRefreshTimeToJsDateTime(t.tileDataUpdatedTime),t=t&&t.getTime();return!!t&&e-t>i.staleDataDeltaInMs},u.prototype.setData=function(e,t,i){try{this.ensureVisual(),this._visual.data=e,this._visual.dataTransforms=t,this._visual.type=i,this.clearCache()}catch(e){this.telemetryService.logEvent(d.telemetry.TileDataUpdateException,{visualType:i,source:e.fileName,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:e.stack,message:e.message})}},u.prototype.createHostServices=function(e){return t({geocoder:this.geocoder,geolocation:this.geolocationService,localizationService:this.localizationService,moduleLoader:this.moduleLoader,promiseFactory:this.promiseFactory,visualHostTooltipService:this.visualHostTooltipService,authenticationService:this.authenticationService,canExpandCollapse:function(){return!0},onNotifyLicense:e&&e.onNotifyLicense,onClearLicenseNotification:e&&e.onClearLicenseNotification,onNotifyFeatureBlocked:e&&e.onNotifyFeatureBlocked})},u.prototype.ensureVisual=function(){this._visual||(this._visual={hostServices:this.createHostServices(),themeCollection:{}},this.calculateLayout())},Object.defineProperty(u.prototype,"config",{get:function(){return this._config},set:function(e){var t,i,o,r,a;this._config=e,this._visual&&(r=(a=e.$visualContainer.config.singleVisual).visualType,this._visual.type=r,t=d.data.DataViewObjectDefinitions.getValue(a.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0),this._visual.stylePresetName=t&&s.isConstant(t)&&t.value,this._visual.themeCollection=_.cloneDeep(e.themeCollection),(r=this.visualPluginService.capabilities(r))&&(i=r.objects,o=a.objects),a=jsCommon.JsonExtensions.tryParseJSON(e.transform),this._visual.dataTransforms=a?n.deserializeDataViewTransformActions(a,r):n.createTransformActions(e.queryMetadata,e.elements,i,o))},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"tileData",{get:function(){return this._tileData},set:function(e){this._tileData=e,this.readDataView(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"tileDataIsVolatile",{get:function(){return this.contract.tileDataIsVolatile},enumerable:!1,configurable:!0}),u.prototype.refreshData=function(){this.readDataView(!1)},u.prototype.setDependencies=function(e){var t=!this.dataProxy&&this._tileData&&!this.isLoading;g.prototype.setDependencies.call(this,e),t&&this.refreshData()},u.prototype.readDataView=function(n){return __awaiter(this,void 0,d.Promise,function(){var t,i,o,r,a;return __generator(this,function(e){switch(e.label){case 0:if(r=this._visual.type,this.visual&&!this.requiresData())return this._visual.data={dataView:null},[2];if(this._tileData,!(t=this.dataProxy))return[2];if(this.contract.queryResultError&&((o=p.TileUtils.getTileErrorDetailsFromQueryResultError(this.contract.queryResultError,this.localizationService))?(this.isError=!0,this.errorDetails=o,this.errorText=o.message):this.errorText=this.localizationService.get("Tile_ErrorText")),!this._tileData||!this._tileData.data)return this.isLoading=!this.isError,[2];a=this._tileData,i={type:a.type,query:{dataSources:null,command:a.data},allowResultFromClientCache:n,perfId:r,kinds:this.pluginOps.dataViewKinds(r)},o=null,this.dataLoadEventDelegate&&(o=this.dataLoadEventDelegate(),this.dataLoadEventDelegate=null),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.execute(i)];case 2:return a=e.sent(),r={dataView:a&&a.dataReaderResult?a.dataReaderResult.dataView:null,dataViewSource:a&&a.dataViewSource?a.dataViewSource:null},a=a.dataReaderResult.error,this._visual.data=r,this.isError=this.isError||null!=a,o&&(this.isError?o.reject():o.resolve()),[3,4];case 3:return e.sent(),this.isError=!0,o&&o.reject(),[3,4];case 4:return[2]}})})},u.prototype.applyLayout=function(e,t){var i;this.requiresResize&&(t||(i=this.visual)&&i.visual&&(t=i.visual,e=e===o.changeType.resized?2:e===o.changeType.resizing?1:void 0,t.update({viewport:i.viewport,dataViews:i.dataViews,suppressAnimations:!0,type:d.VisualUpdateType.Resize,resizeMode:e})),this.requiresResize=!1)},u.prototype.calculateLayout=function(e,t){e&&(this.viewport&&this.viewport.height===e.height&&this.viewport.width===e.width||(this.requiresResize=!0),this.viewport=e),null!=t&&this.useSmallPlotArea!==t&&(this.useSmallPlotArea=t,this.requiresResize=!0),this.viewport&&(e=this.viewport.height,t=this.viewport.width,1===(this._config&&this._config.layoutType)||(this.useSmallPlotArea?e-=i.TileConstants.VisualSmallVerticalMargin:e-=i.TileConstants.VisualVerticalMargin,t-=i.TileConstants.VisualHorizontalMargin),this._visual&&(this._visual.viewport={height:e,width:t,scale:1}))},u.prototype.canResizeTo=function(e){var t=this._visual&&this._visual.visual;return!!t&&(!t.canResizeTo||t.canResizeTo(d.common.GridLayoutConstants.getDefaultGridItemViewport(e)))},u.prototype.getErrorLocId=function(e,t){return""},u.prototype.requiresData=function(){var e=this.visual,t=this.pluginOps;if(e){if(e&&e.type){if(!t)return!0;if(!t.isQueryVisual(e.type))return!1}return!0}},u.prototype.updateVisualInteractivityOptions=function(e){var t=this.visualPluginService.getInteractivityOptions(this._visual.type);void 0!==t.isInteractiveLegend&&(t.isInteractiveLegend=t.isInteractiveLegend&&e),this._visual.interactivityOptions=t},u.prototype.clearCache=function(){this.cachedHeading=void 0},u.prototype.onNotifyLicense=function(e){0!==e&&this.licenseUIManager.displayNotification(e)},u.prototype.onNotifyFeatureBlocked=function(e){this.licenseUIManager.displayFeatureBlockedBanner(e)},u.prototype.onClearLicenseNotification=function(){this.licenseUIManager.clearNotification()},u);function u(e,t,i,o,r,a,n,s,l,c,u,d,p,h){var m=g.call(this,e,t,i)||this;m.featureSwitchService=o,m.geolocationService=r,m.geocoder=a,m.promiseFactory=n,m.moduleLoader=s,m.telemetryService=l,m.themeService=c,m.authenticationService=u,m.localizationService=d,m.visualHostTooltipService=p,m.requiresResize=!1,h&&(m.licenseUIManager=h.create());p={onNotifyLicense:function(e){return m.onNotifyLicense(e)},onClearLicenseNotification:function(){return m.onClearLicenseNotification()},onNotifyFeatureBlocked:function(e){return m.onNotifyFeatureBlocked(e)}};return m._visual={hostServices:m.createHostServices(h?p:void 0),themeCollection:{}},m}i.SingleVisualCompositeTileModel=e})((p=d.dataServices||(d.dataServices={})).models||(p.models={}))}(powerbi=powerbi||{}),function(i){!function(e){function t(e){this.contract=e}e=e.models||(e.models={}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===i.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},e.IframeTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(i){!function(e){function t(e){this.contract=e}e=e.models||(e.models={}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){(this._imageUrl=e)&&!this.isStatic&&0!==e.indexOf("data:")&&(this._imageUrl=jsCommon.Utility.getAbsoluteUri(e))},enumerable:!1,configurable:!0}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===i.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},e.ImageTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(i){!function(e){function t(e){this.contract=e}e=e.models||(e.models={}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemSmallLandscapeRowSpan},t.prototype.getErrorLocId=function(e,t){return""},e.ModelTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(l){!function(r){var a,h,n,s,t;function e(e,t,i,o,r,a,n,s,l,c,u,d,p){p=h.call(this,e,t,i,o,r,a,n,s,l,c,u,d,p)||this;return p._visual=null,p._localizationService=d,p}a=r.models||(r.models={}),n=r.constants.SingleValueRealTimeWindow,s=l.data.EmptyDataClientError,t=l.data.FailedRealTimeUpdateClientError,h=a.SingleVisualCompositeTileModel,__extends(e,h),e.prototype.setModelId=function(t){return __awaiter(this,void 0,l.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.contract.modelId=t,[4,this.initialize()];case 1:return e.sent(),[2]}})})},e.prototype.getRealTimeModelId=function(){return __awaiter(this,void 0,l.Promise,function(){var i,o=this;return __generator(this,function(e){return this.datasetStore?(i=this.contract,[2,this.datasetStore.findAll(i.modelId,!0).then(function(e){if(!_.isEmpty(e)){var t=_.find(e,function(e){return null==i.packageId||e.packageId===i.packageId});return{id:(t=(t=t||_.find(e,function(e){return jsCommon.EnumExtensions.hasFlag(e.permissions,7)}))||_.first(e)).id,originalModelId:t.originalModelId,tableName:o.getSchemaTableName(),schema:o.getRealTimeConceptualSchema(),packageId:i.packageId}}})]):[2,void 0]})})},e.prototype.setRealTimeModelDependencies=function(e,t,i,o,r){h.prototype.setDependencies.call(this,e),this.visualQueryGenerator=t,this.conceptualSchemaProxy=i,this.realTimeDataService=o,this.datasetStore=r},e.prototype.copyRealTimeModelDependencies=function(i){return __awaiter(this,void 0,l.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(i.schema&&(this.schema=i.schema),i.dataProxy&&i.realTimeDataService&&i.visualQueryGenerator&&i.conceptualSchemaProxy)?(this.setRealTimeModelDependencies(i.dataProxy,i.visualQueryGenerator,i.conceptualSchemaProxy,i.realTimeDataService,i.datasetStore),i.onErrorDelegate&&!this.onErrorDelegate&&(this.onErrorDelegate=i.onErrorDelegate),[4,i.getRealTimeModelId()]):[2];case 1:return t=e.sent(),this.realTimeDataService.replaceListener(t,i,this),[2]}})})},e.prototype.onDataChanged=function(){return __awaiter(this,void 0,l.Promise,function(){var t,o,i,r=this;return __generator(this,function(e){switch(e.label){case 0:return(this.visualQueryGenerator,this.dataProxy,this.singleVisualConfig)?(t=n,(i=this.config)&&i.dataWindow&&(t=i.dataWindow),[4,this.getDatasources()]):[2];case 1:return i=e.sent(),!(o=this.visualQueryGenerator.execute({dataSources:i,schema:this.schema,config:this.singleVisualConfig,additionalFilters:null,dataWindow:t}))||o.error?(i=void 0,o&&o.error&&(i=o.error.getDetails(this._localizationService)),this.onError(i)):this.dataProxy.execute(o.options).then(function(e){r.isError=!1;var t={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null},e=r.lastCategoryValue;try{var i=a.RealTimeModelUtility.getLastDateOrNumericCategoryValue(t.dataView);if(null!=e&&null!=i&&e.valueOf()>=i.valueOf())return;r.lastCategoryValue=i}catch(e){}r.setData(t,o.transforms,r.config.$visualContainer.config.singleVisual.visualType),r.isLoading=!1},function(e){e instanceof s||(e=e&&e.getDetails(r._localizationService),r.onError(e))}),[2]}})})},e.prototype.onError=function(e){e=e||(new t).getDetails(this._localizationService),this.setErrorDetails(e)},e.prototype.getDatasources=function(){return __awaiter(this,void 0,l.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRealTimeModelId()];case 1:return(t=e.sent())?[2,a.RealTimeModelUtility.getRealTimeDataSource(t.id,t.originalModelId)]:[2,void 0]}})})},Object.defineProperty(e.prototype,"singleVisualConfig",{get:function(){return this.config.$visualContainer.config.singleVisual},set:function(e){this.config.$visualContainer.config.singleVisual=e,this.onDataChanged()},enumerable:!1,configurable:!0}),e.prototype.isDataStale=function(){return!1},e.prototype.initialize=function(){return __awaiter(this,void 0,l.Promise,function(){var t,i=this;return __generator(this,function(e){return t=r.ContractUtils.getMasterLayoutPosition(this.contract),this.size={rowSpan:t.height,colSpan:t.width},[2,this.getDatasources().then(function(e){if(e)return i.conceptualSchemaProxy.get(e).then(function(e){return i.fixUpSchema(e),i.schema=e,i.getRealTimeModelId().then(function(e){i.realTimeDataService.subscribe(e,i)})})})]})})},e.prototype.unsubscribe=function(){return __awaiter(this,void 0,l.Promise,function(){var t=this;return __generator(this,function(e){return[2,this.getRealTimeModelId().then(function(e){if(e&&e.tableName)return t.realTimeDataService.unsubscribe(e,t)})]})})},e.prototype.fixUpSchema=function(e){e=e.schema(r.constants.RealTimeDataSourceName).entities;e&&e.length;for(var t=0,i=e[0].properties;t<i.length;t++){var o=i[t];o.type!==l.ValueType.fromDescriptor({numeric:!0})&&o.type!==l.ValueType.fromDescriptor({integer:!0})||(o.kind=1)}},e.prototype.getSchemaTableName=function(){var e=this.getRealTimeConceptualSchema();if(e){e=e.entities;return e.length,_.head(e).name}},e.prototype.getRealTimeConceptualSchema=function(){if(this.schema)return this.schema.schema(r.constants.RealTimeDataSourceName)},e.prototype.setErrorDetails=function(e){this.errorDetails=e,this.errorText=e.message,this.isError=!0},a.RealTimeTileModel=e}(l.dataServices||(l.dataServices={}))}(powerbi=powerbi||{}),function(a){var i,e,n;i=a.dataServices||(a.dataServices={}),e=i.models||(i.models={}),n=e.RealTimeModel,(e=e.RealTimeModelUtility||(e.RealTimeModelUtility={})).getRealTimeDataSource=function(e,t){if(e&&!(e<0))return a.explore.contracts.createDataSourceArray([{id:e,type:a.data.tabular.type,name:i.constants.RealTimeDataSourceName,tabular:{modelId:null!=t?t:e}}])},e.convertToColumnsDefinition=function(e){if(e=a.data.tabular.getColumnsMetadata(e)){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i];t.push({name:r.name,dataType:n.convertToRealTimeDataType(a.ValueType.fromDescriptor(r.type))})}return t}},e.getLastDateOrNumericCategoryValue=function(e){if(e=e&&e.categorical){e=_.head(e.categories),e=e&&e.values;if(!_.isEmpty(e)){e=_.last(e);return e&&!_.isBoolean(e)&&(_.isDate(e)||_.isNumber(e))?e:void 0}}}}(powerbi=powerbi||{}),function(i){!function(e){function t(e){this.contract=e,this.exploration={contract:void 0,exploreCanvas:void 0,sections:[]},this.isError=!1,this.tilesUpdated=!1}e=e.models||(e.models={}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===i.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},e.ReportTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(i){!function(e){function t(e){this.contract=e}e=e.models||(e.models={}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){e&&(0!==e.indexOf("data:")?this._imageUrl=jsCommon.Utility.getAbsoluteUri(e):this._imageUrl=e)},enumerable:!1,configurable:!0}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemLargeLandscapeRowSpan||e.colSpan===i.common.GridLayoutConstants.gridItemLargeLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},e.SsrsTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(g){var f;(function(t){var r,i=jsCommon.ArrayExtensions,a=jsCommon.DateExtensions,n=g.common.utils.DateFormatter,o=g.common.helpers.ModelConverterHelper,s=jsCommon.UrlUtils;function l(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.DashboardIntraDomainNavigationPrefix)}function c(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.ReportIntraDomainNavigationPrefix)}function u(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.RdlReportIntraDomainNavigationPrefix)}function d(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.WorkbookIntraDomainNavigationPrefix)}function p(e){return l(e)||c(e)||u(e)||d(e)}(e=t.IntraDomainNavigationType||(t.IntraDomainNavigationType={}))[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.RdlReport=2]="RdlReport",t.getDashboardGuidFromUrl=function(e){if(!(_.isEmpty(e)||e.length<t.DashboardIntraDomainNavigationPrefix.length)&&l(e))return e.substr(t.DashboardIntraDomainNavigationPrefix.length)},t.IsDashboardIntraDomainPrefix=l,t.IsReportIntraDomainPrefix=c,t.IsRdlReportIntraDomainPrefix=u,t.IsWorkbookIntraDomainPrefix=d,t.IsValidIntraDomainPrefix=p,t.DashboardIntraDomainNavigationPrefix="/dashboards/",t.ReportIntraDomainNavigationPrefix="/reports/",t.RdlReportIntraDomainNavigationPrefix="/rdlreports/",t.WorkbookIntraDomainNavigationPrefix="/workbooks/",(e=r=t.TileConstants||(t.TileConstants={})).SubtitleHeight=10,e.TileDefaultPadding=10,e.RegularHeaderHeight=50,e.SmallHeaderHeight=42,e.LargeHeaderHeight=65,e.sensitivityDesktopBannerHeight=44,e.sensitivityMobileBannerHeight=40,e.sensitivityMobileExpendBannerHeight=64,e.VisualVerticalMargin=20,e.VisualHorizontalMargin=20,e.VisualSmallVerticalMargin=8;var h,e=(Object.defineProperty(m.prototype,"gridLayouts",{get:function(){return this.contract.$layoutConfig.layouts},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"details",{get:function(){switch(this.type){case f.contracts.TileType.composite:return this.composite;case f.contracts.TileType.iframe:return this.iframe;case f.contracts.TileType.image:return this.image;case f.contracts.TileType.model:return this.model;case f.contracts.TileType.ssrs:return this.ssrs;case f.contracts.TileType.workbook:return this.workbook;case f.contracts.TileType.report:return this.reportTile;case f.contracts.TileType.realTime:return this.realTime;default:return null}},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"shouldBeIncludedInTelemetryMeasurement",{get:function(){return this.details&&!!this.details.shouldBeIncludedInTelemetryMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isTemporary",{get:function(){return this.id<=0},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isTileLoading",{get:function(){return this.composite?this.composite.isLoading&&!this.composite.isError:this.isLoading},enumerable:!1,configurable:!0}),m.prototype.calculateLayout=function(e,t){var i,o=this.getHeaderSizeByType(this.tileHeaderSize);_.isNil(this.currentViewPort)||!_.isNil(e)||_.isNil(t)||(e=this.currentViewPort),this.compositeTile&&e&&(i=e,e=2===this.tileHeaderSize,_.isNil(t)||_.isNil(this.currentViewPort)?(e?this.hasTitle()?i.height-=o:1!==(this.composite&&this.composite.config&&this.composite.config.layoutType)&&(i.height-=r.TileDefaultPadding):this.hasTitle()&&(this.hasSubtitle()?i.height-=o:i.height-=o-r.SubtitleHeight),this.currentViewPort=i):0<t&&((o={width:this.currentViewPort.width,height:this.currentViewPort.height}).height-=t,o.height<=0?o.height:i=o),this.compositeTile.calculateLayout(i,e))},m.prototype.getTileHeight=function(){return this.hasTitle()?this.getHeaderSizeByType(this.tileHeaderSize):0},m.prototype.applyLayout=function(e,t){this.compositeTile&&this.compositeTile.applyLayout(e,t)},m.prototype.invalidateLayout=function(){this.tryPopulateLayoutPositionValues()&&this.gridLayoutContext.onLayoutInvalidated()},m.prototype.tryPopulateLayoutPositionValues=function(){if(!this.gridLayoutContext||this.gridLayoutContext.isLayoutUpdateLocked)return!1;var e=this.gridLayoutContext.getActiveLayout(),e=i.extendWithId(this.contract.$layoutConfig.layouts).withId(e);return e&&e.position&&(this.layoutPosition=_.cloneDeep(e.position)),!0},m.prototype.applyChanges=function(){var e,t;this.contract&&this.gridLayoutContext&&(e=_.cloneDeep(this.layoutPosition),t=this.contract.$layoutConfig,f.TileUtils.addOrUpdateLayoutPosition(t,e,this.gridLayoutContext.getActiveLayout()),this.contract.layoutConfig=JSON.stringify(this.contract.$layoutConfig))},m.isValidUrl=function(e,t){return!_.isEmpty(e)&&(s.isValidHttpUrl(e,!1)||t&&p(e))},m.prototype.getDisplayText=function(){return this.displayText||(this.compositeTile?this.compositeTile.heading1:"")},m.prototype.getSubDisplayText=function(){if(this.displayText&&this.subDisplayText)return this.subDisplayText;if(this.compositeTile){var e=this.compositeTile.config;if(!this.displayText&&e&&!_.isEmpty(e.heading3))return e.heading3}return""},m.prototype.shouldPlaceBulletSeperator=function(){return this.displayText&&0<this.displayText.length&&this.subDisplayText&&0<this.subDisplayText.length&&this.config&&this.config.lastRefreshTimeEnabled},Object.defineProperty(m.prototype,"hrefTarget",{get:function(){return this.action.openInSameTab&&!this.forceOpenCustomLinksInNewTab?"_self":"_blank"},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"lastRefreshTimeInLocaleString",{get:function(){var e=o.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime),t="";return e?t=e.toLocaleString():this.datasetModel&&(t=this.datasetModel.lastRefreshTimeInLocaleString),t||""},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"formattedTime",{get:function(){var e;{if(e=this.workbook?(e=this.contract.tilePackage)?o.convertRefreshTimeToJsDateTime(e.lastRefreshTime):null:o.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime))return this.cachedRefreshTime&&e.getTime()===this.cachedRefreshTime.getTime()?this.cachedRefreshString:(this.cachedRefreshTime=e,this.cachedRefreshString=this.getFormattedDateString(e));if(this.datasetModel)return this.datasetModel.lastRefreshTimeInLocaleString}},enumerable:!1,configurable:!0}),m.prototype.getFormattedDateString=function(e){var t=h,i=a.isContainedInTimeFrame,o=a.isMomentPresent();return o&&i(e,t.Minute,t.MaxMinuteThreshold,!1)?n.getPrettyRelativeDate(e,this.localizationService):o&&i(e,t.Day,t.SameDayThreshold,!0)?a.GetTime(this.localizationService.currentLanguageLocale,e):o&&i(e,t.Day,t.YesterdayThreshold,!0)?this.localizationService.format("DashboardTile_YesterdayTemplate",[a.GetTime(this.localizationService.currentLanguageLocale,e)]):o&&i(e,t.Day,t.WeekThreshold,!0)?a.GetDayWithTime(this.localizationService.currentLanguageLocale,e):a.GetFullDateWithTime(this.localizationService.currentLanguageLocale,e)},m.prototype.setDatasetModelAndPackageInfo=function(e,t){e&&(this.datasetModel=e,t&&(this.datasetModel.packagePublishStatus=t.publishOrRefreshStatus))},m.prototype.hasTitle=function(){return(!this.config||!this.config.hideTitle)&&(!_.isEmpty(this.displayText)||this.compositeTile&&!_.isEmpty(this.compositeTile.heading1))},m.prototype.hasSubtitle=function(){var e=this.config;return(!e||!e.hideTitle)&&(!_.isEmpty(this.subDisplayText)||e&&e.lastRefreshTimeEnabled)},m.prototype.lastRefreshTimeInLocaleWithLabel=function(){if(this.config&&this.config.lastRefreshTimeEnabled)return this.localizationService.format("Refreshed",[this.formattedTime])},m.prototype.setTileHeaderSize=function(e){this.tileHeaderSize!==e&&(this.tileHeaderSize=e,this.invalidateLayout())},Object.defineProperty(m.prototype,"compositeTile",{get:function(){return this.composite||this.realTime},enumerable:!1,configurable:!0}),m.prototype.hasLayoutDefinition=function(e){return!!i.extendWithId(this.contract.$layoutConfig.layouts).withId(e)},m.prototype.hasLayoutPosition=function(e){return!!f.ContractUtils.getLayoutPosition(this.contract,e)},m.prototype.removeLayoutPosition=function(e){return this.hasLayoutDefinition(e=void 0===e?1:e)&&(this.addLayout({id:e,position:null},e),this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},m.prototype.resetTileLayoutSizeAndPosition=function(){this.layoutPosition.x=null,this.layoutPosition.y=null,this.layoutPosition.height=null,this.layoutPosition.width=null,this.gridLayoutContext=null},m.prototype.removeLayoutDefinition=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.hasLayoutDefinition(t)&&(_.remove(this.contract.$layoutConfig.layouts,function(e){return e.id===t}),e&&this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},m.prototype.applyLayoutSize=function(e,t,i){this.compositeTile&&(this.compositeTile.size={colSpan:e.colSpan,rowSpan:e.rowSpan}),this.applyLayout(t,i)},m.prototype.getCurrentTileLayoutDescriptor=function(e,t,i){e=e||this.contract.$layoutConfig;return f.TileUtils.getCurrentTileLayoutDescriptor(this.contract,e,t,i)},m.prototype.buildLayoutDescriptor=function(){var e=_.cloneDeep(this.layoutPosition),t=_.cloneDeep(this.contract.$layoutConfig);f.TileUtils.addOrUpdateLayoutPosition(t,e,this.gridLayoutContext.getActiveLayout());var i=this.composite&&this.composite.contract&&this.composite.contract.query,o=i&&f.TileUtils.getTileQueryAfterResize(i,e),e=null;return i&&o&&(this.composite.contract.query.modelQuery.sq=JSON.stringify(o),e=JSON.stringify(this.composite.contract.query)),f.TileUtils.getCurrentTileLayoutDescriptor(this.contract,t,i,e)},m.prototype.addLayout=function(e,t){return this.removeLayoutDefinition(t),this.contract.$layoutConfig.layouts.push(e),this.getCurrentTileLayoutDescriptor()},m.prototype.getHeaderSizeByType=function(e){switch(e){case 0:return r.LargeHeaderHeight;case 2:return r.SmallHeaderHeight;default:return r.RegularHeaderHeight}},m);function m(e,t,i){this.forceOpenCustomLinksInNewTab=i,this.isSelected=!1,this.hasConversation=!1,this.hasSpotlight=!1,this.contract=e,this.tileHeaderSize=1,this.layoutPosition={},this.localizationService=t,this.themeName="Light",this.tileStyles={},this.tileHeaderStyles={},this.tileBackground={}}t.Tile=e,(e=h=h||{}).Minute="minute",e.Day="day",e.MaxMinuteThreshold=15,e.SameDayThreshold=0,e.YesterdayThreshold=1,e.WeekThreshold=6})((f=g.dataServices||(g.dataServices={})).models||(f.models={}))}(powerbi=powerbi||{}),function(i){!function(e){function t(e,t){this.contract=e,this.tileModel=t}e=e.models||(e.models={}),t.prototype.canResizeTo=function(e){return e.rowSpan===i.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===i.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){var i,o=[];switch(e){case 10:i="WorkbookTile_GeneralError";break;case 11:i="WorkbookTile_FileNotFound";break;case 12:i="WorkbookTile_ObjectNotFound",o=this.contract.$config.workbookTile?[this.contract.$config.workbookTile.item]:["pinned object"];break;case 13:i="WorkbookTile_Unauthorized";break;default:return""}return t.format(i,o)},t.prototype.hasImages=function(){return this.hasWorkbookTileConfig&&this.tileModel.config.workbookTile.images&&0<this.tileModel.config.workbookTile.images.length},Object.defineProperty(t.prototype,"images",{get:function(){return this.hasWorkbookTileConfig?this.tileModel.config.workbookTile.images:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasWorkbookTileConfig",{get:function(){return!!this.tileModel&&!!this.tileModel.config&&!!this.tileModel.config.workbookTile},enumerable:!1,configurable:!0}),e.WorkbookTileModel=t}(i.dataServices||(i.dataServices={}))}(powerbi=powerbi||{}),function(e){var i;function t(e){if(e&&e.modelQuery&&e.modelQuery.sq){var t;try{t=JSON.parse(e.modelQuery.sq)}catch(e){}if(t){var i=null;return(e=t).dataQuery&&e.dataQuery.Commands&&0<e.dataQuery.Commands.length?i=t.dataQuery:(e=t).Commands&&0<e.Commands.length?i=t:t.defn&&(i={Commands:[{SemanticQueryDataShapeCommand:{Query:t.defn,Binding:t.shape}}]}),i}}}function o(e,t){e.$layoutConfig,e.$layoutConfig.layouts;t=i.extendWithId(e.$layoutConfig.layouts).withId(t);return t?t.position:null}e=e.dataServices||(e.dataServices={}),i=jsCommon.ArrayExtensions,(e=e.ContractUtils||(e.ContractUtils={})).findContentProviderId=function(e,t){if(e)for(var i=e.length,o=0;o<i;o++)if(e[o].id===t)return e[o].contentProviderId;return null},e.convertToSemanticQueryWithDataShapeBinding=function(e){if((e=t(e))&&e.Commands&&0<e.Commands.length){e=e.Commands[0].SemanticQueryDataShapeCommand;return{defn:e.Query,shape:e.Binding}}return null},e.convertToTileDataQuery=t,e.createMasterLayoutConfig=function(e){return{layouts:[{id:0,position:e=void 0===e?{}:e}]}},e.getMasterLayoutPosition=function(e){return e=o(e,0)},e.getLayoutPosition=o,e.reportTypeToString=function(e){switch(e){case 0:return"pbix";case 1:return"rdl";default:return"unknown"}}}(powerbi=powerbi||{}),function(e){var i,o;e=e.dataServices||(e.dataServices={}),i=jsCommon.DateExtensions,o=jsCommon.Utility,(e.DateUtils||(e.DateUtils={})).convertDate=function(e){var t=o.getDateFromWcfJsonString(e,!0);return t=t||i.parseIsoDate(e)}}(powerbi=powerbi||{}),function(o){var i,e,t,r,a,n;function s(e){return e&&5===e.category}function l(e){return 7===e.category||6===e.category||3===e.category}function c(e){return e.originalPackageId||(e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0)}function u(e,t){if(e){e=t.getAppInstance(e);return e&&e.providerContract.providerKey}}function d(e){return!(e.icon||_.isEmpty(e.iconUrl)&&_.isEmpty(e.localAppLogoImageData))}function p(e,t){if(d(e))return e.localAppLogoImageData||(e.iconUrl?a.urlCombine(t,e.iconUrl):void 0)}function h(t,e){e=_.find(e.packages,function(e){return e.contract.folderId===t&&e.contract.serviceAppObjectId});if(e)return e.id}function m(e,t){e=t.findPackage(e);if(e&&e.contract&&e.contract.folderId)return h(e.contract.folderId,t)}i=o.dataServices||(o.dataServices={}),t=jsCommon.Color,r=o.common.models.Model,a=jsCommon.Utility,n=i.models.Workbook,(e=i.AppUtils||(i.AppUtils={})).isOrgApp=s,e.isOrgAppInstance=function(e,t){return(e=t.getAppInstance(e))&&s(e.providerContract)},e.isParameterizedApp=l,e.isParameterizedAppInstance=function(e,t){return(e=t.getAppInstance(e))&&l(e.providerContract)},e.getDashboardAppGUID=function(e,t){if(e&&e.contract)return u(e.getUniquePackageId&&e.getUniquePackageId(),t)},e.getDashboardAppGUIDByContract=function(e,t){if(e)return u(c(e),t)},e.getUniquePackageId=c,e.getResourceAppGUID=function(e,t){if(e)return u(e.packageId,t)},e.getAppGUIDByPackageId=u,e.convertDisplayDate=function(e,t){return(e=i.DateUtils.convertDate(e))&&e.toLocaleDateString(t.currentLanguageLocale,{month:"short",day:"numeric",year:"numeric"})},e.hasAppLogoImage=d,e.getAppLogoImageUrl=p,e.getAppLogoImageUrlStyle=function(e,t){if(d(e))return"url("+p(e,t)+")"},e.getAppHeaderFontColor=function(e){return e?125<.299*(e=t.parseColorString(e)).R+.587*e.G+.144*e.B?"#000":"#FFF":"inherit"},e.getAppHeaderBackgroundColor=function(e){if(e)return t.calculateHighlightColor(t.parseColorString(e),.8,.2)},e.getAppContentModelObjectId=function(e){return e instanceof r?e.dbName:e instanceof n?e.uniqueId:e.objectId},e.getAppAuthor=function(e){if(e=jsCommon.JsonExtensions.tryParseJSON(e.providerConfig))return e.author},e.getServiceAppWorkspacePackageIdByFolderId=h,e.getServiceAppWorkspacePackageId=m,e.isServiceApp=function(e,t){return null!=m(e,t)},e.findContentProviderName=function(e,t){var i="Unknown";return e&&t&&(6===t?i="Excel Workbook":7===t?i="Power BI Designer File":17===t?i="OrgContent":60===t?i="CSV File":(t=_.find(e,{id:t}))&&(i=t.clientCategory===o.common.contracts.ContentProviderClientCategory.Organizational?"OrgContent":t.displayText)),i}}(powerbi=powerbi||{}),function(r){var e,t,o;function C(e,t,i){var o=e[e.length-1];!_.isEmpty(e)&&t>=o.startPosition&&t<o.startPosition+o.size?t+i>o.startPosition+o.size&&(o.size=t+i-o.startPosition):e.push({startPosition:t,size:i})}function w(e,t,i){return 1<e.length&&i&&t<=o}e=r.dataServices||(r.dataServices={}),t=r.common.helpers.ModelConverterHelper,o=3,(e=e.DashboardUtils||(e.DashboardUtils={})).isWriteable=function(e){return 2==(2&e.permissions)},e.notifyReadOnly=function(e,t,i,o){return e="NotifiedReadOnlyDashboard"+e.id,(o=o||!r.common.sessionStorageService.getData(e))&&(t.notify({title:i.get("Warning_Title"),message:i.get("DashboardReadOnlyWarning_Message"),notificationType:1}),r.common.sessionStorageService.setData(e,!0)),o},e.isQnaSupportedModel=function(e){return!!e&&t.getIsQnaSupported(e)},e.getDashboardModels=function(e,t){var i=[];if(!e)return i;var o=[],r=e.modelIds;if(_.isEmpty(r)||(o=r.slice(0)),e=e.tiles,_.map(e,function(e){null!=e.modelId&&o.push(e.modelId)}),_.isEmpty(o))return i;for(var o=_.uniq(o),a=0,n=o.length;a<n;a++){var s=_.filter(t,function(e){return e.id===o[a]});_.isEmpty(s)||i.push(s[0])}return i},e.orderItems=function(e){for(var t=_.filter(e,function(e){var t;return 0<(null===(t=e.pos)||void 0===t?void 0:t.x)&&0<(null===(e=e.pos)||void 0===e?void 0:e.y)}),i=[],o=_.sortBy(t,function(e){e=e.pos;return 1e3*e.y+e.x}),r=0,a=o;r<a.length;r++)C(i,(n=a[r].pos).y,n.height);for(var n,s=[],e=_.sortBy(t,function(e){e=e.pos;return 1e3*e.x+e.y}),l=0,c=e;l<c.length;l++)C(s,(n=c[l].pos).x,n.width);for(var u=function(t,i){var e=_.isEmpty(t)?-1/0:_.maxBy(t,function(e){return e.size}).size,o=_.isEmpty(i)?-1/0:_.maxBy(i,function(e){return e.size}).size,r=_.every(t,function(e){return e.size===t[0].size}),a=_.every(i,function(e){return e.size===i[0].size});o=w(t,e,r)||!w(i,o,a)&&e<=o?0:1;return o}(i,s),o=0===u?e:o,d=[],p=0,h=0,m=t=0===u?i:s;h<m.length;h++){for(var g=m[h],f=p+1;f<g.startPosition;f++)d.push(void 0);for(var y=g.startPosition;y<g.startPosition+g.size;y++)d.push(g.startPosition),p=y}for(var v=_.groupBy(o,function(e){e=0===u?e.pos.y:e.pos.x;return d[e-1]}),T=[],b=0,S=t;b<S.length;b++)g=S[b],T=T.concat(v[g.startPosition]);return _.map(T,function(e){return e.item})},e.containsLayout=function(e,t,i){if(!i||!i.tiles)return!1;switch(e){case 0:return _.some(i.tiles,function(e){return e.hasLayoutDefinition(t)});case 1:return _.some(i.tiles,function(e){return e.hasLayoutPosition(t)})}},e.markTilesAsNewIfNeeded=function(e){for(var t=[],i=0,o=e.tiles;i<o.length;i++){var r=o[i];r.hasLayoutDefinition(1)?r.shouldNewBadgeAppear=!1:t.push(r.addLayout({id:1,position:null},1))}return t}}(powerbi=powerbi||{}),function(e){var t,o,r,i,a;t=e.dataServices||(e.dataServices={}),r=t.contracts,i=e.visuals.plugins,a="__default__",e=t.TileDefaultSizesUtils||(t.TileDefaultSizesUtils={}),o={},(t={})[r.TileType[r.TileType.report]]=6,t[i.card.name]=2,t[i.animatedNumber.name]=2,t[i.textbox.name]=2,t[a]=3,o[1]=t,e.getRowSpan=function(e,t){var i=o[t=void 0===t?1:t];return i?(t=r.TileType[e.type],i[t]||!e.composite||(e=e.composite)&&(t=e.visual.type),i[t]||i[a]):1}}(powerbi=powerbi||{}),function(h){var m,i,c,r,o,l,g,t;function e(){this.rScriptCount=0,this.pythonScriptCount=0}function f(e,t,i,o,r,a,n,s){s=s.execute({dataSources:e,schema:r,config:t,additionalFilters:null,dataWindow:i}),r=a.getPinData({name:"tile",config:{singleVisual:t},layouts:void 0},0,e,{},null,null,s,r);r.realTimeDataWindow=i;n=n.capabilities(l.getVisualType(r));return m.models.TileFactory.createTileForPinData(r,n,o)}m=h.dataServices||(h.dataServices={}),r=jsCommon.ArrayExtensions,o=jsCommon.JsonExtensions,l=h.explore.contracts.PinData,g=m.contracts.TileType,t=jsCommon.Version,i=m.TileUtils||(m.TileUtils={}),Object.defineProperty(e.prototype,"hasScriptVisuals",{get:function(){return 0<this.rScriptCount||0<this.pythonScriptCount},enumerable:!1,configurable:!0}),c=e,i.ScriptVisualCounts=c,i.getUpdatedContract=f,i.UpdateRealTimeTile=function(r,a,n,s,l,c,u,d,p){return __awaiter(this,void 0,h.Promise,function(){var t,i,o;return __generator(this,function(e){switch(e.label){case 0:return r.type===m.contracts.TileType.realTime&&r.realTime,[4,(t=r.realTime).getDatasources()];case 1:return(o=e.sent(),i=f(o,a,n,s,l,c,u,d),o=i.$config)?(o.hideTitle=r.config.hideTitle,r.config=o,r.realTime.config=o.realTimeVisual,(o=r.contract).query=i.query,o.modelId=i.modelId,r.isTemporary&&(o=m.ContractUtils.getMasterLayoutPosition(o),i=m.ContractUtils.getMasterLayoutPosition(i),o.width=i.width,o.height=i.height,o={colSpan:o.width,rowSpan:o.height},r.calculateLayout(h.common.GridLayoutConstants.getDefaultGridItemViewport(o)),r.invalidateLayout()),t.singleVisualConfig=a,[2]):(p.logEvent(h.telemetry.DashboardTileError,{tileType:g[g.realTime],message:"Invalid tile config object"}),[2])}})})},i.getVisualType=function(e){if(e){e=e.visualContainer||e.realTimeVisual;return e&&e.$visualContainer?e.$visualContainer.config.singleVisual.visualType:void 0}},i.tileContainsScriptVisuals=function(e,t){return i.isScriptVisualTile(e,t)||i.countTileScriptVisuals(e,t).hasScriptVisuals},i.isScriptVisualTile=function(e,t){return e&&e.type===g.composite&&t.isScriptVisual(i.getVisualType(e.config))},i.countTileScriptVisuals=function(e,t){var i=new c,o=e&&e.reportTile&&e.reportTile.exploration&&e.reportTile.exploration.sections;if(!o||e.type!==g.report)return i;for(var r=0,a=o;r<a.length;r++)for(var n=0,s=a[r].contract.visualContainers;n<s.length;n++){var l=s[n],l=h.explore.util.VisualContainerUtils.getVisualType(l);if(l&&t&&t.isScriptVisual(l))switch(h.explore.util.ScriptVisualsUtil.getScriptVisualType(l)){case 0:i.rScriptCount++;break;case 1:i.pythonScriptCount++}}return i},i.tileTrackerFn=function(e,t){return"tile_"+e.id+"_dash_"+t},i.createDefaultPhoneByTile=function(e,t,i){var o=m.TileDefaultSizesUtils.getRowSpan(i,1),r=i.addLayout({id:1,position:{y:e,x:t,width:6,height:o}},1);return i.layoutPosition.y=e,i.layoutPosition.x=t,i.layoutPosition.height=o,i.layoutPosition.width=6,r},i.getTileErrorDetailsFromQueryResultError=function(e,t){if((e=o.tryParseJSON(e.errorDetail))&&!_.isEmpty(e.DataShapes)){e=e.DataShapes[0]["odata.error"];if(e)return new h.DsrClientError(e).getDetails(t)}},i.convertTileLayoutConfig=function(e){if(e.$layoutConfig)return e.$layoutConfig;var t={x:e.col,y:e.row,width:e.colSpan,height:e.rowSpan},i=void 0;if(e.layoutConfig)try{i=JSON.parse(e.layoutConfig);r.extendWithId(i.layouts).withId(0).position=t}catch(e){}else i={layouts:[{id:0,position:t}]};return i},i.addOrUpdateLayoutPosition=function(e,t,i){var o=r.extendWithId(e.layouts);(e=o.withId(i))||o.push(e={id:i,position:{}}),e.position=t},i.getCurrentTileLayoutDescriptor=function(e,t,i,o){return{id:e.id,row:null,col:null,rowSpan:null,colSpan:null,layoutConfig:JSON.stringify(t),query:o?i:null,updatedQuery:o,modelId:e.modelId,objectId:e.objectId}},i.getTileQueryAfterResize=function(e,t){if(e=m.ContractUtils.convertToTileDataQuery(e)){for(var i=t.width*h.common.GridLayoutConstants.defaultGridWidth,o=t.height*h.common.GridLayoutConstants.defaultGridHeight,r=!1,a=0,n=e.Commands;a<n.length;a++){var s,l,c=n[a],u=c.ScriptVisualCommand;u&&(s=u.ViewportWidthPx,l=u.ViewportHeightPx,s===i&&l===o||(u.ViewportWidthPx=i,u.ViewportHeightPx=o,c.ScriptVisualCommand=u,r=!0))}return r?e:void 0}},i.deserializeTileConfig=function(e){return e=null==(e=o.tryParseJSON(e))?{version:t.ZeroStr}:e}}(powerbi=powerbi||{}),function(e){var t,i,o;t=e.dataServices||(e.dataServices={}),i=jsCommon.EnumExtensions,o=e.common.contracts.PackageType,(t=t.PermissionsUtils||(t.PermissionsUtils={})).isPackageTemplateInstance=function(e){return!(!e||e.packageType!==o.AppInstance)&&!(!e.contentProviderId&&!e.serviceContentProviderId)},t.canReshare=function(e){return i.hasFlag(e,6)},t.hasWriteFlag=function(e){return jsCommon.EnumExtensions.hasFlag(e,2)}}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).events||(e.events={})).syncServiceDashboardEditedEvent={name:"syncServiceDashboardEdited",type:4},e.syncServiceDashboardDeepEditedEvent={name:"syncServiceDashboardDeepEdited",type:4},e.syncServiceTilesAddedOrUpdated={name:"syncServiceTilesAddedOrUpdated",type:4},e.syncServiceCustomTilesUpdate={name:"syncServiceCustomTilesUpdate",type:4},e.syncServiceTileDeleted={name:"syncServiceTileDeleted",type:4}}(powerbi=powerbi||{}),function(e){var t,o,r,a;t=(t=e.dataServices||(e.dataServices={})).models||(t.models={}),o=e.dataServices.ContractUtils,r=e.dataServices.models.RealTimeTileModel,a=e.dataServices.contracts.TileType,t.convertRealTimeTile=function(e,t){if(e&&e.type===a.realTime){var i=t.tileModelConverter.convertTileConfig(e);t.tileModelConverter.convertTileLayoutConfig(e);t=new r(e,t.visualPlugin,t.visualPluginOps,t.featureSwitchService,t.geolocationService,t.geocoder,t.promiseFactory,t.moduleLoader,t.telemetryService,t.themeService,t.authenticationService,t.localizationService,t.visualHostTooltipService);i&&i.realTimeVisual&&(t.config=i.realTimeVisual),t.displayText=e.displayText,t.subDisplayText=e.subDisplayText;e=o.getMasterLayoutPosition(e);return t.size={rowSpan:e.height,colSpan:e.width},t}}}(powerbi=powerbi||{}),function(l){var c;(function(o){var a=jsCommon.GzipUtility,n=jsCommon.PerfTimer,r=c.contracts.TileType,i=jsCommon.Utility,s=l.dataServices.TileUtils;o.createTileModelConverter=function(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m){return new g(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m)};var g=(e.prototype.convertCompositeTile=function(e){if(!e||e.type!==r.composite)return null;var t,i=this.convertTileConfig(e);if(this.convertTileLayoutConfig(e),!i||!i.visualContainer)return null;(t=new o.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)).config=i.visualContainer,t.displayText=e.displayText,t.subDisplayText=e.subDisplayText;i=c.ContractUtils.getMasterLayoutPosition(e);return t.size={rowSpan:i.height,colSpan:i.width},t.isLoading=o.TileFactory.isTileLoading(e),e.queryResultError&&(t.isError=!0,i=e.queryResultError,this.telemetryService.logEvent(l.telemetry.DashboardTileError,{tileType:r[r.composite],message:jsCommon.StringExtensions.format("{0}:{1} with rootActivityId:{2}, modelId:{3} and tileId:{4}",jsCommon.EnumExtensions.toString(c.contracts.QueryResultErrorType,i.type),i.errorDetail,i.rootActivityId,e.modelId.toString(),e.id.toString())}),(i=s.getTileErrorDetailsFromQueryResultError(i,this.localizationService))?(t.errorDetails=i,t.errorText=i.message):t.errorText=this.localizationService.get("Tile_ErrorText")),t},e.prototype.convertTileData=function(t){if(t.tileDataSet)return t.tileDataSet;var e=this.convertTileConfig(t);try{t.tileDataSet=this.parseTileData(t,e.tileDataType)}catch(e){throw this.telemetryService.logEvent(l.telemetry.DashboardTileError,{tileType:r[r.composite],message:jsCommon.StringExtensions.format("DsrParseError:{0} with modelId:{1} and tileId:{2}",e.message,t.modelId.toString(),t.id.toString())}),i.ensureError(e)}return t.tileDataSet},e.prototype.convertTileConfig=function(e){if(!(i=e.$config)){var t=n.start("Parse tile config");try{var i,o=(i=e.$config=s.deserializeTileConfig(e.config)).visualContainer||i.realTimeVisual;this.deserializeVisualContainer(o);var r=o||i.visual;this.deserializeModelExtensions(r),this.tileConfigUpgraderService.upgrade(e.id,i,e.query)}catch(e){}finally{t()}}return i},e.prototype.convertTileLayoutConfig=function(e){var t;return e.$layoutConfig||(t=s.convertTileLayoutConfig(e),e.$layoutConfig=t,e.layoutConfig=JSON.stringify(t)),e.$layoutConfig},e.prototype.deserializeVisualContainer=function(e){e&&e.visualContainer&&!e.$visualContainer&&(e.$visualContainer=this.explorationSerializer.deserializeCanvasItem(e.visualContainer))},e.prototype.deserializeModelExtensions=function(e){e&&e.modelExtensions&&!e.$modelExtensions&&(e.$modelExtensions=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions))},e.prototype.parseTileData=function(e,t){var i,o,r=n.start("Parse tile data");try{return e.tileDataBinaryBase64Encoded?(i=a.uncompress(e.tileDataBinaryBase64Encoded),o=JSON.parse(i)):e.tileData&&(o=JSON.parse(e.tileData)),{type:t,data:o}}finally{r()}},e);function e(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m){this.geolocationService=e,this.telemetryService=t,this.visualPlugins=i,this.visualPluginOps=o,this.featureSwitchService=r,this.geocoder=a,this.promiseFactory=n,this.moduleLoader=s,this.tileConfigUpgraderService=l,this.explorationSerializer=c,this.themeService=u,this.authenticationService=d,this.localizationService=p,this.visualHostTooltipService=h,this.licenseUIManagerFactory=m}})((c=l.dataServices||(l.dataServices={})).models||(c.models={}))}(powerbi=powerbi||{});