"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('donutChartVisuals.min.js');var es6,powerbi,__spreadArray=this&&this.__spreadArray||function(t,e){for(var a=0,i=e.length,r=t.length;a<i;a++,r++)t[r]=e[a];return t},__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();!function(t){var h;function l(t,e,a){var i=Math.sqrt(a.x*a.x+a.y*a.y);if(i<e.innerRadius)return!1;if(i>e.outerRadius)return!1;a=r(a);return!(a<t.startAngle)&&!(a>t.endAngle)}function r(t){if(t){var e=t.x,t=-t.y,t=Math.atan2(e,t);return t<0&&(t+=2*Math.PI),t}}h=t.visuals||(t.visuals={}),(t=h.DonutLabelUtils||(h.DonutLabelUtils={})).DiagonalLineIndex=0,t.HorizontalLineIndex=1,t.getLabelLeaderLineForDonutChart=function(t,e,a,i,r,n,o){void 0===r&&(r=0),void 0===n&&(n=0);var s,l,d=.8/.9*1.025;return t=(i=void 0===i?0:i)?(s=i,i=e.labelRadius,l=[Math.cos(s)*i,Math.sin(s)*i],[Math.cos(s)*i,Math.sin(s)*i]):(l=e.labelArc.centroid(t),e.labelArc.centroid(t)),null!=o&&o.pieChartMarginBetweenSlices&&(l[0]=l[0]-r,l[1]=l[1]-n,t[0]=t[0]-r,t[1]=t[1]-n),r=a.x,n=h.DataLabelViewModel.maxLabelOffset/2,a=[r+=r<0?-n:n,a.y],t[0]*=d,t[1]*=d,[t,l,a]},t.getLabelLeaderLinesSizeForDonutChart=function(t){return t&&2<t.length?[{width:Math.abs(t[1][0]-t[0][0]),height:Math.abs(t[1][1]-t[0][1])},{width:Math.abs(t[2][0]-t[1][0]),height:h.DataLabelRenderer.LineStrokeWidth}]:null},t.getXPositionForDonutLabel=function(t){return t+(t<0?-h.DataLabelViewModel.maxLabelOffset:h.DataLabelViewModel.maxLabelOffset)},t.getSpaceAvailableForDonutLabels=function(t,e){return e.width/2-Math.abs(t)-h.DataLabelViewModel.maxLabelOffset},t.getLabelPosition=function(t,e){var a;return Math.PI,a=e*Math.sin(t-Math.PI/2),{x:e*Math.cos(t-Math.PI/2),y:a}},t.canLabelFit=function(t,e,a){for(var i=a.left,r=a.left+a.width,n=a.top,a=a.top+a.height,o=0,s=[{x:i,y:n},{x:i,y:a},{x:r,y:n},{x:r,y:a}];o<s.length;o++)if(!l(t,e,s[o]))return!1;return!0},t.canPointFit=l,t.getAngleFromPoint=r}(powerbi=powerbi||{}),function(p){!function(A){var o,t,s=p.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,D=jsCommon.EnumExtensions,a=A.labelStyle,w=A.labelStyle.labelStyleFlagEnum;(t=o=o||{}).animationDurationMs=500,t.ease="cubic-in-out",A.donutChartProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"}},slices:{innerRadiusRatio:{objectName:"slices",propertyName:"innerRadiusRatio"},startAngle:{objectName:"slices",propertyName:"startAngle"},borderWidth:{objectName:"slices",propertyName:"borderWidth"},borderColor:{objectName:"slices",propertyName:"borderColor"},explode:{objectName:"slices",propertyName:"explode"}},labels:{position:{objectName:"labels",propertyName:"position"},overflow:{objectName:"labels",propertyName:"overflow"},background:{objectName:"labels",propertyName:"background"}}};var y=e("slice"),b=e("slice-highlight"),c=2*Math.PI;A.DefaultDonutStrokeColorName="foregroundLight";var R=(x.getDefaultDonutLabelSettings=function(t){t=x.getDefaultLabelSettings(t);return t.labelStyle=a.category,t.percentagePrecision=A.DataLabelViewModel.defaultPercentageLabelPrecision,t.position=A.donutLabelPosition.outside,t.overflow=!0,t.enableBackgroundWithAuto=A.donutLabelBackground.auto,t.bold=!1,t.italic=!1,t.underline=!1,t},x.converter=function(t,e,a,i,r,n,o,s){t=new d.DonutChartConverter(t,e,a,o=void 0===o?!0:o);t.convert();var l,a=t.startAngle*(Math.PI/x.OnePiRadianInDegree),o=a+2*Math.PI,o=d3.pie().startAngle(a).endAngle(o).sort(null).value(function(t){return t.percentage});n&&(l=!t.hasCategoryData&&t.hasSeriesData?A.DataPointNavigationStrategy.SeriesOnly:t.hasCategoryData&&t.hasSeriesData?A.DataPointNavigationStrategy.CategoryFirst:A.DataPointNavigationStrategy.CategoryOnly,n.applySelectionStateToData(t.dataPoints),n.applySelectionStateToData(t.legendData.dataPoints));s=!r&&i?x.cullDataByViewport(t.dataPoints,t.maxValue,i,e.isHighContrast,t.borderWidth,s):t.dataPoints;return{dataPointsToDeprecate:s,dataPoints:o(s),unCulledDataPoints:t.dataPoints,dataPointsToEnumerate:t.legendData.dataPoints,legendData:t.legendData,hasHighlights:t.hasHighlights,highlightsOverflow:t.highlightsOverflow,dataLabelsSettings:t.dataLabelsSettings,legendObjectProperties:t.legendObjectProperties,maxValue:t.maxValue,visibleGeometryCulled:t.dataPoints.length!==s.length,hasNegativeValues:t.hasNegativeValues,allValuesAreNegative:t.allValuesAreNegative,donutInnerRadiusRatio:t.donutInnerRadiusRatio,startAngle:t.startAngle,navigationStrategy:l,explode:t.explode,borderWidth:t.borderWidth,borderColor:t.borderColor,hasDynamicSeries:t.hasDynamicSeries}},x.prototype.getFirstElement=function(){var t=this.flattenViewModel();if(_.isEmpty(t))return{element:null};var e=t[0].categoryIndex,t=t[0].seriesIndex;return{element:this.findHTMLElement(e,t)}},x.prototype.getNextDataPoint=function(t,e,a){var i=this.flattenViewModel(),a=A.NavigationUtils.getNextFromFlattenedViewModel(i,t,e,this.data.navigationStrategy,a);return{element:this.findHTMLElement(a.categoryIndex,a.seriesIndex)}},x.prototype.findHTMLElement=function(e,a){return this.mainGraphicsContext.selectAll(y.selector).filter(function(t){return t.data.categoryIndex===e&&t.data.seriesIndex===a}).node()},x.prototype.flattenViewModel=function(){return this.data.dataPoints.map(function(t){return{categoryIndex:t.data.categoryIndex,seriesIndex:t.data.seriesIndex}})},x.prototype.init=function(t){this.options=t,this.featureSwitches=t.featureSwitches;var e=t.element;e.empty(),this.parentViewport=t.viewport,this.currentViewport={height:t.viewport.height,width:t.viewport.width},this.style=t.style,this.colors=this.style.colorPalette.dataColors;var a=A.Legend.getDefaultLegendData(this.style);this.data={dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:a,hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?x.DefaultDonutInnerRadiusRatio:0,startAngle:x.DefaultStartAngleDegrees,navigationStrategy:null,explode:x.DefaultExplode,borderWidth:x.DefaultBorderWidth,borderColor:A.DefaultDonutStrokeColorName},this.radius=0,this.maxOffset=0,this.mobileInteractiveLegend=t.interactivity&&t.interactivity.isInteractiveLegend,this.hostService=t.host,this.behavior&&(this.interactivityService=A.createInteractivityService(this.hostService)),this.legend=A.createLegend(e,t.interactivity&&t.interactivity.isInteractiveLegend,this.interactivityService,this.isScrollable,void 0,this.style,this.hostService),this.tooltipService=A.createTooltipService(this.hostService),this.mobileInteractiveLegend&&(a=this.legendContainer=d3.select(e.get(0)).append("div").classed("donutLegend",!0),this.interactivityState={interactiveLegend:new i(this,a,this.colors,t),valueToAngleFactor:0,sliceAngles:[],currentRotate:0,interactiveChosenSliceFinishedSetting:!1,lastChosenInteractiveSliceIndex:0,totalDragAngleDifference:0,currentIndexDrag:0,previousIndexDrag:0,previousDragAngle:0,donutCenter:{x:0,y:0}}),this.svg=d3.select(e.get(0)).append("svg").style("position","absolute").classed("donutChart",!0),this.behavior&&(this.clearCatcher=A.appendClearCatcher(this.svg)),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("slices",!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0).attr("aria-label",this.hostService.getLocalizedString("Visual_Plot")).attr("aria-multiselectable",!0).attr("role","listbox").classed(A.SetFocusRingClassName,!e)),this.labelBackgroundGraphicsContext=this.svg.append("g").classed(A.DataLabelViewModel.labelBackgroundGraphicsContextClass.class,!0),this.labelGraphicsContext=this.svg.append("g").classed(A.DataLabelViewModel.labelGraphicsContextClass.class,!0),this.pie=d3.pie().sort(null).value(function(t){return t.percentage})},x.prototype.update=function(t){var e=t.viewport;this.parentViewport=e;e=this.dataViews;t.type===p.VisualUpdateType.Resize||t.type===p.VisualUpdateType.ResizeEnd||(t.dataViews,(e=this.dataViews=t.dataViews)&&0<e.length&&e[0].categorical?this.data=x.converter(e[0],this.style,this.isDonutChart,this.parentViewport,this.disableGeometricCulling,this.interactivityService,this.tooltipsEnabled,this.featureSwitches):this.data={dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:A.Legend.getDefaultLegendData(this.style),hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?x.DefaultDonutInnerRadiusRatio:0,startAngle:x.DefaultStartAngleDegrees,navigationStrategy:null,explode:x.DefaultExplode,borderWidth:x.DefaultBorderWidth,borderColor:A.DefaultDonutStrokeColorName}),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.initViewportDependantProperties(),this.initDonutProperties(),this.updateInternal(this.data,t.suppressAnimations),e&&(e=A.getInvalidValueWarnings(e,!1,!1,!1,["Tooltips"]),this.data.allValuesAreNegative?e.push(new A.AllNegativeValuesWarning):this.data.hasNegativeValues&&e.push(new A.NegativeValuesNotSupportedWarning),this.hostService.setWarnings(e))},x.prototype.getLegendCard=function(){var t=this.data.legendData;return A.Legend.getLegendFormattingModel({legendData:t},this.hostService,this.featureSwitches)},x.prototype.getSlicesCard=function(){var e=this,t=this.data;if(t){var a=A.donutChartObjectDescriptorProps.slices,i=function(t){return e.hostService.getLocalizedString(t)},r=[A.donutChartObjectDescriptorProps.dataPoint.fill,a.innerRadiusRatio,a.borderColor,a.borderWidth,a.explode],r=new A.builder.FormattingCardBuilder(new A.builder.FormattingCardUidBuilder("slices"),"Role_DisplayName_Slices",r,i),n=A.LegendData.toIEnumerableDataPoints(t.legendData);return 0<n.length&&r.addGroup("colors",function(t){t.withDisplayName("Visual_Colors");t={groupBuilder:t,dataPoints:n,seriesColorProps:A.donutChartObjectDescriptorProps.dataPoint,localize:i,featureSwitches:e.featureSwitches};p.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t)}),this.featureSwitches.pieChartMarginBetweenSlices?(0!==this.maxOffset&&this.data.explode>this.maxOffset&&(this.data.explode=this.maxOffset),r.addGroup("border",function(t){t.withDisplayName("Visual_Border").addSimpleSlice("borderColor",function(){var t={value:e.data.borderColor};return new s.ColorPickerBuilder({descriptor:a.borderColor,value:t}).build()}).addSimpleSlice("borderWidth",new s.SliderBuilder({descriptor:A.donutChartObjectDescriptorProps.slices.borderWidth,value:e.data.borderWidth,localize:i}).build())}),r.addGroup("spacing",function(t){t.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new s.SliderBuilder({descriptor:a.innerRadiusRatio,value:Math.round(100*e.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:i,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:A.visualLocKeys.PixelUnitSymbol}}).build()).addSimpleSlice("explode",new s.SliderBuilder({descriptor:a.explode,value:e.data.explode,localize:i}).build())})):this.isDonutChart&&r.addGroup("spacing",function(t){t.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new s.SliderBuilder({descriptor:a.innerRadiusRatio,value:Math.round(100*e.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:i,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:A.visualLocKeys.PixelUnitSymbol}}).build())}),r.build()}},x.prototype.getDetailLabelsCard=function(){var e=this,t={dataLabelsSettings:this.data&&this.data.dataLabelsSettings?this.data.dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},a=A.DataLabelViewModel.getDefaultDataLabelsProps("labels");a.position=A.donutChartObjectDescriptorProps.labels.position,a.overflow=A.donutChartObjectDescriptorProps.labels.overflow,a.background=A.donutChartObjectDescriptorProps.labels.background;t={cardBuilder:new s.FormattingCardBuilder(new s.FormattingCardUidBuilder("labels"),"Visual_DetailLabels",a,function(t){return e.hostService.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:t,omitDescription:!0,individualSelector:A.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:!!_.first(this.data.legendData.dataPoints),hasDynamicSeries:this.data.hasDynamicSeries})};return A.DataLabelViewModel.getDataLabelsFormattingModel(t)},x.prototype.getRotationCard=function(){var e=this;if(this.data){var a=function(t){return e.hostService.getLocalizedString(t)},t=new A.builder.FormattingCardBuilder(new A.builder.FormattingCardUidBuilder("rotation"),"Visual_BasicShape_Rotate",[A.donutChartObjectDescriptorProps.slices.startAngle],a);return this.featureSwitches.donutChartStartAngle&&t.addGroup("default",function(t){t.addSimpleSlice("rotation",new s.SliderBuilder({descriptor:A.donutChartObjectDescriptorProps.slices.startAngle,value:e.data.startAngle,options:{minValue:{type:0,value:0},maxValue:{type:1,value:360},unitSymbol:A.visualLocKeys.DegreeLocKey},localize:a}).build(),function(t){return t.withCustomDisplayName("Visual_BasicShape_Rotate")})}),t.build()}},x.prototype.getFormattingModel=function(){var t=this;if(this.data)return new A.builder.FormattingModelBuilder(function(){return t.getLegendCard()},function(){return t.getSlicesCard()},function(){return t.getDetailLabelsCard()},function(){return t.getRotationCard()}).build()},x.prototype.enumerateObjectInstances=function(t){var e=new A.ObjectEnumerationBuilder,a=this.data&&this.data.dataLabelsSettings?this.data.dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style);switch(t.objectName){case"legend":this.enumerateLegend(e);break;case"dataPoint":this.enumerateDataPoints(e);break;case"slices":this.enumerateSlices(e);break;case"labels":var i={enumeration:e,dataLabelsSettings:a,show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},r=void 0,r={position:a.position};a.position!==A.donutLabelPosition.outside&&(r.overflow=a.overflow,r.background=a.enableBackgroundWithAuto),A.DataLabelViewModel.enumerateDataLabels(i,this.featureSwitches,r)}return e.complete()},x.prototype.enumerateDataPoints=function(t){this.data&&p.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:t,dataPoints:A.LegendData.toIEnumerableDataPoints(this.data.legendData)},this.featureSwitches)},x.prototype.enumerateLegend=function(t){var e;this.data&&(e=this.data.legendData,A.Legend.enumerate({enumeration:t,legendData:e},this.featureSwitches))},x.prototype.enumerateSlices=function(t){if(this.data){if(this.featureSwitches.pieChartMarginBetweenSlices){0!==this.donutProperties.maxOffset&&this.data.explode>this.donutProperties.maxOffset&&(this.data.explode=this.donutProperties.maxOffset);var e={selector:null,validValues:{explode:{numberRange:{min:0,max:this.donutProperties.maxOffset},unitSymbol:p.visuals.visualLocKeys.PercentLocKey}},properties:{innerRadiusRatio:Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio),borderWidth:this.data.borderWidth,borderColor:this.data.borderColor,explode:this.data.explode},objectName:"slices"};this.featureSwitches.donutChartStartAngle&&(e.properties.startAngle=this.data.startAngle)}else{if(!this.isDonutChart&&!this.featureSwitches.donutChartStartAngle)return;e={selector:null,properties:{},objectName:"slices"},this.isDonutChart&&(e.properties.innerRadiusRatio=Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio)),this.featureSwitches.donutChartStartAngle&&(e.properties.startAngle=this.data.startAngle)}t.pushInstance(e)}},x.prototype.setInteractiveChosenSlice=function(t,e){var a,i,r,n=this;0!==this.interactivityState.sliceAngles.length&&(this.interactivityState.lastChosenInteractiveSliceIndex=t,this.interactivityState.interactiveChosenSliceFinishedSetting=!1,a=this.currentViewport,i=t%this.data.dataPoints.length,r=this.interactivityState.sliceAngles[i],(t=this.svg.select("g")).transition().duration(null!=e?e:o.animationDurationMs).ease(A.D3Helper.easeCompat(o.ease)).attr("transform",A.SVGUtil.translateAndRotate(a.width/2,a.height/2,0,0,r)).on("end",function(){n.interactivityState.interactiveChosenSliceFinishedSetting=!0}),this.interactivityState.currentRotate=r,this.interactivityState.interactiveLegend.updateLegend(i),this.svg.selectAll(".slice").attr("opacity",function(t,e){return e===i?1:.6}),A.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,t))},x.prototype.calculateRadius=function(){var t=this.currentViewport;if(!this.mobileInteractiveLegend&&this.data&&this.data.dataLabelsSettings.show){var e=t.height/t.width,e=2+1/(1+Math.exp(-5*(e-1)));return Math.min(t.height,t.width)/e}return Math.min(t.height,t.width)/2},x.prototype.getScaleForLegendArrow=function(){var t=1;return t=this.maxHeightToScaleDonutLegend&&this.currentViewport.height<this.maxHeightToScaleDonutLegend?this.currentViewport.height/this.maxHeightToScaleDonutLegend:t},x.prototype.initViewportDependantProperties=function(t){void 0===t&&(t=0),this.currentViewport.height=this.parentViewport.height,this.currentViewport.width=this.parentViewport.width;var e=this.currentViewport;this.mobileInteractiveLegend?e.height-=x.InteractiveLegendContainerHeight:(i=this.legend.getMargins(),e.height-=i.height,e.width-=i.width),this.svg.attr("width",e.width).attr("height",e.height),this.mobileInteractiveLegend?(this.legendContainer.style("width","100%").style("height",x.InteractiveLegendContainerHeight+"px").style("overflow","hidden").style("top",0),this.svg.style("top",x.InteractiveLegendContainerHeight)):A.Legend.positionChartArea(this.svg,this.legend),this.previousRadius=this.radius;var a=this.radius=this.calculateRadius(),i=e.width/2,e=e.height/2;this.outerArc=d3.arc(),this.labelArc=d3.arc().innerRadius(.9*a).outerRadius(.9*a-this.data.explode),this.mobileInteractiveLegend?(this.mainGraphicsContext.attr("transform",A.SVGUtil.translate(i,e)),this.labelGraphicsContext.attr("transform",A.SVGUtil.translate(i,e)),this.labelBackgroundGraphicsContext.attr("transform",A.SVGUtil.translate(i,e))):(this.mainGraphicsContext.transition().duration(t).attr("transform",A.SVGUtil.translate(i,e)),this.labelGraphicsContext.transition().duration(t).attr("transform",A.SVGUtil.translate(i,e)),this.labelBackgroundGraphicsContext.transition().duration(t).attr("transform",A.SVGUtil.translate(i,e))),A.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,this.mainGraphicsContext,this.labelGraphicsContext,this.labelBackgroundGraphicsContext)},x.explodeXOffset=function(t,e){e=e.explode;return Math.sin(t)*e},x.explodeYOffset=function(t,e){e=e.explode;return-Math.cos(t)*e},x.prototype.initDonutProperties=function(){var t,e=.9*this.radius,a=this.radius*x.OuterRadiusRatio-this.data.explode,i=this.radius*this.data.donutInnerRadiusRatio;2*a+5<Math.min(this.currentViewport.height,this.currentViewport.width)&&(t=Math.round(this.radius*x.OuterRadiusRatio-(this.data.explode+1)),t=Math.min(50,Math.max(0,t))),(Math.round(a-i)<x.MinDonutThickness||this.radius*x.OuterRadiusRatio+this.data.explode>e)&&(this.data.explode=0),this.donutProperties={viewport:this.currentViewport,outerArc:this.outerArc.innerRadius(0).outerRadius(i),labelArc:this.labelArc,dataLabelsSettings:this.data.dataLabelsSettings,innerRadius:i,outerRadius:a,labelRadius:e,startAngle:this.data.startAngle,explode:this.data.explode,maxOffset:t}},x.prototype.mergeDatasets=function(t,e){for(var a={},i=0,r=e;i<r.length;i++){var n=r[i],n=(n.identity?n:n.data).identity.getKey();a[n]=null}t=_.filter(t,function(t){return!((t.identity?t:t.data).identity.getKey()in a)}),t=_.map(t,function(t){t=p.Prototype.inherit(t);return void 0===t.percentage?t.data.percentage=0:t.percentage=0,t});return __spreadArray(__spreadArray([],e),t)},x.prototype.updateInternal=function(t,e,a){var i,r,n,o,s,l,d=this.currentViewport;a=(a=void 0===a?0:a)||A.AnimatorCommon.GetAnimationDuration(this.animator,e),this.animator?(i=x.getLayout(this.donutProperties,this.style,this.featureSwitches,t),l=o=void 0,n=[],(r=t.dataLabelsSettings)&&r.show&&(n=this.createLabels()),e||(s={viewModel:t,colors:this.colors,graphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,labelBackgroundContext:this.labelBackgroundGraphicsContext,interactivityService:this.interactivityService,layout:i,radius:this.radius,donutProperties:this.donutProperties,viewport:d,labels:n,style:this.style},s=(o=this.animator.animate(s)).shapes,l=o.highlightShapes),(e||o.failed)&&(s=x.drawDefaultShapes(this.svg,t,i,this.radius,this.style,this.interactivityService),l=x.drawDefaultHighlightShapes(this.svg,t,i,this.radius,this.style),A.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:n,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,twoRows:!0,hasTooltip:!0}),A.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,n)),this.assignInteractions(s,l,t),this.tooltipsEnabled&&this.addTooltips(s,l)):this.updateInternalToMove(t,a,this.style),A.SVGUtil.flushAllD3TransitionsIfNeeded(this.options)},x.prototype.createLabels=function(){var t=new p.DonutLabelLayout(this.donutProperties),e=this.createLabelDataPoints();return t.layout(e,this.data.dataLabelsSettings,this.featureSwitches)},x.prototype.createLabelDataPoints=function(){var t=this.data,e=[],a=A.DataLabelViewModel.createColumnFormatterCacheManager(),i=null;0===t.dataLabelsSettings.displayUnits&&(i=d3.max(t.dataPoints,function(t){return Math.abs(t.data.measure)}));for(var r=0;r<this.data.dataPoints.length;r++){var n=this.createLabelDataPoint(t.dataPoints[r],i,a,this.featureSwitches);e.push(n)}return e},x.prototype.createLabelDataPoint=function(t,e,a,i){var r,n,o,s,l,d,h,u,c,g=this.labelArc.centroid(t),p=(t.startAngle+t.endAngle)/2,f=x.explodeXOffset(p,this.donutProperties),v=x.explodeYOffset(p,this.donutProperties),y=null!=i&&i.pieChartMarginBetweenSlices?(S=A.DonutLabelUtils.getXPositionForDonutLabel(g[0])-f,g[1]-v):(S=A.DonutLabelUtils.getXPositionForDonutLabel(g[0]),g[1]),b=this.data.dataLabelsSettings,m={point:{x:S,y:y},validPositions:[S<0?4:8],radius:0},p=A.ColorHelper.getThemeColor(this.style,A.DataLabelViewModel.DefaultLabelColorName),i=A.ColorHelper.getThemeColor(this.style,A.DataLabelViewModel.DefaultInsideLabelColorName),S=null!==(y=null!==(g=t.data.detailLabelFill)&&void 0!==g?g:b.fontProperties.color)&&void 0!==y?y:p,p=null!==(y=null!==(g=t.data.detailLabelFill)&&void 0!==g?g:b.fontProperties.color)&&void 0!==y?y:i,g=A.DataLabelViewModel.getLabelStyleFlagType(b.labelStyle),L=b.fontProperties,C="",y=this.data.hasHighlights,i=this.data.highlightsOverflow;switch(D.hasFlag(g,A.labelStyle.flagLabelStyleData)&&(h=u=void 0,h=y&&!i?(u=t.data.originalHighlightValue,a.getOrCreate(t.data.highlightFormat,b,e)):(u=t.data.originalMeasure,a.getOrCreate(t.data.measureFormat,b,e)),l=null!=u?h.format(u):null,d=A.DataLabelViewModel.getTextSize(l,L)),D.hasFlag(g,A.labelStyle.flagLabelStyleCategory)&&(r=t.data.label,n=A.DataLabelViewModel.getTextSize(r,L)),D.hasFlag(g,A.labelStyle.flagLabelStylePercent)&&(h=A.valueFormatter.getLocalizedString("Percentage"),u=y&&!i?t.data.highlightPercentage:t.data.percentage,i=(y=_.clone(b)).percentagePrecision,y.displayUnits=0,c=_.isFinite(i)?(y=a.getOrCreate(h,y,null,y.percentagePrecision),null!=u?y.format(u):null):A.valueFormatter.format(u,h),o=A.DataLabelViewModel.getTextSize(c,L)),g){case w.categoryAndDataAndPercent:C=r,l&&(C=A.DataLabelViewModel.combineStrings([C,l]," ")),c&&(C=A.DataLabelViewModel.combineStrings([C,"("+c+")"]," ")),s=A.DataLabelViewModel.getTextSize(C,L);break;case w.categoryAndData:C=r,l&&(C=A.DataLabelViewModel.combineStrings([C,l]," ")),s=A.DataLabelViewModel.getTextSize(C,L);break;case w.categoryAndPercent:C=r,c&&(C=A.DataLabelViewModel.combineStrings([C,c]," ")),s=A.DataLabelViewModel.getTextSize(C,L);break;case w.dataAndPercent:C=l,c&&(C=A.DataLabelViewModel.combineStrings([C,"("+c+")"]," ")),s=A.DataLabelViewModel.getTextSize(C,L);break;case w.data:s=_.clone(d),C=l;break;case w.percent:s=_.clone(o),C=c;break;default:w.category;s=_.clone(n),C=r}f=A.DonutLabelUtils.getLabelLeaderLineForDonutChart(t,this.donutProperties,m.point,0,f,v,this.featureSwitches),v=A.DonutLabelUtils.getLabelLeaderLinesSizeForDonutChart(f);return{isPreferred:!0,text:"",tooltip:C,textSize:s,outsideFill:S,fontProperties:b.fontProperties,identity:t.data.identity,parentShape:m,insideFill:p,parentType:0,alternativeScale:e,donutArcDescriptor:t,angle:(t.endAngle+t.startAngle)/2,dataLabel:l,dataLabelSize:d,categoryLabel:r,categoryLabelSize:n,percentLabel:c,percentLabelSize:o,leaderLinePoints:f,linesSize:v,backgroundColor:b.backgroundColor,backgroundTransparency:b.backgroundTransparency}},x.prototype.renderLegend=function(){var t;this.mobileInteractiveLegend||(this.data.legendObjectProperties?(null!=(t=this.data.legendData).position&&this.legend.setPosition(t.position),this.legend.drawLegend(t,this.parentViewport)):(this.legend.setPosition(A.LegendPosition.Top),this.legend.drawLegend(A.Legend.getDefaultLegendData(this.style),this.parentViewport)))},x.prototype.addInteractiveLegendArrow=function(){var t,e,a;this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&(this.interactiveLegendArrow||((e=this.svg.append("g")).append("path").classed("donutLegendArrow",!0).attr("d","M1.5,2.6C0.65,1.15,1.85,0,3,0l27,0c1.65,0,2.35,1.15,1.5,2.6L18,26.45c-0.8,1.45-2.15,1.45-2.95,0L1.95,2.6z"),this.interactiveLegendArrow=e),a=this.currentViewport,t=this.getScaleForLegendArrow(),e=(a.height-2*this.radius)/2+11*t,a=a.width/2-16.5*t,this.interactiveLegendArrow.attr("transform",A.SVGUtil.translateAndScale(a,e,t)))},x.prototype.calculateSliceAngles=function(){var t=[],e=this.data.dataPoints;if(0===e.length)return this.interactivityState.valueToAngleFactor=0,void(this.interactivityState.sliceAngles=[]);for(var a=0,i=0,r=e.length;i<r;i++)a+=e[i].data.percentage;this.interactivityState.valueToAngleFactor=360/a;for(var n=0,i=0,r=e.length;i<r;i++){var o=e[i].data.percentage*this.interactivityState.valueToAngleFactor;n+=o,t.push(o/2-n)}this.interactivityState.sliceAngles=t},x.prototype.assignInteractions=function(t,e,a){var i;this.mobileInteractiveLegend?this.assignInteractiveChartInteractions(t):this.interactivityService&&(i=a.dataPoints.map(function(t){return t.data}),a={root:this.mainGraphicsContext,clearCatcher:this.clearCatcher,slices:t,highlightSlices:e,visual:this,hasHighlights:a.hasHighlights,visualInstanceId:this.hostService.instanceId},t.attr("tabindex",0).attr("focusable",!0),t={navigationStrategy:this.data.navigationStrategy,helper:this},this.interactivityService.bind(i,this.behavior,a,{navigationOptions:t,pointSourceKey:"donut"}))},x.prototype.assignInteractiveChartInteractions=function(t){var a=this,e=this.svg;this.interactivityState.interactiveChosenSliceFinishedSetting=!0;var i=e.node().getBoundingClientRect();this.interactivityState.donutCenter={x:i.left+i.width/2,y:i.top+i.height/2},this.interactivityState.totalDragAngleDifference=0,this.interactivityState.currentRotate=0,this.calculateSliceAngles(),t.on("click",function(t,e){d3.event.defaultPrevented||a.setInteractiveChosenSlice(e)});t=d3.drag().on("start",this.interactiveDragStart).on("drag",this.interactiveDragMove).on("end",this.interactiveDragEnd);e.style("touch-action","none").call(t)},x.prototype.getAngleFromDragEvent=function(){var t=this.interactivityState,e=d3.event.sourceEvent;if(-1!==e.type.toLowerCase().indexOf("touch")){if(1!==e.touches.length)return null;var a=e.touches[0],i=a.pageX,a=a.pageY}else i=e.pageX,a=e.pageY;t={x:i-t.donutCenter.x,y:-a+t.donutCenter.y};return 180*Math.atan2(t.y,t.x)/Math.PI},x.prototype.interactiveDragStart=function(){this.interactivityState.totalDragAngleDifference=0,this.interactivityState.previousDragAngle=this.getAngleFromDragEvent()},x.prototype.interactiveDragMove=function(){var t=this.data.dataPoints,e=this.currentViewport,a=this.interactivityState;if(!0===a.interactiveChosenSliceFinishedSetting){var i=this.getAngleFromDragEvent();if(i){var r=a.previousDragAngle-i;a.totalDragAngleDifference+=r,a.previousDragAngle=i,a.currentRotate+=r,this.svg.select("g").attr("transform",A.SVGUtil.translateAndRotate(e.width/2,e.height/2,0,0,this.interactivityState.currentRotate));var n=t[0].data.percentage*a.valueToAngleFactor,o=a.currentRotate<=0?-1*a.currentRotate%360:360-a.currentRotate%360;a.currentIndexDrag=0;for(var s=t.length;a.currentIndexDrag<s&&n<o;)a.currentIndexDrag<s-1&&(n+=t[a.currentIndexDrag+1].data.percentage*a.valueToAngleFactor),a.currentIndexDrag++;a.currentIndexDrag!==a.previousIndexDrag&&(a.interactiveLegend.updateLegend(a.currentIndexDrag),this.svg.selectAll(".slice").attr("opacity",function(t,e){return e===a.currentIndexDrag?1:.6}),a.previousIndexDrag=a.currentIndexDrag)}}},x.prototype.interactiveDragEnd=function(){0!==this.interactivityState.totalDragAngleDifference&&(this.setInteractiveChosenSlice(this.interactivityState.currentIndexDrag),d3.event.sourceEvent.stopPropagation())},x.prototype.updateInternalToMove=function(e,t,a){void 0===t&&(t=0);var i=this.svg,r=this.pie,n=this.key,o=this.outerArc,s=this.radius,l=this.previousRadius,d=e.borderColor,h=this.donutProperties,u=this.svg.select(".slices").selectAll("path"+y.selector).data().map(function(t){return t.data});0===u.length&&(u=e.dataPointsToDeprecate);var c=this.mergeDatasets(u,e.dataPointsToDeprecate);(f=i.select(".slices").selectAll("path"+y.selector).data(r(e.dataPointsToDeprecate),n)).enter().insert("path").classed(y.class,!0).each(function(t){this._current=t});var g,p,f=i.select(".slices").selectAll("path"+y.selector).data(r(c),n),v=this.donutProperties.innerRadius;x.isSingleColor(e.dataPoints),a.isHighContrast||f.style("stroke-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.hasHighlights)}).style("stroke-dasharray",function(t){return x.drawStrokeForDonutChart(t,h)}),f.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.hasHighlights)}).style("stroke",d).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrTween("d",function(t){var e=d3.interpolate(this._current,t),a=d3.interpolate(l*x.OuterRadiusRatio,s*x.OuterRadiusRatio);return this._current=e(0),function(t){return o.innerRadius(v).outerRadius(a(t))(e(t))}}),(f=i.select(".slices").selectAll("path"+y.selector).data(r(e.dataPointsToDeprecate),n)).exit().transition().delay(t).duration(0).remove(),this.mobileInteractiveLegend||(u=[],(c=e.dataLabelsSettings)&&c.show&&(u=this.createLabels()),A.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:u,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext}),A.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,u)),e.hasHighlights?(g=(p=i.select(".slices").selectAll("path"+b.selector).data(r(e.dataPointsToDeprecate),n)).enter().insert("path").classed(b.class,!0).each(function(t){this._current=t}).merge(p),x.isSingleColor(e.dataPoints),a.isHighContrast||g.style("stroke-opacity",1).style("stroke-dasharray",function(t){return x.drawStrokeForDonutChart(t,h,t.data.highlightRatio)}),g.style("fill",function(t){return t.data.color}).style("fill-opacity",1).style("stroke",d).style("stroke-width",function(t){return 0===t.data.highlightRatio?0:t.data.strokeWidth}).transition().duration(t).attrTween("d",function(t){var e=d3.interpolate(this._current,t),a=d3.interpolate(l*x.OuterRadiusRatio,x.getHighlightRadius(h,t.data.highlightRatio));return this._current=e(0),function(t){return o.innerRadius(v).outerRadius(a(t))(e(t))}}),p=p.exit().transition().delay(t).duration(0).remove()):i.selectAll("path"+b.selector).transition().delay(t).duration(0).remove(),this.assignInteractions(f,g,e),this.tooltipsEnabled&&this.addTooltips(f,g),A.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,f,f.exit(),g,p),this.mobileInteractiveLegend&&(this.addInteractiveLegendArrow(),this.interactivityState.interactiveLegend.drawLegend(this.data.dataPointsToDeprecate),p=this.interactivityState.lastChosenInteractiveSliceIndex||0,this.setInteractiveChosenSlice(p,t))},x.prototype.addTooltips=function(t,e){this.tooltipService.addTooltip(t,function(t){return t.data&&t.data.data.tooltipInfo},function(t){return t.data&&t.data.data.identity&&[t.data.data.identity]}),e&&this.tooltipService.addTooltip(e,function(t){return t.data&&t.data.data.tooltipInfo},function(t){return t.data&&t.data.data.identity&&[t.data.data.identity]})},x.drawDefaultShapes=function(t,e,a,i,r,n){var o=t.select(".slices").selectAll("path"+y.selector).data(e.dataPoints,function(t){return t.data.identity.getKey()}),s=n&&n.hasSelection(),l=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),t=o.enter().insert("path").attr("class",y.class).merge(o);return x.isSingleColor(e.dataPoints),n&&t.attr("tabindex",function(t){return null!=t.data.measure?0:null}).attr("focusable",function(t){return null!=t.data.measure||null}).attr("aria-label",function(t){return t.data.formattedTooltip}).attr("role","option").classed(A.SetFocusRingClassName,!l),t.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!1,s,e.hasHighlights)}).style("stroke-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!1,s,e.hasHighlights)}).style("stroke",e.borderColor).style("stroke-width",function(t){return t.data.strokeWidth}).attrs(a.shapeLayout.attrs).styles(a.shapeLayout.styles),o.exit().remove(),t},x.drawDefaultHighlightShapes=function(t,e,a,i,r){var n=t.select(".slices").selectAll("path"+b.selector).data(e.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),t=n.enter().insert("path").classed(b.class,!0).each(function(t){this._current=t}).merge(n);return x.isSingleColor(e.dataPoints),t.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!0,!1,e.hasHighlights)}).style("stroke-opacity",function(t){return A.ColumnUtil.getFillOpacity(t.data.selected,!0,!1,e.hasHighlights)}).style("stroke",A.ColorHelper.getThemeColor(r,A.DefaultDonutStrokeColorName)).style("stroke-width",function(t){return 0===t.data.highlightRatio?0:t.data.strokeWidth}).attrs(a.highlightShapeLayout.attrs).styles(a.highlightShapeLayout.styles),n.exit().remove(),t},x.isSingleColor=function(t){var e;1<t.length&&(t[e=t.length-1].data.isLastInDonut=t[e].data.color===t[0].data.color)},x.drawStrokeForDonutChart=function(t,e,a){var i=e.outerRadius*(a=void 0===a?1:a),r=(t.endAngle-t.startAngle)*i,a=e.innerRadius;if(0<a){var n=e.outerRadius-a,o=(t.endAngle-t.startAngle)*a;if(t.data.highlightRatio&&(r=(t.endAngle-t.startAngle)*(n+a)),t.data.isLastInDonut)return"0 "+r+" "+n+" "+o+" "+n;o=r+n+o,n=n}else n=t.data.isLastInDonut?(o=r,2*i):(o=r+i,i);return"0 "+o+" "+n},x.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},x.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},x.getLayout=function(s,t,e,a){var i=s.innerRadius,l=s.outerRadius,r=i||x.EffectiveZeroValue,d=d3.arc().innerRadius(i),n=d3.arc().innerRadius(i).outerRadius(l-a.explode),o=d3.arc().innerRadius(i).outerRadius(r);return{shapeLayout:{attrs:{d:function(t){return n(t)},transform:function(t){if(e.pieChartMarginBetweenSlices){t=(t.startAngle+t.endAngle)/2;return"translate("+x.explodeXOffset(t,s)+", "+x.explodeYOffset(t,s)+")"}return"translate(0, 0)"}},styles:{"stroke-dasharray":e.pieChartMarginBetweenSlices||t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s)}}},highlightShapeLayout:{attrs:{d:function(t){return d.outerRadius(x.getHighlightRadius(s,t.data.highlightRatio))(t)}},styles:{"stroke-dasharray":t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s,t.data.highlightRatio)}}},highlightShapeTween:function(o){return function(t){var e=0===o?l:x.getHighlightRadius(s,null!==(a=null===(e=this._current.data)||void 0===e?void 0:e.highlightRatio)&&void 0!==a?a:1),a=2===o?l:x.getHighlightRadius(s,t.data.highlightRatio),i=d.outerRadius(l),r=d3.interpolateNumber(e,a),n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return i.outerRadius(r(t))(n(t)).toString()}}},zeroShapeLayout:{attrs:{d:function(t){return o(t)}},styles:{"stroke-dasharray":t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s,r)}}}}},x.getHighlightRadius=function(t,e){var a=t.innerRadius;return a+e*(t.outerRadius-a)},x.cullDataByViewport=function(t,e,a,i,r,n){var o=0;72<t.length&&(o=1/(Math.min(a.width,a.height)/2*c)*e);for(var s,l=[],d=0,h=t;d<h.length;d++){var u=h[d];u.measure>o&&(r=r===x.DefaultBorderWidth?i||s===u.color?1:0:r,u.strokeWidth=null!=n&&n.pieChartMarginBetweenSlices?r:i||s===u.color?1:0,s=u.color,l.push(u))}return l},x.getDefaultLabelSettings=function(t){var e=A.DataLabelViewModel.getDefaultLabelSettings({style:t,textClassName:"smallLightLabel",noColor:!0}).fontProperties;return{show:!0,position:0,displayUnits:0,precision:A.DataLabelViewModel.defaultLabelPrecision,fontProperties:e,enableBackground:!0,backgroundColor:A.ColorHelper.getThemeColor(t,A.DataLabelViewModel.DefaultLabelBackgroundColorName),backgroundTransparency:.5}},x.OuterRadiusRatio=.8,x.DefaultDonutInnerRadiusRatio=.48,x.DefaultStartAngleDegrees=0,x.OnePiRadianInDegree=180,x.DefaultExplode=0,x.DefaultBorderWidth=0,x.MinDonutThickness=5,x.InteractiveLegendContainerHeight=70,x.EffectiveZeroValue=1e-9,x.PolylineOpacity=.5,x);function x(t){t&&(this.isDonutChart=0!==t.sliceWidthRatio,this.animator=t.animator,this.isScrollable=t.isScrollable||!1,this.disableGeometricCulling=t.disableGeometricCulling||!1,this.behavior=t.behavior,this.tooltipsEnabled=t.tooltipsEnabled,t.smallViewPortProperties&&(this.maxHeightToScaleDonutLegend=t.smallViewPortProperties.maxHeightToScaleDonutLegend))}A.DonutChart=R;var d,i=(g.prototype.drawLegend=function(t){var h=this;this.data=t,this.currentNumberOfLegendItems=t.length,this.currentIndex=0,this.leftMostIndex=0,this.rightMostIndex=t.length-1,this.legendContainerParent.select(g.LegendContainerSelector).empty()&&(this.legendContainer=this.legendContainerParent.append("div").classed(g.LegendContainerClassName,!0));var e=this.legendContainer.selectAll(g.LegendItemSelector).data(t),t=this.legendContainerWidth=this.legendContainer.node().getBoundingClientRect().width,t=t/2-.4*t/2+g.ItemMargin,u=t;this.currentXOffset=t;e.enter().insert("div").classed(g.LegendItemClassName,!0).each(function(t){!function(t,e){t.attr("data-legend-index",e.index).css({position:"absolute",left:u});var a=A.valueFormatter.format(e.label),i=A.valueFormatter.format(e.originalMeasure,e.measureFormat),r=A.valueFormatter.format(e.percentage,"0.00 %;-0.00 %;0.00 %"),n=e.color,o=g.createBasicLegendItemSpan(g.LegendItemValueClassName,i,11),s=g.createBasicLegendItemSpan(g.LegendItemCategoryClassName,a,11),l=g.createBasicLegendItemSpan(g.LegendItemPercentageClassName,r,20),e=g.spanWidth(o),i=g.spanWidth(s),a=g.spanWidth(l),d=g.legendBoxSize(e,i,a);t.css("width",d),h.maxLegendItemWidth=Math.max(h.maxLegendItemWidth,d);r=function(t){return 0<d-t?(d-t)/2:0},e=r(e),i=r(i),a=r(a);g.createLegendItemSpan(s,i),g.createLegendItemSpan(o,e),g.createLegendItemSpan(l,a).css("color",n),t.append(s),t.append(l),t.append(o),h.legendItemsPositions.push({startX:u,boxWidth:d}),u+=d+g.ItemMargin}($(this),t)}),e.exit().remove(),this.assignInteractions()},g.prototype.updateLegend=function(t){var i=this,e=this.legendContainerWidth;this.currentIndex=t,this.updateLabelBlocks(t);var r=-1*(this.legendItemsPositions[t].startX+this.legendItemsPositions[t].boxWidth/2-e/2);this.legendContainer.transition().styleTween("-webkit-transform",function(t,e,a){return d3.interpolate(A.SVGUtil.translateWithPixels(i.currentXOffset,0),A.SVGUtil.translateWithPixels(r,0))}).styleTween("transform",function(t,e,a){return d3.interpolate(A.SVGUtil.translateWithPixels(i.currentXOffset,0),A.SVGUtil.translateWithPixels(r,0))}).duration(o.animationDurationMs).ease(A.D3Helper.easeCompat(o.ease)).on("end",function(){i.currentXOffset=r}),A.SVGUtil.flushAllD3TransitionsIfNeeded(this.visualInitOptions,this.legendContainer)},g.prototype.assignInteractions=function(){var e=this,a=0,t=d3.drag().on("start",function(){a=0}).on("drag",function(){var t;a+=d3.event.dx,Math.abs(a)<e.maxLegendItemWidth||(t=a<0,e.dragLegend(t),a=0)});this.legendContainer.style("touch-action","none").style("cursor","pointer").call(t)},g.prototype.dragLegend=function(t){this.currentNumberOfLegendItems>g.MinimumItemsInLegendForCycled-1?this.currentIndex=this.getCyclingCurrentIndex(t):this.shouldChangeIndexInNonCycling(t)&&(t?this.currentIndex++:this.currentIndex--),this.donutChart.setInteractiveChosenSlice(this.currentIndex)},g.prototype.shouldChangeIndexInNonCycling=function(t){return!(0===this.currentIndex&&!t||this.currentIndex===this.currentNumberOfLegendItems-1&&t)},g.prototype.getCyclingCurrentIndex=function(t){var e=this.data.length,t=(this.currentIndex+(t?1:-1))%(e||1);return t<0?t+e:t},g.prototype.updateLegendItemsBlocks=function(t,e){var a,i,r=$(this.legendContainer.node());t?((a=r.find("[data-legend-index="+this.leftMostIndex+"]")).remove().insertAfter(r.find("[data-legend-index="+this.rightMostIndex+"]")),i=this.legendItemsPositions[this.rightMostIndex].startX+this.legendItemsPositions[this.rightMostIndex].boxWidth+g.ItemMargin,this.legendItemsPositions[this.leftMostIndex].startX=i,a.css("left",i),this.rightMostIndex=this.leftMostIndex,this.leftMostIndex=(this.leftMostIndex+1)%this.data.length):((a=r.find("[data-legend-index="+this.rightMostIndex+"]")).remove().insertBefore(r.find("[data-legend-index="+this.leftMostIndex+"]")),i=this.legendItemsPositions[this.leftMostIndex].startX-this.legendItemsPositions[this.rightMostIndex].boxWidth-g.ItemMargin,this.legendItemsPositions[this.rightMostIndex].startX=i,a.css("left",i),this.leftMostIndex=this.rightMostIndex,this.rightMostIndex=this.rightMostIndex-1==-1?this.legendItemsPositions.length-1:this.rightMostIndex-1),e-1!=0&&this.updateLegendItemsBlocks(t,e-1)},g.prototype.updateLabelBlocks=function(t){this.currentNumberOfLegendItems>g.MinimumItemsInLegendForCycled?(this.rightMostIndex===t&&this.updateLegendItemsBlocks(!0,2),this.leftMostIndex===t&&this.updateLegendItemsBlocks(!1,2),(this.rightMostIndex===t+1||0===this.rightMostIndex&&t===this.currentNumberOfLegendItems-1)&&this.updateLegendItemsBlocks(!0,1),(this.leftMostIndex===t-1||this.leftMostIndex===this.currentNumberOfLegendItems-1&&0===t)&&this.updateLegendItemsBlocks(!1,1)):this.currentNumberOfLegendItems===g.MinimumItemsInLegendForCycled&&(this.rightMostIndex===t&&this.updateLegendItemsBlocks(!0,1),this.leftMostIndex===t&&this.updateLegendItemsBlocks(!1,1))},g.createBasicLegendItemSpan=function(t,e,a){return $("<span></span>").addClass(t).css({"white-space":"nowrap","font-size":a+"px"}).text(e)},g.createLegendItemSpan=function(t,e){return t.css({overflow:"hidden","text-overflow":"ellipsis",display:"inline-block",width:"100%","margin-left":e}),t},g.legendBoxSize=function(t,e,a){e=a<(e=e<t?t:e)?e:a;return e=g.MaxLegendItemBoxSize<e?g.MaxLegendItemBoxSize:e+2},g.spanWidth=function(t){return this.FakeElementSpan||(this.FakeElementSpan=$("<span>").hide().appendTo(document.body)),this.FakeElementSpan.empty(),this.FakeElementSpan.append(t),this.FakeElementSpan.width()},g.LegendContainerClassName="legend-container",g.LegendContainerSelector=".legend-container",g.LegendItemClassName="legend-item",g.LegendItemSelector=".legend-item",g.LegendItemCategoryClassName="category",g.LegendItemPercentageClassName="percentage",g.LegendItemValueClassName="value",g.MaxLegendItemBoxSize=160,g.ItemMargin=30,g.MinimumItemsInLegendForCycled=3,g);function g(t,e,a,i){this.maxLegendItemWidth=15,this.legendContainerParent=e,this.donutChart=t,this.visualInitOptions=i,this.legendItemsPositions=[]}function M(t,e,a,i){void 0===i&&(i=!0);var r=this.reader=p.data.createDataViewCategoricalReaderAdvanced(t,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:e},formatStringProp:A.donutChartProps.general.formatString}),n=r.data,o=(this.dataView=t).categorical;this.dataViewMetadata=t.metadata,this.tooltipsEnabled=i,this.maxValue=0,this.hasNegativeValues=!1,this.allValuesAreNegative=!1,this.style=e,o.categories&&0<o.categories.length&&(s=o.categories[0],this.categoryValues=s.values,this.categoryFormatString=A.valueFormatter.getFormatString(s.source,A.donutChartProps.general.formatString)),this.hasDynamicSeries=r.columns.hasDynamicSeries(),this.hasSeriesData=n.hasSeries(),this.hasCategoryData=n.hasCategories(),this.highlightsOverflow=!1,this.total=0,this.highlightTotal=0,this.dataPoints=[],this.dataLabelsSettings=null;var s=0,e=A.ColorHelper.create(e);if(this.borderColor=e.getColorForProperty(r.objects.getStaticObjects(),A.donutChartProps.slices.borderColor,A.DefaultDonutStrokeColorName),this.explode=p.DataViewObjects.getValue(r.objects.getStaticObjects(),A.donutChartProps.slices.explode,R.DefaultExplode),this.borderWidth=p.DataViewObjects.getValue(r.objects.getStaticObjects(),A.donutChartProps.slices.borderWidth,R.DefaultBorderWidth),null==(s=p.DataViewObjects.getValue(r.objects.getStaticObjects(),A.donutChartProps.slices.innerRadiusRatio))?s=a?R.DefaultDonutInnerRadiusRatio:0:s/=100/R.OuterRadiusRatio,this.startAngle=p.DataViewObjects.getValue(r.objects.getStaticObjects(),A.donutChartProps.slices.startAngle,R.DefaultStartAngleDegrees),this.donutInnerRadiusRatio=s,n.hasValues("Y")){var l=this.seriesCount=n.getSeriesCount();this.hasHighlights=n.hasHighlights();var d=n.getCategoryCount()||1;this.allValuesAreNegative=void 0;for(var h=0;h<d;h++)for(var u=0;u<l;u++){var c=n.getValue("Y",h,u),g=void 0;this.hasHighlights&&null==(g=n.getHighlight("Y",h,u))&&(g=0),void 0===this.allValuesAreNegative?this.allValuesAreNegative=(!this.hasHighlights||g<=0)&&c<=0:this.allValuesAreNegative=this.allValuesAreNegative&&(!this.hasHighlights||g<=0)&&c<=0,this.hasNegativeValues||(this.hasNegativeValues=c<0||!!this.hasHighlights&&g<0)}this.allValuesAreNegative=!!this.allValuesAreNegative;for(h=0;h<d;h++)for(u=0;u<l;u++){c=n.getValue("Y",h,u);c=M.normalizedValue(c,this.allValuesAreNegative),this.total+=c,this.hasHighlights&&(g=n.getHighlight("Y",h,u),g=M.normalizedValue(g,this.allValuesAreNegative),this.highlightTotal+=g,!this.highlightsOverflow&&p.Double.greaterWithPrecision(g,c,p.Double.getPrecision(Math.min(g,c)))&&(this.highlightsOverflow=!0))}}}e=d=d||{},M.normalizedValue=function(t,e){return null==t||isNaN(t)?0:t===Number.POSITIVE_INFINITY?Number.MAX_VALUE:t===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:e?Math.abs(t):t<0?0:t},M.prototype.convert=function(){var t=this.reader,e=this.reader.data,a=0!==this.total?this.categoryValues?this.convertCategoricalWithSlicing():this.hasDynamicSeries?this.convertSeries():this.convertMeasures():[];this.dataLabelsSettings=this.convertDataLabelSettings();var i=this.dataViewMetadata;!i||(i=i.objects)&&(this.legendObjectProperties=i.legend);var r=_.isEmpty(this.dataView.categorical.categories)?null:this.dataView.categorical.categories[0];this.dataPoints=[];for(var n=A.donutChartProps.general.formatString,o=A.valueFormatter.getLocalizedString("Percentage"),s=0,l=a.length;s<l;s++){var d=a[s],h=d.measure,u=M.normalizedValue(d.measure,this.allValuesAreNegative),c=d.highlightMeasure,g=M.normalizedValue(d.highlightMeasure,this.allValuesAreNegative),p=0<this.total?u/this.total:0,f=void 0,v=void 0;u>this.maxValue&&(this.maxValue=u),g>this.maxValue&&(this.maxValue=g),this.hasHighlights&&(f=this.highlightsOverflow?(h=c,u=g,p=0<this.highlightTotal?g/this.highlightTotal:0,1):0!==u?g/u:0,v=p*(f=f||R.EffectiveZeroValue));var y=d.categoryLabel,b=this.dataView.categorical,m=void 0,m=null!=d.seriesIndex?d.seriesIndex:s,S=t.columns.getValueMetadataColumn("Y",m),L=this.hasHighlights&&this.highlightsOverflow?c:h,C=d.measureFormat||A.valueFormatter.getFormatString(S,n),D=this.hasHighlights&&!this.highlightsOverflow?c:void 0,w=d.highlightMeasureFormat||A.valueFormatter.getFormatString(S,n),x=A.valueFormatter.format(p,o),m=void 0;null!=L&&null!=x&&(m=A.valueFormatter.format(L,C)+" ("+x+")");x=void 0;null!=D&&null!=v&&(P=A.valueFormatter.format(v,o),x=A.valueFormatter.format(D,w)+" ("+P+")");var P=void 0;this.tooltipsEnabled&&(P=[],r&&P.push({displayName:r.source.displayName,value:y}),this.hasDynamicSeries&&(r&&r.source===b.values.source||P.push({displayName:b.values.source.displayName,value:d.label})),null!=m&&P.push({displayName:S.displayName,value:m}),null!=x&&P.push({displayName:A.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:x}),A.TooltipBuilder.addTooltipMeasures(t,P,this.categoryValues?d.categoryIndex:0,this.hasDynamicSeries?d.seriesIndex:void 0,n));var m=this.style.isHighContrast||I===d.color&&p&&0<p?1:0,I=p&&0<p?d.color:I,x=A.DataLabelUtil.determineDataLabelFillColor(void 0,t,d.categoryIndex),d={identity:d.identity,measure:u,originalMeasure:h,measureFormat:null!==(h=d.measureFormat)&&void 0!==h?h:S.format,percentage:p,index:d.index,label:d.label,highlightRatio:f,highlightValue:this.hasHighlights&&!this.highlightsOverflow?g:void 0,originalHighlightValue:this.hasHighlights&&!this.highlightsOverflow?c:void 0,highlightFormat:this.hasHighlights&&!this.highlightsOverflow?null!==(c=d.highlightMeasureFormat)&&void 0!==c?c:S.format:void 0,highlightPercentage:this.hasHighlights&&!this.highlightsOverflow?v:void 0,selected:!1,tooltipInfo:P,formattedTooltip:A.tooltipUtils.formatTooltipInfo(P),color:d.color,strokeWidth:m,seriesIndex:d.seriesIndex||0,categoryIndex:d.categoryIndex||0};x&&(d.detailLabelFill=x),this.dataPoints.push(d)}e.hasCategoryWithRole("Category")?this.legendData=A.Legend.buildCategoryLegendData({dataView:this.dataView,categoryRole:"Category",style:this.style,valueRole:"Y",showByDefault:!1}):this.legendData=A.Legend.buildSeriesLegendData({dataView:this.dataView,staticSeriesRoleNames:["Y"],style:this.style,showByDefault:!1})},M.prototype.convertCategoricalWithSlicing=function(){for(var t,e=this.reader,a=this.reader.data,i=this.dataView.categorical,r=A.donutChartProps.general.formatString,n=[],o=0,s=this.categoryValues.length;o<s;o++)for(var l=this.categoryValues[o],d=e.colors.createByCategory(o),h=A.valueFormatter.format(l,this.categoryFormatString),u=0;u<this.seriesCount;u++){var c,g,p,f,v=a.getValue("Y",o,u),y=a.getFormatString("Y",o,u),b=this.hasHighlights?a.getHighlight("Y",o,u):void 0,m=this.hasHighlights?a.getHighlightFormatString("Y",o,u):void 0;null==v&&null==b||(p=e.columns.getValueColumn("Y",u),c=i.values.grouped()[u],f=h,(this.hasDynamicSeries||1<a.getSeriesCount())&&(f=A.converterHelper.getFormattedLegendLabel(p.source,i.values,r)),g=p.source.queryName,g=A.SelectionIdBuilder.builder().withCategory([i.categories[0]],o,null===(t=null===(t=i.categories[0])||void 0===t?void 0:t.source)||void 0===t?void 0:t.queryName,!0).withSeries(i.values,this.hasDynamicSeries?c:void 0,!0).withMeasure(g,p,o).createSelectionId(),p=A.valueFormatter.getFormatString(p.source,r,!0),f={identity:g,measureFormat:y||p,measure:v,highlightMeasureFormat:null!=m?m:p,highlightMeasure:b,index:n.length,label:f,categoryLabel:h,color:d,categoryIndex:o,seriesIndex:u},n.push(f))}return n},M.prototype.convertMeasures=function(){for(var t=this.reader,e=[],a=A.donutChartProps.general.formatString,i=0;i<this.seriesCount;i++){var r=t.data.getValue("Y",0,i),n=t.data.getFormatString("Y",0,i),o=this.hasHighlights?t.data.getHighlight("Y",0,i):void 0,s=this.hasHighlights?t.data.getHighlightFormatString("Y",0,i):void 0,l=t.columns.getValueColumn("Y",i),d=A.valueFormatter.getFormatString(l.source,a,!0),h=l.source.displayName,u=A.SelectionId.createWithMeasure(l.source.queryName),l=t.colors.createBySeries(i);e.push({identity:u,measureFormat:n||d,measure:r,highlightMeasure:o,highlightMeasureFormat:s||d,index:i,label:h,categoryLabel:h,color:l,categoryIndex:i,seriesIndex:null})}return e},M.prototype.convertSeries=function(){for(var t=this.reader,e=this.dataView.categorical,a=[],i=A.donutChartProps.general.formatString,r=0;r<this.seriesCount;r++){var n=t.data.getValue("Y",0,r),o=t.data.getFormatString("Y",0,r),s=this.hasHighlights?t.data.getHighlight("Y",0,r):void 0,l=this.hasHighlights?t.data.getHighlightFormatString("Y",0,r):void 0,d=t.columns.getValueColumn("Y",r),h=e.values.grouped()[r],u=A.valueFormatter.getFormatString(d.source,i,!0),c=A.converterHelper.getFormattedLegendLabel(d.source,e.values,i),h=(new A.SelectionIdBuilder).withSeries(e.values,h,!0).withMeasure(d.source.queryName,d,0).createSelectionId(),d=t.colors.createBySeries(r);a.push({identity:h,measureFormat:o||u,measure:n,highlightMeasure:s,highlightMeasureFormat:null!=l?l:u,index:r,label:c,categoryLabel:c,color:d,categoryIndex:0,seriesIndex:r})}return a},M.prototype.convertDataLabelSettings=function(){var t,e=this.dataViewMetadata,a=R.getDefaultDonutLabelSettings(this.style);return e&&(!(t=e.objects)||(e=t.labels)&&A.DataLabelViewModel.updateLabelSettingsFromLabelsObject(e,a,void 0,this.style),a.position=p.DataViewObjects.getValue(t,A.donutChartProps.labels.position,A.donutLabelPosition.outside),a.overflow=p.DataViewObjects.getValue(t,A.donutChartProps.labels.overflow,!0),a.enableBackgroundWithAuto=p.DataViewObjects.getValue(t,A.donutChartProps.labels.background,A.donutLabelBackground.auto)),a},e.DonutChartConverter=M}(p.visuals||(p.visuals={}))}(powerbi=powerbi||{}),function(t){var o,e;function a(t){return e.call(this,t)||this}o=t.visuals||(t.visuals={}),e=o.BaseAnimator,__extends(a,e),a.prototype.animate=function(t){var e={failed:!0,shapes:null,highlightShapes:null},a=t.viewModel,i=this.previousViewModel;if(a.highlightsOverflow||i&&i.highlightsOverflow)return this.previousViewModel=a,e;var r=i&&i.hasHighlights,n=a.hasHighlights;return i&&(n&&!r?e=this.animateNormalToHighlighted(t):n&&r?e=this.animateHighlightedToHighlighted(t):!n&&r&&(e=this.animateHighlightedToNormal(t))),this.previousViewModel=a,e},a.prototype.animateNormalToHighlighted=function(e){var t=this.animateDefaultShapes(e),a=e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),i=a.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(a);o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}));var r=e.interactivityService&&e.interactivityService.hasSelection();return i.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,r,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,r,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles).transition().duration(this.animationDuration).attrTween("d",e.layout.highlightShapeTween(0)).styles(e.layout.highlightShapeLayout.styles),a.exit().remove(),o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:e.labelGraphicsContext,backgroundContext:e.labelBackgroundContext,dataLabels:e.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(e.labelGraphicsContext,e.labels),{failed:!1,shapes:t,highlightShapes:i}},a.prototype.animateHighlightedToHighlighted=function(t){var e=this.animateDefaultShapes(t),a=this.animateDefaultHighlightShapes(t);return o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:t.labelGraphicsContext,backgroundContext:t.labelBackgroundContext,dataLabels:t.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(t.labelGraphicsContext,t.labels),{failed:!1,shapes:e,highlightShapes:a}},a.prototype.animateHighlightedToNormal=function(e){var a=e.interactivityService&&e.interactivityService.hasSelection(),t=this.animationDuration,i=e.graphicsContext.select(".slices").selectAll("path.slice").data(e.viewModel.dataPoints,function(t){return t.data.identity.getKey()}),r=i.enter().insert("path").classed("slice",!0).each(function(t){this._current=t}).merge(i);o.DonutChart.isSingleColor(e.viewModel.dataPoints),r.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,t.data.selected,!t.data.selected)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,t.data.selected,!t.data.selected)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles).transition().duration(0).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,a,!1)}).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,a,!1)}),i.exit().remove();var n=e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),i=n.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(n);return o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio})),n.exit().style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",o.ColumnUtil.getFillOpacity(!1,!0,!1,!0)).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",o.ColumnUtil.getFillOpacity(!1,!0,!1,!0)).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrTween("d",e.layout.highlightShapeTween(2)).styles((a?e.layout.zeroShapeLayout:e.layout.shapeLayout).styles).remove(),o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:e.labelGraphicsContext,backgroundContext:e.labelBackgroundContext,dataLabels:e.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(e.labelGraphicsContext,e.labels),{failed:!1,shapes:r,highlightShapes:i}},a.prototype.animateDefaultShapes=function(e){var t=e.graphicsContext.select(".slices").selectAll("path.slice").data(e.viewModel.dataPoints,function(t){return t.data.identity.getKey()}),a=t.enter().insert("path").classed("slice",!0).each(function(t){this._current=t}).merge(t);return o.DonutChart.isSingleColor(e.viewModel.dataPoints),a.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(this.animationDuration).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles),t.exit().remove(),a},a.prototype.animateDefaultHighlightShapes=function(e){var t=e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),a=t.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(t);o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}));var i=e.interactivityService&&e.interactivityService.hasSelection();return a.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,i,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,i,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(this.animationDuration).attrTween("d",e.layout.highlightShapeTween(1)).styles(e.layout.highlightShapeLayout.styles),t.exit().remove(),a},o.WebDonutChartAnimator=a}(powerbi=powerbi||{}),function(t){var r,n;function e(){}r=t.visuals||(t.visuals={}),n=jsCommon.BrowserUtils,e.prototype.bindEvents=function(t,e,a){this.root=t.root,this.slices=t.slices,this.highlightSlices=t.highlightSlices,this.hasHighlights=t.hasHighlights,this.visualInstanceId=t.visualInstanceId;var i=t.clearCatcher;r.InteractivityUtils.registerStandardInteractivityHandlers(this.slices,e),this.highlightSlices&&r.InteractivityUtils.registerStandardInteractivityHandlers(this.highlightSlices,e),a&&(t=a.dataPointNavigationManager,a=a.pointSourceKey,t.isEmpty(a)||(r.InteractivityUtils.registerClearCatcherShortcut(this.root,e),r.InteractivityUtils.appendUseElementForFocus(this.root,this.visualInstanceId,a),r.InteractivityUtils.registerEnterPlotAreaHandler(this.root,t,a),r.InteractivityUtils.registerDataPointNavigationHandler(this.slices,t,a))),i.on("click",function(){var t=d3.event;n.isCtrlOrMeta(t)||e.handleClearSelection()})},e.prototype.renderFocus=function(t){var e=r.CurrentFocusDataPointId+"-"+this.visualInstanceId;this.root.select("#"+e).attr("id",null),t&&(t.setAttribute("id",e),n.focus(t))},e.prototype.renderSelection=function(e){var a=this.hasHighlights;this.slices.style("fill-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!1,e,a)}).style("stroke-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!1,e,a)}).attr("aria-selected",function(t){return t.data.selected}),this.highlightSlices&&this.highlightSlices.style("fill-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!0,e,a)}).style("stroke-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!0,e,a)})},r.DonutChartWebBehavior=e}(powerbi=powerbi||{}),function(b){var v=b.visuals.donutLabelBackground,p=b.visuals.donutLabelPosition,m=b.visuals.DonutLabelUtils,y=jsCommon.EnumExtensions,S=b.visuals.FontProperties,L=b.visuals.labelStyle,C=b.visuals.DataLabelViewModel,D=L.labelStyleFlagEnum,w=b.visuals.DonutChart,f=[L.categoryAndDataAndPercent,L.categoryAndData,L.categoryAndPercent,L.dataAndPercent],x=[0,1,2,3,4],t=(u.prototype.layout=function(t,e,a){for(var i=[],r=0,n=t;r<n.length;r++){var o=n[r];i.push({labelDataPoint:o,hasBeenRendered:!1,labelSize:o.textSize})}for(var s=[],l=[],d=this.donutChartProperties.viewport,h={labelDataPoints:i,maxNumberOfLabels:t.length},d=new b.LabelArrangeGrid([h],d),u=i.length-1;0<=u;u--)i[u].labelDataPoint.isPreferred&&(l=i.splice(u,1).concat(l));return 0<l.length&&(s=this.positionLabels(l,d,e,a)),0<t.length&&(a=this.positionLabels(i,d,e,a),s=s.concat(a)),_.filter(s,function(t){return t.isVisible})},u.prototype.positionLabels=function(o,s,i,a){function t(t){for(var e=0,a=o;e<a.length;e++){var i,r,n=a[e];n.hasBeenRendered||(!(i=t(n,s))||(r=i.label)&&(i.overflows&&(h=!0),n.hasBeenRendered=!0,d.push(r)))}}function e(){t(function(t,e){return{label:n.tryOutsidePositionForDonut(t,e,i,a),overflows:!0}})}function r(){t(function(t,e){if(_.includes(f,n.donutChartProperties.dataLabelsSettings.labelStyle)){var a=n.splitDonutDataPoint(t,n.donutChartProperties.dataLabelsSettings.labelStyle);return n.tryInsidePositionForDonut(a,n.donutChartProperties,e,i)}return n.tryInsidePositionForDonut(t,n.donutChartProperties,e,i)})}var n=this,l=null==i.position?p.outside:i.position,d=[],h=!1;switch(l){case p.outside:e();break;case p.inside:r();break;case p.preferOutside:e(),r();break;case p.preferInside:r(),e()}if(h&&i.enableBackgroundWithAuto===v.auto)for(var u=0,c=d;u<c.length;u++){var g=c[u];g.outside||(g.hasBackground=!0)}return d},u.prototype.tryOutsidePositionForDonut=function(t,e,a,i){var r=t.labelDataPoint.parentShape;if(!_.isEmpty(r.validPositions)&&0!==r.validPositions[0]){var n=r.validPositions[0],r=this.tryAllOutsidePositions(t,e,n,i);if(r&&0===r.score)return this.buildLabel(r,e,!0,a);if(_.includes(f,this.donutChartProperties.dataLabelsSettings.labelStyle)){t=this.splitDonutDataPoint(t,this.donutChartProperties.dataLabelsSettings.labelStyle),i=this.tryAllOutsidePositions(t,e,n,i);if(i&&(!r||i.score<r.score))return this.buildLabel(i,e,!0,a)}return r?this.buildLabel(r,e,!0,a):void 0}},u.prototype.tryInsidePositionForDonut=function(t,e,a,i){e=this.tryAllInsidePositions(t,e,a,i.overflow);if(e)return{label:this.buildLabel(e,a,!1,i),overflows:e.overflows}},u.prototype.generateCandidate=function(t,e,a,i){var r=t.labelDataPoint,n=u.generateCandidateAngleForPosition(r.donutArcDescriptor,e),o=this.getPointPositionForAngle(n),s=o.point,l=this.score(r,s),d=(r.donutArcDescriptor.startAngle+r.donutArcDescriptor.endAngle)/2,e=w.explodeXOffset(d,this.donutChartProperties),d=w.explodeYOffset(d,this.donutChartProperties),e=m.getLabelLeaderLineForDonutChart(r.donutArcDescriptor,this.donutChartProperties,s,n,e,d,i),d=m.getLabelLeaderLinesSizeForDonutChart(e),r=_.clone(r);return r.parentShape=o,r.leaderLinePoints=e,r.linesSize=d,{point:o,score:l,labelRects:u.tryPositionPoint(a,o.validPositions[0],r,this.center,this.donutChartProperties.viewport,0,i),donutLabelDataPointLayoutInfo:{labelDataPoint:r,hasBeenRendered:t.hasBeenRendered,labelSize:t.labelSize},renderLeaderLines:!0,overflows:!1}},u.prototype.tryAllOutsidePositions=function(t,e,a,i){var r=t.labelDataPoint,n=this.donutChartProperties.explode,o=u.tryPositionPoint(e,a,r,this.center,this.donutChartProperties.viewport,n,i),a=r.parentShape,n={point:a,score:this.score(r,a.point),labelRects:o,donutLabelDataPointLayoutInfo:t,renderLeaderLines:!0,overflows:!1};if(o&&o.textRect&&0===n.score)return n;var s,a=[];o&&o.textRect?(a=u.getLabelPointPositions(r.parentShape,!0),s=n):a=u.getLabelPointPositions(r.parentShape,!1);for(var l=0,d=a;l<d.length;l++){var h=d[l],h=this.generateCandidate(t,h,e,i);if(h.labelRects&&h.labelRects.textRect&&(null==s||h.score<s.score)&&0===(s=h).score)return s}return s},u.prototype.tryAllInsidePositions=function(t,e,a,i){for(var r,n,o,s,l=t.labelDataPoint.angle,d=(e.innerRadius+e.outerRadius)/2,h=w.explodeXOffset(l,e),u=w.explodeYOffset(l,e),c=0,g=x;c<g.length;c++){var p=this.getInsidePosition(t,e,l,d,g[c]),f=this.score(t.labelDataPoint,p),v={point:p,radius:0,validPositions:[256]},y=b.DataLabelPointPositioner.getLabelRect(t.labelDataPoint.textSize,v,256,0),p=void 0,p=0===e.explode?{left:y.left+this.center.x,top:y.top+this.center.y,width:y.width,height:y.height}:{left:y.left+this.center.x+h,top:y.top+this.center.y+u,width:y.width,height:y.height},y=!m.canLabelFit(t.labelDataPoint.donutArcDescriptor,e,y);!(null==o||o<f)||a.hasConflict(p)||!i&&y||(r=v,n=p,o=f,s=y)}if(r)return{point:r,score:0,labelRects:{textRect:n,diagonalLineRect:null,horizontalLineRect:null},donutLabelDataPointLayoutInfo:t,renderLeaderLines:!1,overflows:s}},u.prototype.getInsidePosition=function(t,e,a,i,r){var n=i,o=a;switch(r){case 0:break;case 1:n=i+.25*(e.outerRadius-e.innerRadius);break;case 2:n=i-.25*(e.outerRadius-e.innerRadius);break;case 3:o=a+.25*(t.labelDataPoint.donutArcDescriptor.endAngle-t.labelDataPoint.donutArcDescriptor.startAngle);break;case 4:o=a-.25*(t.labelDataPoint.donutArcDescriptor.endAngle-t.labelDataPoint.donutArcDescriptor.startAngle)}return m.getLabelPosition(o,n)},u.prototype.buildLabel=function(t,e,a,i){var r,n=t.labelRects.textRect,o=t.labelRects.horizontalLineRect,s=t.labelRects.diagonalLineRect,l=t.donutLabelDataPointLayoutInfo.labelDataPoint;null==l.categoryLabel&&null==l.dataLabel&&null==l.percentLabel||(r=!0),e.add(n),o&&e.add(o),s&&e.add(s);var d,o=n.top-this.center.y,e=n.left-this.center.x;switch(a&&(e<0?e+=n.width/2:e-=n.width/2),t.point.validPositions[0]){case 8:d="start";break;case 4:d="end";break;case 256:d="middle"}var h,u,c,g,s={left:e,top:o,height:n.height,width:n.width},e=C.getLabelStyleFlagType(this.donutChartProperties.dataLabelsSettings.labelStyle),o=m.getSpaceAvailableForDonutLabels(l.parentShape.point.x,this.donutChartProperties.viewport),p=o,n=b.visuals.DataLabelViewModel.getLabelTailoredText;if(e===L.labelStyleFlagEnum.categoryAndDataAndPercent?null==l.secondRowText?p=o/=3:p/=2:e!==D.categoryAndData&&e!==D.categoryAndPercent&&e!==D.dataAndPercent||null==l.secondRowText&&(p=o/=2),y.hasFlag(e,L.flagLabelStyleData)&&(f=void 0,(f=e!==L.labelStyleFlagEnum.categoryAndDataAndPercent&&e!==D.categoryAndData||null!=l.secondRowText?p:p-this.additionalSpaceWidth)<this.ellipsisWidth&&(r=!1),h=n({label:l.dataLabel,maxWidth:f,fontProperties:l.fontProperties})),y.hasFlag(e,L.flagLabelStyleCategory)&&(o<this.ellipsisWidth&&(r=!1),u=n({label:l.categoryLabel,maxWidth:o,fontProperties:l.fontProperties})),y.hasFlag(e,L.flagLabelStylePercent)){var f=void 0;switch(e){case D.categoryAndDataAndPercent:f=p-this.additionalParenthesesWidth-this.additionalSpaceWidth;break;case D.dataAndPercent:f=null==l.secondRowText?p-this.additionalParenthesesWidth-this.additionalSpaceWidth:p-this.additionalParenthesesWidth;break;case D.categoryAndPercent:f=p-this.additionalSpaceWidth;break;default:D.percent;f=p}f<this.ellipsisWidth&&(r=!1),c=n({label:l.percentLabel,maxWidth:f,fontProperties:l.fontProperties})}switch(h&&"…"!==h||u&&"…"!==u||c&&"…"!==c||(r=!1),e){case D.categoryAndDataAndPercent:c=c?"("+c+")":null,null==l.secondRowText?g=C.combineStrings([u,h,c]," "):(g=C.combineStrings([h,c]," "),l.secondRowText=u);break;case D.categoryAndData:null==l.secondRowText?g=C.combineStrings([u,h]," "):(g=h,l.secondRowText=u);break;case D.categoryAndPercent:null==l.secondRowText?g=C.combineStrings([u,c]," "):(g=c,l.secondRowText=u);break;case D.dataAndPercent:c=c?"("+c+")":null,null==l.secondRowText?g=C.combineStrings([h,c]," "):(g=c,l.secondRowText=h);break;case D.data:g=h;break;case D.percent:g=c;break;default:D.category;g=u}return o=e===D.categoryAndDataAndPercent&&null==l.secondRowText?o+p+p:e===D.categoryAndData||e===D.categoryAndPercent?o+p:e===D.dataAndPercent?p+p:o,l.textSize.width=Math.min(l.textSize.width,o),{boundingBox:s,text:g,tooltip:a?l.tooltip:null,isVisible:r,identity:l.identity,fontProperties:S.inherit(l.fontProperties,{color:a?l.outsideFill:l.insideFill}),selected:!1,textAnchor:d,leaderLinePoints:t.renderLeaderLines?l.leaderLinePoints:void 0,hasBackground:!a&&i.enableBackgroundWithAuto===v.on,secondRowText:l.secondRowText,backgroundColor:l.backgroundColor,backgroundTransparency:l.backgroundTransparency,outside:a}},u.tryPositionPoint=function(t,e,a,i,r,n,o){void 0===n&&(n=0);var s=a.parentShape,o=null==o||!o.pieChartMarginBetweenSlices||C.startingLabelOffset-n<C.startingLabelOffset?C.startingLabelOffset:C.startingLabelOffset-n,n=_.clone(a.textSize);n.width=Math.min(n.width,m.getSpaceAvailableForDonutLabels(s.point.x,r));r=b.DataLabelPointPositioner.getLabelRect(n,s,e,o),n={point:{x:a.leaderLinePoints[0][0],y:(a.leaderLinePoints[0][1]<0?a.leaderLinePoints[1]:a.leaderLinePoints[0])[1]},radius:0,validPositions:null},s=b.DataLabelPointPositioner.getLabelRect(a.linesSize[m.DiagonalLineIndex],n,e,o),n={point:{x:a.leaderLinePoints[1][0],y:a.leaderLinePoints[1][1]},radius:0,validPositions:null},e=b.DataLabelPointPositioner.getLabelRect(a.linesSize[m.HorizontalLineIndex],n,e,o);if(r&&s&&e){r.left+=i.x,r.top+=i.y;o=i.x-r.width/2;return s.left+=o,s.top+=i.y,e.left+=o,e.top+=i.y,t.hasConflict(r)||t.hasConflict(s)||t.hasConflict(e)?void 0:{textRect:r,diagonalLineRect:s,horizontalLineRect:e}}},u.getLabelPointPositions=function(t,e){var a=t.validPositions[0];return e?t.point.y<0?8===a?[64]:[128]:8===a?[16]:[32]:4===a?[128,32]:[16,64]},u.prototype.splitDonutDataPoint=function(t,e){var a=t.labelDataPoint,i=a.categoryLabelSize?a.categoryLabelSize.width:0,r=a.dataLabelSize?a.dataLabelSize.width:0,n=a.percentLabelSize?e===L.dataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth:e===L.categoryAndDataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth+this.additionalSpaceWidth:a.percentLabelSize.width:0,o=a.categoryLabelSize?a.categoryLabelSize.height:0,s=a.dataLabelSize?a.dataLabelSize.height:0,l=a.percentLabelSize?a.percentLabelSize.height:0,s={width:e===L.dataAndPercent?Math.max(r,n):Math.max(i,r+n),height:2*Math.max(o,Math.max(s,l))},l=_.clone(a);return l.textSize=s,l.secondRowText=e===L.dataAndPercent?a.dataLabel:a.categoryLabel,{labelDataPoint:l,hasBeenRendered:t.hasBeenRendered,labelSize:t.labelSize}},u.generateCandidateAngleForPosition=function(t,e){var a=t.startAngle+(t.endAngle-t.startAngle)/2;switch(e){case 64:case 32:return(t.startAngle+a-Math.PI)/2;case 128:case 16:return(a+t.endAngle-Math.PI)/2}},u.prototype.getPointPositionForAngle=function(t){var e=m.getXPositionForDonutLabel(Math.cos(t)*this.labelRadius);return{point:{x:e,y:Math.sin(t)*this.labelRadius},validPositions:[e<0?4:8],radius:0}},u.prototype.score=function(t,e){var a=m.getSpaceAvailableForDonutLabels(e.x,this.donutChartProperties.viewport),i=this.donutChartProperties.dataLabelsSettings.labelStyle,r=t.categoryLabelSize?t.categoryLabelSize.width:0,n=t.dataLabelSize?t.dataLabelSize.width:0,o=t.percentLabelSize?t.percentLabelSize.width:0;if(i===L.categoryAndDataAndPercent){if(null!=t.secondRowText){var e=Math.max(r-a,0),s=Math.max(Math.max(n,o+this.additionalParenthesesWidth+this.additionalSpaceWidth)-a/2,0);return Math.max(e,s)}s=Math.max(r,n+this.additionalSpaceWidth,o+this.additionalParenthesesWidth+this.additionalSpaceWidth),a/=3}else i===L.categoryAndData&&null==t.secondRowText?(s=Math.max(r,n+this.additionalSpaceWidth),a/=2):i===L.categoryAndPercent&&null==t.secondRowText?(s=Math.max(r,o+this.additionalSpaceWidth),a/=2):i===L.dataAndPercent?(s=null==t.secondRowText?Math.max(n,o+this.additionalParenthesesWidth+this.additionalSpaceWidth):Math.max(n,o+this.additionalParenthesesWidth),a/=2):s=t.textSize.width;return Math.max(s-a,0)},u);function u(t){this.donutChartProperties=t,this.center={x:t.viewport.width/2,y:t.viewport.height/2},this.labelRadius=this.donutChartProperties.labelRadius;t=S.toTextProperties(t.dataLabelsSettings.fontProperties);this.additionalParenthesesWidth=b.TextMeasurementService.measureSvgTextWidth(t,"()"),this.additionalSpaceWidth=b.TextMeasurementService.measureSvgTextWidth(t," "),this.ellipsisWidth=b.TextMeasurementService.measureSvgTextWidth(t,"…")}b.DonutLabelLayout=t}(powerbi=powerbi||{}),function(t){((t=t.powerbi||(t.powerbi={})).visuals||(t.visuals={})).imporDonutChartModule=function(){}}(es6=es6||{}),function(t){var e;(e=t.visuals||(t.visuals={})).initializeDonutChartFactoryES6=function(){e.setCreateDonutChart(function(e){return es6.powerbi.visuals.imporDonutChartModule().then(function(t){return new t.DonutChart(e)})})}}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
