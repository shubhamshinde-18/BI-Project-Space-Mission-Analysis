'use strict'; 
"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] || (this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('powerbiportal.addons.bundle.min.js');var powerbi,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(a,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?a(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,n)}r((c=c.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(a,i){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return (function(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&t[0]?r.return:t[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,t[1])).done)return o;switch(r=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(a,s)}catch(e){t=[6,e],r=0}finally{n=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}})([t,e])}}};!(function(n){!(function(t){var e=jsCommon.Utility,a=n.telemetryEventFactory,i=n.telemetry.EventFactories;e?e.generateGuid:Function.prototype;t.GatewaysAddPrepopulatedDatasourceToGatewayEventName="PBI.Gateways.AddPrepopulatedDatasourceToGateway",t.GatewaysAddPrepopulatedDatasourceToGateway=i[t.GatewaysAddPrepopulatedDatasourceToGatewayEventName]=function(e){return a({name:t.GatewaysAddPrepopulatedDatasourceToGatewayEventName,baseEvent:t.CustomerAction(e),info:e,category:n.TelemetryCategory.CustomerAction,loggers:t.GatewaysAddPrepopulatedDatasourceToGatewayLoggers})},t.GatewaysTableLoadedEventName="PBI.Gateways.TableLoaded",t.GatewaysTableLoaded=i[t.GatewaysTableLoadedEventName]=function(e){return a({name:t.GatewaysTableLoadedEventName,baseEvent:t.Verbose(e),info:e,category:n.TelemetryCategory.Verbose,loggers:t.GatewaysTableLoadedLoggers})},t.GatewaysGetTokenErrorEventName="PBI.Gateways.GetTokenError",t.GatewaysGetTokenError=i[t.GatewaysGetTokenErrorEventName]=function(e){return a({name:t.GatewaysGetTokenErrorEventName,baseEvent:t.ErrorWithStackTrace(e),info:e,category:n.TelemetryCategory.CriticalError,loggers:t.GatewaysGetTokenErrorLoggers})}})(n.telemetry||(n.telemetry={}))})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).htmlTemplate||(e.htmlTemplate={})).put=function(e){e.put("components/datasourceSettings/datasourceSettingsView.html",'<div class="formContainer"><header ng-switch on="ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.isLoadingForm"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false"><div class="successContainer" ng-if="ctrl.isDataSourceTestConnectionSuccessful()"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsDataSource_SettingsConnectionSuccessfulText"></span></div><div ng-if="!ctrl.viewModel.hasTestConnectionFailure && ctrl.datasourceModel.connectionError && !ctrl.datasourceModel.connected"><inline-message use-error-icon trace-details="ctrl.datasourceModel.traceDetails"><span localize="SettingsDataSource_SettingsConnectionErrorTitle"></span><span ng-bind="ctrl.datasourceModel.connectionError"></span></inline-message></div><div ng-if="!ctrl.viewModel.hasTestConnectionFailure && ctrl.datasourceModel.connectionError && ctrl.datasourceModel.connected"><inline-message class="inlineInfo" trace-details="ctrl.datasourceModel.traceDetails"><span ng-bind="ctrl.datasourceModel.connectionError"></span></inline-message></div><div class="messageContainer" ng-switch on="ctrl.viewModel.messageState"><div ng-switch-when="1"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><span localize="SettingsDataSource_SettingsAddUserText1" localize-fragments><a fragment-index="0" href=\'\' localize="SettingsDataSource_SettingsAddUserText2" ng-click="ctrl.switchToUserTab()"></a></span></inline-message></div><div ng-switch-when="2"><inline-message use-error-icon trace-details="ctrl.datasourceModel.compositeTraceDetails"><span ng-bind="ctrl.datasourceModel.errorTitle" role="alert"></span><span ng-bind="ctrl.datasourceModel.compositeErrorMessage" role="alert"></span></inline-message></div></div></div></header><form name="settingsForm" autocomplete="off" ng-hide="ctrl.viewModel.isLoadingForm"><section><label for="dataSourceName" class="input-field-label" localize="SettingsDataSource_SettingsName"></label> <input id="dataSourceName" select-pristine-on-focus type="text" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.viewModel.editableSettings.dataSourceName" required/></section><section><label for="dataSourceType" class="input-field-label" localize="SettingsDataSource_SettingsType"></label> <select id="dataSourceType" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.viewModel.editableSettings.dataSourceKind" ng-change="ctrl.onDataSourceTypeChange()" ng-options="dataSourceKind as value.name for (dataSourceKind, value) in ctrl.viewModel.dataSourceMetadataMap" required><option value="" disabled localize="SettingsGateway_SelectDataSourceType">Select a data source type</option></select></section><div class="connectionSettings" ng-show="ctrl.viewModel.editableSettings.dataSourceKind !== undefined"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.requiredDataSourceConnectionParameters"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label> <input id="{{ ::parameter.name }}" type="{{ ::parameter.type }}" ng-if="::!parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" required/> <select id="{{ ::parameter.name }}" ng-if="::parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" ng-options="option.value as option.caption for option in parameter.options" required></select></section><section ng-show="ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions.length > 1                    || ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions[0].id === 5"><label for="dataSourceAuthenticationMethod" class="input-field-label" localize="SettingsDataSource_SettingsAuthenticationMethod"></label> <select id="dataSourceAuthenticationMethod" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus || ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-model="ctrl.viewModel.editableSettings.credentialType" ng-change="ctrl.onCredentialMethodChange()" ng-options="option.id as option.name for option in ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions" required><option value="" disabled localize="SettingsGateway_SelectAnAuthenticationMethod">Select an authentication method</option></select></section><div ng-show="ctrl.viewModel.editableSettings.credentialType !== undefined && ctrl.viewModel.editableSettings.credentialType !== 0 && ctrl.viewModel.editableSettings.credentialType !== 2" ng-disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled"><section><span localize="SettingsDataSource_SettingsCredentialEncryptionText"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></section><div ng-if="ctrl.viewModel.editableSettings.credentialType !== 5"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.credentialParameters"><section ng-show="{{ parameter.shouldDisplay }}"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label><section ng-if="parameter.type === \'text\'"> <input id="{{ ::parameter.name }}" type="text" placeholder="{{ ::parameter.placeholder }}" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"/></section><section ng-if="parameter.type === \'password\'"> <input id="{{ ::parameter.name }}" type="password" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"/></section><section ng-if="parameter.type === \'select\'"> <select id="{{ ::parameter.name }}" ng-options="nvp.Value as nvp.Name for nvp in parameter.options" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"><option value="" disabled localize="SelectAnOption"> Select an Option</option></select><section class="glyph-error-color" ng-if="ctrl.showSAPBWSncLibWarningMessage()"><span localize="SettingsDataSource_SettingsSAPBWSncLibWarning_Message"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=2151620" localize="LearnMore"></a></section></section></section></section></div><div class="oauthCredentialCheck" ng-if="ctrl.viewModel.editableSettings.credentialType === 5"><i class="glyphicon pbi-glyph-error glyph-small" ng-show="ctrl.viewModel.isAddingDataSource && authDialogParameters.credentialData === undefined"></i> <button class="oauthEditCredentialButton" localize="SettingsDataset_ManageDataSources_EditButtonText" ng-click="ctrl.oauthEditCredentialButton(settingsForm.$valid)"></button></div></div><div class="skipTestConnectionCheckBox" ng-if="ctrl.isSkipTestConnectionAllowed()"> <input id="skipTestConnection" type="checkbox" ng-disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-model="ctrl.isSkipTestConnectionSelected" ng-change="ctrl.onSkipTestConnectionChange()"/><label class="skipTestConnectionLabel" localize="SettingsDataSource_SettingsSkipTestConnection_Text" for="skipTestConnection"></label></div><section class="advancedSettingsContainer" ng-if="ctrl.enterpriseGatewayETLEnabled"> <button class="expandHiddenSectionButton" ng-class="{expanded: ctrl.viewModel.advancedSettingsExpanded}" ng-click="ctrl.viewModel.advancedSettingsExpanded = !ctrl.viewModel.advancedSettingsExpanded; $event.stopPropagation();" aria-expanded="{{ctrl.viewModel.advancedSettingsExpanded}}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon"></i><span localize="SettingsDataSource_AdvancedSettings"></span></button><div ng-show="ctrl.viewModel.advancedSettingsExpanded"><section ng-if="ctrl.hasOptionalParameters()" id="optionalParametersSection"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.optionalDataSourceConnectionParameters"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label> <input id="{{ ::parameter.name }}" type="{{ ::parameter.type }}" ng-if="::!parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value"/> <select id="{{ ::parameter.name }}" ng-if="::parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" ng-options="option.value as option.caption for option in parameter.options"></select></section></section><section ng-if="ctrl.allowOnPremSingleSignOn()" id="singleSignOnOptionSection"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnKerberosForDQ" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnKerberosEnabled" ng-change="ctrl.onSingleSignOnKerberosChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOn_Text" for="singleSignOnKerberosForDQ"></label></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div><section ng-if="ctrl.showKerberosSSOForDQAndRefresh()"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnKerberosForDQAndRefresh" type="checkbox" ng-disabled="!ctrl.viewModel.isAddingDataSource" ng-model="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-change="ctrl.onSingleSignOnKerberosForDQAndRefreshChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_Text" for="singleSignOnKerberosForDQAndRefresh"></label></div><div class="singleSignOnSettingDescription singleSignOnSettingDescriptionFirstLine"><span localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div><div ng-if="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" class="singleSignOnSettingDescription singleSignOnSettingDescriptionLastLine"><span localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_DisabledWarning"></span></div></section><div class="singleSignOnSettingCheckBox" ng-if="ctrl.isSingleSignOnSAMLAllowed()"> <input id="singleSignOnSAMLForDQ" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnSAMLEnabled" ng-change="ctrl.onSingleSignOnSAMLChange()"/><label class="singleSignOnSettingDescription singleSignOnSettingDescriptionOnlyLine" localize="SettingsDataSource_SettingsSingleSignOnSAML_Text" for="singleSignOnSAMLForDQ"></label></div></section><section ng-if="ctrl.isSingleSignOnAADSupported()"><div class="singleSignOnSettingCheckBox"> <input id="SingleSignOnAAD" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnAADEnabled" ng-change="ctrl.onSingleSignOnAADChange()" no-label/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOnAAD_Text" for="SingleSignOnAAD"></label></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=861818" localize="LearnMore"></a></div></section><section ng-if="ctrl.showSSOTestConnection()"><sso-test-connection datasource-model="ctrl.datasourceModel" single-sign-on-type="ctrl.viewModel.singleSignOnType"></sso-test-connection></section><section ng-if="ctrl.showEncryptedConnection()" id="EncryptedConnectionSection"><section id="EncryptedConnectionSelectSection"><label for="EncryptedConnectionSelect" class="input-field-label" localize="SettingsDataSource_SettingsEncryptedConnectionOptionLabel"></label> <select id="EncryptedConnectionSelect" ng-disabled="ctrl.disableEncryptedConnection()" ng-model="ctrl.encryptedConnectionString" ng-change="ctrl.onEncryptedConnectionChange()"><option value="0" localize="Encrypted" ng-selected="ctrl.viewModel.editableSettings.encryptedConnection === 0"></option><option value="2" localize="NotEncrypted" ng-selected="ctrl.viewModel.editableSettings.encryptedConnection === 2"></option></select></section><div ng-show="ctrl.isAutoDetectEncryptedConnectionVisible" id="autoDetectEncryptedConnectionCheckBox"> <input id="autoDetectEncryptedConnection" type="checkbox" ng-model="ctrl.isAutoDetectEncryptedConnectionEnabled" ng-change="ctrl.onAutoDetectEncryptedConnectionChange()" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus"/><label for="autoDetectEncryptedConnection" class="input-field-label" localize="SettingsDataSource_SettingsAutoDetectEncryptedConnectionLabel"></label></div></section><section><label for="dataSourcePrivacyLevel" class="input-field-label" localize="SettingsDataSource_SettingsPrivacyLevelLabel"></label> <select id="dataSourcePrivacyLevel" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.privacyLevelString" ng-change="ctrl.onPrivacyLevelChange()"><option value="0" localize="None" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 0"></option><option value="1" localize="SettingsDataSource_SettingsPrivacyLevel_Private" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 1"></option><option value="2" localize="SettingsDataSource_SettingsPrivacyLevel_Organizational" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 2"></option><option value="3" localize="SettingsDataSource_SettingsPrivacyLevel_Public" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 3"></option></select></section></div></section></div><div class="buttonsContainer" ng-if="ctrl.viewModel.editableSettings.dataSourceKind !== undefined"><div ng-switch on="ctrl.viewModel.isAddingDataSource"> <button class="primary" localize="Apply" ng-switch-when="false" ng-disabled="ctrl.isUpdateDataSourceDisabled()" ng-click="ctrl.tryApplyChanges(settingsForm.$valid)"></button> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-switch-when="true" ng-disabled="ctrl.isAddDataSourceDisabled()" ng-click="ctrl.tryAddDataSource(settingsForm.$valid)"></button> <button localize="SettingsDataSource_SettingsDiscard" ng-disabled="!settingsForm.$dirty || ctrl.viewModel.waitingForDataSourceStatus" ng-click="ctrl.tryDiscardChanges()" formnovalidate></button></div></div><auth-dialog view-model="authDialogParameters" ng-if="authDialogParameters.showAuthDialog"></auth-dialog></form></div>'),e.put("components/gatewaysTable/gatewaysTableView.html",'<section class="outerContainer emptyGateways" ng-if="$ctrl.parentViewModel.egwStatusLoaded && $ctrl.showGatewaysTable && $ctrl.noGateways()"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h3 localize="Gateways_NoGatewaysWarningTitle"></h3><p><span localize="SettingsGateways_NoSuitableDataGateways"></span><a href="https://go.microsoft.com/fwlink/?linkid=2162537" target="_blank" localize="LearnMore"></a></p></section><section ng-class="$ctrl.getEGWClass()"><div class="outerContainer hideIfNoEGW" ng-if="$ctrl.showGatewaysTable" ng-switch on="$ctrl.parentViewModel.egwStatusLoaded"><spinner ng-switch-when="false"></spinner><div class="innerContainer" ng-switch-when="true"><table class="gatewaysTable"><thead class="header"><tr><th class="gatewaysTableSelection hideIfNoEGW"></th><th class="gatewayName headerContent" localize="SettingsGateways_Gateway"></th><th class="departmentName headerContent" localize="SettingsGateways_Department"></th><th class="contactInfo headerContent" localize="SettingsGateways_ContactInformation"></th><th class="status headerContent" ng-if="$ctrl.parentViewModel.showStatus" localize="SettingsGateways_Status"></th><th class="gatewayActions headerContent" localize="Actions"></th></tr></thead><tbody class="gatewaysTableBody"><tr ng-if="$ctrl.shouldShowOnlinePgw() && !$ctrl.isSoverignCloud" class="gatewayRows" ng-click="$ctrl.selectPersonalGateway()"><td class="egwRadioButton hideIfNoEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-model="$ctrl.parentViewModel.useEnterpriseGateway" ng-value="false" ng-click="$ctrl.selectPersonalGateway()"><label class="dummyRadioButtonLabel"></label></div></td><td><div class="gatewayNameContainer" ng-switch="gateway.gatewayType"><i ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-normal egwIcon"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-normal vnetIcon"></i><label localize="SettingsDataset_GatewayPersonal"></label></div></td><td></td><td></td><td><div class="gatewayStatusContainer"><i class="glyphicon pbi-glyph-circled-checkmark glyph-small gatewayStatusLabelOnline gatewayStatusIcon"></i><label class="gatewayStatusLabelOnline" ng-bind="$ctrl.getOnlineGatewayMachineStatusString(null)"></label></div></td><td> <button class="actionButton" name="DeletePGW" ng-click="$ctrl.deletePersonalGatewayInTable(); $event.stopPropagation();"><i class="glyphicon pbi-glyph-delete glyph-small" localize-tooltip="SettingsGateway_DeletePersonalGateway"></i></button></td></tr></tbody><tbody class="gatewaysTableBody" ng-repeat="gateway in $ctrl.parentViewModel.enterpriseGateways"><tr class="gatewayRows" ng-class="{ \'disabledGateway\' : gateway.isDisabled }" ng-click="$ctrl.enterpriseGatewaySelectedInTable(gateway)"><td class="egwRadioButton hideIfNoEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-model="$ctrl.parentViewModel.selectedGatewayObjectId" ng-value="gateway.objectId" ng-click="$ctrl.enterpriseGatewaySelectedInTable(gateway)" ng-disabled="$ctrl.isProperlyConfiguredEGWDisabled(gateway)"><label class="dummyRadioButtonLabel"></label></div></td><td><div class="gatewayNameContainer" ng-switch="gateway.gatewayType"><i ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-normal egwIcon"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-normal vnetIcon"></i><span class="trimmedTextWithEllipsis" ng-if="gateway.displayName" ng-bind="gateway.displayName" title="{{gateway.displayName}}"></span><span class="trimmedTextWithEllipsis" ng-if="!gateway.displayName" localize="SettingsGateways_ConnectToCloudDatasource"></span></div></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayDepartment" title="{{gateway.gatewayAnnotation.gatewayDepartment}}"></span></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')" title="{{gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')}}"></span></td><td ng-if="$ctrl.parentViewModel.showStatus" ng-switch="$ctrl.getGatewayState(gateway)"><div class="gatewayStatusContainer"><i ng-switch-when="offline" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="offline" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline_Or_Datasources"></label><i ng-switch-when="online" class="glyphicon pbi-glyph-circled-checkmark glyph-small gatewayStatusLabelOnline gatewayStatusIcon"></i><label ng-switch-when="online" class="gatewayStatusLabelOnline" ng-bind="$ctrl.getOnlineGatewayMachineStatusString(gateway)"></label><i ng-switch-when="supportedUntilDateAndOnline" class="glyphicon pbi-glyph-circled-checkmark glyph-small gatewayStatusLabelOnline gatewayStatusIcon"></i><label ng-switch-when="supportedUntilDateAndOnline" class="gatewayStatusLabelOnline" ng-bind="$ctrl.getOnlineGatewayMachineStatusString(gateway)"></label><i ng-switch-when="supportedUntilDateAndOffline" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="supportedUntilDateAndOffline" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline_Or_Datasources_SupportedUntilDate"></label><i ng-switch-when="notSupported" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="notSupported" class="gatewayStatusLabelOffline" localize="Gateways_Status_Not_Supported"></label><spinner ng-switch-when="unknown" class="gatewayStatusSpinner glyph-mini"></spinner></div></td><td> <button class="actionButton" name="ManageEGW" ng-click="$ctrl.navigateToManageGatewaysItem(gateway.gatewayType, gateway.objectId, null); $event.stopPropagation();" ng-disabled="gateway.isDisabled"><i class="glyphicon pbi-glyph-gear glyph-small" localize-tooltip="SettingsDataset_Gateway_StaticInfo_ManageGateways"></i></button><spinner class="actionSpinner" feature-switch="gatewayMultipleCredentials" ng-if="$ctrl.expandProperlyConfiguredDatasources === undefined"></spinner> <button class="actionButton" name="ExpandDatasources" ng-if="$ctrl.expandProperlyConfiguredDatasources" feature-switch="gatewayMultipleCredentials" ng-disabled="gateway.isDisabled" ng-click="$ctrl.expandProperlyConfiguredDatasources[$index] = !$ctrl.expandProperlyConfiguredDatasources[$index]; $event.stopPropagation();"><i class="glyphicon glyph-small" ng-class="{true:\'pbi-glyph-caretdown\', false:\'pbi-glyph-caretright\'}[$ctrl.expandProperlyConfiguredDatasources[$index]]" localize-tooltip="SettingsDataset_Gateway_StaticInfo_ViewDatasources"></i></button></td></tr><tr feature-switch="gatewayMultipleCredentials"><td colspan="6" class="datasourcesOuterContainer"><gateways-table-datasources gateway="gateway" monikers="$ctrl.monikers" expand-datasources="$ctrl.expandProperlyConfiguredDatasources[$index]" datasource-whitelist="::$ctrl.gatewayToDatasourceWhiteList[gateway.objectId]" datasources="$ctrl.datasources" is-dirty="$ctrl.isDirty" all-datasource-credentials-selected="$ctrl.allDatasourceCredentialsSelected[gateway.objectId]" datasource-status="$ctrl.parentViewModel.cachedDatasourceStatusResponse[gateway.objectId]"></gateways-table-datasources></td></tr></tbody><tbody class="gatewaysTableBody"><tr class="gatewayRows pgwRow" ng-if="$ctrl.shouldShowOfflinePgw() && !$ctrl.isSoverignCloud"><td class="egwRadioButton hideIfNoEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-disabled="true"><label class="dummyRadioButtonLabel"></label></div></td><td><div class="gatewayNameContainer" ng-switch="gateway.gatewayType"><i ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-normal egwIcon"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-normal vnetIcon"></i><label localize="SettingsDataset_GatewayPersonal"></label></div></td><td><span ng-if="$ctrl.parentViewModel.pgwAnnotation.gatewayMachine" ng-bind="$ctrl.parentViewModel.pgwAnnotation.gatewayMachine" title="{{$ctrl.parentViewModel.pgwAnnotation.gatewayMachine}}"></span></td><td></td><td><div class="gatewayStatusContainer"><i class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label class="gatewayStatusLabelOffline" localize="Gateways_Status_Not_Reachable"></label></td></div><td> <button class="actionButton" name="DeletePGW" ng-click="$ctrl.deletePersonalGatewayInTable()"><i class="glyphicon pbi-glyph-delete glyph-small" localize-tooltip="SettingsGateway_DeletePersonalGateway"></i></button></td></tr></tbody><tbody class="gatewaysTableBody" ng-repeat="gateway in $ctrl.parentViewModel.improperlyConfiguredEnterpriseGateways"><tr class="gatewayRows" ng-class="{ \'disabledGateway\' : gateway.isDisabled }"><td class="egwRadioButton hideIfNoEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-disabled="true"><label class="dummyRadioButtonLabel"></label></div></td><td><div class="gatewayNameContainer" ng-switch="gateway.gatewayType"><i ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-normal egwIcon"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-normal vnetIcon"></i><span class="trimmedTextWithEllipsis" ng-if="gateway.displayName" ng-bind="gateway.displayName" title="{{gateway.displayName}}"></span></div></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayDepartment" title="{{gateway.gatewayAnnotation.gatewayDepartment}}"></span></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')" title="{{gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')}}"></span></td><td ng-if="$ctrl.parentViewModel.showStatus" ng-switch="$ctrl.getImproperlyConfiguredGatewayState(gateway)"><div class="gatewayStatusContainer"><i ng-switch-when="supportedUntilDate" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="supportedUntilDate" class="gatewayStatusLabelOffline " localize="Gateways_Status_Deprecated_Improperly_Configured"></label><i ng-switch-when="notSupported" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="notSupported" class="gatewayStatusLabelOffline " localize="Gateways_Status_Not_Supported_Improperly_Configured"></label><i ng-switch-when="misconfigured" class="glyphicon pbi-glyph-error glyph-small gatewayStatusLabelOffline gatewayStatusIcon"></i><label ng-switch-when="misconfigured" class="gatewayStatusLabelOffline" localize="Gateways_Status_Improperly_Configured"></label><spinner ng-switch-when="unknown" class="gatewayStatusSpinner glyph-mini"></spinner></div></td><td> <button class="actionButton" name="ManageEGW" ng-disabled="gateway.isDisabled || gateway.isUserNonAdmin" ng-click="$ctrl.navigateToManageGatewaysItem(gateway.gatewayType, gateway.objectId, null)"><i class="glyphicon pbi-glyph-gear glyph-small" localize-tooltip="SettingsDataset_Gateway_StaticInfo_ManageGateways"></i></button><spinner class="actionSpinner" ng-if="$ctrl.expandDatasources === undefined"></spinner> <button class="actionButton" name="ExpandDatasources" ng-if="$ctrl.expandDatasources" ng-disabled="gateway.isDisabled" ng-click="$ctrl.expandDatasources[$index] = !$ctrl.expandDatasources[$index]"><i class="glyphicon glyph-small" ng-class="{true:\'pbi-glyph-caretdown\', false:\'pbi-glyph-caretright\'}[$ctrl.expandDatasources[$index]]" localize-tooltip="SettingsDataset_Gateway_StaticInfo_ViewDatasources"></i></button></td></tr><tr><td colspan="6" class="datasourcesOuterContainer"><gateways-table-datasources gateway="gateway" monikers="$ctrl.monikers" expand-datasources="$ctrl.expandDatasources[$index]" datasource-whitelist="::$ctrl.gatewayToDatasourceWhiteList[gateway.objectId]" datasources="$ctrl.datasources"></gateways-table-datasources></td></tr></tbody></table></div></div></section>'),e.put("components/gatewaysTableDatasources/gatewaysTableDatasourcesView.html",'<section ng-if="$ctrl.expandDatasources" class="datasourcesContainer"><p ng-if="::$ctrl.showAdminCenterLink" localize="GatewayDataSource_AdminCenter" localize-fragments><a target="_blank" fragment-index="0" ng-href="{{::$ctrl.adminCenterlUrl}}" localize="PowerPlatformAdminCenter" localize-tooltip="PowerPlatformAdminCenter"></a></p><label localize="GatewayDataSource_MustBeAdded"></label><table><tbody ng-repeat="moniker in $ctrl.filteredMonikerDatasources"><tr ng-switch="$ctrl.isDataSourceAddedToGateway(moniker.monikerDataSource)"><td><i ng-switch-when="true" class="glyphicon pbi-glyph-circled-checkmark glyph-small goodDatasource"></i><i ng-switch-when="false" class="glyphicon pbi-glyph-error glyph-small errorDatasource"></i><i ng-if="moniker.isMashedUp" class="glyphicon pbi-glyph-info glyph-small" localize-attr="{ title: \'SettingsDataset_MashupCloudDatasource_Information\' }"></i></td><td class="datasourceText"><span ng-bind="::$ctrl.getDatasourceDisplayString(moniker.monikerDataSource)"></span></td><td class="monikerTableActions" ng-if="::!$ctrl.gateway.isUserNonAdmin" align="right"><spinner ng-if="!$ctrl.datasourceWhitelist || !$ctrl.buildTableCompleted"></spinner><section ng-if="$ctrl.datasourceWhitelist && $ctrl.buildTableCompleted" ng-switch-when="true"><label feature-switch="gatewayMultipleCredentials" id="multipleDatasource" localize="GatewayDataSource_MapsTo"></label> <select class="selectMultipleDatasource" aria-labelledby="multipleDatasource" feature-switch="gatewayMultipleCredentials" ng-model="$ctrl.selectedDatasourceObjectIds[$ctrl.getCredentialsForMoniker(moniker.monikerDataSource).index]" ng-switch="$ctrl.getCredentialsForMoniker(moniker.monikerDataSource).canDatasourceBeAddedToGateway" ng-change="$ctrl.multipleCredentialSelected($ctrl.getCredentialsForMoniker(moniker.monikerDataSource).index, moniker.monikerDataSource)"><option value="remove" ng-if="$ctrl.shouldShowRemoveCloudDS(moniker.monikerDataSource)"></option><option ng-repeat="datasource in $ctrl.getCredentialsForMoniker(moniker.monikerDataSource).dataSources" value="{{datasource.objectId}}" ng-bind="datasource.displayName"></option><option value="0" ng-switch-when="0" ng-bind="$ctrl.addToGatewayString"></option><option value="2" ng-switch-when="2" ng-bind="$ctrl.addToGatewayOptionalString"></option><option value="4" ng-switch-when="4" ng-bind="$ctrl.manuallyAddToGatewayString"></option></select></section><section ng-if="$ctrl.datasourceWhitelist" ng-switch-when="false" ng-switch="::$ctrl.getDatasourceActionLabel(moniker)"><a href="" ng-switch-when="0" ng-click="$ctrl.navigateToAddDatasource(moniker.monikerDataSource)" ng-bind="$ctrl.addToGatewayString"></a><label ng-switch-when="1" localize="GatewayDataSource_CannotBeAddedToGateway"></label><a href="" ng-switch-when="2" ng-click="$ctrl.navigateToAddDatasource(moniker.monikerDataSource)" ng-bind="$ctrl.addToGatewayOptionalString"></a><a href="" ng-switch-when="3" ng-click="$ctrl.tryAddDatasourceUser(moniker.monikerDataSource)" localize="GatewayDataSource_GrantUserDataSourceAccess"></a><a href="" ng-switch-when="4" ng-click="$ctrl.navigateToAddDatasource(moniker.monikerDataSource)" ng-bind="$ctrl.manuallyAddToGatewayString"></a></section></td><td class="monikerTableActions" ng-if="::$ctrl.gateway.isUserNonAdmin" align="right"><section ng-switch-when="false" ng-switch="::$ctrl.getDatasourceActionLabel(moniker)"><label ng-switch-when="5" localize="GatewayDataSource_ContactAdminToAdd"></label><label ng-switch-when="6" localize="GatewayDataSource_ContactAdminToAddOptional"></label></section></td></tr></tbody></table></section>'),e.put("components/pgwWarningBox/pgwWarningBoxView.html",'<span><div class="gatewayTypeSelectionContainer newPersonalGatewayInstallNow" ng-if="$ctrl.allowPersonalGateway && $ctrl.showPersonalGatewayFirstTimeInstallNow()"><label localize="SettingsDataset_No_Personal_Gateways_Installed" class="noPersonalGatewaysInstalledLabel"></label><a localize="LearnMore" target="onPremGatewayPersonalLearnMore" href="https://go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a> <button><a localize="SettingsDataset_OnPrem_Gateway_InstallNow" href="https://go.microsoft.com/fwlink/?LinkID=534231" target="onPremGatewayPersonalDownloadPage"></a></button></div><div class="gatewayTypeSelectionContainer newPersonalGatewayInstallNow" ng-if="$ctrl.allowPersonalGateway && $ctrl.showPersonalGatewayUpgradeRequired()"><label localize="SettingsDataset_New_OnPrem_Gateway_Available_WithExpirationInfo" class="noPersonalGatewaysInstalledLabel"></label><a localize="LearnMore" target="onPremGatewayPersonalLearnMore" href="https://go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a> <button><a localize="UpgradeDialogButtonText_UpgradeNow" href="https://go.microsoft.com/fwlink/?LinkID=534231" target="onPremGatewayPersonalDownloadPage"></a></button></div></span>'),e.put("components/selectGateway/selectGateway.html",'<div ng-if="$ctrl.viewModel.isOnPremGatewayRequired && !$ctrl.viewModel.isCloudScheduleRefresh" localize="SettingsDataset_Gateway_StaticInfo" localize-fragments><a fragment-index="0" localize="SettingsDataset_Gateway_StaticInfo_ManageGateways" href="" ng-click="$ctrl.navigateToManageGateways()"></a></div><div ng-if="!$ctrl.viewModel.isOnPremGatewayRequired && $ctrl.viewModel.isCloudScheduleRefresh" localize="$ctrl.getNotRequiredGWString()" localize-fragments><a fragment-index="0" localize="Generic_LearnMore" target="_blank" href="https://go.microsoft.com/fwlink/?linkid=866567"></a></div><div ng-if="::$ctrl.viewModel.showHeader"><span class="title" ng-bind="$ctrl.viewModel.title"></span></div><div class="gatewayTypeSelectionContainer"><div class="gwOption"><span class="pbi-input"><label feature-switch-not="gatewayVNets" class="form-label" localize="SettingsDataset_GatewaySelectLabel"></label><label feature-switch="gatewayVNets" class="form-label" localize="SettingsDataset_GatewayVNetSelectLabel"></label><pbi-toggle class="toggleAction toggleTopMargin" ng-model="$ctrl.viewModel.useGateway" ng-change="$ctrl.useDataGateway()" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff" ng-disabled="$ctrl.isToggleDisabled()"></pbi-toggle><spinner ng-if="!$ctrl.viewModel.egwStatusLoaded"></spinner></span></div><div class="gwOption"><spinner ng-if="!$ctrl.viewModel.egwStatusLoaded"></spinner></div><section class="warningContainer" ng-if="$ctrl.viewModel.egwStatusLoaded && $ctrl.viewModel.showVNetWarning" role="alert"><span localize="SettingsDataset_GatewayVNetWarning"></span></section></div><gateways-table parent-view-model="$ctrl.viewModel" enterprise-gateway-selected="$ctrl.enterpriseGatewaySelected(gatewayObjectId)" gateway-type-selected="$ctrl.gatewayTypeSelected()" delete-personal-gateway="$ctrl.deletePersonalGateway()" monikers="$ctrl.cachedDiscoverDatasourceResponse.monikers" show-gateways-table="$ctrl.viewModel.showGatewaysTable" datasources="$ctrl.cachedDiscoverDatasourceResponse.datasources"></gateways-table><pgw-warning-box ng-if="!$ctrl.viewModel.enterpriseGateways || $ctrl.viewModel.enterpriseGateways.length === 0" is-cloud-schedule-refresh="$ctrl.viewModel.isCloudScheduleRefresh" gateway-status="$ctrl.viewModel.pgw.gatewayStatusJson.gatewayStatus" gateway-upgrade-state="$ctrl.viewModel.pgw.gatewayStatusJson.gatewayUpgradeState" allow-personal-gateway="$ctrl.viewModel.allowPersonalGateway"></pgw-warning-box>'),e.put("components/ssoTestConnection/ssoTestConnectionView.html",'<section> <button class="expandHiddenSectionButton" ng-class="{expanded: $ctrl.ssoTestConnectionExpanded}" ng-click="$ctrl.ssoTestConnectionExpanded = !$ctrl.ssoTestConnectionExpanded; $event.stopPropagation();" aria-expanded="{{$ctrl.ssoTestConnectionExpanded}}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon"></i><span localize="SettingsGateways_SSOTestConnection_Title"></span></button><section ng-if="$ctrl.ssoTestConnectionExpanded"><div class="description"><span localize="SettingsGateways_SSOTestConnection_Description"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=2154997" localize="LearnMore"></a></div><div class="inputContainer"> <input id="ssoTestConnectionUpnInput" ng-model="$ctrl.upn" type="text" localize-attr="{placeholder: \'UserPrincipalName\'}" ng-disabled="$ctrl.gatewayUpgradeRequired()" ignore-dirty/> <button localize="StartTest" ng-click="$ctrl.executeSSOTestConnection()" ng-disabled="$ctrl.disableStartTestButton()"></button></div><div ng-if="$ctrl.gatewayUpgradeRequired()" class="description"><i class="glyphicon glyph-small pbi-glyph-warning glyph-warning-color"></i><span localize="SettingsGateways_SSOTestConnection_UpgradeGateway"></span></div><div class="statusContainer" ng-style="{\'visibility\': $ctrl.testStatus !== \'NoResults\' ? \'visible\':\'hidden\'}" ng-switch on="$ctrl.testStatus"><div ng-switch-when="Running"><spinner></spinner><span localize="TestingGatewayCluster"></span></div><div ng-switch-when="Success"><i class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></i><span localize="CdsaAuthoring_Iframe_Succeeded"></span></div><div ng-switch-when="Failed"><i class="glyphicon glyph-small pbi-glyph-error glyph-error-color"></i><span localize="CdsaAuthoring_Iframe_Failed"></span></div><a ng-switch-when="Success|Failed" ng-switch-when-separator="|" ng-click="$ctrl.setDisplayDetailedResults(true); $event.stopPropagation();" localize="DetailedResults"></a></div></section></section><modal-dialog class="ssoTestConnectionModal" ng-if="$ctrl.displayDetailedResults" on-confirm-action="$ctrl.setDisplayDetailedResults(false)" on-cancel-action="$ctrl.setDisplayDetailedResults(false)" view-model="$ctrl.dialogModel"><section><h3 localize="DetailedResults"></h3><section class="resultContainer"><h4 ng-if="$ctrl.testResults.data.results.length > 1" class="resultsHeader" localize="ResultsByGateway"></h4><table ng-repeat="result in $ctrl.testResults.data.results"><tr><td ng-bind="::$ctrl.getGatewayNameFromObjectId(result.gatewayObjectId)" class="gatewayName"></td><td ng-switch="result.testSuccessful"><span ng-switch-when="true" localize="TestSucceeded" class="gatewayStatus"></span><span ng-switch-when="false" localize="TestFailed" class="gatewayStatus"></span></td></tr><tr ng-if="result.error || result.upgradeGateway"><td localize="SnapshotEmbed_ErrorMessage"></td><td ng-switch="result.upgradeGateway"><span ng-switch-when="true" localize="SettingsGateways_SSOTestConnection_UpgradeGateway"></span><span ng-switch-when="false" ng-bind="::$ctrl.convertToErrorMessage(result.error)"></span></td></tr><tr ng-if="result.error && result.error.code"><td localize="ErrorCode"></td><td ng-bind="::result.error.code"></td></tr><tr ng-switch="$ctrl.singleSignOnType" ng-if="result.resolvedUserPrincipalName"><td ng-switch-when="3" localize="SAMLCertificateUPN"></td><td ng-switch-default localize="LocalActiveDirectoryUPN"></td><td ng-bind="::result.resolvedUserPrincipalName"></td></tr><tr ng-if="result.activeDirectoryServer"><td localize="ActiveDirectoryServer"></td><td ng-bind="::result.activeDirectoryServer"></td></tr></table><span ng-if="$ctrl.testStatus === \'Failed\'" localize="SettingsGateways_SSOTestConnection_GatewayLogs"></span><h4 class="additionalInfo" localize="AdditionalInfo"></h4><table><tr><td localize="ServerError_ActivityIdText"></td><td ng-bind="::$ctrl.testResults.activityId"></td></tr><tr><td localize="ServerError_RequestIdText"></td><td ng-bind="::$ctrl.testResults.requestId"></td></tr><tr><td localize="DateAndTimeLabel"></td><td ng-bind="::$ctrl.testTimestamp"></td></tr></table></section> <button class="primary" ng-click="$ctrl.setDisplayDetailedResults(false)" localize="InFocus_Close"></button></section></modal-dialog>'),e.put("components/upnMappingPane/upnMappingPaneView.html",'<div class="upnMappingPane" ng-if="::$ctrl.viewModel"><header><h3 class="primaryHeading" localize="UpnMappingPane_Title"></h3><h6 class="secondaryHeading" localize="UpnMappingPane_Subtitle" localize-fragments><a fragment-index="0" href="//go.microsoft.com/fwlink/?LinkID=786855" target="_blank" localize="LearnMore"></a></h6></header><section class="contentContainer"><section class="dataSource"><h6 localize="UpnMappingPane_SelectDataSource"></h6><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="0"/><label class="form-label" localize="UpnMappingPane_EffectiveUserName"></label></div><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="1"/><label class="form-label" localize="UpnMappingPane_CustomData"></label></div></section><section class="mappingTable"><div class="mappingTableContainer"><div class="caption"><div localize="UpnMappingPane_Replace"></div><div localize="UpnMappingPane_With"></div></div><div class="tableContainer"><table><tr ng-repeat="rule in $ctrl.viewModel.mappingRules track by $index" ng-click="$ctrl.selectedRule = rule" ng-class="{selected: rule === $ctrl.selectedRule}"><td ng-bind="$index + 1"></td><td ng-bind="rule.searchString"></td><td ng-bind="rule.replacementString"></td></tr><tr><td ng-bind="$ctrl.viewModel.mappingRules.length + 1"></td><td> <input name="newSearchString" ng-model="$ctrl.newRule.searchString" placeholder="{{::$ctrl.localizedOriginalName}}"/></td><td> <input name="newReplacementString" ng-model="$ctrl.newRule.replacementString" placeholder="{{::$ctrl.localizedNewName}}"/></td></tr></table></div></div><div class="tableSelectionControl"><i class="glyphicon pbi-glyph-chevronupmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectPre()"></i><i class="glyphicon pbi-glyph-chevrondownmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectNext()"></i></div><div> <button localize="UpnMappingPane_Add" ng-disabled="!$ctrl.newRule.searchString || !$ctrl.newRule.replacementString" ng-click="$ctrl.addNewRule()"></button> <button localize="Delete" ng-disabled="!$ctrl.selectedRule" ng-click="$ctrl.deleteRule()"></button></div></section><section class="testRule"><div localize="UpnMappingPane_TestRuleTitle"></div><div class="originalValue"><div localize="UpnMappingPane_OriginalName"></div><div> <input ng-model="$ctrl.testRuleOriginalName" placeholder="{{::$ctrl.localizedOriginalName}}"/> <button localize="UpnMappingPane_TestRuleButtonText" ng-disabled="!$ctrl.testRuleOriginalName" ng-click="$ctrl.testRule()"></button></div></div><div class="replacementValue"><div localize="UpnMappingPane_AfterRuleApplied"></div><div> <input ng-model="$ctrl.testRuleNewName" placeholder="{{::$ctrl.localizedResultOfApplyingMappingRule}}" readonly/><spinner ng-show="$ctrl.isTestRuleRequestPending"></spinner></div></div></section></section><footer><div class="buttons"><spinner ng-show="$ctrl.isUpdateDataSourceRequestPending"></spinner> <button class="biButton primary" type="button" localize="OK_ButtonText" ng-disabled="false" ng-click="$ctrl.saveChangesAndExit()"></button> <button class="biButton" type="button" localize="Cancel_ButtonText" ng-click="$ctrl.closeUpnMappingPane()"></button></div></footer></div>'),e.put("views/datasourceUsersView.html",'<div class="formContainer verticalPaneContainer"><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_UsersAllowed"></label><div class="addEmailAddress"><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddUsers()"></button></div></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><table><tr ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" style="display:block"><td><div class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved" ng-attr-aria-label="{{editableUser.name}}"> <label class="form-label">{{editableUser.name}}</label></div></td><td><pbi-icon class="overrideEffectiveIdentity" name="permissions" size="small" ng-if="::editableUser.accessRight === 9" tooltip tooltip-config="{tooltipLocalizeDescription: \'OverrideEffectiveIdentityAccessRight_Icon_Tooltip\', tooltipArrowPosition: 1}"></pbi-icon></td></tr></table></div></div> <button localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedUsers()"></button> <button class="rightSideButton" ng-if="upnMappingEnabled" localize="UpnMappingPane_Title" ng-disabled="!viewModel.editableUsers || viewModel.editableUsers.length === 0" ng-click="mapUserNames()"></button></section></div></div>'),e.put("views/datasourceView.html",'<div class="settingsContainer"><div class="tabHeader"><ul><li ng-class="{selected: viewModel.tabSelectionType === 1}"> <button class="tabHeaderButton" ng-click="onTabSelected(1)" localize="SettingsDataSource_SettingsTitle"></button></li><li ng-class="{selected: viewModel.tabSelectionType === 2}" ng-if="viewModel.id !== -1"> <button class="tabHeaderButton" ng-click="onTabSelected(2)" localize="SettingsDataSource_UsersTitle"></button></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><datasource-settings ng-switch-when="1" datasource-model="viewModel"></datasource-settings><datasource-users ng-switch-when="2" datasource-model="viewModel"></datasource-users></div></div>'),e.put("views/gatewayAdministratorsView.html",'<div class="formContainer verticalPaneContainer"><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_AdminsAllowed"></label><div class="addEmailAddress"><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddAdministrators()"></button></div></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved" ng-attr-aria-label="{{editableUser.name}}"> <label ng-class="{\'userWithNoEmailAddress\': editableUser.emailAddress === null}" class="form-label">{{editableUser.name}}</label></div></div></div> <button class="rightSideButton" localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedAdminstrators()"></button></section></div></div>'),e.put("views/gatewaySettingsView.html",'<div class="formContainer"><header ng-switch="viewModel.isLoadingStatus"><div ng-switch-when="false" ng-switch="viewModel.status"><div ng-switch-when="1"><inline-message use-error-icon trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div><div ng-switch-when="2"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsGateway_ConnectedText"></span><div class="warning" ng-if="viewModel.traceDetails.details.length > 0"><inline-message class="inlineInfo" trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div></div></div><div ng-switch-when="true"><div class="statusContainer"><spinner class="settingsLoadingSpinner"></spinner><span localize="SettingsGateway_WaitingForConnectinonText"></span></div></div><div class="warning" ng-show="viewModel.gatewayUpgradeState === \'UpgradeRequired\'"><inline-message><span localize="SettingsGateway_UpgradeRequiredText"></span><a localize="UpgradeDialogButtonText_UpgradeNow" target="onPremGatewayUpgrade" href="//go.microsoft.com/fwlink/?linkid=856106" class="upgradeLink"></a></inline-message></div><div class="warning" role="alert" ng-if="viewModel.gatewayVersionStatuses.length > 0"><inline-message class="inlineInfo"><span localize="SettingsGateway_UpgradeAvailableText"></span><ul><li ng-repeat="gateway in viewModel.gatewayVersionStatuses"><span ng-bind="gateway.gatewayName"></span><span ng-bind="gateway.gatewayStatus"></span></li></ul><span localize="SettingsGateway_UpgradeText"></span><a localize="Capacity_Metrics_Notification_Message_Link" target="onPremGatewayUpgrade" href="//go.microsoft.com/fwlink/?linkid=856106" class="upgradeLink"></a></inline-message></div><div class="warning" ng-if="viewModel.status === 2 && viewModel.dataSources.length === 0"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><a href=\'\' localize="AddDataSourceToGatewayText" ng-click="addDataSource()"></a></inline-message></div></header><form name="settingsForm" autocomplete="off"><section><label id="gatewayClusterNameLabel" for="gatewayName" class="input-field-label" localize="SettingsGatewayCluster_Name"></label> <input id="gatewayName" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.displayName ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDepartment" class="input-field-label" localize="SettingsGateways_Department"></label> <input id="gatewayDepartment" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.gatewayAnnotation.gatewayDepartment ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDescription" class="input-field-label" localize="Description"></label><textarea id="gatewayDescription" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.description" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"></textarea></section><section><label for="gatewayContactInfo" class="input-field-label" localize="SettingsGateway_ContactInformation"></label><textarea id="gatewayContactInfo" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.contactInformationString" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"></textarea></section><div ng-if="isEnterpriseGatewayType()"><div class="gatewayConfigContainer"> <input id="cloudRefreshCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.allowCloudDatasourceRefreshThroughGateway" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_AllowCloudDataSourceRefreshThroughGateway" for="cloudRefreshCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2005525" localize="LearnMore"></a></div><div class="gatewayConfigContainer" ng-if="!isCustomConnectorsDisabled(viewModel.allowCustomConnectorsThroughGateway)"> <input id="customConnectorsCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.allowCustomConnectorsThroughGateway" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_AllowCustomConnectorsThroughGateway" for="customConnectorsCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2003934" localize="LearnMore"></a><div class="customConnectorsUnsupportedInformation" ng-show="!hasSupportedCustomConnectorsStaticCapabilities()"><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon"></span><label class="input-field-label" localize="SettingsGateway_CustomConnectorsUnsupportedInformation"></label></div></div><div class="gatewayConfigContainer"> <input id="basicLoadBalancingCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.isBasicLoadBalancingEnabled" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_EnableBasicLoadBalancing" for="basicLoadBalancingCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2005428" localize="LearnMore"></a></div></div><div class="buttonsContainer"> <button class="biButton primary" localize="Apply" ng-disabled="!viewModel.isDirty" ng-click="applyChanges()"></button> <button class="biButton" localize="SettingsDataSource_SettingsDiscard" ng-disabled="!viewModel.isDirty" ng-click="discardChanges()"></button></div></form></div>'),e.put("views/gatewaysView.html",'<div class="gatewaysSliderContentView" ng-if="::gatewayDataService" ng-switch="isLoading"><div class="gatewaysLayoutTop"><div class="sliderContentHeader"><spinner [size]="\'large\'" class="settingsLoadingSpinner" ng-switch-when="true"></spinner></div></div><div class="gatewaysLayoutBody" ng-switch-when="false" ng-switch="viewModel.gateways.length > 0"><div ng-switch-when="true"> <button class="settingsAddDataSource" ng-click="tryAddDataSource()" localize="AddDataSourceText" pbi-auto-focus></button><div class="settingsGateways"><div class="settingsGatewaysLeftColumn"><div><span id="gatewayClustersSpan" localize="SettingsGatewayClusters_SettingsTitle"></span></div><div class="gatewayTree"><ul><li class="navTreeItem" ng-repeat="gateway in viewModel.gateways" ng-class="{expanded: gateway.isExpanded}"><div ng-class="{selected: gateway.isExpanded ? viewModel.currentGatewayObjectId === gateway.objectId && viewModel.currentDataSourceObjectId === null : viewModel.currentGatewayObjectId === gateway.objectId}" ng-click="onItemSelected(gateway.objectId, null)"><div class="gatewayTreeItem"> <button class="expanderContainer" ng-disabled="gateway.dataSources.length === 0" ng-click="gateway.isExpanded = !gateway.isExpanded; $event.stopPropagation();"><i ng-if="gateway.dataSources.length > 0" class="glyphicon refreshSectionExpander pbi-glyph-chevronrightmedium expandIcon"></i></button> <button class="gatewayLabel trimmedTextWithEllipsis" ng-bind="gateway.displayName"></button><div class="gatewayIconContainer" ng-switch="gateway.gatewayType"><span ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-small egwIcon"></span><span ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-small vnetIcon"></span></div><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="gateway.status != 2"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="gateway.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></div></div><div class="expandableInnerContainer" ng-show="gateway.isExpanded"><ul><li ng-repeat="dataSource in gateway.dataSources" class="gatewayTreeItem" ng-class="{selected: viewModel.currentGatewayObjectId === gateway.objectId && viewModel.currentDataSourceObjectId === dataSource.objectId}" ng-click="onItemSelected(gateway.objectId, dataSource.objectId)"> <button class="gatewayLabel trimmedTextWithEllipsis" ng-bind="dataSource.displayName"></button><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="(dataSource.connectionError && !dataSource.connected) || dataSource.compositeErrorMessage"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="dataSource.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></li></ul></div></li></ul></div><div class="testConnectionContainer"> <button class="biButton" localize="SettingsGateway_TestConnections" ng-click="testConnections()"></button></div></div><div class="settingsGatewaysRightColumn"><div ng-switch on="getSelectionType()"><gateway ng-switch-when="1" view-model="viewModel.currentGateway"></gateway><datasource ng-switch-when="2" view-model="viewModel.currentDataSource"></datasource></div></div></div></div><div class="gatewaysEmpty unselectable" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h2 localize="Gateways_NoGatewaysWarningTitle"></h2><p localize="Gateways_NoGatewaysWarningText"></p><a href="https://go.microsoft.com/fwlink/?LinkId=627094" localize-tooltip="Gateways_LearnMore_Title" target="_blank" localize="LearnMore" pbi-auto-focus></a></div></div></div>'),e.put("views/gatewayView.html",'<div class="settingsContainer"><div class="tabHeader"><ul><li ng-class="{selected: viewModel.tabSelectionType === 1}"> <button id="gatewayClusterSettingsTitleSpan" class="tabHeaderButton" ng-click="onTabSelected(1)" localize="SettingsGatewayCluster_SettingsTitle"></button></li><li ng-class="{selected: viewModel.tabSelectionType === 2}"> <button class="tabHeaderButton" ng-click="onTabSelected(2)" localize="GatewayDataSource_SettingsAdministrators"></button></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><gateway-settings ng-switch-when="1" view-model="viewModel"></gateway-settings><gateway-administrators ng-switch-when="2" gateway-model="viewModel"></gateway-administrators></div></div>'),e.put("views/manageGatewaysView.html",'<div><main><iframe title="{{gatewayAdminPortalTitle}}" allow="clipboard-read; clipboard-write" name="gatewayAdminPortalFrame" id="gatewayAdminPortalFrame" sandbox="allow-scripts allow-popups allow-forms allow-same-origin" ng-src="{{gatewayAdminPortalUrl}}"></iframe></main></div>')}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).GatewaySettings=function(){this.restrict="E",this.templateUrl="views/gatewaySettingsView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewaySettingsController)}})(powerbi=powerbi||{}),(function(e){(e=(e=e.gateways||(e.gateways={})).constants||(e.constants={})).switchToUserTabEventName="gatewaySettingsSwitchToUserTab",e.dataSourceCreatedEventName="gatewaySettingsDataSourceCreated",e.onDirtyGatewaySelectionChanging="gatewayOnDirtyGatewaySelectionChanging",e.onGatewaySelectionChanged="gatewayOnGatewaySelectionChanged",e.discardAddingDataSourceEventName="gatewaySettingsDiscardAddingDataSource",e.addDataSourceEventName="gatewayAddDataSource",e.gatewaySelectionDiscardedEventName="gatewaySettingsGatewaySelectionDiscarded",e.selectGatewayStatusReadyEventName="gatewaySettingsSelectGatewayStatusReady",e.DataSourceTypePrefix="SettingsDataSourceType_",e.AuthenticationMethodPrefix="SettingsAuthenticationMethod_",e.LabelPrefix="SettingsLabel_",e.ServerError_ModelHasNoPowerBIDMMoniker="ModelHasNoPowerBIDMMoniker",e.ExtensionDataSourceKind="ExtensionDataSourceKind",e.extensionDataSourcePath="extensionDataSourcePath",e.database="database",e.server="server",e.warehouse="warehouse",e.dataSourceInformation="dataSourceInformation",e.PublishDatasourceToClusterErrorCode="DMTS_PublishDatasourceToClusterErrorCode",e.UpdateClusterDatasourceCredentialsErrorCode="DMTS_UpdateClusterDatasourceCredentialsErrorCode",e.UnsupportedConnectionStringErrorCode="DMTS_UnsupportedConnectionStringError",e.UnsupportedDatasourceKindErrorCode="DMTS_UnsupportedDatasourceKindErrorCode",e.GatewayMissingCustomConnectorErrorCode="DMTS_GatewayMissingCustomConnectorErrorCode",e.CreateMonikerDatasourceErrorCode="DMTS_CreateMonikerDatasourceErrorCode",e.GatewayUnreachableErrorCode="DM_GWPipeline_Client_GatewayUnreachable",e.mashupExtensionKindAllowListLowerCase=["impala","netezza","snowflake","spark"],e.PBIXContentProviderId=7,e.DynamicDataSourcesIsNotSupportedForRefreshErrorCode="DynamicDataSourcesIsNotSupportedForRefresh",e.DataSourcesV3serverErrorCodes=["DynamicDataSourcesIsNotSupportedForRefresh","DatasourceAnalysisFailedDueToGatewayUnreachableError","DatasourceAnalysisFailedDueToInvalidFormat","DatasourceAnalysisFailedDueToMissingExtension","DatasourceAnalysisFailedDueToUnknownError","DatasourceAnalysisFailedWithUnknownFunctions","DatasourceAnalysisFailedWithUnknownNativeQueries","DatasourceAnalysisFailedWithUnsupportedGatewayError","DatasourceAnalysisFailedWithUnknownOrUnsupportedDataSources"]})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).models||(e.models={})).DataSourceSettingsModel=function(){}})(powerbi=powerbi||{}),(function(e){var t,a;function i(){this.pendingUsers=new a,this.editableUsers=[],this.isAdding=!1,this.isReloadingList=!1}t=(t=e.gateways||(e.gateways={})).models||(t.models={}),a=e.common.models.EmailsListModel,t.DataSourceUserModel=i})(powerbi=powerbi||{}),(function(a){var y,e,w,h,s,r,n,o;function i(t,e,a){var i=f(t.allowableOptions),n=b(t.allowableOptions);return{displayName:t.gatewayName,objectId:t.gatewayObjectId,id:t.gatewayId,isLoadingDataSources:!1,isLoadingStatus:!1,status:D(t.gatewayStatus),dataSources:e?l(_.filter(e,(function(e){return e.gatewayObjectId===t.gatewayObjectId}))):[],isExpanded:!1,description:t.gatewayDescription,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:1,publicKey:t.gatewayPublicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:g(t.gatewayAnnotation),staticCapabilities:null,allowCloudDatasourceRefreshThroughGateway:i,allowCustomConnectorsThroughGateway:n,allowableOptions:t.allowableOptions,gatewayVersionStatuses:[{gatewayName:t.gatewayName,gatewayStatus:t.versionStatus}],expiryDate:t.expiryDate,gatewayType:t.gatewayType,isDisabled:!a&&t.gatewayType===r.VirtualNetwork,permission:t.permission}}function c(e,t){var a=p(e),i=v(e),n=null!==i&&1===i.selector,r=f(e.allowableOptions),o=b(e.allowableOptions),t=(function(e,t){for(var a="",i=[],n=0,r=e.gateways;n<r.length;n++){var o=r[n];null!==o.gatewayVersionStatus&&""!==o.gatewayVersionStatus&&"Latest"!==o.gatewayVersionStatus&&(a="SupportedUntilDate"===o.gatewayVersionStatus?t.format("SettingsGateways_VersionStatus_SupportedUntilDate",[(function(e,t){void 0===t&&(t=1);if(_.isEmpty(e)&&0!==t)return null;return new Date(new Date(e).getTime()+864e5*t).toDateString()})(o.expiryDate,1).toString()]):t.get("SettingsGateways_VersionStatus_"+o.gatewayVersionStatus),i.push({gatewayName:o.gatewayName,gatewayStatus:a}))}return i})(e,t);return{displayName:e.name,id:e.gatewayId,objectId:e.objectId,isLoadingDataSources:!1,isLoadingStatus:!1,status:D(s.Installed),dataSources:[],isExpanded:!1,description:e.description,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:1,publicKey:e.publicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:a,staticCapabilities:null,allowCloudDatasourceRefreshThroughGateway:r,allowCustomConnectorsThroughGateway:o,loadBalancingClusterSettings:i,isBasicLoadBalancingEnabled:n,gateways:e.gateways,allowableOptions:e.allowableOptions,gatewayVersionStatuses:t,expiryDate:e.expiryDate,gatewayType:e.type}}function l(e){return _.map(e,t)}function t(e){var t={id:e.dataSourceId,objectId:e.dataSourceObjectId,displayName:e.dataSourceName,onPremGatewayRequired:e.onPremGatewayRequired,dataSourceType:e.dataSourceType,connectionInfo:{connectionDetails:e.connectionDetails,credentialDetails:e.credentialDetails},users:null,tabSelectionType:1,singleSignOnType:e.singleSignOnType,key:e.key};return t.dataSourceAnnotation=d(e.dataSourceAnnotation),t}function d(e){var t={dataSourceAnnotationUPNMapping:{connectionStringPropertyName:a.common.contracts.gateway.ConnectionStringPropertyName.EffectiveUserName,mappingRules:[]}};if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}function u(e,t){for(var a=[],i=0,n=e;i<n.length;i++){var r,o,s,c=n[i],l=c.dataSourceType===h.Extension?c.extensionDataSourceKind:h[c.dataSourceType];null!=l&&(null!=(r=M(y.constants.DataSourceTypePrefix,l,t))&&(o=_.map(c.dataSourceCredentialTypes,(function(e){return{id:e,name:M(y.constants.AuthenticationMethodPrefix,w[e],t)}})),s=_.map(c.dataSourceLabels,(function(e){return{name:e.name,displayName:M(y.constants.LabelPrefix,e.name,t),type:C(e.name),isRequired:!0}})),a.push({dataSourceKind:l,name:r,dataSourceType:c.dataSourceType,extensionDataSourceKind:c.extensionDataSourceKind,labels:s,nestedParameters:null,credentialTypeOptions:o,isEncryptedConnectionSupported:c.isEncryptedConnectionSupported})))}return a}function S(e,t,a){for(var i=[],n=0;n<e.length;n++)i.push({name:t&&t[n]||e[n],caption:a&&a[n]||e[n],value:e[n]});return i}function p(e){return g(e.annotation)}function g(e){if(e)try{return JSON.parse(e)}catch(e){return null}return null}function v(e){return m(e.loadBalancingSettings)}function m(e){if(e)try{return JSON.parse(e)}catch(e){return null}return null}function f(e){return T(e,1)}function b(e){return T(e,2)}function D(e){return e===s.Live?a.connectivity.models.GatewayStatus.Live:a.connectivity.models.GatewayStatus.NotReachable}function M(e,t,a){t=0<t.length?t.charAt(0).toUpperCase()+t.slice(1):"";return a.getOptional("SettingsDataSource_"+e+t)||t}function C(e){switch(e.toLocaleLowerCase()){case"url":case"nullable url":case"sharepointsiteurl":return"url";case"number":case"nullable number":return"number";case"record":case"nullable record":return"record";default:return"text"}}function T(e,t){return(e&t)===t}y=a.gateways||(a.gateways={}),e=y.models||(y.models={}),w=a.common.contracts.gateway.CredentialType,h=a.common.contracts.gateway.DataSourceType,s=a.common.contracts.gateway.GatewayStatus,r=a.common.contracts.gateway.GatewayType,n=a.common.contracts.gateway.SingleSignOnType,o=a.common.models.TestConnectionState,(e=e.GatewayModelConverter||(e.GatewayModelConverter={})).convertSettingsGateways=function(e,t,a){return _.map(e,(function(e){return i(e,t,a)}))},e.convertGateway=i,e.convertSettingsClusters=function(e,t){return _.map(e,(function(e){return c(e,t)}))},e.convertClusters=c,e.convertDataSources=l,e.convertDataSource=t,e.convertToOAuthDatasourceModel=function(e,t,a,i){return{modelId:e.isAddingDataSource?-1:t.id,gatewayId:t.gateway.id,gatewayObjectId:t.gateway.objectId,datasourceId:e.isAddingDataSource?-1:t.id,name:a,oAuth2URL:i.OAuthEndpoint,oAuth2Nonce:i.OAuthNonce,datasourceType:h.Extension,credentialTypes:[w.OAuth2],credentialTypesNames:["OAuth2"],connectionStringGeneralProperties:null,alreadyExecutedTestConnection:!1,testConnectionState:o.Failed,testConnectionErrorMessage:null,onpremGatewayRequired:!0,isCloudDirectQuery:!1,packageId:null,contentProviderId:null,packageContentProviderId:null,fullName:a,displayName:a,useEGW:!0,singleSignOnType:n.None}},e.convertDataSourceAnnotation=d,e.convertUsers=function(e,t){return[{accessRight:t,principalList:e}]},e.convertToPrincipalAccessEntry=function(e,t){return[{accessRight:t,principalList:e}]},e.convertSupportedDataSourcesToDataSourceMetadataMap=function(e,t){var a={},i=u(e.builtInDataSourceTypes,t),t=null==(e=e.mashupExtensionsMetadata)?[]:(function(e,t){for(var a=[],i=0,n=e;i<n.length;i++){var r=n[i],o=r.moduleName,s=r.dataSourceKind,c=r.version,l=_.map(r.authenticationInfo,(function(e){e=e.credentialType;return{id:e,name:M(y.constants.AuthenticationMethodPrefix,w[e],t)}}));r.functions.length;var d=r.functions[0],u=d.documentation["Documentation.Name"],p=(function n(e){return _.reduce(e,(function(e,t){var a=t.parameterType.toLocaleLowerCase(),i="nullable ";switch("record"===(a=_.startsWith(a,i)?a.slice(i.length):a)&&(t.recordParameters=n(t.recordParameters),0<t.recordParameters.length&&e.push(t)),a){case"url":case"text":case"number":case"sharepointsiteurl":e.push(t)}return e}),[])})(d.parameters),g=(function a(e){return _.reduce(e,(function(e,t){return null!=t.recordParameters?e.push.apply(e,a(t.recordParameters)):t.allowedValues?e.push({name:t.name,displayName:t.fieldCaption||_.upperFirst(t.name),type:C(t.parameterType),options:S(t.allowedValues,t.enumNames,t.enumCaptions),isRequired:t.isRequired,isSelectableList:!0}):e.push({name:t.name,displayName:t.fieldCaption||_.upperFirst(t.name),type:C(t.parameterType),isRequired:t.isRequired}),e}),[])})(p),c={functionName:d.name,moduleName:o,moduleVersion:c};a.push({dataSourceKind:s,name:null===u?_.upperFirst(o):u,dataSourceType:h.Extension,labels:g,nestedParameters:p,credentialTypeOptions:l,mashupExtensionsFunctionDetails:c,extensionDataSourceKind:s,isEncryptedConnectionSupported:r.isEncryptedConnectionSupported,isDirectQuerySupported:d.publish.SupportsDirectQuery})}return a})(e,t);i.push.apply(i,t||[]);for(var n=0,r=_.sortBy(i,(function(e){return e.name}));n<r.length;n++){var o=r[n];a[o.dataSourceKind]=o}return a},e.convertBuiltInDatasourcesMetadata=u,e.convertGatewayDetailsAndStatusToDetails=function(e){return{gatewayId:e.gatewayId,gatewayObjectId:e.gatewayObjectId,gatewayName:e.gatewayName,gatewayDescription:e.gatewayDescription,gatewayPublicKey:e.gatewayPublicKey,gatewayStatus:e.gatewayStatusJson.gatewayStatus,gatewayAnnotation:e.gatewayAnnotation,gatewayType:e.gatewayType,allowableOptions:e.allowableOptions}},e.getDataSourceKind=function(e){return e.dataSourceType!==h.Extension?h[e.dataSourceType]:JSON.parse(e.connectionInfo.connectionDetails).extensionDataSourceKind},e.getGatewayAnnotation=function(e){return g(e.gatewayAnnotation)},e.getGatewayAnnotationFromClusterDetails=p,e.getGatewayAnnotationFromString=g,e.getLoadBalancingClusterSettingsFromClusterDetails=v,e.getLoadBalancingClusterSettingsFromString=m,e.isAllowCloudDatasourceRefreshThroughGateway=f,e.isAllowCustomConnectorsThroughGateway=b,e.getLocalizedString=M,e.getLabelType=C})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).models||(e.models={})).SelectGatewayModel=function(e,t,a,i){this.modelId=e,this.selectedGatewayObjectId=void 0,this.title=null,this.showStatus=!0,this.showHeader=t,this.showVNetWarning=!1,this.allowPersonalGateway=a,this.egwStatusLoaded=!1,this.isCloudScheduleRefresh=i,this.cachedDatasourceStatusResponse=[]}})(powerbi=powerbi||{}),(function(e){((e=(e=e.gateways||(e.gateways={})).utils||(e.utils={})).GatewaysUtils||(e.GatewaysUtils={})).getNameFromPrincipalEntry=function(e,t){return e.displayName&&0<e.displayName.length?e.displayName:e.givenName&&0<e.givenName.length?t.format("Capacity_User_DisplayName",[e.givenName,e.familyName||""]):e.emailAddress}})(powerbi=powerbi||{}),(function(t){var e,r,o,n,s;function c(e){for(var t=0,a=s;t<a.length;t++){var i=a[t];if(i.window===e)return i}return null}function l(e){var t=c(e);return null===t&&s.push(t={window:e,originRegex:void 0,origin:"",isSynced:!1,nextMessageId:0,pendingMessages:[],messageHandlers:{handlerById:{},handlersByType:{}}}),t}function d(e){for(e.isSynced=!0;e.pendingMessages.length;){var t=e.pendingMessages.pop();e.window.postMessage(t,e.origin)}}function u(a,i,n){var e=new t.Promise(function(e,t){a.messageHandlers.handlerById[i.id]=e,setTimeout((function(){delete a.messageHandlers.handlerById[i.id],t("No response received for '"+i.type+"' message in "+n+" ms")}),n)});return a.isSynced||i.type===r||i.type===o?a.window.postMessage(i,i.type===r?"*":a.origin):a.pendingMessages.push(i),e}function p(a){var i=c(a.source);if(i&&(a.origin===i.origin||i.originRegex&&null!==a.origin.match(i.originRegex))){i.origin=a.origin;var e={type:a.data.type,payload:a.data.payload,respond:function(e,t){void 0===t&&(t=5e3);e=__assign(__assign({},e),{id:a.data.id});return u(i,e,t)}},t=i.messageHandlers.handlerById[a.data.id];t&&(t(e),delete i.messageHandlers.handlerById[a.data.id]);var n=i.messageHandlers.handlersByType[a.data.type];if(n)for(var r in n)n[r](e)}}e=(e=t.gateways||(t.gateways={})).utils||(e.utils={}),r="SYN",n=!(o="ACK"),s=[],e.IFrameMessenger={sync:function(e,t){n||(n=!0,window.addEventListener("message",p,!1));var a,i=c(e);null!==i&&i.isSynced||(a=l(e),"string"==typeof t?a.origin=t:a.originRegex=t,this.addListener(e,r,(function(e){e.respond({type:o}).catch((function(){})),d(a)})),this.postMessage(e,{type:r}).then((function(e){e.type===o&&d(a)})).catch((function(){})))},postMessage:function(e,t,a){return void 0===a&&(a=5e3),u(l(e),__assign(__assign({},t),{id:jsCommon.Utility.generateGuid()}),a)},addListener:function(e,t,a){var i=l(e);i.messageHandlers.handlersByType[t]||(i.messageHandlers.handlersByType[t]={});e=jsCommon.Utility.generateGuid();return i.messageHandlers.handlersByType[t][e]=a,e},removeListener:function(e,t){var a=c(e);if(null!==a)for(var i in a.messageHandlers.handlersByType)if(a.messageHandlers.handlersByType[i][t]){delete a.messageHandlers.handlersByType[i][t],0===Object.keys(a.messageHandlers.handlersByType[i]).length&&delete a.messageHandlers.handlersByType[i];break}}}})(powerbi=powerbi||{}),(function(e){!(function(i){var e;function t(e,t){var a=this;this.scope=e,this.scope.onTabSelected=function(e){return a.onTabSelected(e)},this.scope.$on(i.constants.switchToUserTabEventName,(function(e){return a.switchToUserTabListener(e)}))}e=i.controllers||(i.controllers={}),t.prototype.switchToUserTabListener=function(e){e.stopPropagation(),this.onTabSelected(2)},t.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e.DataSourceController=t})(e.gateways||(e.gateways={}))})(powerbi=powerbi||{}),(function(o){!(function(i){var e,t,r;function a(e,t){var a=this;this.scope=e,this.services=t,this.dataSourceModel=e.dataSourceModel,this.viewModel=this.scope.viewModel=new i.models.DataSourceUserModel,this.scope.tryAddUsers=function(){return a.tryAddUsers()},this.scope.tryRemoveSelectedUsers=function(){return a.tryRemoveSelectedUsers()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.scope.mapUserNames=function(){return a.mapUserNames()},this.getDataSourceUsers(),this.setupUpnMappingButton(),this.startWatchDataSourceModel(),this.scope.dataSourceModel.isDirty=function(){return!1}}e=i.controllers||(i.controllers={}),t=o.common.contracts.gateway.DataSourceType,r=o.gateways.utils.GatewaysUtils,a.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService","taskPaneSliderService","telemetryService"]}},a.prototype.startWatchDataSourceModel=function(){var a=this;this.scope.$watch("dataSourceModel",(function(e,t){t!==e&&(a.dataSourceModel=a.scope.dataSourceModel,a.getDataSourceUsers(),a.setupUpnMappingButton())}))},a.prototype.setupUpnMappingButton=function(){this.scope.upnMappingEnabled=this.dataSourceModel&&this.dataSourceModel.dataSourceType===t.AnalysisServices},a.prototype.tryAddUsers=function(){var t=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),0<this.viewModel.pendingUsers.validEmailsList.length?this.services.gatewaysMetadataService.addDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId,i.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,1)).then((function(){t.viewModel.isAdding=!1,t.viewModel.pendingUsers.inputUserList=[],t.getDataSourceUsers()}),(function(e){t.viewModel.isAdding=!1,t.services.errorService.error(t.services.localizationService.get(o.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddDataSourceUser_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},a.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.uniq(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress||""})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},a.prototype.arrayStringsToLowerCase=function(e){return _.map(e,(function(e){return e.toLowerCase()}))},a.prototype.tryRemoveSelectedUsers=function(){var t=this,e=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),e=_.map(e,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId,i.models.GatewayModelConverter.convertToPrincipalAccessEntry(e,0)).then((function(){t.getDataSourceUsers()}),(function(e){t.viewModel.isReloadingList=!1,t.services.errorService.error(t.services.localizationService.get(o.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddDataSourceUser_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},a.prototype.getDataSourceUsers=function(){var n=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId).then((function(e){for(var a=[],t=0,i=e;t<i.length;t++)!(function(t){var e;1!==t.accessRight&&9!==t.accessRight||(e=_.map(t.principalList,(function(e){return{objectId:e.objectId,name:r.getNameFromPrincipalEntry(e,n.services.localizationService),emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1,accessRight:t.accessRight}})),a=a.concat(e))})(i[t]);n.viewModel.editableUsers=_.sortBy(a,(function(e){return e.name.toLowerCase()})),n.viewModel.isReloadingList=!1}),(function(e){var t=e.error&&e.error.code||"UnknownError";n.services.errorService.error(n.services.localizationService.get(o.ServiceErrorHelper.serverErrorPrefix+t),"GetDataSourceUsers_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()}),n.viewModel.isReloadingList=!1}))},a.prototype.shouldDisableRemoveButton=function(){return _.every(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},a.prototype.mapUserNames=function(){this.services.telemetryService.logEvent(o.telemetry.SettingsOpenGatewayDatasourceUPNMappingPane),this.services.taskPaneSliderService.expandPane(8,3)},e.DataSourceUsersController=a})(o.gateways||(o.gateways={}))})(powerbi=powerbi||{}),(function(n){!(function(i){var e,a;function t(e,t){var a=this;this.scope=e,this.services=t,this.gatewayModel=e.gatewayModel,this.viewModel=this.scope.viewModel=new i.models.DataSourceUserModel,this.scope.tryAddAdministrators=function(){return a.tryAddAdministrators()},this.scope.tryRemoveSelectedAdminstrators=function(){return a.tryRemoveSelectedAdministrators()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.getGatewayAdministrators(),this.startWatchGatewayModel()}e=i.controllers||(i.controllers={}),a=n.gateways.utils.GatewaysUtils,t.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService"]}},t.prototype.startWatchGatewayModel=function(){var a=this;this.scope.$watch("gatewayModel",(function(e,t){t!==e&&(a.gatewayModel=a.scope.gatewayModel,a.getGatewayAdministrators())}))},t.prototype.tryAddAdministrators=function(){var t=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),0<this.viewModel.pendingUsers.validEmailsList.length?this.services.gatewaysMetadataService.addGatewayPrincipals(this.gatewayModel.objectId,i.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,3)).then((function(){t.viewModel.isAdding=!1,t.viewModel.pendingUsers.inputUserList=[],t.getGatewayAdministrators()}),(function(e){t.viewModel.isAdding=!1,t.services.errorService.error(t.services.localizationService.get(n.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddGatewayAdmin_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},t.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_(this.viewModel.pendingUsers.validEmailsList).map((function(e){return e?e.toLowerCase():null})).uniq().value();var e=_(this.viewModel.editableUsers).map((function(e){return e.emailAddress})).map((function(e){return e?e.toLowerCase():null})).value();this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},t.prototype.tryRemoveSelectedAdministrators=function(){var t=this,e=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),e=_.map(e,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteGatewayPrincipals(this.gatewayModel.objectId,i.models.GatewayModelConverter.convertToPrincipalAccessEntry(e,0)).then((function(){t.getGatewayAdministrators()}),(function(e){t.viewModel.isReloadingList=!1,t.services.errorService.error(t.services.localizationService.get(n.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddGatewayAdmin_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.getGatewayAdministrators=function(){var t=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getGatewayPrincipals(this.gatewayModel.objectId).then((function(e){e=_.filter(e,(function(e){return 3&e.accessRight})),e=_.flatten(_.map(e,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(e,(function(e){return{objectId:e.objectId,name:a.getNameFromPrincipalEntry(e,t.services.localizationService),emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1,accessRight:3}})),t.viewModel.isReloadingList=!1}),(function(e){t.services.errorService.error(t.services.localizationService.get(n.ServiceErrorHelper.serverErrorPrefix+e.error.code),"GetGatewaysAdmins_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()}),t.viewModel.isReloadingList=!1}))},t.prototype.shouldDisableRemoveButton=function(){return _.every(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},e.GatewayAdministratorsController=t})(n.gateways||(n.gateways={}))})(powerbi=powerbi||{}),(function(e){!(function(e){function t(e,t){var a=this;this.scope=e,this.scope.onTabSelected=function(e){return a.onTabSelected(e)}}e=e.controllers||(e.controllers={}),t.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e.GatewayController=t})(e.gateways||(e.gateways={}))})(powerbi=powerbi||{}),(function(u){!(function(r){var e,n,i,o,l,s,d;function t(e,t){var a=this;this.scope=e,this.services=t,this.scope.onItemSelected=function(e,t){return a.onItemSelected(e,t)},this.scope.getSelectionType=function(){return a.getSelectionType()},this.scope.tryAddDataSource=function(){return a.tryAddDataSource(a.scope.viewModel.currentGateway)},this.scope.testConnections=function(){return a.testConnections()},this.scope.isLoading=!1,this.loadGatewayClusters(),this.scope.$on(r.constants.dataSourceCreatedEventName,(function(e,t){return a.updateCurrentDataSource(e,t[0])})),this.scope.$on(r.constants.discardAddingDataSourceEventName,(function(e){return a.discardAddingDataSource(e)})),this.scope.$on(r.constants.addDataSourceEventName,(function(){return a.tryAddDataSource(a.scope.viewModel.currentGateway)})),this.ensureGatewayDataServiceInitialized()}e=r.controllers||(r.controllers={}),n=u.common.constants,i=u.connectivity.models.DataSourceContextMenuItemModel,o=u.connectivity.models.GatewayContextMenuItemModel,l=u.connectivity.models.GatewayStatus,s=u.common.contracts.gateway.SingleSignOnType,d=window,t.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","lazy","gatewaysMetadataService","localizationService","navigation","promiseFactory","datasourceService","downgradedRouterUtilities"]}},t.prototype.updateCurrentDataSource=function(e,t){e.stopPropagation(),this.scope.viewModel.currentDataSourceObjectId=t,this.backNavigation?this.services.navigation.navigateToDatasetSettings(this.backNavigation.settingsGroup,this.backNavigation.settingsId):this.loadDataSourceContextMenu(this.scope.viewModel.currentDataSource)},t.prototype.discardAddingDataSource=function(e){e.stopPropagation(),this.scope.viewModel.currentGateway.dataSources.pop(),this.backNavigation?this.services.navigation.navigateToDatasetSettings(this.backNavigation.settingsGroup,this.backNavigation.settingsId):this.openItem(this.scope.viewModel.currentGatewayObjectId,null)},t.prototype.gatewayExists=function(t){var e=_.find(this.scope.viewModel.gateways,(function(e){return e.objectId===t}));return null!=e},t.prototype.dataSourceExists=function(e,t){e=_.find(e.dataSources,(function(e){return e.objectId===t}));return null!=e},t.prototype.getGatewaysRouteParams=function(){var e=this.services.downgradedRouterUtilities.getCurrentActivatedRouteSnapshotLeaf();return{gatewayObjectId:e.paramMap.get(r.services.gatewayObjectIdParamName),dataSourceObjectId:e.paramMap.get(r.services.dataSourceObjectIdParamName)}},t.prototype.tryInitializeGatewaySelection=function(){var e,t;0<this.scope.viewModel.gateways.length&&(e=(t=this.getGatewaysRouteParams()).dataSourceObjectId,null!==(t=t.gatewayObjectId)&&this.gatewayExists(t)?e||this.onItemSelected(t,null):(t=this.scope.viewModel.gateways[0].objectId,this.onItemSelected(t,null)))},t.prototype.tryInitializeDataSourceSelection=function(e){var t=this.getGatewaysRouteParams(),a=t.dataSourceObjectId,t=t.gatewayObjectId;e.objectId===t&&a&&(a===n.EmptyGuid?(this.onItemSelected(t,null),this.tryAddDataSource(e)):this.dataSourceExists(e,a)?this.onItemSelected(t,a):this.onItemSelected(t,null))},t.prototype.loadGatewaysState=function(){for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var a=t[e];this.loadGatewayContextMenu(a),null===this.scope.viewModel.gatewayClusters?this.loadGatewayStatus(a):this.loadClusterStatus(a),this.loadDataSources(a)}},t.prototype.loadGatewayContextMenu=function(e){var t=this,a=new o(e);a.actions=[],a.actions.push({text:this.services.localizationService.get("AddDataSourceText"),action:function(){t.tryAddDataSource(e)}}),a.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){t.tryDeleteGateway(e)}}),a.metadata=[],a.metadata.push({type:u.common.models.ContextMenuItemMetadataType.Status,status:u.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),e.contextMenuItem=a},t.prototype.tryDeleteGateway=function(e){var t=this,a=this.services.errorService.control(),i=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(i,function(){a.hideDialog(),t.deleteGateway(e)}),new InJs.ModalDialogAction(n,function(){a.hideDialog()})],o=this.services.localizationService.get("SettingsGateway_DeleteWarning_Title"),i=this.services.localizationService.get("SettingsGateway_DeleteWarning_Message");a.showCustomDialog(o,$("<div></div>").text(i),r,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0)},t.prototype.deleteGateway=function(t){var a=this;t&&this.services.gatewaysMetadataService.deleteGateway(t.objectId).then((function(){var e=a.scope.viewModel.gateways.indexOf(t);-1<e&&(a.scope.viewModel.gateways.splice(e,1),0<a.scope.viewModel.gateways.length?a.onItemSelected(a.scope.viewModel.gateways[0].objectId,null):a.onItemSelected(null,null))}),(function(e){a.services.errorService.error(a.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),"Gateways_Error_FailedToDelete",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.getCurrentGateway=function(){return this.scope.viewModel.currentGateway},t.prototype.getCurrentDataSource=function(){return this.scope.viewModel.currentDataSource},t.prototype.loadGatewayStatus=function(s){var c=this;s.isLoadingStatus=!0,this.services.gatewaysMetadataService.getGatewayStatus(s.objectId).then((function(e){s.status=l.Live,s.staticCapabilities=e.gatewayStaticCapabilities,s.isLoadingStatus=!1,s.gatewayVersion=e.gatewayVersion,s.gatewayUpgradeState=e.gatewayUpgradeState,s.contextMenuItem&&((e=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Success,e.value=c.services.localizationService.get("SettingsGateway_OnlineMessage"))}),(function(e){s.isLoadingStatus=!1,s.status=l.NotReachable;var t,a=u.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService);s.connectionError=c.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"));var i=[];if(a&&a.displayableErrorInfo)for(var n=0,r=a.displayableErrorInfo;n<r.length;n++){var o=r[n];i.push({key:o.errorInfoKey,value:o.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.loadClusterStatus=function(s){var c=this;s.isLoadingStatus=!0,this.services.gatewaysMetadataService.getGatewayClusterStatus(s.objectId).then((function(e){var t;s.isLoadingStatus=!1,s.staticCapabilities=e.data.gatewayStaticCapabilities,s.gatewayVersion=e.data.gatewayVersion,s.gatewayUpgradeState=e.data.gatewayUpgradeState,1===e.data.clusterStatus?(s.status=l.Live,s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Success,t.value=c.services.localizationService.get("SettingsGateway_OnlineMessage"))):(s.status=l.NotReachable,s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage")));var a=e.data.gatewayNameToErrorResponseDictionary;if(0<Object.keys(a).length){s.connectionError=s.status===l.Live?c.services.localizationService.get("ServerError_DMTS_NotAllGatewaySucceeded"):c.services.localizationService.get("ServerError_DMTS_NoneGatewaySucceeded");var i,n=[];for(i in a){var r=a[i],r=u.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(r.error,c.services.localizationService);r&&r.displayableErrorInfo&&r.message&&n.push({key:i,value:r.message})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:"",details:n,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion()}}}),(function(e){s.isLoadingStatus=!1,s.status=l.NotReachable;var t,a=u.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService);s.connectionError=c.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"));var i=[];if(a&&a.displayableErrorInfo)for(var n=0,r=a.displayableErrorInfo;n<r.length;n++){var o=r[n];i.push({key:o.errorInfoKey,value:o.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.loadDataSources=function(t){var a=this;t.isLoadingDataSources=!0,this.services.gatewaysMetadataService.getDataSources(t.objectId).then((function(e){t.dataSources=r.models.GatewayModelConverter.convertDataSources(e),t.isLoadingDataSources=!1,a.tryInitializeDataSourceSelection(t),a.loadDataSourcesState(t)}),(function(e){a.services.errorService.error(a.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),"SettingsDataSources_Error_FailedToLoad",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.loadDataSourcesState=function(t){for(var e=0,a=t.dataSources;e<a.length;e++){var i=a[e];i.gateway=t,(i.gatewayCluster=null)!==this.scope.viewModel.gatewayClusters&&(i.gatewayCluster=_.find(this.scope.viewModel.gatewayClusters,(function(e){return t.objectId===e.objectId}))),this.loadDataSourceContextMenu(i),this.loadDataSourceStatus(t,i)}},t.prototype.loadDataSourceContextMenu=function(e){var t=this,a=new i(e);a.actions=[],a.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){t.tryDeleteDataSource(e)}}),a.metadata=[],a.metadata.push({type:u.common.models.ContextMenuItemMetadataType.Status,status:u.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),e.contextMenuItem=a},t.prototype.tryDeleteDataSource=function(e){var t=this,a=this.services.errorService.control(),i=this.services.localizationService.get("SettingsDataSource_DeleteWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(i,function(){a.hideDialog(),t.deleteDataSource(e)}),new InJs.ModalDialogAction(n,function(){a.hideDialog()})],o=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Title"),i=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Message");a.showCustomDialog(o,$("<div></div>").text(i),r,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0)},t.prototype.deleteDataSource=function(t){var e,a=this,i=t.gateway;i&&t&&(t.objectId===n.EmptyGuid?-1<(e=i.dataSources.indexOf(t))&&(i.dataSources.splice(e,1),this.openItem(i.objectId,null)):this.services.gatewaysMetadataService.deleteDataSource(i.objectId,t.objectId).then((function(){var e=i.dataSources.indexOf(t);-1<e&&(i.dataSources.splice(e,1),a.onItemSelected(i.objectId,null))}),(function(e){a.services.errorService.error(a.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),"DataSources_Error_FailedToDelete",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})))},t.prototype.loadDataSourceStatus=function(e,s){var c=this;if(s.objectId!==n.EmptyGuid)return null!==s.gatewayCluster?this.loadClusterDataSourceStatus(e,s):void this.services.gatewaysMetadataService.getDataSourceStatus(e.objectId,s.objectId).then((function(){var e;s.connected=!0,s.connectionError=null,s.contextMenuItem&&((e=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Success,e.value=c.services.localizationService.get("SettingsGateway_OnlineMessage"))}),(function(e){s.connected=!1,s.gateway.isExpanded=!0;var t,a=u.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService);s.connectionError=c.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"));var i=[];if(a&&a.displayableErrorInfo)for(var n=0,r=a.displayableErrorInfo;n<r.length;n++){var o=r[n];i.push({key:o.errorInfoKey,value:o.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.loadClusterDataSourceStatus=function(e,s){var c=this;this.services.gatewaysMetadataService.getClusterDataSourceStatus(e.objectId,s.objectId).then((function(e){var t;if(s.connectionError=null,s.connected=1===e.data.status,s.contextMenuItem&&(t=s.contextMenuItem.metadata[0],s.connected?(t.status=u.common.models.ContextMenuItemMetadataStatus.Success,t.value=c.services.localizationService.get("SettingsGateway_OnlineMessage")):(t.status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"))),!_.isEmpty(e.data.errors)){s.connectionError=s.connected?c.services.localizationService.get("ServerError_DMTS_GetClusterDataSourceStatusError"):c.services.localizationService.get("ServerError_DMTS_GetClusterDataSourceStatusNotConnectedError"),s.gateway.isExpanded=!0;for(var a=[],i=0,n=e.data.errors;i<n.length;i++){var r=n[i],o=c.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+r.errorCode);a.push({key:r.gatewayName,value:o||r.errorMessage})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:"",details:a,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}}),(function(e){s.connected=!1,s.gateway.isExpanded=!0;var t,a=u.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService);s.connectionError=c.services.localizationService.get(u.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=u.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"));var i=[];if(a&&a.displayableErrorInfo)for(var n=0,r=a.displayableErrorInfo;n<r.length;n++){var o=r[n];i.push({key:o.errorInfoKey,value:o.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:d.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:u.getBuild(),clientVersion:u.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.generateUniqueDataSourceName=function(){if(!this.scope.viewModel.currentGateway)return null;for(var e=this.services.localizationService.get("NewDataSourceName"),t=e,a=0;;){if(!_.find(this.scope.viewModel.currentGateway.dataSources,(function(e){return e.displayName===t})))break;t=e+" "+ ++a}return t},t.prototype.tryAddDataSource=function(e){var t=this;this.backNavigation=this.services.datasourceService.getAndResetLastUpdatedDatasource(),this.scope.viewModel.currentDataSourceObjectId===n.EmptyGuid||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){t.addDataSource(e)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(r.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){t.addDataSource(e),t.scope.$apply()})):this.addDataSource(e))},t.prototype.addDataSource=function(t){var e={objectId:n.EmptyGuid,displayName:this.generateUniqueDataSourceName(),dataSourceType:void 0,gateway:t,connectionInfo:{},users:null,tabSelectionType:1,gatewayCluster:null,singleSignOnType:s.None},a=this.services.datasourceService.getAndResetConnectionInfo(),i=this.services.datasourceService.getAndResetDataSourceType();a&&null!=i&&(e.connectionInfo=a,e.dataSourceType=i),null!==this.scope.viewModel.gatewayClusters&&(e.gatewayCluster=_.find(this.scope.viewModel.gatewayClusters,(function(e){return t.objectId===e.objectId}))),t.dataSources.push(e),this.loadDataSourceContextMenu(e),this.openItem(t.objectId,e.objectId)},t.prototype.onItemSelected=function(e,t){var a=this;e===this.scope.viewModel.currentGatewayObjectId&&t===this.scope.viewModel.currentDataSourceObjectId||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){a.scope.viewModel.currentDataSourceObjectId===n.EmptyGuid&&a.scope.viewModel.currentGateway.dataSources.pop(),a.openItem(e,t)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(r.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){a.openItem(e,t),a.scope.$apply()})):(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSourceObjectId===n.EmptyGuid&&this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(e,t)))},t.prototype.openItem=function(i,n){return __awaiter(this,void 0,u.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return(t=this.scope.viewModel).currentGatewayObjectId=i,t.currentDataSourceObjectId=n,t.currentGateway=this.getCurrentGatewayModel(),t.currentDataSource=this.getCurrentDataSourceModel(),[4,this.ensureGatewayDataServiceInitialized()];case 1:return e.sent(),this.scope.gatewayDataService.setSelectedGatewayDataSource(this.getCurrentDataSourceModel()),n?this.scope.viewModel.currentGateway.isExpanded=!0:requestAnimationFrame((function(){return a.scope.$broadcast(r.constants.onGatewaySelectionChanged)})),this.services.navigation&&this.services.navigation.navigateToGatewayItem(i,n),[2]}}))}))},t.prototype.ensureGatewayDataServiceInitialized=function(){return __awaiter(this,void 0,u.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.scope.gatewayDataService?[3,2]:(t=this.scope,[4,this.services.lazy("gatewayDataService")]);case 1:t.gatewayDataService=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.getSelectionType=function(){return this.scope.viewModel.currentGatewayObjectId?this.scope.viewModel.currentDataSourceObjectId?u.connectivity.models.GatewaysSelectionType.DataSource:u.connectivity.models.GatewaysSelectionType.Gateway:u.connectivity.models.GatewaysSelectionType.None},t.prototype.getCurrentGatewayModel=function(){var t=this;return _.find(this.scope.viewModel.gateways,(function(e){return e.objectId===t.scope.viewModel.currentGatewayObjectId}))},t.prototype.getCurrentDataSourceModel=function(){var t=this.scope.viewModel.currentDataSourceObjectId;if(t){var e=this.getCurrentGatewayModel();if(e)return _.find(e.dataSources,(function(e){return e.objectId===t}))}return null},t.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),n=[new InJs.ModalDialogAction(a,function(){t.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(i,function(){t.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return t.showCustomDialog(r,$("<div></div>").text(a),n,(function(e){e.parent().find('input[value="'+i+'"]').focus()}),!0,!0),e.promise},t.prototype.testConnections=function(){if(this.scope.viewModel.gateways)for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var a=t[e];if(null===this.scope.viewModel.gatewayClusters?this.loadGatewayStatus(a):this.loadClusterStatus(a),a.dataSources)for(var i=0,n=a.dataSources;i<n.length;i++){var r=n[i];this.loadDataSourceStatus(a,r)}}},t.prototype.loadGatewayClusters=function(){var t=this;this.scope.isLoading=!0,this.services.gatewaysMetadataService.getGatewayClusters().then((function(e){e=r.models.GatewayModelConverter.convertSettingsClusters(e,t.services.localizationService);t.scope.viewModel={gateways:e,currentGatewayObjectId:n.EmptyGuid,currentDataSourceObjectId:n.EmptyGuid,currentGateway:null,currentDataSource:null,gatewayClusters:e},t.scope.isLoading=!1,t.tryInitializeGatewaySelection(),t.loadGatewaysState()}),(function(){t.scope.isLoading=!1,t.services.errorService.error(t.services.localizationService.get("SettingsGateways_Error_FailedToLoad"),"SettingsGateways_Error_FailedToLoad")}))},e.GatewaysController=t})(u.gateways||(u.gateways={}))})(powerbi=powerbi||{}),(function(a){!(function(r){var e,o;function t(e,t){var i=this;this.scope=e,this.services=t,this.scope.updateDirtyFlag=function(){return i.updateDirtyFlag()},this.scope.applyChanges=function(){return i.applyChanges()},this.scope.discardChanges=function(){return i.discardChanges()},this.scope.addDataSource=function(){return i.addDataSource()},this.scope.hasSupportedCustomConnectorsStaticCapabilities=function(){return i.hasSupportedCustomConnectorsStaticCapabilities()},this.scope.isCustomConnectorsDisabled=function(e){return i.isCustomConnectorsDisabled(e)},this.scope.isEnterpriseGatewayType=function(){return void 0===i.scope.viewModel.gatewayType||i.scope.viewModel.gatewayType===o.Resource};var a=this.scope.$on(r.constants.onDirtyGatewaySelectionChanging,(function(e,t,a){return i.discardOrCancel(t,a)})),n=this.scope.$on(r.constants.onGatewaySelectionChanged,(function(){return i.initializeGateway()}));this.initializeGateway(),this.scope.$on("$destroy",(function(){a(),n()}))}e=r.controllers||(r.controllers={}),o=a.common.contracts.gateway.GatewayType,t.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","gatewaysMetadataService","telemetryService"]}},t.prototype.initializeGateway=function(){var e=this.scope.viewModel;e.contactInformationString=this.getContactInformationString(e.gatewayAnnotation.gatewayContactInformation),this.initializeOriginalValues()},t.prototype.updateDirtyFlag=function(){var e=this.scope.viewModel,t=e.allowCloudDatasourceRefreshThroughGateway!==e.originalValues.allowCloudDatasourceRefreshThroughGateway||e.allowCustomConnectorsThroughGateway!==e.originalValues.allowCustomConnectorsThroughGateway;e.isDirty=e.displayName!==e.originalValues.name||e.description!==e.originalValues.description||e.gatewayAnnotation.gatewayDepartment!==e.originalValues.department||e.contactInformationString!==e.originalValues.contactInformationString||e.isBasicLoadBalancingEnabled!==e.originalValues.isBasicLoadBalancingEnabled||t,t&&this.updateAllowableOptions()},t.prototype.discardOrCancel=function(e,t){var a=this,i=this.services.errorService.control(),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),o=[new InJs.ModalDialogAction(n,function(){a.restoreOriginalValues(),a.scope.$apply(),i.hideDialog(),t&&t()}),new InJs.ModalDialogAction(r,function(){i.hideDialog()})],n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),e=this.services.localizationService.get(e);i.showCustomDialog(n,$("<div></div>").text(e),o,(function(e){e.parent().find('input[value="'+r+'"]').focus()}),!0,!0)},t.prototype.restoreOriginalValues=function(){var e=this.scope.viewModel;e.displayName=e.originalValues.name,e.description=e.originalValues.description,e.gatewayAnnotation.gatewayDepartment=e.originalValues.department,e.contactInformationString=e.originalValues.contactInformationString,e.allowCloudDatasourceRefreshThroughGateway=e.originalValues.allowCloudDatasourceRefreshThroughGateway,e.allowCustomConnectorsThroughGateway=e.originalValues.allowCustomConnectorsThroughGateway,e.allowableOptions=e.originalValues.allowableOptions,e.isBasicLoadBalancingEnabled=e.originalValues.isBasicLoadBalancingEnabled,e.isDirty=!1},t.prototype.initializeOriginalValues=function(){var e=this.scope.viewModel;e.originalValues={name:e.displayName,description:e.description,department:e.gatewayAnnotation.gatewayDepartment,contactInformationString:e.contactInformationString,allowCloudDatasourceRefreshThroughGateway:e.allowCloudDatasourceRefreshThroughGateway,allowCustomConnectorsThroughGateway:e.allowCustomConnectorsThroughGateway,isBasicLoadBalancingEnabled:e.isBasicLoadBalancingEnabled,allowableOptions:e.allowableOptions},e.isDirty=!1},t.prototype.getContactInformationString=function(e){var t="";return t=e?e.join(";"):t},t.prototype.parseContactInformation=function(e){return e.split(";")},t.prototype.applyChanges=function(){var t=this;this.scope.viewModel.gatewayAnnotation.gatewayContactInformation=this.parseContactInformation(this.scope.viewModel.contactInformationString),this.scope.viewModel.isWaitingForGatewayUpdate=!0,this.scope.viewModel.allowableOptions=this.updateAllowableOptions();var e,a={name:this.scope.viewModel.displayName,description:this.scope.viewModel.description,annotation:JSON.stringify(this.scope.viewModel.gatewayAnnotation),allowableOptions:this.scope.viewModel.allowableOptions};this.scope.viewModel.isBasicLoadBalancingEnabled!==this.scope.viewModel.originalValues.isBasicLoadBalancingEnabled&&(e=!0===this.scope.viewModel.isBasicLoadBalancingEnabled?1:0,this.scope.viewModel.loadBalancingClusterSettings=__assign(__assign({},this.scope.viewModel.loadBalancingClusterSettings),{selector:e}),a.loadBalancingSettings=JSON.stringify(this.scope.viewModel.loadBalancingClusterSettings)),this.services.gatewaysMetadataService.updateGatewayCluster(this.scope.viewModel.objectId,a).then((function(){t.successCallback()}),(function(e){t.errorCallback(e)}))},t.prototype.discardChanges=function(){this.discardOrCancel("SettingsGateway_DiscardChangesWarning_GatewaySettingsMessage",null)},t.prototype.addDataSource=function(){this.scope.$emit(r.constants.addDataSourceEventName)},t.prototype.successCallback=function(){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.initializeOriginalValues()},t.prototype.errorCallback=function(e){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.services.errorService.error(this.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"UpdateGateway_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})},t.prototype.updateAllowableOptions=function(){var e=this.scope.viewModel,t=this.scope.viewModel.originalValues.allowableOptions;return e.allowCloudDatasourceRefreshThroughGateway?t|=1:t&=-2,e.allowCustomConnectorsThroughGateway?t|=2:t&=-3,t},t.prototype.hasSupportedCustomConnectorsStaticCapabilities=function(){return 128==(128&this.scope.viewModel.staticCapabilities)},t.prototype.isCustomConnectorsDisabled=function(e){return!1===e&&!this.hasSupportedCustomConnectorsStaticCapabilities()&&this.scope.viewModel.allowCustomConnectorsThroughGateway===this.scope.viewModel.originalValues.allowCustomConnectorsThroughGateway},e.GatewaySettingsController=t})(a.gateways||(a.gateways={}))})(powerbi=powerbi||{}),(function(s){!(function(e){var o,t,a;function i(e,t){this.scope=e,this.services=t,this.scope.createDatasourceParameters=this.services.gatewayRedirectService.getAndResetCreateDatasourceParameters(),this.scope.openGatewaySettingsParameters=this.services.gatewayRedirectService.getAndResetOpenGatewaySettingsParameters(),this.scope.createConnectionParameters=this.services.gatewayRedirectService.getCreateConnectionParameters(),this.scope.editConnectionParameters=this.services.gatewayRedirectService.getEditConnectionParameters(),this.scope.gatewayAdminPortalUrl=this.getGatewayAdminPortalUrl(),this.scope.gatewayAdminPortalTitle=this.services.localizationService.get("GatewayAdminPortal_PageTitle");t=document.getElementById("gatewayAdminPortalFrame");t&&this.scope.gatewayAdminPortalUrl!==a&&(this.scope.iFrameWindow=t.contentWindow,this.initIFrameMessenger())}e=e.controllers||(e.controllers={}),o=window,t=s.gateways.utils.IFrameMessenger,a="about:blank",i.createOptions=function(){return{additionalServices:["navigation","localizationService","telemetryService","gatewayRedirectService","gatewayMsalService"]}},i.prototype.getGatewayAdminPortalUrl=function(){return o.gatewayAdminPortalUrl?o.gatewayAdminPortalUrl+"/#/?host="+this.getHost()+this.getAdditionalQueryParameters():a},i.prototype.getHost=function(){return o.isTrident?"trident":"pbi"},i.prototype.getAdditionalQueryParameters=function(){var e="&redirect=";return this.scope.createDatasourceParameters?e+"createDataSource":this.scope.openGatewaySettingsParameters?e+"openGatewaySettings":this.scope.createConnectionParameters?e+"createConnection":this.scope.editConnectionParameters?e+"editConnection":""},i.prototype.initIFrameMessenger=function(){t.sync(this.scope.iFrameWindow,o.gatewayAdminPortalUrl),t.addListener(this.scope.iFrameWindow,"requestAuth",this.requestAuthHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"addDataSource",this.createDatasourceEndHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"createDataSourceStart",this.createDatasourceStartHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"createDataSourceEnd",this.createDatasourceEndHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"openGatewaySettings",this.openGatewaySettingsHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"createConnectionStart",this.createConnectionStartHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"createConnectionEnd",this.createConnectionEndHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"editConnectionStart",this.editConnectionStartHandler.bind(this)),t.addListener(this.scope.iFrameWindow,"editConnectionEnd",this.editConnectionEndHandler.bind(this))},i.prototype.requestAuthHandler=function(r){return __awaiter(this,void 0,s.Promise,(function(){var t,a,i,n;return __generator(this,(function(e){switch(e.label){case 0:return(e.trys.push([0,4,,5]),t=r.payload.resource,a=r.payload.scopes,a=a&&0<a.length?a:[".default"],t!==o.pbiResourceUrl)?[3,1]:(i=o.powerBIAccessToken,[3,3]);case 1:return[4,this.services.gatewayMsalService.acquireAccessToken(t,a)];case 2:i=e.sent().token,e.label=3;case 3:return n=i,r.respond({type:"Bearer token",payload:n}).catch((function(){})),[3,5];case 4:return n=e.sent(),this.services.telemetryService.logEvent(s.telemetry.GatewaysGetTokenError,{stack:n.stack,message:n.message}),[2];case 5:return[2]}}))}))},i.prototype.createDatasourceStartHandler=function(a){return __awaiter(this,void 0,s.Promise,(function(){var t;return __generator(this,(function(e){return t={gatewayObjectId:this.scope.createDatasourceParameters.gatewayObjectId,dataSourceType:this.scope.createDatasourceParameters.dataSourceType,connectionDetails:this.scope.createDatasourceParameters.connectionDetails},a.respond({type:"createDataSourceData",payload:t}).catch((function(){})),[2]}))}))},i.prototype.createDatasourceEndHandler=function(t){return __awaiter(this,void 0,s.Promise,(function(){return __generator(this,(function(e){return t.respond({type:"ACK"}).catch((function(){})),this.scope.createDatasourceParameters&&this.services.navigation.navigateToDatasetSettings(this.scope.createDatasourceParameters.settingsGroupType,this.scope.createDatasourceParameters.settingsId),[2]}))}))},i.prototype.openGatewaySettingsHandler=function(a){return __awaiter(this,void 0,s.Promise,(function(){var t;return __generator(this,(function(e){return t={gatewayType:this.scope.openGatewaySettingsParameters.gatewayType,gatewayObjectId:this.scope.openGatewaySettingsParameters.gatewayObjectId},a.respond({type:"openGatewaySettingsData",payload:t}).catch((function(){})),[2]}))}))},i.prototype.createConnectionStartHandler=function(a){return __awaiter(this,void 0,s.Promise,(function(){var t;return __generator(this,(function(e){return t={connectionTypes:this.scope.createConnectionParameters.connectionTypes},a.respond({type:"createConnectionData",payload:t}).catch((function(){})),[2]}))}))},i.prototype.createConnectionEndHandler=function(t){return __awaiter(this,void 0,s.Promise,(function(){return __generator(this,(function(e){return t.respond({type:"ACK"}).catch((function(){})),window.open("","_self","").close(),[2]}))}))},i.prototype.editConnectionStartHandler=function(a){return __awaiter(this,void 0,s.Promise,(function(){var t;return __generator(this,(function(e){return t={connectionId:this.scope.editConnectionParameters.connectionId},a.respond({type:"editConnectionData",payload:t}).catch((function(){})),[2]}))}))},i.prototype.editConnectionEndHandler=function(t){return __awaiter(this,void 0,s.Promise,(function(){return __generator(this,(function(e){return t.respond({type:"ACK"}).catch((function(){})),window.open("","_self","").close(),[2]}))}))},e.ManageGatewaysController=i})(s.gateways||(s.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).Datasource=function(){this.restrict="E",this.templateUrl="views/datasourceView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DataSourceController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).DatasourceUsers=function(){this.restrict="E",this.templateUrl="views/datasourceUsersView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceUsersController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).Gateway=function(){this.restrict="E",this.templateUrl="views/gatewayView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewayController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).GatewayAdministrators=function(){this.restrict="E",this.templateUrl="views/gatewayAdministratorsView.html",this.replace=!0,this.scope={gatewayModel:"= gatewayModel"},this.controller=e.common.createController(t.controllers.GatewayAdministratorsController)}})(powerbi=powerbi||{}),(function(t){var a;((a=t.gateways||(t.gateways={})).directives||(a.directives={})).Gateways=function(e){this.featureSwitchService=e,this.restrict="E",this.templateUrl=this.featureSwitchService.featureSwitches.newManageGatewaysUI?"views/manageGatewaysView.html":"views/gatewaysView.html",this.replace=!0,this.controller=t.common.createController(this.featureSwitchService.featureSwitches.newManageGatewaysUI?a.controllers.ManageGatewaysController:a.controllers.GatewaysController)}})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).directives||(e.directives={})).IgnoreDirty=function(){this.restrict="A",this.require="ngModel",this.link=function(e,t,a,i){i.$setPristine=function(){},i.$pristine=!1}}})(powerbi=powerbi||{}),(function(w){!(function(l){var e,t,d,o,n,r,u,p,g,a,c;function y(e,t){this.scope=e,this.services=t,this.viewModel=new l.models.DataSourceSettingsModel,this.viewModel.isLoadingForm=!0,this.viewModel.advancedSettingsExpanded=!1,this.enterpriseGatewayETLEnabled=this.services.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled,this.kerberosSSOForDQAndRefreshEnabled=this.services.featureSwitchService.featureSwitches.kerberosDqRefresh,this.scope.authDialogParameters=new w.common.models.AuthDialogModel}e=l.controllers||(l.controllers={}),t=jsCommon.BrowserUtils,d=w.common.constants,o=w.common.contracts.gateway.CredentialType,n=w.common.contracts.gateway.DataSourceType,r=w.common.EncryptionContext,u=l.models.GatewayModelConverter,p=w.common.contracts.gateway.PrivacyLevel,g=w.common.contracts.gateway.SingleSignOnType,a=w.common.contracts.gateway.GatewayType,c=window,y.createOptions=function(){return{additionalServices:["credentialParameterService","errorService","featureSwitchService","gatewaysMetadataService","lazy","localizationService","promiseFactory"]}},y.prototype.$onInit=function(){var a=this;this.initEntropy(),this.initializePlaceholder(),this.startWatchFormControl(),this.scope.$on(w.common.constants.datasetShowAuthDialog,(function(e,t){return a.showAuthDialog(t)}))},y.prototype.$onChanges=function(){var e=this;this.initViewModelOptions().then((function(){e.loadViewModelData(),e.datasourceModel.isDirty=function(){return e.scope.settingsForm.$dirty}}))},y.prototype.initEntropy=function(){var n=this;this.services.gatewaysMetadataService.getEntropy().then((function(e){if(n.entropy=[],e)for(var t=atob(e),a=t.length,i=0;i<a;i++)n.entropy.push(t.charCodeAt(i));else n.entropy=r.generateEntropy()}),(function(){}))},y.prototype.initializePlaceholder=function(){y.Placeholder||(t.isChrome()?y.Placeholder="••••••••••••":y.Placeholder="●●●●●●●●●●●●")},y.prototype.initViewModelOptions=function(){var t=this,e=this.services.promiseFactory.defer();return this.services.gatewaysMetadataService.supportedDataSources(this.datasourceModel.gateway.objectId,this.services.localizationService.currentLanguageLocale).then((function(e){t.viewModel.dataSourceMetadataMap=u.convertSupportedDataSourcesToDataSourceMetadataMap(e,t.services.localizationService)}),(function(){})).finally((function(){e.resolve(null)})),e.promise},y.prototype.getPrepopulateDatasourceDefaultAuthType=function(e){if(void 0!==e&&void 0!==this.viewModel.dataSourceMetadataMap[e]){e=this.viewModel.dataSourceMetadataMap[e].credentialTypeOptions;if(!_.isEmpty(e))return e[0].id}},y.prototype.loadViewModelData=function(){var e=this.datasourceModel,t=this.viewModel,a=t.isAddingDataSource=e.objectId===d.EmptyGuid,i=u.getDataSourceKind(e),n=a?this.getPrepopulateDatasourceDefaultAuthType(i):e.connectionInfo.credentialDetails.credentialType,r=this.services.credentialParameterService.create(i,n);if(this.scope.authDialogParameters.credentialData=void 0,t.singleSignOnType=e.singleSignOnType,this.isSingleSignOnKerberosEnabled=t.singleSignOnType===g.Kerberos,this.isSingleSignOnSAMLEnabled=t.singleSignOnType===g.SAML,this.isSingleSignOnKerberosForDQAndRefreshEnabled=t.singleSignOnType===g.KerberosDQAndRefresh,this.isSingleSignOnAADEnabled=t.singleSignOnType===g.AzureActiveDirectory,!a)for(var o=0,s=r;o<s.length;o++){var c=s[o];"select"===c.type?c.value=null:c.value=y.Placeholder,this.isSingleSignOnKerberosForDQAndRefreshEnabled&&("username"!==c.name&&"password"!==c.name||(c.disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",c.required="!ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",c.value=null))}var l=this.createDataSourceConnectionParameters(i,a);t.editableSettings={dataSourceKind:i,dataSourceName:e.displayName,dataSourceType:e.dataSourceType,requiredDataSourceConnectionParameters:l.filter((function(e){return!0===e.isRequired})),optionalDataSourceConnectionParameters:l.filter((function(e){return!1===e.isRequired})),encryptedConnection:this.getEncryptedConnection(a,i),encryptedConnectionEdited:!1,credentialType:n,credentialTypeEdited:!1,credentialParameters:r,privacyLevel:a?p.Organizational:e.connectionInfo.credentialDetails.privacyLevel,singleSignOnType:e.singleSignOnType,privacyLevelEdited:!1,skipTestConnection:!a&&e.connectionInfo.credentialDetails.skipTestConnection},t.waitingForDataSourceStatus=!1,t.hasTestConnectionFailure=!1,t.isLoadingForm=!1,t.messageState=0,e.compositeErrorMessage="",this.scope.settingsForm&&(a?this.scope.settingsForm.$setDirty():this.scope.settingsForm.$setPristine()),this.isSkipTestConnectionSelected=t.editableSettings.skipTestConnection,this.privacyLevelString=this.viewModel.editableSettings.privacyLevel&&this.viewModel.editableSettings.privacyLevel.toString(),this.encryptedConnectionString=null!=this.viewModel.editableSettings.encryptedConnection&&this.viewModel.editableSettings.encryptedConnection.toString(),this.isAutoDetectEncryptedConnectionVisible=!a&&(this.showEncryptedConnection()&&1===this.datasourceModel.connectionInfo.credentialDetails.encryptedConnection),this.isAutoDetectEncryptedConnectionEnabled=this.isAutoDetectEncryptedConnectionVisible,this.isNonImportSSOCheckboxDisabled=!this.viewModel.isAddingDataSource&&this.isSingleSignOnKerberosForDQAndRefreshEnabled},y.prototype.startWatchFormControl=function(){var t=this,a=this.scope.$watch("settingsForm",(function(e){e&&(t.datasourceModel.isDirty=function(){return e.$dirty},t.viewModel.isAddingDataSource&&t.scope.settingsForm.$setDirty(),a())}))},y.prototype.tryApplyChanges=function(e){var t,a,i,n,r=this;this.isFormValid(e)&&(a=(t=this.datasourceModel).gateway,i=this.viewModel.editableSettings.dataSourceName!==t.displayName,n=this.viewModel.singleSignOnType!==t.singleSignOnType&&this.allowSingleSignOn(),(i||n)&&(e={dataSourceName:i?this.viewModel.editableSettings.dataSourceName:null,dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:null,supportedAuthenticationTypes:null,singleSignOnType:n?this.viewModel.singleSignOnType:null},this.services.gatewaysMetadataService.updateDataSource(a.objectId,t.objectId,e).then((function(){i&&(r.datasourceModel.displayName=r.viewModel.editableSettings.dataSourceName),n&&(r.datasourceModel.singleSignOnType=r.viewModel.singleSignOnType),r.isEditableSettingsChanged()||r.loadViewModelData()}),(function(e){r.showDataSourceError(e)}))),this.isEditableSettingsChanged()&&(null===this.datasourceModel.gatewayCluster?this.updateCredentials():this.updateClusterCredentials()))},y.prototype.tryAddDataSource=function(e){this.isFormValid(e)&&(null===this.datasourceModel.gatewayCluster?this.addDataSourceToGateway():this.addDataSourceToCluster())},y.prototype.tryDiscardChanges=function(){var e=this;this.showDiscardPopup().then((function(){e.viewModel.isAddingDataSource?e.scope.$emit(l.constants.discardAddingDataSourceEventName):e.loadViewModelData()}))},y.prototype.onDataSourceTypeChange=function(){var e=this.viewModel.editableSettings,t=this.getDefaultCredentialType(),a=e.dataSourceKind,i=this.viewModel.dataSourceMetadataMap[a];e.dataSourceType=i.dataSourceType,e.credentialType=t,this.scope.authDialogParameters.credentialData=void 0,this.skipTestConnectionOldValue=!1,this.isSkipTestConnectionSelected=!1,this.UncheckCurrentSingleSignOnOption(),e.credentialParameters=this.services.credentialParameterService.create(a,t);for(var n=0,r=e.credentialParameters;n<r.length;n++)r[n].edited=!1;e.encryptedConnection=this.getEncryptedConnection(this.viewModel.isAddingDataSource,a),this.encryptedConnectionString=null!=e.encryptedConnection&&e.encryptedConnection.toString();i=this.createDataSourceConnectionParameters(i.dataSourceKind,!0);e.requiredDataSourceConnectionParameters=i.filter((function(e){return!0===e.isRequired})),e.optionalDataSourceConnectionParameters=i.filter((function(e){return!1===e.isRequired}))},y.prototype.onPrivacyLevelChange=function(){var e=parseInt(this.privacyLevelString,10);_.isNumber(e),this.viewModel.editableSettings.privacyLevel=e,this.viewModel.editableSettings.privacyLevelEdited=!0},y.prototype.onEncryptedConnectionChange=function(){var e=parseInt(this.encryptedConnectionString,10);_.isNumber(e),this.viewModel.editableSettings.encryptedConnection=e,this.viewModel.editableSettings.encryptedConnectionEdited=!0},y.prototype.onAutoDetectEncryptedConnectionChange=function(){this.isAutoDetectEncryptedConnectionEnabled?this.encryptedConnectionString=1..toString():this.encryptedConnectionString=0..toString(),this.onEncryptedConnectionChange()},y.prototype.onSkipTestConnectionChange=function(){this.viewModel.editableSettings.skipTestConnection=this.isSkipTestConnectionSelected},y.prototype.UncheckCurrentSingleSignOnOption=function(){switch(this.viewModel.singleSignOnType){case g.KerberosDQAndRefresh:this.isSkipTestConnectionSelected=this.skipTestConnectionOldValue,this.isSingleSignOnKerberosForDQAndRefreshEnabled=!1;break;case g.Kerberos:this.isSingleSignOnKerberosEnabled=!1;break;case g.SAML:this.isSingleSignOnSAMLEnabled=!1;break;case g.AzureActiveDirectory:this.isSingleSignOnAADEnabled=!1}this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnKerberosChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnKerberosEnabled?this.viewModel.singleSignOnType=g.Kerberos:this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnKerberosForDQAndRefreshChange=function(){if(this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnKerberosForDQAndRefreshEnabled){this.skipTestConnectionOldValue=this.isSkipTestConnectionSelected,this.isSkipTestConnectionSelected=!0,this.viewModel.editableSettings.skipTestConnection=!0,this.viewModel.singleSignOnType=g.KerberosDQAndRefresh,this.viewModel.editableSettings.credentialType!==o.Windows&&(this.viewModel.editableSettings.credentialType=o.Windows,this.onCredentialMethodChange());for(var e=0,t=this.viewModel.editableSettings.credentialParameters;e<t.length;e++){var a=t[e];"username"!==a.name&&"password"!==a.name||(a.value=null)}}else this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnSAMLChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnSAMLEnabled?this.viewModel.singleSignOnType=g.SAML:this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnAADChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnAADEnabled?this.viewModel.singleSignOnType=g.AzureActiveDirectory:this.viewModel.singleSignOnType=g.None},y.prototype.onCredentialMethodChange=function(){var e=this.viewModel.editableSettings,t=e.credentialType,a=e.dataSourceKind;e.credentialType=t,e.credentialTypeEdited=!0,e.credentialParameters=this.services.credentialParameterService.create(a,t);for(var i=0,n=e.credentialParameters;i<n.length;i++){var r=n[i];r.edited=!0,this.showKerberosSSOForDQAndRefresh&&this.allowSingleSignOn&&("username"!==r.name&&"password"!==r.name||(r.disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",r.required="!ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled"))}},y.prototype.onCredentialParameterChange=function(e){for(var t=this.viewModel.editableSettings.credentialParameters,a=0;a<t.length;a++){var i=t[a];a===e?i.edited=!0:i.edited||(void 0!==i.defaultValue?i.value=i.defaultValue:i.value="",i.edited=!0)}},y.prototype.onCredentialParameterFocus=function(e){e=this.viewModel.editableSettings.credentialParameters[e];this.viewModel.isAddingDataSource||e.edited||(e.value="")},y.prototype.onCredentialParameterBlur=function(e){e=this.viewModel.editableSettings.credentialParameters[e];this.viewModel.isAddingDataSource||e.edited||(e.value=y.Placeholder)},y.prototype.switchToUserTab=function(){this.scope.$emit(l.constants.switchToUserTabEventName)},y.prototype.showSAPBWSncLibWarningMessage=function(){var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];if(e&&(e.dataSourceType===n.SAPBW||e.dataSourceType===n.SAPBWMessageServer))for(var t=0,a=this.viewModel.editableSettings.credentialParameters;t<a.length;t++){var i=a[t];if("SNCLibrarySelect"===i.name&&"default"===i.value)return!0}return!1},y.prototype.isOnPremSingleSignOnSupportedForDataSourceType=function(e,t){switch(e){case n.SqlServer:case n.Oracle:case n.SAP:case n.SAPBW:case n.SAPBWMessageServer:case n.Teradata:return!0;case n.Extension:switch(t){case"Impala":case"Spark":case"DenodoForPowerBI":case"ApacheHive":case"TibcoTdv":return!0;default:return!1}default:return!1}},y.prototype.isUpdateDataSourceDisabled=function(){return this.viewModel.waitingForDataSourceStatus||!(this.scope.settingsForm.$dirty||this.viewModel.editableSettings.credentialType===o.OAuth2&&void 0!==this.scope.authDialogParameters.credentialData)},y.prototype.isAddDataSourceDisabled=function(){return this.viewModel.waitingForDataSourceStatus||this.viewModel.editableSettings.credentialType===o.OAuth2&&void 0===this.scope.authDialogParameters.credentialData},y.prototype.showEncryptedConnection=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];return!(!e||!e.isEncryptedConnectionSupported)},y.prototype.hasOptionalParameters=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];return!!_.find(e.labels,(function(e){return!e.isRequired}))},y.prototype.disableEncryptedConnection=function(){return this.viewModel.waitingForDataSourceStatus||this.isAutoDetectEncryptedConnectionEnabled},y.prototype.allowSingleSignOn=function(){return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)&&(this.isSingleSignOnAADSupported()||this.allowOnPremSingleSignOn())},y.prototype.allowOnPremSingleSignOn=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];return(this.datasourceModel.gateway.gatewayType||a.Resource)===a.Resource&&null!=this.datasourceModel.gateway.staticCapabilities&&32==(32&this.datasourceModel.gateway.staticCapabilities)&&this.isOnPremSingleSignOnSupportedForDataSourceType(e.dataSourceType,e.extensionDataSourceKind)},y.prototype.isSingleSignOnAADSupported=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;if((this.datasourceModel.gateway.gatewayType||a.Resource)===a.Resource&&!this.services.featureSwitchService.featureSwitches.aADSSOForGatewayEnabled)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];switch(e.dataSourceType){case n.SqlServer:return!0;case n.Extension:return e.isDirectQuerySupported&&!!_.find(e.credentialTypeOptions,(function(e){return e.id===o.OAuth2}));default:return!1}},y.prototype.isSingleSignOnSAMLAllowed=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];return!!e&&e.dataSourceType===n.SAP},y.prototype.isSkipTestConnectionAllowed=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];return!!e&&(e.dataSourceType!==n.AnalysisServices&&4096==(4096&this.datasourceModel.gateway.staticCapabilities))},y.prototype.showSSOTestConnection=function(){var e=!this.viewModel.isAddingDataSource,t=this.services.featureSwitchService.featureSwitches.singleSignOnTestConnection,a=this.allowOnPremSingleSignOn(),i=this.isSingleSignOnKerberosEnabled||this.isSingleSignOnSAMLEnabled||this.isSingleSignOnKerberosForDQAndRefreshEnabled;return t&&e&&a&&i},y.prototype.showKerberosSSOForDQAndRefresh=function(){return this.kerberosSSOForDQAndRefreshEnabled},y.prototype.isDataSourceTestConnectionSuccessful=function(){return this.datasourceModel.gateway.gatewayType!==a.VirtualNetwork&&!this.viewModel.hasTestConnectionFailure&&this.datasourceModel.connected},y.prototype.oauthEditCredentialButton=function(e){var t=this;this.isFormValid(e)&&(e=this.viewModel.editableSettings.dataSourceKind,this.viewModel.isAddingDataSource?(e={datasourceType:this.viewModel.editableSettings.dataSourceType,connectionDetails:this.getConnectionDetailsString(e),mashupTestConnectionDetails:this.createMashupTestConnectionDetails(e)},this.services.gatewaysMetadataService.initiateOAuthLoginOnGatewayCluster(this.datasourceModel.gateway.objectId,e).then((function(e){t.prepareAndShowOAuthDialog(e)}),(function(e){t.showDataSourceError(e),t.viewModel.hasTestConnectionFailure=!0}))):this.services.gatewaysMetadataService.getDataSourceOAuthDetailsForGatewayCluster(this.datasourceModel.gateway.objectId,this.datasourceModel.objectId).then((function(e){t.prepareAndShowOAuthDialog(e)}),(function(e){t.showDataSourceError(e),t.viewModel.hasTestConnectionFailure=!0})))},y.prototype.prepareAndShowOAuthDialog=function(e){this.scope.authDialogParameters.datasource=this.createDataSourceForAuthDialog(e),this.showAuthDialog({dsIndex:0})},y.prototype.showAuthDialog=function(e){var t=this.scope.authDialogParameters;t.showAuthDialog=!0,t.isImportScenario=!1,t.showError=!1,t.selectedAuthenticationIndex=0,t.providerId=l.constants.PBIXContentProviderId,t.dialogTitle=this.viewModel.editableSettings.dataSourceKind,t.showAuthDialog=!0,t.showModalDialog=!0,t.validateParameters=e.validateParameters||!1,t.allowSingleSignOn=!1,t.isManageGatewaysScenario=!0},y.prototype.createDataSourceForAuthDialog=function(e){var t=this.viewModel.editableSettings.dataSourceKind;return u.convertToOAuthDatasourceModel(this.viewModel,this.datasourceModel,t,e)},y.prototype.createDataSourceConnectionParameters=function(e,t){if(!t&&(this.datasourceModel.dataSourceType===n.Extension||this.isExtensionDataSourceType(e))&&!this.isMashupExtensionAllowListed(e))return this.createDataSourceInformationLabel();t=this.viewModel.dataSourceMetadataMap[e];if(!t)return[];var a=this.getParsedConnectionDetails(e)||{},t=t.labels;return _.map(t,(function(e){var t=e.name;return{name:t,displayName:e.displayName,type:e.type,value:a[t]||a[t.toLowerCase()]||"",options:e.options||[],isSelectableList:e.isSelectableList,isRequired:e.isRequired}}))},y.prototype.createDataSourceInformationLabel=function(){var e=jsCommon.JsonExtensions.tryParseJSON(this.datasourceModel.connectionInfo.connectionDetails);return e?[{name:l.constants.dataSourceInformation,displayName:u.getLocalizedString(l.constants.LabelPrefix,_.upperFirst(l.constants.dataSourceInformation),this.services.localizationService),type:"text",isRequired:!0,value:e[l.constants.extensionDataSourcePath]||""}]:null},y.prototype.isFormValid=function(e){if(!e)return!1;e=this.viewModel.editableSettings.dataSourceName!==this.datasourceModel.displayName;return!((this.viewModel.isAddingDataSource||e)&&!this.isDataSourceNameUnique(this.viewModel.editableSettings.dataSourceName,this.datasourceModel))||(this.datasourceModel.errorTitle="",this.datasourceModel.compositeErrorMessage=this.services.localizationService.get("SettingsDatasources_DuplicateDataSourceName"),!(this.viewModel.messageState=2))},y.prototype.isDataSourceNameUnique=function(t,a){return!_.find(this.datasourceModel.gateway.dataSources,(function(e){return e.displayName===t&&e!==a}))},y.prototype.isEditableSettingsChanged=function(){var e=this.viewModel.editableSettings,t=this.viewModel.editableSettings.credentialParameters;return!!e.credentialTypeEdited||(!!e.privacyLevelEdited||(!!e.encryptedConnectionEdited||(!!t.some((function(e){return e.edited}))||(!_.isEmpty(this.scope.authDialogParameters.credentialData)||this.viewModel.editableSettings.skipTestConnection!==this.datasourceModel.connectionInfo.credentialDetails.skipTestConnection))))},y.prototype.isExtensionDataSourceType=function(e){e=this.viewModel.dataSourceMetadataMap[e];return e&&e.dataSourceType===n.Extension},y.prototype.isMashupExtensionAllowListed=function(e){return this.isExtensionDataSourceType(e)&&_.includes(l.constants.mashupExtensionKindAllowListLowerCase,e.toLowerCase())},y.prototype.getParsedConnectionDetails=function(e){var t=this.datasourceModel.connectionInfo.connectionDetails;if(!t)return null;var a,i=jsCommon.JsonExtensions.tryParseJSON(t);return this.isMashupExtensionAllowListed(e)&&((a=i[l.constants.extensionDataSourcePath].split(";")).length,l.constants.extensionDataSourcePath,a.length,i[l.constants.server]=a[0],t=this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails,2===a.length&&("Snowflake"===_.upperFirst(e)&&t?i[l.constants.warehouse]=a[1]:i[l.constants.database]=a[1]),delete i[l.constants.extensionDataSourcePath]),i},y.prototype.isMashupExtensionsMetadata=function(e){return this.isExtensionDataSourceType(e)&&void 0!==this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails&&null!=this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails},y.prototype.createMashupTestConnectionDetails=function(e){if(!this.isMashupExtensionsMetadata(e))return null;var t=this.viewModel.dataSourceMetadataMap[e],e=_.assign({},t.mashupExtensionsFunctionDetails);return e.parameters=this.createParameterValues(t.nestedParameters),e},y.prototype.createParameterValues=function(e){var a=this;return null===e?null:_.map(e,(function(e){var t=u.getLabelType(e.parameterType);if("record"===t)return{name:e.name,isRequired:e.isRequired,type:t,value:null,recordParameters:a.createParameterValues(e.recordParameters)};t=a.getDataSourceConnectionParameter(e.name);return{name:e.name,isRequired:e.isRequired,type:t.type,value:t.value}}))},y.prototype.getEncryptedConnection=function(e,t){if(null==this.viewModel.dataSourceMetadataMap||null==t)return 1;t=this.viewModel.dataSourceMetadataMap[t];return t&&t.isEncryptedConnectionSupported?e?0:this.datasourceModel.connectionInfo.credentialDetails.encryptedConnection:1},y.prototype.getConnectionDetailsString=function(e){for(var t,a,i={},n=0,r=this.viewModel.dataSourceMetadataMap[e].labels;n<r.length;n++){var o=r[n];i[o.name]=this.getDataSourceConnectionParameter(o.name).value}return this.isExtensionDataSourceType(e)&&this.isMashupExtensionAllowListed(e)&&(i[l.constants.ExtensionDataSourceKind]=e,t=i[l.constants.server],l.constants.server,t.length,l.constants.server,"Spark"===e&&((a=_.startsWith(t.toLowerCase(),"standard/"))&&"s"===t[0]?i[l.constants.server]=t.replace("s","S"):a||_.startsWith(t.toLowerCase(),"http")||(i[l.constants.server]="Standard/"+t)),null!=(a=i[l.constants.database])?(a.length,l.constants.database,i[l.constants.extensionDataSourcePath]=t+";"+i[l.constants.database],delete i[l.constants.database]):i[l.constants.extensionDataSourcePath]=t,delete i[l.constants.server]),JSON.stringify(i)},y.prototype.getDefaultCredentialType=function(){var e=this.viewModel.editableSettings,e=this.viewModel.dataSourceMetadataMap[e.dataSourceKind].credentialTypeOptions;if(1===e.length)return e[0].id},y.prototype.getDataSourceName=function(e){var t=this.viewModel.dataSourceMetadataMap[e.dataSourceKind].labels;return 0<t.length?e[t[0].name]:""},y.prototype.getDataSourceConnectionParameter=function(t){var e=_.concat(this.viewModel.editableSettings.requiredDataSourceConnectionParameters,this.viewModel.editableSettings.optionalDataSourceConnectionParameters),e=_.find(e,(function(e){return e.name===t}));return e},y.prototype.getGatewayErrorDetails=function(e){var t,a=[];for(t in e)if(e.hasOwnProperty(t)){var i=e[t],i=w.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(i.error,this.services.localizationService);if(i&&i.displayableErrorInfo){i.message&&a.push({key:t,value:i.message});for(var n=0,r=i.displayableErrorInfo;n<r.length;n++){var o=r[n];a.push({key:o.errorInfoKey,value:o.errorInfoValue})}}}return a},y.prototype.addDataSourceToGateway=function(){var c=this;this.services.lazy("gatewayDataService").then((function(a){var e=c.datasourceModel,i=c.viewModel.editableSettings,n=c.viewModel.dataSourceMetadataMap,r=i.dataSourceKind,o=e.gateway,e=a.getDecodedPublicKey(e.gateway.publicKey),s={credentialData:c.services.credentialParameterService.convert({credentialParameters:i.credentialParameters,credentialType:i.credentialType,dataSourceKind:i.dataSourceKind})};a.prepareCredentials(s,e,i.credentialType,c.entropy).then((function(e){c.viewModel.waitingForDataSourceStatus=!0,e.privacyLevel=i.privacyLevel,e.skipTestConnection=i.skipTestConnection,e.encryptedConnection=i.encryptedConnection;var t=n[r].dataSourceType,e={dataSourceName:i.dataSourceName,dataSourceType:t,onPremGatewayRequired:!0,connectionDetails:c.getConnectionDetailsString(r),credentialDetails:e,supportedAuthenticationTypes:null,singleSignOnType:c.viewModel.singleSignOnType};a.createDataSourceWithRetry(o,e,s,i.credentialType,c.entropy).then((function(e){c.viewModel.waitingForDataSourceStatus=!1,c.datasourceModel.id=e.dataSourceId,c.datasourceModel.objectId=e.dataSourceObjectId,c.datasourceModel.displayName=e.dataSourceName,c.datasourceModel.dataSourceType=e.dataSourceType,c.datasourceModel.connectionInfo.connectionDetails=e.connectionDetails,c.datasourceModel.connectionInfo.credentialDetails=e.credentialDetails,c.datasourceModel.dataSourceAnnotation=u.convertDataSourceAnnotation(""),c.datasourceModel.singleSignOnType=e.singleSignOnType||g.None,c.loadViewModelData(),c.datasourceModel.connected=!0,c.datasourceModel.connectionError=null,c.viewModel.messageState=1,c.scope.$emit(l.constants.dataSourceCreatedEventName,[e.dataSourceObjectId])}),(function(e){c.showDataSourceError(e),c.datasourceModel.connected=!1}))}))}))},y.prototype.addDataSourceToCluster=function(){var n=this;this.services.lazy("gatewayDataService").then((function(e){n.viewModel.waitingForDataSourceStatus=!0;var t=n.viewModel.editableSettings,a=n.viewModel.editableSettings.dataSourceKind,i=n.createMashupTestConnectionDetails(a),t={credentialData:t.credentialType===o.OAuth2?n.scope.authDialogParameters.credentialData:{credentialData:n.services.credentialParameterService.convert({credentialParameters:t.credentialParameters,credentialType:t.credentialType,dataSourceKind:t.dataSourceKind})},credentialType:t.credentialType,connectionDetails:n.getConnectionDetailsString(a),dataSourceModel:n.datasourceModel,dataSourceName:t.dataSourceName,dataSourceType:t.dataSourceType,entropy:n.entropy,singleSignOnType:n.viewModel.singleSignOnType,privacyLevel:t.privacyLevel,encryptedConnection:t.encryptedConnection,mashupTestConnectionDetails:i,skipTestConnection:t.skipTestConnection};e.createClusterDataSourceWithRetry(t).then((function(e){var t=e.data;n.viewModel.waitingForDataSourceStatus=!1,n.datasourceModel.id=t.datasourceDetails.dataSourceId,n.datasourceModel.objectId=t.datasourceDetails.dataSourceObjectId,n.datasourceModel.displayName=t.datasourceDetails.dataSourceName,n.datasourceModel.dataSourceType=t.datasourceDetails.dataSourceType,n.datasourceModel.connectionInfo.connectionDetails=t.datasourceDetails.connectionDetails,n.datasourceModel.connectionInfo.credentialDetails=t.datasourceDetails.credentialDetails,n.datasourceModel.dataSourceAnnotation=u.convertDataSourceAnnotation(""),n.datasourceModel.singleSignOnType=t.datasourceDetails.singleSignOnType||g.None,n.loadViewModelData(),n.datasourceModel.connected=!0,n.datasourceModel.connectionError=null,n.viewModel.messageState=1,n.scope.$emit(l.constants.dataSourceCreatedEventName,[t.datasourceDetails.dataSourceObjectId]),n.showGatewayError(e.requestId,e.activityId,e.data.gatewayNameToErrorResponseDictionary,"ServerError_DMTS_PublishDatasourceToClusterErrorCode")}),(function(e){n.showDataSourceError(e),n.datasourceModel.connected=!1}))}))},y.prototype.updateCredentials=function(){var s=this;this.services.lazy("gatewayDataService").then((function(t){var a=s.datasourceModel,i=s.viewModel.editableSettings,e=i.dataSourceKind,n=a.gateway,r=t.getDecodedPublicKey(s.datasourceModel.gateway.publicKey),e={credentialType:i.credentialType,credentialParameters:s.viewModel.editableSettings.credentialParameters,dataSourceKind:e},o={credentialData:s.services.credentialParameterService.convert(e)};t.prepareCredentials(o,r,i.credentialType,s.entropy).then((function(e){s.viewModel.waitingForDataSourceStatus=!0,e.privacyLevel=i.privacyLevel,e.skipTestConnection=i.skipTestConnection,e.encryptedConnection=i.encryptedConnection,t.updateCredentialsWithRetry(n,a.objectId,o,i.credentialType,e,s.entropy).then((function(){s.viewModel.waitingForDataSourceStatus=!1,s.datasourceModel.connectionInfo.credentialDetails.credentialType=s.viewModel.editableSettings.credentialType,s.datasourceModel.connectionInfo.credentialDetails.privacyLevel=s.viewModel.editableSettings.privacyLevel,s.datasourceModel.connectionInfo.credentialDetails.skipTestConnection=s.viewModel.editableSettings.skipTestConnection,s.datasourceModel.connectionInfo.credentialDetails.encryptedConnection=s.viewModel.editableSettings.encryptedConnection,s.loadViewModelData(),s.datasourceModel.connected=!0,s.datasourceModel.connectionError=null}),(function(e){s.showDataSourceError(e),s.viewModel.hasTestConnectionFailure=!0}))}))}))},y.prototype.updateClusterCredentials=function(){var r=this;this.services.lazy("gatewayDataService").then((function(e){r.viewModel.waitingForDataSourceStatus=!0;var t=r.viewModel.editableSettings,a=null,i=t.privacyLevel,n=t.encryptedConnection,a=t.credentialType===o.OAuth2?r.scope.authDialogParameters.credentialData:{credentialData:r.services.credentialParameterService.convert({credentialParameters:t.credentialParameters,credentialType:t.credentialType,dataSourceKind:t.dataSourceKind})};e.updateClusterCredentialsWithRetry(r.datasourceModel,i,n,a,t.credentialType,t.skipTestConnection,r.entropy).then((function(e){r.viewModel.waitingForDataSourceStatus=!1,r.datasourceModel.connectionInfo.credentialDetails.credentialType=t.credentialType,r.datasourceModel.connectionInfo.credentialDetails.privacyLevel=t.privacyLevel,r.datasourceModel.connectionInfo.credentialDetails.skipTestConnection=r.viewModel.editableSettings.skipTestConnection,r.datasourceModel.connectionInfo.credentialDetails.encryptedConnection=t.encryptedConnection,r.loadViewModelData(),r.datasourceModel.connected=!0,r.datasourceModel.connectionError=null,r.showGatewayError(e.requestId,e.activityId,e.data.gatewayNameToErrorResponseDictionary,"ServerError_DMTS_UpdateClusterDatasourceCredentialsErrorCode")}),(function(e){r.showDataSourceError(e),r.viewModel.hasTestConnectionFailure=!0}))}))},y.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),n=[new InJs.ModalDialogAction(a,function(){t.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(i,function(){t.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return t.showCustomDialog(r,$("<div></div>").text(a),n,(function(e){e.parent().find('input[value="'+i+'"]').focus()}),!0,!0),e.promise},y.prototype.showGatewayError=function(e,t,a,i){0<Object.keys(a).length&&(this.datasourceModel.connectionError=this.services.localizationService.get(i),a=this.getGatewayErrorDetails(a),this.datasourceModel.traceDetails={requestId:e,activityId:t,clusterUri:c.clusterUri,errorCode:"",details:a,time:(new Date).toString(),version:w.getBuild(),clientVersion:w.getClientVersion()},this.viewModel.waitingForDataSourceStatus=!1)},y.prototype.showDataSourceError=function(e){var t=w.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,this.services.localizationService),a=w.ServiceErrorHelper.serverErrorPrefix+e.error.code,i=this.services.localizationService.get(a);"ServerError_DMTS_DuplicateDatasourceError"===a?(this.datasourceModel.errorTitle="",this.datasourceModel.compositeErrorMessage=i):(this.datasourceModel.errorTitle=this.services.localizationService.get("SettingsDataSource_SettingsConnectionErrorTitle"),this.datasourceModel.compositeErrorMessage=this.services.localizationService.format("SettingsDataSource_SettingsConnectionErrorMessage",[this.getDataSourceName(this.viewModel.editableSettings),i]));var n=[];if(t&&t.displayableErrorInfo)if(e.error.code===l.constants.PublishDatasourceToClusterErrorCode||e.error.code===l.constants.UpdateClusterDatasourceCredentialsErrorCode)0<t.displayableErrorInfo.length&&(i=t.displayableErrorInfo[0].errorInfoValue,n=this.getGatewayErrorDetails(JSON.parse(i)));else for(var r=0,o=t.displayableErrorInfo;r<o.length;r++){var s=o[r];n.push({key:s.errorInfoKey,value:s.errorInfoValue})}this.datasourceModel.compositeTraceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:c.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:n,time:(new Date).toString(),version:w.getBuild(),clientVersion:w.getClientVersion(),linkText:this.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},this.viewModel.waitingForDataSourceStatus=!1,this.viewModel.messageState=2},e.DatasourceSettingsController=y})(w.gateways||(w.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).DatasourceSettings={templateUrl:"components/datasourceSettings/datasourceSettingsView.html",bindings:{datasourceModel:"<"},controllerAs:"ctrl",controller:e.common.createController(t.controllers.DatasourceSettingsController)}})(powerbi=powerbi||{}),(function(u){!(function(e){var t,a;function i(e,t){var a=this;this.services=t,this.isDirty=function(e,t){t&&(a.parentViewModel.isDirty=!0,a.enterpriseGatewaySelectedInTable(e,!0))};t=this.services.featureSwitchService.featureSwitches;this.gatewayMultipleCredentialsEnabled=t.gatewayMultipleCredentials,this.isSovereignCloud=t.isSovereignCloud,this.useNewManageGatewaysUI=t.newManageGatewaysUI,this.gatewayToDatasourceWhiteList={}}e=e.controllers||(e.controllers={}),t=u.common.contracts.gateway.GatewayStatus,a=u.connectivity.models.GatewayStatus,i.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","selectGatewayService","gatewaysMetadataService","featureSwitchService","navigation","gatewayRedirectService"]}},i.prototype.$onChanges=function(e){return __awaiter(this,void 0,u.Promise,(function(){var t,a,i,n,r,o,s,c,l,d;return __generator(this,(function(e){switch(e.label){case 0:if(void 0!==this.expandDatasources||!this.parentViewModel||!this.parentViewModel.improperlyConfiguredEnterpriseGateways)return[3,5];this.expandDatasources=new Array(this.parentViewModel.improperlyConfiguredEnterpriseGateways.length),this.expandDatasources=_.fill(this.expandDatasources,!1),r=this.services.localizationService.currentLanguageLocale,a=this.parentViewModel.improperlyConfiguredEnterpriseGateways,t=0,a=a,e.label=1;case 1:return t<a.length?(c=a[t]).isUserNonAdmin?[3,3]:(i=this.gatewayToDatasourceWhiteList,n=c.objectId,[4,this.services.gatewaysMetadataService.supportedDataSources(c.objectId,r)]):[3,4];case 2:i[n]=e.sent(),e.label=3;case 3:return t++,[3,1];case 4:this.services.telemetryService.logEvent(u.telemetry.GatewaysTableLoaded,{numberOfEnterpriseGateways:this.parentViewModel.enterpriseGateways.length,numberOfImproperlyConfiguredGateways:this.parentViewModel.improperlyConfiguredEnterpriseGateways.length}),e.label=5;case 5:if(void 0!==this.expandProperlyConfiguredDatasources||!this.parentViewModel||!this.parentViewModel.enterpriseGateways)return[3,11];s=this.parentViewModel.enterpriseGateways,this.expandProperlyConfiguredDatasources=new Array(s.length),this.expandProperlyConfiguredDatasources=_.map(s,(function(e){return!e.isDisabled})),r=this.services.localizationService.currentLanguageLocale,o=0,s=s,e.label=6;case 6:if(!(o<s.length))return[3,11];c=s[o],e.label=7;case 7:return e.trys.push([7,9,,10]),l=this.gatewayToDatasourceWhiteList,d=c.objectId,[4,this.services.gatewaysMetadataService.supportedDataSources(c.objectId,r)];case 8:return l[d]=e.sent(),[3,10];case 9:return e.sent(),this.gatewayToDatasourceWhiteList[c.objectId]={builtInDataSourceTypes:[]},[3,10];case 10:return o++,[3,6];case 11:return[2]}}))}))},i.prototype.getNumberOfGateways=function(){var e=this.shouldShowOnlinePgw()||this.shouldShowOfflinePgw()?1:0;return this.parentViewModel.enterpriseGateways.length+this.parentViewModel.improperlyConfiguredEnterpriseGateways.length+e},i.prototype.getEGWClass=function(){return this.parentViewModel.enterpriseGateways&&this.parentViewModel.improperlyConfiguredEnterpriseGateways?this.getEGW(this.getNumberOfGateways()):""},i.prototype.getOnlineGatewayMachineStatusString=function(e){var t=this.services.localizationService;if(!e&&this.parentViewModel.pgwAnnotation)return t.format("Gateways_Status_Online_WithMachine",[this.parentViewModel.pgwAnnotation.gatewayMachine]);if(!e||!e.gatewayAnnotation)return t.get("Gateways_Status_Offline_WithCross");var a=e.gatewayAnnotation;return!this.gatewayMultipleCredentialsEnabled||this.allDatasourceCredentialsSelected&&this.allDatasourceCredentialsSelected[e.objectId]?this.gatewaySupportedUntilDate(e)?a.gatewayMachine?t.format("Gateways_Status_Online_WithMachineAndSupportedUntilDate",[a.gatewayMachine]):t.get("Gateways_Status_Online_WithoutMachineAndSupportedUntilDate"):a.gatewayMachine?t.format("Gateways_Status_Online_WithMachine",[a.gatewayMachine]):t.get("Gateways_Status_Online_WithoutMachine"):this.gatewaySupportedUntilDate(e)?a.gatewayMachine?t.format("Gateways_Status_Online_WithMachine_SelectDatasourceAndSupportedUntilDate",[a.gatewayMachine]):t.get("Gateways_Status_Online_WithoutMachine_SelectDatasourceAndSupportedUntilDate"):a.gatewayMachine?t.format("Gateways_Status_Online_WithMachine_SelectDatasource",[a.gatewayMachine]):t.get("Gateways_Status_Online_WithoutMachine_SelectDatasource")},i.prototype.selectPersonalGateway=function(){this.gatewayTypeSelected,this.parentViewModel.useEnterpriseGateway=!1,this.parentViewModel.useGateway=!0,this.gatewayTypeSelected()},i.prototype.noGateways=function(){return 0===this.getNumberOfGateways()},i.prototype.shouldShowOnlinePgw=function(){return!!(this.parentViewModel&&this.parentViewModel.pgw&&this.parentViewModel.pgw.gatewayStatusJson)&&(this.parentViewModel.allowPersonalGateway&&!this.parentViewModel.isDirectQuery&&!this.parentViewModel.isCloudScheduleRefresh&&this.parentViewModel.pgw.gatewayStatusJson.gatewayStatus===t.Live)},i.prototype.shouldShowOfflinePgw=function(){return!!(this.parentViewModel&&this.parentViewModel.pgw&&this.parentViewModel.pgw.gatewayStatusJson)&&(this.parentViewModel.allowPersonalGateway&&!this.parentViewModel.isDirectQuery&&!this.parentViewModel.isCloudScheduleRefresh&&(this.parentViewModel.pgw.gatewayStatusJson.gatewayStatus===t.NotReachable||this.parentViewModel.pgw.gatewayStatusJson.gatewayStatus===t.Installed))},i.prototype.navigateToManageGatewaysItem=function(e,t,a){this.useNewManageGatewaysUI?(this.services.gatewayRedirectService.setOpenGatewaySettingsParameters({gatewayType:e,gatewayObjectId:t}),this.services.navigation.navigateToManageGateways()):this.services.navigation.navigateToGatewayItem(t,a)},i.prototype.enterpriseGatewaySelectedInTable=function(e,t){!(t=void 0===t?!1:t)&&this.isProperlyConfiguredEGWDisabled(e)||(this.enterpriseGatewaySelected,e={gatewayObjectId:e.objectId},this.enterpriseGatewaySelected(e))},i.prototype.deletePersonalGatewayInTable=function(){this.deletePersonalGateway,this.deletePersonalGateway()},i.prototype.isProperlyConfiguredEGWDisabled=function(t){if(t&&t.isDisabled)return!0;var e=_.find(this.parentViewModel.enterpriseGateways,(function(e){return e.objectId===t.objectId}));return!(!e||!this.gatewayNotSupported(e))||(this.allDatasourceCredentialsSelected?this.gatewayMultipleCredentialsEnabled&&!this.allDatasourceCredentialsSelected[t.objectId]:this.gatewayMultipleCredentialsEnabled)},i.prototype.getEGW=function(e){switch(e){case 0:return"noEGW";case 1:return"singleEGW";default:return"multipleEGW"}},i.prototype.getImproperlyConfiguredGatewayState=function(e){var t=e.status;return this.gatewaySupportedUntilDate(e)?"supportedUntilDate":this.gatewayNotSupported(e)?"notSupported":t===a.Unknown?"unknown":"misconfigured"},i.prototype.getGatewayState=function(e){var t=e.status;if(this.gatewayNotSupported(e))return"notSupported";e=this.gatewaySupportedUntilDate(e);return t===a.Live&&e?"supportedUntilDateAndOnline":t===a.Live?"online":t===a.NotReachable&&e?"supportedUntilDateAndOffline":t===a.NotReachable?"offline":t===a.Unknown?"unknown":void 0},i.prototype.gatewayNotSupported=function(e){return _.some(e.gatewayVersionStatuses,(function(e){return"NotSupported"===e.gatewayStatus}))},i.prototype.gatewaySupportedUntilDate=function(e){return _.some(e.gatewayVersionStatuses,(function(e){return"SupportedUntilDate"===e.gatewayStatus}))},e.GatewaysTableController=i})(u.gateways||(u.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).GatewaysTable={templateUrl:"components/gatewaysTable/gatewaysTableView.html",bindings:{parentViewModel:"=",enterpriseGatewaySelected:"&",gatewayTypeSelected:"&",deletePersonalGateway:"&",monikers:"<",showGatewaysTable:"<",datasources:"<"},controller:e.common.createController(t.controllers.GatewaysTableController)}})(powerbi=powerbi||{}),(function(c){!(function(n){var e,r,a,l,d,o,i,s;function t(e,t){this.services=t,this.buildTableCompleted=!1;t=this.services.featureSwitchService.featureSwitches;this.gatewayMultipleCredentialsEnabled=t.gatewayMultipleCredentials,this.allowGatewaysWithoutMashupCreds=t.allowGatewaysWithoutMashupCreds,this.useNewManageGatewaysUI=t.newManageGatewaysUI,this.undoGetAvailableGatewayCloudDS=this.services.featureSwitchService.featureSwitches.undoGetAvailableGatewayCloudDS,this.addToGatewayString=this.services.localizationService.get("GatewayDataSource_AddToGateway"),this.addToGatewayOptionalString=this.services.localizationService.get("GatewayDataSource_AddToGatewayOptional"),this.manuallyAddToGatewayString=this.services.localizationService.get("GatewayDataSource_ManuallyAddToGateway"),this.adminCenterlUrl=s.dataGatewaysAdminUrl}e=n.controllers||(n.controllers={}),r=c.common.constants,a=c.connectivity.models.GatewayStatus,l=c.common.contracts.gateway.DataSourceType,d=c.common.contracts.gateway.GatewayType,o=c.common.contracts.gateway.SingleSignOnType,i=c.common.contracts.gateway.UnifiedGatewayRole,s=window,t.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","selectGatewayService","gatewaysMetadataService","featureSwitchService","navigation","datasourceService","gatewayRedirectService","downgradedRouterUtilities"]}},t.prototype.$onChanges=function(e){return __awaiter(this,void 0,c.Promise,(function(){var t,a,i,n,r,o,s,c=this;return __generator(this,(function(e){switch(e.label){case 0:if(t=this.services.featureSwitchService.featureSwitches,null!=this.monikers&&void 0===this.filteredMonikerDatasources){for(a=[],i=0,n=this.monikers;i<n.length;i++)r=n[i],a.push.apply(a,r.monikerDataSources||[]);o=t.gatewaysTableUseConnDetails,this.filteredMonikerDatasources=_(a).uniqBy((function(e){if(e.dataSourceType===l.File)return(e.connectionDetails+e.dataSourceType).toLowerCase();if(e.dataSourceType!==l.Folder)return o?e.connectionDetails.toLowerCase()+e.dataSourceType:e.dataSourceObjectId||e.connectionDetails+e.dataSourceType;var t=jsCommon.JsonExtensions.tryParseJSON(e.connectionDetails);return(t?_.trimEnd(t.path,"\\/")+e.dataSourceType:e.connectionDetails+e.dataSourceType).toLowerCase()})).map((function(e){var t=c.isDatasourceOptional(e),a=c.isCloudDatasource(e),i=!1;return a&&(i=c.isMashedUpWithNonCloudDatasource(e),c.allowGatewaysWithoutMashupCreds||!i||t||(a=!1)),{monikerDataSource:e,isOptional:t,isCloud:a,isMashedUp:i}})).value()}return(this.gateway&&this.gateway.gatewayType===d.VirtualNetwork&&(this.addToGatewayString=this.services.localizationService.get("GatewayDataSource_AddToVNet"),this.addToGatewayOptionalString=this.services.localizationService.get("GatewayDataSource_AddToVNetOptional"),this.manuallyAddToGatewayString=this.services.localizationService.get("GatewayDataSource_ManuallyAddToVNet")),!this.credentialOptions&&this.filteredMonikerDatasources&&this.datasourceWhitelist&&this.buildMultipleCredentialOptionsArray(),!this.gateway||this.gatewayMultipleCredentialsEnabled||this.gatewayIncludedDatasources)?[3,2]:[4,(s=this).services.gatewaysMetadataService.getDataSources(this.gateway.objectId)];case 1:s.gatewayIncludedDatasources=e.sent(),e.label=2;case 2:return this.gateway&&(this.showAdminCenterLink=t.gatewaysAdminCenterLink&&!this.doesUserHaveAddToGatewayPermissions()),[2]}}))}))},t.prototype.isDataSourceAddedToGateway=function(t){var a=this.services.selectGatewayService;return _.some(this.gateway.dataSources,(function(e){return a.MatchDatasourceWithMonikerDatasource(e,t)}))},t.prototype.navigateToAddDatasource=function(t){this.services.telemetryService.logEvent(c.telemetry.GatewaysAddPrepopulatedDatasourceToGateway,{datasourceType:l[t.dataSourceType]});var e=_.find(this.datasources,(function(e){return e.key===t.connectionDetails&&"Personal"===e.gatewayType})),a=(e||t).connectionDetails,i=this.services.downgradedRouterUtilities.getCurrentActivatedRouteSnapshotLeaf(),e=i.paramMap.get("settingsGroup"),i=i.paramMap.get("settingsId");this.useNewManageGatewaysUI?(this.services.gatewayRedirectService.setCreateDatasourceParameters({settingsGroupType:e,settingsId:i,gatewayObjectId:this.gateway.objectId,dataSourceType:t.dataSourceType,connectionDetails:a}),this.services.navigation.navigateToManageGateways()):(this.services.datasourceService.setConnectionInfo({connectionDetails:a,credentialDetails:null}),this.services.datasourceService.setDataSourceType(t.dataSourceType),this.services.datasourceService.setLastUpdatedDatasource(e,i),this.services.navigation.navigateToGatewayItem(this.gateway.objectId,r.EmptyGuid))},t.prototype.getDatasourceDisplayString=function(e){return""+l[e.dataSourceType]+[e.connectionDetails]},t.prototype.getDatasourceActionLabel=function(t){var a=this;return this.gateway.isUserNonAdmin?t.isOptional?6:5:this.doesUserHaveAddToGatewayPermissions()?!this.gatewayMultipleCredentialsEnabled&&_.some(this.gatewayIncludedDatasources,(function(e){return a.isMatchingDatasource(t.monikerDataSource,e)}))?3:this.canDatasourceBeAddedToGateway(t):7},t.prototype.tryAddDatasourceUser=function(n){return __awaiter(this,void 0,c.Promise,(function(){var t,a,i=this;return __generator(this,(function(e){switch(e.label){case 0:t=_.find(this.gatewayIncludedDatasources,(function(e){return i.isMatchingDatasource(n,e)})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.services.gatewaysMetadataService.addDataSourcePrincipals(this.gateway.objectId,t.dataSourceObjectId,[{accessRight:1,principalList:[c.session.UserInfoUtils.getUPN()]}])];case 2:return e.sent(),window.location.reload(),[3,4];case 3:return a=e.sent(),this.services.errorService.error(this.services.localizationService.get(c.ServiceErrorHelper.serverErrorPrefix+a.error.code),"AddDataSourceUser_Error",{requestId:a.requestId,ecsCorrelationId:a.activityId,statusCode:a.status.toString()}),[3,4];case 4:return[2]}}))}))},t.prototype.getCredentialsForMoniker=function(t){var a=this;return _.find(this.credentialOptions,(function(e){return e.monikerDatasourceType===t.dataSourceType&&a.compareConnectionDetails(e.monikerConnectionDetails,t.connectionDetails)}))},t.prototype.shouldShowRemoveCloudDS=function(e){e=this.getCredentialsForMoniker(e);return!!e&&(this.selectedDatasourceObjectIds[e.index]&&e.isCloud)},t.prototype.multipleCredentialSelected=function(e,t,a){void 0===a&&(a=!1);var i,n,r,o,s=this.selectedDatasourceObjectIds[e];1===s.length?0!==(i=parseInt(s,10))&&2!==i&&4!==i||this.navigateToAddDatasource(t):"remove"===s?((n=this.previouslySelectedDatasourceObjectIds[e])&&this.gateway.selectedDataSourceObjectIds&&(o=_.findIndex(this.gateway.selectedDataSourceObjectIds,(function(e){return e===n})),_.pullAt(this.gateway.selectedDataSourceObjectIds,o)),this.selectedDatasourceObjectIds[e]=void 0,this.isDirty&&!a&&this.isDirty(this.gateway,this.allDatasourceCredentialsSelected),this.areAllNonCloudDatasourcesSelected()&&(this.allDatasourceCredentialsSelected=!0,this.verifyGatewayStatusAfterCredentialsSelected())):((r=this.previouslySelectedDatasourceObjectIds[e])&&this.gateway.selectedDataSourceObjectIds&&(o=_.findIndex(this.gateway.selectedDataSourceObjectIds,(function(e){return e===r})),_.pullAt(this.gateway.selectedDataSourceObjectIds,o)),this.gateway.selectedDataSourceObjectIds||(this.gateway.selectedDataSourceObjectIds=[]),this.gateway.selectedDataSourceObjectIds.push(s),this.previouslySelectedDatasourceObjectIds[e]=s,this.areAllNonCloudDatasourcesSelected()&&(this.allDatasourceCredentialsSelected=!0,this.verifyGatewayStatusAfterCredentialsSelected()),this.isDirty&&!a&&this.isDirty(this.gateway,this.allDatasourceCredentialsSelected))},t.prototype.doesUserHaveAddToGatewayPermissions=function(){var e=this.gateway&&this.gateway.permission,t=this.services.featureSwitchService.featureSwitches;return!t.gatewaysAdminCenterLink||!!e&&(!!t.newManageGatewaysUI||e.role===i.Admin)},t.prototype.areAllNonCloudDatasourcesSelected=function(){var t=this,e=_.keys(_.pickBy(this.selectedDatasourceObjectIds,(function(e){return void 0===e})));return!_.some(e,(function(e){return!t.filteredMonikerDatasources[e].isCloud}))},t.prototype.verifyGatewayStatusAfterCredentialsSelected=function(){var e,t=this;this.gatewayMultipleCredentialsEnabled&&this.gateway.status!==a.Unknown&&(e=_.every(this.selectedDatasourceObjectIds,(function(e){return!e||t.datasourceStatus&&t.datasourceStatus[e]&&1===t.datasourceStatus[e].status})),this.gateway.status=e?a.Live:a.NotReachable)},t.prototype.buildMultipleCredentialOptionsArray=function(){var i=this;if(!this.credentialOptions){this.selectedDatasourceObjectIds=new Array(this.filteredMonikerDatasources.length),this.previouslySelectedDatasourceObjectIds=new Array(this.filteredMonikerDatasources.length),this.selectedDatasourceObjectIds=_.fill(this.selectedDatasourceObjectIds,void 0),this.previouslySelectedDatasourceObjectIds=_.fill(this.previouslySelectedDatasourceObjectIds,void 0),this.credentialOptions=[];for(var n=0,r=this,e=0,t=this.filteredMonikerDatasources;e<t.length;e++)!(function(e){var t=e.monikerDataSource,a=_.map(r.getGatewayDatasourcesForMoniker(t),(function(e){return e.singleSignOnType===o.KerberosDQAndRefresh&&(e.displayName=i.services.localizationService.format("SettingsDataset_Gateway_DatasourceDisplayNameSSO",[e.displayName])),e}));r.credentialOptions.push({index:n,monikerConnectionDetails:t.connectionDetails,monikerDatasourceType:t.dataSourceType,dataSources:a,canDatasourceBeAddedToGateway:r.canDatasourceBeAddedToGateway(e),isCloud:e.isCloud}),_.some(a,(function(e){return e.objectId===t.dataSourceObjectId}))&&(r.selectedDatasourceObjectIds[n]=t.dataSourceObjectId,r.multipleCredentialSelected(n,t,!0)),n++})(t[e]);this.allDatasourceCredentialsSelected=this.areAllNonCloudDatasourcesSelected(),this.buildTableCompleted=!0}},t.prototype.getGatewayDatasourcesForMoniker=function(t){var a=this.services.selectGatewayService;return _.filter(this.gateway.dataSources,(function(e){return a.MatchDatasourceWithMonikerDatasource(e,t)}))},t.prototype.isMatchingDatasource=function(e,t){return this.services.selectGatewayService.MatchDatasourceWithMonikerDatasource(t,e)},t.prototype.canDatasourceBeAddedToGateway=function(e){var t=e.monikerDataSource,a=jsCommon.JsonExtensions.tryParseJSON(t.connectionDetails);if(a){var e=this.doesUserHaveAddToGatewayPermissions()?e.isOptional?2:0:7,i=a.extensionDataSourceKind;if(t.dataSourceType===l.Extension){if(_.some(this.datasourceWhitelist.builtInDataSourceTypes,(function(e){return e.extensionDataSourceKind===i}))||_.some(this.datasourceWhitelist.mashupExtensionsMetadata,(function(e){return e.dataSourceKind===i})))return _.includes(n.constants.mashupExtensionKindAllowListLowerCase,i.toLowerCase())?e:4}else if(_.some(this.datasourceWhitelist.builtInDataSourceTypes,(function(e){return e.dataSourceType===t.dataSourceType})))return e}return 1},t.prototype.compareConnectionDetails=function(e,t){return e.toLowerCase()===t.toLowerCase()},t.prototype.isDatasourceOptional=function(e){return!!this.gateway.allowCloudDatasourceRefreshThroughGateway&&this.isCloudDatasource(e)},t.prototype.isCloudDatasource=function(t){var a=this.services.selectGatewayService;if(this.undoGetAvailableGatewayCloudDS){var e=_.find(this.datasources,(function(e){return e.dataSourceObjectId===t.dataSourceObjectId}));return(e=e||_.find(this.datasources,(function(e){return a.MatchDatasourceWithMonikerDatasource(e,t)&&"Personal"===e.gatewayType})))&&!e.onPremGatewayRequired}return _(this.datasources).filter((function(e){return a.MatchDatasourceWithMonikerDatasource(e,t)})).map((function(e){return e.onPremGatewayRequired})).some((function(e){return!e})).valueOf()},t.prototype.isMashedUpWithNonCloudDatasource=function(t){for(var e=[],a=0,i=this.monikers;a<i.length;a++){var n=i[a];!n.monikerDataSources||n.monikerDataSources.length<=1||0<=_.findIndex(n.monikerDataSources,(function(e){return e.dataSourceType===t.dataSourceType&&e.connectionDetails===t.connectionDetails}))&&(s=_.filter(n.monikerDataSources,(function(e){return e.dataSourceType!==t.dataSourceType||e.connectionDetails!==t.connectionDetails})),e.push.apply(e,s))}for(var r=0,o=e;r<o.length;r++){var s=o[r];if(!this.isCloudDatasource(s))return!0}return!1},e.GatewaysTableDatasourcesController=t})(c.gateways||(c.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).GatewaysTableDatasources={templateUrl:"components/gatewaysTableDatasources/gatewaysTableDatasourcesView.html",bindings:{gateway:"<",monikers:"<",expandDatasources:"=",datasourceWhitelist:"<",datasources:"<",isDirty:"<?",allDatasourceCredentialsSelected:"=?",datasourceStatus:"<?"},controller:e.common.createController(t.controllers.GatewaysTableDatasourcesController)}})(powerbi=powerbi||{}),(function(n){!(function(i){var e;function t(e,t){var a=this;this.scope=e,this.services=t,this.localizedOriginalName=t.localizationService.get("UpnMappingPane_OriginalName"),this.localizedNewName=t.localizationService.get("UpnMappingPane_NewName"),this.localizedResultOfApplyingMappingRule=t.localizationService.get("UpnMappingPane_AfterRuleAppliedPlaceHolder"),this.resetNewRule(),this.services.lazy("gatewayDataService").then((function(e){var t=(a.gatewayDataService=e).getSelectedGatewayDataSource();t.dataSourceAnnotation&&t.dataSourceAnnotation.dataSourceAnnotationUPNMapping||(t.dataSourceAnnotation=i.models.GatewayModelConverter.convertDataSourceAnnotation("")),a.viewModel=_.cloneDeep(e.getSelectedGatewayDataSource().dataSourceAnnotation.dataSourceAnnotationUPNMapping)}))}e=i.controllers||(i.controllers={}),t.createOptions=function(){return{additionalServices:["lazy","gatewaysMetadataService","localizationService","errorService","telemetryService","notificationToast","promiseFactory","taskPaneSliderService"]}},t.prototype.addNewRule=function(){var e=this.newRule;this.viewModel.mappingRules.push({algorithm:e.algorithm,searchString:e.searchString,replacementString:e.replacementString}),this.resetNewRule()},t.prototype.deleteRule=function(){var e;this.selectedRule&&(e=this.viewModel.mappingRules.indexOf(this.selectedRule),this.viewModel.mappingRules.splice(e,1))},t.prototype.testRule=function(){var t=this;this.testRuleOriginalName&&(this.isTestRuleRequestPending=!0,this.services.gatewaysMetadataService.getUPNMappingResult([this.testRuleOriginalName],this.viewModel).then((function(e){_.isEmpty(e.upns)||(e=e.upns[0],t.testRuleNewName=e.result)}),(function(){t.services.errorService.error(t.services.localizationService.get("UpnMappingPane_FailToTestUPNRuleMessage"),"FailToTestUPNRuleMessage")})).finally((function(){t.isTestRuleRequestPending=!1})))},t.prototype.saveChangesAndExit=function(){var e=this;this.isUpdateDataSourceRequestPending=!0;var t=JSON.stringify({dataSourceAnnotationUPNMapping:{connectionStringPropertyName:this.viewModel.connectionStringPropertyName,mappingRules:this.viewModel.mappingRules}}),a=this.gatewayDataService.getSelectedGatewayDataSource(),i=this.services.telemetryService.startEvent(n.telemetry.SettingsUpdateGatewayDatasourceUPNMapping);this.services.gatewaysMetadataService.updateDataSource(a.gateway.objectId,a.objectId,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:t,supportedAuthenticationTypes:null}).then((function(){a.dataSourceAnnotation.dataSourceAnnotationUPNMapping=_.cloneDeep(e.viewModel),e.closeUpnMappingPane(),e.services.notificationToast.notify({title:e.services.localizationService.get("UpnMappingPane_SuccessfulMessage"),notificationType:7}),i.resolve()}),(function(){e.services.errorService.error(e.services.localizationService.get("UpnMappingPane_FailToUpdateMessage"),"FailToUpdateGatewayUPNMapping"),i.reject()})).finally((function(){e.isUpdateDataSourceRequestPending=!1}))},t.prototype.closeUpnMappingPane=function(){this.services.taskPaneSliderService.collapsePane()},t.prototype.selectPre=function(){var e,t=this.viewModel.mappingRules,a=t.indexOf(this.selectedRule);1<t.length&&0<a&&(e=t[a],t[a]=t[a-1],t[a-1]=e,this.selectedRule=t[a-1])},t.prototype.selectNext=function(){var e,t=this.viewModel.mappingRules,a=t.indexOf(this.selectedRule);1<t.length&&a<t.length-1&&(e=t[a],t[a]=t[a+1],t[a+1]=e,this.selectedRule=t[a+1])},t.prototype.resetNewRule=function(){this.newRule={algorithm:n.common.contracts.gateway.DataSourceAnnotationUPNMappingAlgorithm.SubstringReplacement,searchString:"",replacementString:""}},e.UpnMappingPaneController=t})(n.gateways||(n.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).UpnMappingPane={templateUrl:"components/upnMappingPane/upnMappingPaneView.html",controller:e.common.createController(t.controllers.UpnMappingPaneController)}})(powerbi=powerbi||{}),(function(n){var e;(function(e){var i;(t=i=e.SSOTestConnectionStatus||(e.SSOTestConnectionStatus={})).NoResults="NoResults",t.Running="Running",t.Success="Success",t.Failed="Failed";var t=(a.prototype.$onInit=function(){this.resetComponent(),this.ssoTestConnectionExpanded=!1},a.prototype.$onChanges=function(){this.resetComponent(),this.ssoTestConnectionExpanded=!0},a.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","gatewaysMetadataService","lazy","localizationService"]}},a.prototype.executeSSOTestConnection=function(){return __awaiter(this,void 0,n.Promise,(function(){var t,a;return __generator(this,(function(e){switch(e.label){case 0:this.testStatus=i.Running,this.testResults=null,this.testTimestamp="",e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.services.gatewaysMetadataService.getSSOTestConnection(this.datasourceModel.gatewayCluster.objectId,this.datasourceModel.objectId,this.upn,this.singleSignOnType)];case 2:return a=e.sent(),t=a.data,this.testTimestamp=(new Date).toString(),t=_.chain(t.results).map((function(e){return e.testSuccessful})).reduce((function(e,t){return e&&t})).value(),this.testResults=a,this.testStatus=t?i.Success:i.Failed,[3,4];case 3:return a=e.sent(),t=a,this.testStatus=i.NoResults,a="WebRequestFailed",400===t.status&&t.data&&t.data.error&&"DMTS_RequestInvalidErrorCode"===t.data.error.code&&(a="InvalidEmailAddress"),this.services.errorService.error(this.services.localizationService.get(a),"Gateways_SSOTestConnection_Failure",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()}),[3,4];case 4:return[2]}}))}))},a.prototype.setDisplayDetailedResults=function(e){this.displayDetailedResults=e},a.prototype.convertToErrorMessage=function(e){this.attachDatasourceName(e);e=n.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e,this.services.localizationService);return null!=e.message?e.message:""},a.prototype.getGatewayNameFromObjectId=function(e){return this.gatewayObjectIdToName[e]},a.prototype.gatewayUpgradeRequired=function(){var e=this.datasourceModel.gateway.staticCapabilities;return null!=e&&131072!=(131072&e)},a.prototype.disableStartTestButton=function(){return this.gatewayUpgradeRequired()||!(0<this.upn.length)||this.testStatus===i.Running},a.prototype.resetComponent=function(){this.testStatus=i.NoResults,this.upn="",this.displayDetailedResults=!1,this.dialogModel=new n.common.models.ModalDialogModel(!1,"",!0,this.services.localizationService,!1,!0),this.dialogModel.hideCancelButton=!0,this.buildGatewayObjectIdToNameDict()},a.prototype.buildGatewayObjectIdToNameDict=function(){this.gatewayObjectIdToName={};for(var e=0,t=this.datasourceModel.gatewayCluster.gateways;e<t.length;e++){var a=t[e];this.gatewayObjectIdToName[a.gatewayObjectId]=a.gatewayName}},a);function a(e,t){var a=this;this.attachDatasourceName=function(e){e&&e["pbi.error"]&&(null==(e=e["pbi.error"]).parameters&&(e.parameters=[]),_.isEmpty(e.parameters)&&(_.isArray(e.parameters)?e.parameters[0]={Key:"0",Value:a.datasourceModel.displayName}:e.parameters[0]=a.datasourceModel.displayName))},this.services=t}e.SSOTestConnectionController=t})((e=n.gateways||(n.gateways={})).controllers||(e.controllers={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).SSOTestConnection={templateUrl:"components/ssoTestConnection/ssoTestConnectionView.html",bindings:{datasourceModel:"<",singleSignOnType:"<"},controller:e.common.createController(t.controllers.SSOTestConnectionController)}})(powerbi=powerbi||{}),(function(i){!(function(e){var t;function a(e,t){}e=e.controllers||(e.controllers={}),t=i.common.contracts.gateway.GatewayStatus,a.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","featureSwitchService"]}},a.prototype.showPersonalGatewayFirstTimeInstallNow=function(){return!this.isCloudScheduleRefresh&&this.gatewayStatus===t.NotInstalled},a.prototype.showPersonalGatewayUpgradeRequired=function(){return!this.isCloudScheduleRefresh&&this.gatewayStatus!==t.NotInstalled&&"UpgradeRequired"===this.gatewayUpgradeState},e.PgwWarningBoxController=a})(i.gateways||(i.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).PgwWarningBox={templateUrl:"components/pgwWarningBox/pgwWarningBoxView.html",bindings:{isCloudScheduleRefresh:"<",gatewayStatus:"<",gatewayUpgradeState:"<",allowPersonalGateway:"<"},controller:e.common.createController(t.controllers.PgwWarningBoxController)}})(powerbi=powerbi||{}),(function(w){!(function(e){var g,r,u,y;function t(e,t){this.services=t,this.cachedDiscoverDatasourceResponse={monikers:[],gateways:[],datasources:[]}}e=e.controllers||(e.controllers={}),g=w.gateways.models.GatewayModelConverter,r=w.common.contracts.gateway.GatewayStatus,u=w.connectivity.models.GatewayStatus,y=w.common.contracts.gateway.GatewayType,t.createOptions=function(){return{additionalServices:["errorService","localizationService","selectGatewayService","gatewaysMetadataService","featureSwitchService","navigation","globalEventBridge","rdlDatasourceService","folderService"]}},t.prototype.$onInit=function(){var t=this,e=this.services.localizationService;this.viewModel.title=e.format("SettingsGateways_ConnectToServer",[this.viewModel.serverName]),this.viewModel.gatewayOnlineStatusLabel=e.format("BracketedValue",[this.services.localizationService.get("Gateways_Status_Online")]),this.viewModel.gatewayOfflineStatusLabel=e.format("BracketedValue",[this.services.localizationService.get("Gateways_Status_Offline")]),this.subscription=this.services.globalEventBridge.createChannelSubscriptionManager().subscribe(w.gateways.services.events.refreshGateways,(function(e){t.populateGatewayTable()})),this.populateGatewayTable(),this.getPersonalGatewayDatasourceLimit()},t.prototype.onDestroy=function(){this.subscription&&this.subscription.unsubscribeAll()},t.prototype.isSovereignCloud=function(){return this.services.featureSwitchService.featureSwitches.isSovereignCloud},t.prototype.showPersonalGatewayFirstTimeInstallNow=function(){var e;return!this.viewModel.isCloudScheduleRefresh&&(null===(e=null===(e=this.viewModel.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.NotInstalled},t.prototype.isGatewayInLiveState=function(){var e;return(null===(e=null===(e=this.viewModel.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.Live},t.prototype.isGatewayNotReachableOrInstalled=function(){var e;return(null===(e=null===(e=this.viewModel.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.NotReachable||(null===(e=null===(e=this.viewModel.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.Installed},t.prototype.isGatewayInstalled=function(){var e;return(null===(e=null===(e=this.viewModel.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)!==r.NotInstalled},t.prototype.getNotRequiredGWString=function(){switch(this.discoverDatasourceType){case 1:return"SettingsDataset_GatewayNotRequired_StaticInfo";case 2:return"SettingsDatapool_GatewayNotRequired_StaticInfo";case 3:return"SettingsReport_GatewayNotRequired_StaticInfo";default:return this.discoverDatasourceType,""}},t.prototype.convertGatewayClusterResultToGateways=function(e){return _.map(e,(function(e){for(var t={gatewayId:e.gatewayId,gatewayName:e.name,gatewayObjectId:e.objectId,gatewayDescription:e.description,gatewayPublicKey:e.publicKey,gatewayStatus:r.NotInstalled,gatewayAnnotation:e.annotation,allowableOptions:e.allowableOptions,gatewayType:e.type||y.Resource,versionStatus:e.versionStatus,expiryDate:e.expiryDate,permission:e.permission},a=0,i=e.gateways;a<i.length;a++){var n=i[a];if(n.isAnchorGateway){t.gatewayStatus=n.gatewayStatus;break}}return t}))},t.prototype.containsGatewayObjectId=function(e,t){return _.some(e,(function(e){return e.gatewayObjectId===t}))},t.prototype.getPersonalGatewayDatasourceLimit=function(){return __awaiter(this,void 0,w.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return t=this.viewModel,[4,this.services.gatewaysMetadataService.getUserDatasourceLimitStatus()];case 1:return t.personaGatewayDatasourceLimitStatus=e.sent(),[2]}}))}))},t.prototype.populateGatewayTableIncludeImproperlyConfigured=function(p){return __awaiter(this,void 0,w.Promise,(function(){var t,a,i,n,r,o,s,c,l,d,u=this;return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),[4,this.getDiscoverDatasourcesPromise()];case 1:return t=e.sent(),[4,this.filterCloudDatasourcesForRdlReports(t)];case 2:return(e.sent(),this.cachedDiscoverDatasourceResponse=t,l=this.viewModel,_.isEmpty(t.gateways)&&_.isEmpty(t.datasources))?(l.isCloudScheduleRefresh||this.loadPersonalGateway(),l.enterpriseGateways=[],d=this.convertGatewayClusterResultToGateways(p),l.improperlyConfiguredEnterpriseGateways=g.convertSettingsGateways(_.filter(d,(function(e){return e.gatewayType===y.Resource})),t.datasources),l.egwStatusLoaded=!0,l.useEnterpriseGateway=void 0,l.showGatewaysTable=!l.isCloudScheduleRefresh,this.updateGatewaysAreLoaded(l),[2]):(a=this.services.selectGatewayService.getAvailableGateways(t),c=this.convertGatewayClusterResultToGateways(p),(n=this.services.featureSwitchService.featureSwitches).gatewaysAdminCenterLink&&this.populatePermissions(a,c),i=_.filter(c,(function(e){return!u.containsGatewayObjectId(a,e.gatewayObjectId)})),s=n.showAllGateways,d=void 0,s&&(d=_(t.gateways).filter((function(e){return e.gatewayType===y.Resource})).differenceBy(a,"gatewayObjectId").differenceBy(i,"gatewayObjectId").value()),l.serverName=this.services.selectGatewayService.getServerName(t),c=n.gatewayVNets&&3===this.discoverDatasourceType&&n.gatewayVNetsRdl,r=n.gatewayVNets&&(1===this.discoverDatasourceType||c),c=!!this.services.folderService.activeFolder&&!!this.services.folderService.activeFolder.capacity,o=!1,l.enterpriseGateways=g.convertSettingsGateways(_.filter(a,(function(e){return o=o||e.gatewayType===y.VirtualNetwork,r?e.gatewayType===y.Resource||e.gatewayType===y.VirtualNetwork:e.gatewayType===y.Resource})),t.datasources,c),l.improperlyConfiguredEnterpriseGateways=g.convertSettingsGateways(_.filter(i,(function(e){return o=o||e.gatewayType===y.VirtualNetwork,r?e.gatewayType===y.Resource||e.gatewayType===y.VirtualNetwork:e.gatewayType===y.Resource})),t.datasources,c),s&&(s=g.convertSettingsGateways(d,t.datasources,c),_.map(s,(function(e){e.isUserNonAdmin=!0})),(d=l.improperlyConfiguredEnterpriseGateways).push.apply(d,s)),this.viewModel.showVNetWarning=r&&!c&&o,this.loadSelectedGateway(t),[4,this.loadDataSourcesStatus(t.datasources)]);case 3:return e.sent(),this.loadDmtsPlaceHolderPersonalGatewayObjectId(t),[4,this.loadPersonalGateway()];case 4:return e.sent(),l.egwStatusLoaded=!0,this.updateGatewaysAreLoaded(l),[3,6];case 5:return c=e.sent(),l=this.viewModel,c.error&&c.error.code===w.gateways.constants.ServerError_ModelHasNoPowerBIDMMoniker&&(l.isCloudScheduleRefresh||this.loadPersonalGateway(),l.enterpriseGateways=[],l.egwStatusLoaded=!0,l.useEnterpriseGateway=!1),this.updateGatewaysAreLoaded(l),[3,6];case 6:return[2]}}))}))},t.prototype.populatePermissions=function(e,a){for(var t=0,i=e;t<i.length;t++)!(function(t){var e=_.find(a,(function(e){return e.gatewayObjectId===t.gatewayObjectId}));e&&(t.permission=_.cloneDeep(e.permission))})(i[t])},t.prototype.filterCloudDatasourcesForRdlReports=function(n){return __awaiter(this,void 0,w.Promise,(function(){var t,a,i;return __generator(this,(function(e){switch(e.label){case 0:return 3===this.discoverDatasourceType&&this.services.featureSwitchService.featureSwitches.allowGatewayForRDLWithCloudDS?[4,this.services.rdlDatasourceService.getRdlReportDatasources(this.viewModel.modelObjectId)]:[3,2];case 1:t=e.sent(),a=new RegExp("(asazure://|pbiazure://|powerbi://|link://)","i"),i=_.filter(t,(function(e){return a.test(e.connectionString)})),n.monikers=_.filter(n.monikers,(function(t){return!_.some(i,(function(e){return e.dMMoniker===t.moniker}))})),e.label=2;case 2:return[2]}}))}))},t.prototype.updateGatewaysAreLoaded=function(e){this.gatewaysLoaded&&this.gatewaysLoaded({selectGatewayModel:e})},t.prototype.getDiscoverDatasourcesPromise=function(){var e;switch(this.discoverDatasourceType){case 1:e=this.services.gatewaysMetadataService.getModelDataSources(this.viewModel.modelId);break;case 2:e=this.services.gatewaysMetadataService.getDatapoolDataSources(this.viewModel.modelObjectId);break;case 3:e=this.services.gatewaysMetadataService.getRdlDataSources(this.viewModel.modelObjectId);break;default:this.discoverDatasourceType}return e},t.prototype.populateGatewayTable=function(){var t=this;this.services.featureSwitchService.featureSwitches.gatewaysAdminCenterLink?this.services.gatewaysMetadataService.getGatewayClustersWithRoleOptions().then((function(e){t.populateGatewayTableIncludeImproperlyConfigured(e)})):this.services.gatewaysMetadataService.getGatewayClusters().then((function(e){t.populateGatewayTableIncludeImproperlyConfigured(e)}))},t.prototype.loadDmtsPlaceHolderPersonalGatewayObjectId=function(e){e=_.find(e.gateways,(function(e){return e.gatewayType===y.Personal}));e&&(this.viewModel.dmtsPlaceHolderGatewayObjectId=e.gatewayObjectId)},t.prototype.loadPersonalGateway=function(){return __awaiter(this,void 0,w.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.services.gatewaysMetadataService.getPersonalGatewayAndGetStatus()];case 1:return t=e.sent(),this.viewModel.pgw=t,this.viewModel.pgwAnnotation=g.getGatewayAnnotationFromString(t.gatewayAnnotation),[2]}}))}))},t.prototype.loadDataSourcesStatus=function(n){return __awaiter(this,void 0,w.Promise,(function(){var t,a,i;return __generator(this,(function(e){switch(e.label){case 0:if(!this.viewModel.showStatus)return[3,4];t=0,a=this.viewModel.enterpriseGateways,e.label=1;case 1:return t<a.length?(i=a[t],[4,this.getDataSourcesStatus(i,n,this.services.gatewaysMetadataService)]):[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype.getDataSourcesStatus=function(c,l,d){return __awaiter(this,void 0,w.Promise,(function(){var t,a,i,n,r,o,s;return __generator(this,(function(e){switch(e.label){case 0:if(s=this.getDataSourceObjectIds(c.objectId,l),t=s.length,a=this.viewModel.cachedDatasourceStatusResponse,0===t)return c.status=u.NotReachable,[2];i=!0,c.status=u.Unknown,n=0,r=s,e.label=1;case 1:if(!(n<r.length))return[3,6];o=r[n],e.label=2;case 2:return e.trys.push([2,4,,5]),[4,d.getClusterDataSourceStatus(c.objectId,o)];case 3:return s=e.sent(),i&&(1===s.data.status?0===--t&&(c.status=u.Live):(i=!1,c.status=u.NotReachable)),a[c.objectId]||(a[c.objectId]=[]),a[c.objectId][o]=s.data,[3,5];case 4:return e.sent(),i&&(i=!1,c.status=u.NotReachable),[3,5];case 5:return n++,[3,1];case 6:return[2]}}))}))},t.prototype.getDataSourceObjectIds=function(t,e){return _.map(_.filter(e,(function(e){return e.gatewayObjectId===t})),(function(e){return e.dataSourceObjectId}))},t.prototype.loadSelectedGateway=function(r){return __awaiter(this,void 0,w.Promise,(function(){var t,a,i,n;return __generator(this,(function(e){switch(e.label){case 0:switch(t=this.services.selectGatewayService,a=t.getSelectedGateway(r),n=t.getSelectedGatewayType(a),i=this.viewModel,n=2===n&&!_.some(i.enterpriseGateways,(function(e){return e.objectId===a.gatewayObjectId}))?0:n){case 0:return[3,1];case 1:return[3,9];case 2:return[3,10]}return[3,11];case 1:if(!i.isCloudScheduleRefresh)return[3,7];if(n=_.find(r.gateways,(function(e){return e.gatewayType===y.Personal})),i.selectedGatewayObjectId=n&&n.gatewayObjectId,i.useEnterpriseGateway=!n&&void 0,i.useGateway=!1,i.egwAccessLost=t.isEGWAccessLost(r),!n)return[3,6];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.services.gatewaysMetadataService.bindModelToGateway(i.modelId,i.selectedGatewayObjectId)];case 3:return e.sent(),[3,5];case 4:return e.sent(),i.useGateway=!0,i.showGatewaysTable=!0,[3,5];case 5:this.services.globalEventBridge.publishToChannel(w.gateways.services.events.dataSourcesOnDatasetStaleArtifact),e.label=6;case 6:return[3,8];case 7:i.selectedGatewayObjectId=void 0,i.useEnterpriseGateway=void 0,i.useGateway=!0,i.egwAccessLost=this.services.selectGatewayService.isEGWAccessLost(r),e.label=8;case 8:return[3,11];case 9:return i.selectedGatewayObjectId=a.gatewayObjectId,i.useEnterpriseGateway=!1,i.useGateway=!i.isCloudScheduleRefresh,[3,11];case 10:i.selectedGatewayObjectId=a.gatewayObjectId,i.useEnterpriseGateway=!0,i.useGateway=!0,e.label=11;case 11:return i.isCloudScheduleRefresh?i.showGatewaysTable=!_.isEmpty(i.enterpriseGateways)||i.useGateway:i.showGatewaysTable=!0,[2]}}))}))},t.prototype.isToggleDisabled=function(){return this.viewModel.useGateway?!this.viewModel.isCloudScheduleRefresh:this.viewModel.isCloudScheduleRefresh?!this.viewModel.egwStatusLoaded||this.viewModel.enterpriseGateways&&0===this.viewModel.enterpriseGateways.length&&this.viewModel.improperlyConfiguredEnterpriseGateways&&0===this.viewModel.improperlyConfiguredEnterpriseGateways.length:this.viewModel.isDirectQuery?!this.viewModel.egwStatusLoaded||_.isEmpty(this.viewModel.enterpriseGateways):!this.isPgwOrEgwAvailable()},t.prototype.isPgwOrEgwAvailable=function(){var e,t=this.viewModel;return(null===(e=null===(e=t.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.Live||t.egwStatusLoaded&&0<t.enterpriseGateways.length},t.prototype.useDataGateway=function(){var e,t=this.viewModel;if(t.isCloudScheduleRefresh){if(_.isEmpty(t.enterpriseGateways))return void(t.showGatewaysTable=t.useGateway);t.useEnterpriseGateway=t.useGateway}else void 0===t.useEnterpriseGateway&&((null===(e=null===(e=t.pgw)||void 0===e?void 0:e.gatewayStatusJson)||void 0===e?void 0:e.gatewayStatus)===r.Live?t.useEnterpriseGateway=!1:t.egwStatusLoaded&&0<t.enterpriseGateways.length&&(t.useEnterpriseGateway=!0));this.services.featureSwitchService.featureSwitches.gatewayMultipleCredentials&&t.useEnterpriseGateway?this.viewModel.isDirty=!1:this.gatewayTypeSelected()},t.prototype.gatewayTypeSelected=function(){this.viewModel.selectedGatewayObjectId=this.viewModel.useEnterpriseGateway?this.viewModel.enterpriseGateways[0].objectId:this.viewModel.dmtsPlaceHolderGatewayObjectId,this.viewModel.isDirty=!0},t.prototype.enterpriseGatewaySelected=function(e){this.viewModel.useEnterpriseGateway=!0,this.viewModel.useGateway=!0,this.viewModel.selectedGatewayObjectId=e,this.viewModel.isDirty=!0},t.prototype.navigateToManageGateways=function(){this.services.navigation&&this.services.navigation.navigateToManageGateways(this.services.folderService.activeFolderObjectId)},t.prototype.deletePersonalGateway=function(){this.tryDeleteGateway(this.viewModel.pgw.gatewayObjectId)},t.prototype.tryDeleteGateway=function(e){var t=this,a=this.services.errorService.control(),i=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(i,function(){a.hideDialog(),t.services.gatewaysMetadataService.deleteGateway(e).then((function(){t.populateGatewayTable()}),(function(e){t.services.errorService.error(t.services.localizationService.get(w.ServiceErrorHelper.serverErrorPrefix+e.error.code),"Gateways_Error_FailedToDelete",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))}),new InJs.ModalDialogAction(n,function(){a.hideDialog()})],o=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Title"),i=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Message");a.showCustomDialog(o,$("<div></div>").text(i),r,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0)},e.SelectGatewayController=t})(w.gateways||(w.gateways={}))})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).SelectGateway={templateUrl:"components/selectGateway/selectGateway.html",bindings:{viewModel:"=",discoverDatasourceType:"<",gatewaysLoaded:"&"},controller:e.common.createController(t.controllers.SelectGatewayController)}})(powerbi=powerbi||{}),(function(n){!(function(e){var a=n.common.contracts.gateway.CredentialType;e.createCredentialParameterService=function(e,t){return new i(e,t)};var i=(t.prototype.create=function(e,t){if(null==t)return[];switch(t){case a.NotSpecified:case a.Anonymous:case a.EffectiveUserName:case a.OAuth2:case a.SingleSignOn:case a.WindowsWithoutImpersonation:return[];case a.Basic:switch(e){case"SAP":return this.createSapBasic();case"SAPBW":case"SAPBWMessageServer":return this.createSapBwBasic();case"ODBC":return this.createUsernamePassword(e,!1);default:return this.createUsernamePassword(e)}case a.Windows:switch(e){case"Spark":return this.createExtensionSparkWindows();case"SAP":return this.createSapBasic();case"SAPBW":case"SAPBWMessageServer":return this.createSapBwWindows();default:return this.createUsernamePassword(e)}case a.Key:return"AzureTable"!==e?this.createKey():this.createAzureTableKey();case a.SAS:return this.createSAS()}},t.prototype.convert=function(e){switch(e.dataSourceKind){case"SAP":return this.convertSap(e);case"SAPBW":case"SAPBWMessageServer":return this.convertSapBw(e)}for(var t=[],a=0,i=e.credentialParameters;a<i.length;a++){var n=i[a];"select"===n.type&&"default"===n.value.toLocaleLowerCase()||t.push({name:n.name,value:n.value})}return t},t.prototype.createSapBasic=function(){var e=[{type:"select",name:"SSLValidateServerCertificate",displayName:this.localizationService.get("SettingsDataSource_SettingsSslValidateServerCertificate"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"true",defaultValue:"true",options:[{Name:this.localizationService.get("Yes"),Value:"true"},{Name:this.localizationService.get("No"),Value:"false"}]},{type:"select",name:"SSLCryptoProvider",displayName:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.editableSettings.credentialParameters[0].value !== 'true'",required:"parameter.shouldDisplay && ctrl.viewModel.editableSettings.credentialParameters[0].value === 'true'",edited:!1,value:"mscrypto",defaultValue:"mscrypto",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_SapCrypto"),Value:"sapcrypto"},{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_CommonCrypto"),Value:"commoncrypto"},{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_MsCrypto"),Value:"mscrypto"}]},{type:"text",name:"SSLKeyStore",displayName:this.localizationService.get("Key_Store"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSslPlaceholder"),disabled:"ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.editableSettings.credentialParameters[0].value !== 'true' || ctrl.viewModel.editableSettings.credentialParameters[1].value === 'mscrypto'",required:"false",edited:!1},{type:"text",name:"SSLTrustStore",displayName:this.localizationService.get("Trust_Store"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSslPlaceholder"),disabled:"ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.editableSettings.credentialParameters[0].value !== 'true' || ctrl.viewModel.editableSettings.credentialParameters[1].value === 'mscrypto'",required:"false",edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},t.prototype.createExtensionSparkWindows=function(){var e=[{type:"text",name:"Realm",displayName:this.localizationService.get("Realm"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"text",name:"HostFQDN",displayName:this.localizationService.get("Host_FQDN"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"text",name:"ServiceName",displayName:this.localizationService.get("Service_Name"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},t.prototype.createSapBwBasic=function(){var e="ctrl.isSingleSignOnKerberosEnabled",t="ctrl.viewModel.editableSettings.credentialParameters[1].value",t=[{type:"text",name:"SNCPartnerName",displayName:this.localizationService.get("SettingsDataSource_SettingsSncPartnerName"),shouldDisplay:e,disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:e,edited:!1},{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelect"),shouldDisplay:e,disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:e,edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectSncLib"),Value:"default"},{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectNtlm"),Value:"NTLM"},{Name:this.localizationService.get("Custom"),Value:"custom"}]},{type:"text",name:"SNCLibraryCustom",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustom"),shouldDisplay:e,placeholder:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustomPlaceholder"),disabled:"ctrl.viewModel.waitingForDataSourceStatus || "+t+" !== 'custom'",required:"parameter.shouldDisplay && "+t+" === 'custom'",edited:!1}];return t.push.apply(t,this.createUsernamePassword()||[]),t},t.prototype.createSapBwWindows=function(){var e=[{type:"text",name:"SNCPartnerName",displayName:this.localizationService.get("SettingsDataSource_SettingsSncPartnerName"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelect"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectSncLib"),Value:"default"},{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectNtlm"),Value:"NTLM"},{Name:this.localizationService.get("Custom"),Value:"custom"}]},{type:"text",name:"SNCLibraryCustom",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustom"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustomPlaceholder"),disabled:"ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.editableSettings.credentialParameters[1].value !== 'custom'",required:"parameter.shouldDisplay && ctrl.viewModel.editableSettings.credentialParameters[1].value === 'custom'",edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},t.prototype.createUsernamePassword=function(e,t){return void 0===t&&(t=!0),[{type:"text",shouldDisplay:"true",name:"username",displayName:this.getUserNameLabel(e),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"password",shouldDisplay:"true",name:"password",displayName:this.getPasswordLabel(e),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:t?"parameter.shouldDisplay":"parameter.optional",edited:!1}]},t.prototype.createAzureTableKey=function(){var e=[{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsAuthenticationMethod"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsAuthenticationMethod_Key"),Value:"default"}]}];return e.push.apply(e,this.createKey()||[]),e},t.prototype.createKey=function(){return[{type:"text",shouldDisplay:"true",name:"key",displayName:this.localizationService.get("SettingsDataSource_SettingsAccountKey"),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}]},t.prototype.createSAS=function(){return[{type:"text",shouldDisplay:"true",name:"Token",displayName:this.localizationService.get("AuthDialog_FieldName_SAS"),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}]},t.prototype.getUserNameLabel=function(e){return"File"===e||"Folder"===e?this.localizationService.get("SettingsDataSource_SettingsWindowsUsername"):this.localizationService.get("SettingsDataSource_SettingsUsername")},t.prototype.getPasswordLabel=function(e){return"File"===e||"Folder"===e?this.localizationService.get("SettingsDataSource_SettingsWindowsPassword"):this.localizationService.get("SettingsDataSource_SettingsPassword")},t.prototype.convertSap=function(e){for(var t,a,i,n,r=[],o=0,s=e.credentialParameters;o<s.length;o++){var c=s[o];"SSLValidateServerCertificate"===c.name?t=c.value:"SSLCryptoProvider"===c.name?a=c.value:"SSLKeyStore"===c.name?i=c.value:"SSLTrustStore"===c.name?n=c.value:r.push({name:c.name,value:c.value})}if("true"===t)for(var l=0,d=[["SSLValidateServerCertificate",t],["SSLCryptoProvider",a],["SSLKeyStore",i],["SSLTrustStore",n]];l<d.length;l++){var u=d[l],p=u[0],u=u[1];u&&r.push({name:p,value:u})}return r},t.prototype.convertSapBw=function(e){for(var t,a,i="SNCLibrary",n=[],r=0,o=e.credentialParameters;r<o.length;r++){var s=o[r];"select"===s.type&&"default"===s.value.toLocaleLowerCase()||("SNCLibrarySelect"===s.name?t=s.value:"SNCLibraryCustom"===s.name?a=s.value:n.push({name:s.name,value:s.value}))}return"custom"===t&&a?n.push({name:i,value:a}):t&&n.push({name:i,value:t}),n},t);function t(e,t){this.localizationService=t}e.CredentialParameterService=i})(n.gateways||(n.gateways={}))})(powerbi=powerbi||{}),(function(e){(e=(e=(e=e.gateways||(e.gateways={})).services||(e.services={})).events||(e.events={})).dataSourcesOnDatasetStaleArtifact={name:"dataSourcesOnDatasetStaleArtifact",type:4},e.refreshGateways={name:"refreshGateways",type:4}})(powerbi=powerbi||{}),define("Gateways/services/gatewayDataService",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GatewayDataService=t.create=void 0;var d=powerbi.gateways.constants,u=powerbi.gateways.models,s=powerbi.common.EncryptionContext,c=powerbi.common.contracts.gateway.PrivacyLevel,l=powerbi.common.contracts.gateway.GatewayType;t.create=function(e,t,a,i,n){return new r(e,t,a,i,n)};var r=(a.prototype.getSelectedGatewayDataSource=function(){return this.selectedGatewayDatasource},a.prototype.setSelectedGatewayDataSource=function(e){this.selectedGatewayDatasource=e},a.prototype.getDecodedPublicKey=function(e){return atob(e).split(/<\/Modulus>|<Modulus>/)[1]},a.prototype.prepareCredentials=function(e,t,a,i,n){var r=this.promiseFactory.defer(),o={credentials:null,credentialType:a,encryptedConnection:this.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled?2:0,privacyLevel:c.Public,encryptionAlgorithm:null};return n&&n===l.VirtualNetwork?(o.credentials=JSON.stringify(e),o.encryptionAlgorithm="NONE",r.resolve(o)):s.create(JSON.stringify(e),t,i,(function(e){o.credentials=e,o.encryptionAlgorithm="RSA-OAEP",r.resolve(o)}),this.moduleLoader,this.promiseFactory).then((function(e){e.rsaEncrypt()})),r.promise},a.prototype.createDataSourceWithRetry=function(t,a,i,n,r){var o=this,s=this.promiseFactory.defer();return this.gatewaysMetadataService.createDataSource(t.objectId,a).then((function(e){s.resolve(e)}),(function(e){o.updateGatewayPublicKeyIfNeed(t,i,n,r,e).then((function(e){a.credentialDetails=e,o.gatewaysMetadataService.createDataSource(t.objectId,a).then((function(e){s.resolve(e)}),(function(e){s.reject(e)}))}),(function(){s.reject(e)}))})),s.promise},a.prototype.createClusterDataSourceWithRetry=function(t){var a=this,i=this.promiseFactory.defer();return this.createClusterDataSource(t).then((function(e){i.resolve(e)}),(function(e){e.error.code===d.PublishDatasourceToClusterErrorCode?a.getGatewayClusterIfUpdated(t.dataSourceModel).then((function(e){t.dataSourceModel.gatewayCluster=u.GatewayModelConverter.convertClusters(e,a.localizationService),a.createClusterDataSource(t).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))}),(function(){i.reject(e)})):i.reject(e)})),i.promise},a.prototype.createClusterDataSource=function(a){for(var t=this,i=this.promiseFactory.defer(),n=a.dataSourceModel.gatewayCluster,r={},o=[],s=this,e=0,c=n.gateways;e<c.length;e++)!(function(t){var e=s.getDecodedPublicKey(t.gatewayPublicKey);o.push(s.prepareCredentials(a.credentialData,e,a.credentialType,a.entropy,n.gatewayType).then((function(e){e.privacyLevel=a.privacyLevel,e.skipTestConnection=a.skipTestConnection,e.encryptedConnection=a.encryptedConnection,r[t.gatewayObjectId]=e})))})(c[e]);return this.promiseFactory.all(o).then((function(){var e={dataSourceName:a.dataSourceName,dataSourceType:a.dataSourceType,onPremGatewayRequired:!0,connectionDetails:a.connectionDetails,supportedAuthenticationTypes:null,singleSignOnType:a.singleSignOnType,credentialDetailsDictionary:r,mashupTestConnectionDetails:a.mashupTestConnectionDetails};t.gatewaysMetadataService.createDataSourceToCluster(n.objectId,e).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))})),i.promise},a.prototype.updateCredentialsWithRetry=function(t,a,i,n,r,o){var s=this,c=this.promiseFactory.defer();return this.gatewaysMetadataService.updateCredentials(t.objectId,a,r).then((function(){c.resolve(null)}),(function(e){s.updateGatewayPublicKeyIfNeed(t,i,n,o,e).then((function(e){e.privacyLevel=r.privacyLevel,e.skipTestConnection=r.skipTestConnection,e.encryptedConnection=r.encryptedConnection,s.gatewaysMetadataService.updateCredentials(t.objectId,a,e).then((function(){c.resolve(null)}),(function(e){c.reject(e)}))}),(function(){c.reject(e)}))})),c.promise},a.prototype.updateClusterCredentialsWithRetry=function(t,a,i,n,r,o,s){var c=this,l=this.promiseFactory.defer();return this.updateClusterCredentials(t,a,i,n,r,o,s).then((function(e){l.resolve(e)}),(function(e){e.error.code===d.UpdateClusterDatasourceCredentialsErrorCode?c.getGatewayClusterIfUpdated(t).then((function(e){t.gatewayCluster=u.GatewayModelConverter.convertClusters(e,c.localizationService),c.updateClusterCredentials(t,a,i,n,r,o,s).then((function(e){l.resolve(e)}),(function(e){l.reject(e)}))}),(function(){l.reject(e)})):l.reject(e)})),l.promise},a.prototype.updateClusterCredentials=function(t,a,i,n,r,o,s){for(var c=this,l=this.promiseFactory.defer(),d=t.gatewayCluster,u={},p=[],g=this,e=0,y=d.gateways;e<y.length;e++)!(function(t){var e=g.getDecodedPublicKey(t.gatewayPublicKey);p.push(g.prepareCredentials(n,e,r,s,d.gatewayType).then((function(e){e.privacyLevel=a,e.skipTestConnection=o,e.encryptedConnection=i,u[t.gatewayObjectId]=e})))})(y[e]);return this.promiseFactory.all(p).then((function(){var e={gatewayObjectIdToCredentialDetailsDictionary:u};c.gatewaysMetadataService.updateClusterCredentials(d.objectId,t.objectId,e).then((function(e){l.resolve(e)}),(function(e){l.reject(e)}))})),l.promise},a.prototype.updateGatewayPublicKeyIfNeed=function(t,a,i,n,e){var r,o=this,s=this.promiseFactory.defer(),e=powerbi.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,this.localizationService);return e&&e.displayableErrorInfo&&(r=this.localizationService.get("ServerError_DM_ErrorDetailNameCode_UnderlyingErrorMessage"),_.filter(e.displayableErrorInfo,(function(e){return e.errorInfoKey===r}))&&this.gatewaysMetadataService.getGateways().then((function(e){e=_.filter(e,(function(e){return e.gatewayObjectId===t.objectId&&t.publicKey!==e.gatewayPublicKey}));_.isEmpty(e)?s.reject():(t.publicKey=e[0].gatewayPublicKey,e=o.getDecodedPublicKey(t.publicKey),o.prepareCredentials(a,e,i,n).then((function(e){s.resolve(e)}),(function(){s.reject()})))}),(function(){s.reject()}))),s.promise},a.prototype.getGatewayClusterIfUpdated=function(a){var t=this.promiseFactory.defer();return this.gatewaysMetadataService.getGatewayClusters().then((function(e){e=_.find(e,(function(e){return e.objectId===a.gatewayCluster.objectId}));e&&_.find(e.gateways,(function(t){var e=_.find(a.gatewayCluster.gateways,(function(e){return e.gatewayObjectId===t.gatewayObjectId}));return!e||e.gatewayPublicKey!==t.gatewayPublicKey}))?t.resolve(e):t.reject()}),(function(){t.reject()})),t.promise},a);function a(e,t,a,i,n){this.featureSwitchService=e,this.gatewaysMetadataService=t,this.localizationService=a,this.moduleLoader=i,this.promiseFactory=n}t.GatewayDataService=r})),(function(e){(e=(e=e.gateways||(e.gateways={})).services||(e.services={})).gatewayObjectIdParamName="gatewayObjectId",e.dataSourceObjectIdParamName="dataSourceObjectId"})(powerbi=powerbi||{}),(function(e){!(function(e){e.createGatewayRedirectService=function(){return new t};var t=(a.prototype.setCreateDatasourceParameters=function(e){this.createDatasourceParameters=e},a.prototype.getAndResetCreateDatasourceParameters=function(){var e=this.createDatasourceParameters;return this.createDatasourceParameters=null,e},a.prototype.setOpenGatewaySettingsParameters=function(e){this.openGatewaySettingsParameters=e},a.prototype.getAndResetOpenGatewaySettingsParameters=function(){var e=this.openGatewaySettingsParameters;return this.openGatewaySettingsParameters=null,e},a.prototype.getCreateConnectionParameters=function(){var e=jsCommon.QueryStringUtil.parseUrl(window.location.href);if("createConnection"===e.redirect&&e.connectionTypes&&0<e.connectionTypes.length)return{connectionTypes:e.connectionTypes.split(",")}},a.prototype.getEditConnectionParameters=function(){var e=jsCommon.QueryStringUtil.parseUrl(window.location.href);if("editConnection"===e.redirect&&e.connectionId&&0<e.connectionId.length)return{connectionId:e.connectionId}},a);function a(){}e.GatewayRedirectService=t})(e.gateways||(e.gateways={}))})(powerbi=powerbi||{}),(function(e){!(function(e){e.createDatasourceService=function(){return new t};var t=(a.prototype.getAndResetConnectionInfo=function(){var e=this.connectionInfo;return this.connectionInfo=null,e},a.prototype.getAndResetDataSourceType=function(){var e=this.dataSourceType;return this.dataSourceType=null,e},a.prototype.getAndResetLastUpdatedDatasource=function(){var e=this.lastUpdatedDatasource;return this.lastUpdatedDatasource=null,e},a.prototype.setConnectionInfo=function(e){this.connectionInfo=e},a.prototype.setDataSourceType=function(e){this.dataSourceType=e},a.prototype.setLastUpdatedDatasource=function(e,t){this.lastUpdatedDatasource={settingsGroup:e,settingsId:t}},a);function a(){}e.DatasourceService=t})(e.gateways||(e.gateways={}))})(powerbi=powerbi||{}),(function(e){!(function(r){var l=e.common.contracts.gateway.DataSourceType,d=e.common.contracts.gateway.GatewayType,u=jsCommon.JsonExtensions;r.createSelectGatewayService=function(e,t,a,i,n,r){return new o(e,t,a,i,n,r)};var o=(s.prototype.bindModelToGateway=function(t,a,i,e){var n=this;this.showDialog(t,(function(e){return n.bindModel(t,e,a,i)}),e)},s.prototype.bindModel=function(e,t,a,i){this.gatewaysMetadataService.bindModelToGateway(e,t).then((function(){a()}),(function(){i()}))},s.prototype.getAvailableGateways=function(o){var s=this;if(0===o.monikers.length)return[];var e=_.filter(o.monikers,(function(e){return(!_.some(e.monikerGateways,(function(e){return!e.onPremGatewayRequired}))||0===e.monikerGateways.length)&&0!==e.monikerDataSources.length}));!this.featureSwitchService.featureSwitches.undoGetAvailableGatewayCloudDS&&0!==e.length||(e=_.filter(o.monikers,(function(e){return _.some(e.monikerGateways,(function(e){return e.onPremGatewayRequired}))||0===e.monikerGateways.length&&0!==e.monikerDataSources.length})));var c=_.filter(o.monikers,(function(e){return 1<e.monikerDataSources.length})),e=_.map(e,(function(e){return _.map(_.filter(e.monikerGateways,(function(e){return e.onPremGatewayRequired})),(function(e){return e.gatewayObjectId}))})),t=_.intersection.apply(_,e),e=_.filter(o.gateways,(function(e){return-1!==t.indexOf(e.gatewayObjectId)&&(e.gatewayPublicKey||e.gatewayType===d.VirtualNetwork)})),l=[];if(0<c.length){for(var a=0,i=e;a<i.length;a++)!(function(t){if(t.gatewayType!==d.Personal)for(var e=_.filter(o.datasources,(function(e){return e.gatewayObjectId===t.gatewayObjectId})),a=0,i=c;a<i.length;a++){var n=i[a],r=_.filter(n.monikerDataSources,(function(t){return 0===_.filter(e,(function(e){return s.MatchDatasourceWithMonikerDatasource(e,t)})).length})),n=1==(1&t.allowableOptions);if(0<r.length&&!n){l.push(t.gatewayObjectId);break}}})(i[a]);e=_.filter(e,(function(e){return-1===l.indexOf(e.gatewayObjectId)}))}return e},s.prototype.MatchDatasourceWithMonikerDatasource=function(e,t){if(this.isDataSourceModel(e)){var a={dsType:e.dataSourceType,dsConn:e.connectionInfo.connectionDetails,dsObjId:e.objectId,mdsType:t.dataSourceType,mdsConn:t.connectionDetails,mdsObjId:t.matchingDataSourceObjectIds,dsKey:e.key};return this.MatchDatasourceWithMonikerDatasourceInternal(a)}a={dsType:e.dataSourceType,dsConn:e.connectionDetails,dsObjId:e.dataSourceObjectId,mdsType:t.dataSourceType,mdsConn:t.connectionDetails,mdsObjId:t.matchingDataSourceObjectIds,dsKey:e.key};return this.MatchDatasourceWithMonikerDatasourceInternal(a)},s.prototype.isDataSourceModel=function(e){return e.connectionInfo&&void 0!==e.connectionInfo.connectionDetails},s.prototype.MatchDatasourceWithMonikerDatasourceInternal=function(e){var t=e.dsType,a=e.mdsType,i=e.dsConn,n=e.mdsConn,r=e.dsKey,o=e.dsObjId,s=e.mdsObjId;if(t===a&&i.toLowerCase()===n.toLowerCase())return!0;if(t===l.Folder&&a===l.File||t===l.Folder&&a===l.Folder)return this.IsPartialMatch(u.tryParseJSON(n).path,u.tryParseJSON(i).path);if(t===l.Web&&a===l.Web||t===l.OData&&a===l.OData){var c=!1,e=u.tryParseJSON(n).url;return(c=r?this.IsPartialMatch(e,u.tryParseJSON(r).url):c)||this.IsPartialMatch(e,u.tryParseJSON(i).url)}return t===l.SharePoint&&a===l.SharePoint?this.IsPartialMatch(u.tryParseJSON(n).sharePointSiteUrl,u.tryParseJSON(i).sharePointSiteUrl):(t===l.ODBC&&a===l.ODBC||t===l.OleDb&&a===l.OleDb||a===l.SqlServer||a===l.Oracle)&&(!(!s||!o||0===s.length)&&_.some(s,(function(e){return e===o})))},s.prototype.IsPartialMatch=function(e,t){return _.includes(this.NormalizePath(e),this.NormalizePath(t))},s.prototype.NormalizePath=function(e){return _.trimEnd(e,"/").toLowerCase()},s.prototype.getServerName=function(e){if(0===e.monikers.length)return null;if(0===e.monikers[0].monikerDataSources.length)return null;try{return JSON.parse(e.monikers[0].monikerDataSources[0].connectionDetails).server}catch(e){return null}},s.prototype.getSelectedGateway=function(a){for(var i=[],n=!1,e=0,t=a.monikers;e<t.length;e++){var r=(function(e){if(0===e.monikerDataSources.length)return"continue";var t=_.map(e.monikerDataSources,(function(e){return e.dataSourceObjectId}));if(!_.every(t))return{value:void 0};e=_.filter(a.datasources,(function(e){return-1<t.indexOf(e.dataSourceObjectId)}));return 0===e.length?{value:void 0}:_.find(e,(function(e){return e.onPremGatewayRequired}))?(n=!0,void(i=i.concat(t))):"continue"})(t[e]);if("object"==typeof r)return r.value}if(0===i.length&&!n)return _.find(a.gateways,(function(e){return e.gatewayType===d.Personal}));var o=_.filter(a.datasources,(function(e){return-1<i.indexOf(e.dataSourceObjectId)&&e.onPremGatewayRequired})),o=_.map(o,(function(e){return e.gatewayObjectId})),s=_.uniq(o);return 1===s.length?_.find(a.gateways,(function(e){return s[0]===e.gatewayObjectId})):void 0},s.prototype.isEGWAccessLost=function(e){for(var t=[],a=0,i=e.monikers;a<i.length;a++){var n=i[a],n=_.map(n.monikerDataSources,(function(e){return e.dataSourceObjectId}));if(!_.every(n,(function(e){return e})))return!1;t.push.apply(t,n||[])}for(var r=0,o=t;r<o.length;r++){var s=o[r];if(!_.find(e.datasources,(function(e){return e.dataSourceObjectId===s})))return!0}return!1},s.prototype.getSelectedGatewayType=function(e){return e?_.isEmpty(e.gatewayName)?1:2:0},s.prototype.showDialog=function(e,t,a){var i=new r.models.SelectGatewayModel(e,!0,!1,!1),e=this.rootScope.$new();e.viewModel=i;var e={dialogName:null,isDismissable:!0,scope:e,template:s.htmlTemplate,focusOnFirstButton:!0,dialogCssClass:"gatewaysDialog",dialogActions:[new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Connect"),function(){t(i.selectedGatewayObjectId),n.then((function(e){return e.closeDialog()}))}),new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Cancel"),function(){a(),n.then((function(e){return e.closeDialog()}))})]},n=this.modalDialogService.showLegacyWebModalDialog(e)},s.htmlTemplate="<select-gateway view-model='viewModel' discover-datasource-type="+(s.discoverDatasetType=1)+"></select-gateway>",s);function s(e,t,a,i,n,r){this.rootScope=e,this.gatewaysMetadataService=a,this.modalDialogService=i,this.localizationService=n,this.featureSwitchService=r}r.SelectGatewayService=o})(e.gateways||(e.gateways={}))})(powerbi=powerbi||{}),(function(s){!(function(o){var e=s.gateways.htmlTemplate.put;function t(){i||(s.common.initializeAngularModule(),s.connectivity.initializeAngularModule(),angular.module("powerbi.gateways.directives",[]),angular.module("powerbi.gateways.components",[]),angular.module("powerbi.gateways.controllers",[]),angular.module("powerbi.gateways",["powerbi.common","powerbi.connectivity","powerbi.gateways.directives","powerbi.gateways.controllers","powerbi.gateways.components"]).factory("credentialParameterService",["featureSwitchService","localizationService",function(e,t){return o.createCredentialParameterService(e,t)}]).factory("selectGatewayService",["$rootScope","$compile","gatewaysMetadataService","modalDialogService","localizationService","featureSwitchService",function(e,t,a,i,n,r){return o.createSelectGatewayService(e,t,a,i,n,r)}]).factory("gatewaysMetadataHttpService",["httpService",function(e){return s.connectivity.createGatewaysMetadataHttpService(e)}]).factory("gatewaysMetadataService",["promiseFactory","gatewaysMetadataHttpService","telemetryService","featureSwitchService","localizationService","httpService",function(e,t,a,i,n,r){return s.connectivity.createGatewaysMetadataService(e,t,a,i,n,r)}]).factory("datasourceService",[function(){return o.createDatasourceService()}]).factory("gatewayRedirectService",[function(){return o.createGatewayRedirectService()}]).factory("gatewayMsalService",["httpService","accessTokenProviderService",function(e,t){return o.createGatewayMsalService(e,t)}]).config(["lazyProvider",function(e){e.factories.gatewayDataService={source:{javascript:"Gateways/services/gatewayDataService"},ng:["featureSwitchService","gatewaysMetadataService","localizationService","moduleLoader","promiseFactory"],fn:function(e,t,a,i,n,r){return e.create(t,a,i,n,r)}}}]).run(["$templateCache",e]),a(8),i=!0,window.gatewaysModuleDefined=!0)}function a(e){var t;i||(t=[{name:"Gateways",dependencies:["featureSwitchService"],blockType:1,consumerHostFlags:8,factory:s.gateways.directives.Gateways},{name:"Gateway",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.Gateway},{name:"GatewaySettings",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.GatewaySettings},{name:"GatewayAdministrators",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.GatewayAdministrators},{name:"IgnoreDirty",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.IgnoreDirty},{name:"DatasourceUsers",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.DatasourceUsers},{name:"Datasource",blockType:1,consumerHostFlags:8,factory:s.gateways.directives.Datasource},{name:"DatasourceSettings",blockType:2,consumerHostFlags:8,factory:s.gateways.components.DatasourceSettings},{name:"GatewaysTable",blockType:2,consumerHostFlags:8,factory:s.gateways.components.GatewaysTable},{name:"GatewaysTableDatasources",blockType:2,consumerHostFlags:8,factory:s.gateways.components.GatewaysTableDatasources},{name:"PgwWarningBox",blockType:2,consumerHostFlags:8,factory:s.gateways.components.PgwWarningBox},{name:"SelectGateway",blockType:2,consumerHostFlags:8,factory:s.gateways.components.SelectGateway},{name:"SSOTestConnection",blockType:2,consumerHostFlags:8,factory:s.gateways.components.SSOTestConnection},{name:"UpnMappingPane",blockType:2,consumerHostFlags:8,factory:s.gateways.components.UpnMappingPane}],s.common.registerBuildingBlocksForHost(e,t,{directivesTarget:"powerbi.gateways.directives",componentsTarget:"powerbi.gateways.components"}))}o.initializeAngularModule=t,o.registerBuildingBlocksForHost=a;var i=!1;t()})(s.gateways||(s.gateways={}))})(powerbi=powerbi||{}),(function(o){!(function(e){var r=window;e.createGatewayMsalService=function(e,t){return new a(e,t)};var a=(t.prototype.acquireAccessToken=function(a,i){return __awaiter(this,void 0,o.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:if(0===(null==i?void 0:i.length))throw new Error("Invalid scopes");return t=_.map(i,(function(e){return a+"/"+e})),[4,this.acquireAccessTokenInternal(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.acquireAccessTokenInternal=function(n){return __awaiter(this,void 0,o.Promise,(function(){var t,a,i;return __generator(this,(function(e){switch(e.label){case 0:return r.clientAuthEnabled?[4,this.acquireAccessTokenInternalFromAccessTokenProvider(n)]:[3,2];case 1:return[2,{token:(i=e.sent()).token,expiry:i.expiry.toISOString()}];case 2:return t=n.join(","),(a=this.cachedAccessTokens[t])&&new Date(a.expiry).getTime()>Date.now()+3e5?[2,a]:[3,3];case 3:return[4,this.acquireAccessTokenInternalFromProxy(n)];case 4:return i=e.sent(),this.cachedAccessTokens[t]={token:i.data.AccessToken,expiry:i.data.ExpiresOn},[2,this.cachedAccessTokens[t]]}}))}))},t.prototype.acquireAccessTokenInternalFromProxy=function(e){var t=this.httpService.powerbiRequestOptions();return t.params={scopes:e.join(",")},this.httpService.get(jsCommon.StringExtensions.format("{0}/msal",this.getFrontEndUrl()),t)},t.prototype.acquireAccessTokenInternalFromAccessTokenProvider=function(e){return this.accessTokenProviderService.acquireToken("Gateway",e)},t.prototype.getFrontEndUrl=function(){return r.baseUrl||window.location.origin},t);function t(e,t){this.httpService=e,this.accessTokenProviderService=t,this.cachedAccessTokens={}}e.GatewayMsalService=a})(o.gateways||(o.gateways={}))})(powerbi=powerbi||{});;
"use strict";var powerbi;!(function(t){((t=t.userNotifications||(t.userNotifications={})).constants||(t.constants={})).userNotificationsInfoService="userNotificationsInfoService"})(powerbi=powerbi||{}),(function(r){!(function(){function t(){i||(angular.module("powerbi.userNotifications",[]).factory("userNotificationHttp",["httpService",function(t){return r.userNotifications.createUserNotificationHttpService(t)}]).factory("legacyUserNotificationInfo",["userNotificationHttp","promiseFactory","telemetryService","$interval","syncService","profileImageService","$timeout",function(t,i,e,o,s,n,a){return r.userNotifications.createUserNotificationInfoService({userNotificationHttpService:t,promiseFactory:i,telemetryService:e,intervalService:o,syncService:s,profileImageService:n,timeout:a},!0)}]),i=!0,window.userNotificationsModuleDefined=!0)}(r.userNotifications||(r.userNotifications={})).initializeAngularModule=t;var i=!1;t()})()})(powerbi=powerbi||{}),(function(t){var i;i=t.userNotifications||(t.userNotifications={}),(i=(t=i.contracts||(i.contracts={})).NotificationCategory||(t.NotificationCategory={}))[i.NewFeatureProductMessage=0]="NewFeatureProductMessage",i[i.DashboardSharing=2]="DashboardSharing",i[i.DashboardAddedToGroup=3]="DashboardAddedToGroup",i[i.Trial=5]="Trial",i[i.DataDrivenAlert=6]="DataDrivenAlert",i[i.AccessRequest=14]="AccessRequest",i[i.TemplateAppsUpdateAvailable=29]="TemplateAppsUpdateAvailable",i[i.CapacityOverloaded=34]="CapacityOverloaded",i[i.CapacityAutoScaled=35]="CapacityAutoScaled",i[i.CapacityAutoScaleMaximumReached=36]="CapacityAutoScaleMaximumReached",i[i.TeamsAppInstallation=42]="TeamsAppInstallation",i[i.DynamicMessage=999]="DynamicMessage",(t=t.NotificationResource||(t.NotificationResource={}))[t.DashboardContentPackNewVersion=0]="DashboardContentPackNewVersion",t[t.UsersNotifications_SharedDashboard=1]="UsersNotifications_SharedDashboard",t[t.ExtendTrial_TrialExpired=2]="ExtendTrial_TrialExpired",t[t.UsersNotifications_TrialRunsOutInLessThanADay=3]="UsersNotifications_TrialRunsOutInLessThanADay",t[t.UsersNotifications_TrialRunningOut=4]="UsersNotifications_TrialRunningOut",t[t.UsersNotifications_TitleTrialExpired=5]="UsersNotifications_TitleTrialExpired",t[t.UsersNotifications_UserName=6]="UsersNotifications_UserName",t[t.UsersNotifications_GoToApp=7]="UsersNotifications_GoToApp",t[t.UsersNotifications_GoToDashboard=8]="UsersNotifications_GoToDashboard",t[t.UsersNotifications_TrialRunsOutInOneDay=9]="UsersNotifications_TrialRunsOutInOneDay",t[t.UsersNotifications_TitleTrialRunsOutInOneDay=10]="UsersNotifications_TitleTrialRunsOutInOneDay",t[t.UsersNotifications_TitleTrialRunsOutInLessThanADay=11]="UsersNotifications_TitleTrialRunsOutInLessThanADay",t[t.UsersNotifications_TitleTrialRunningOut=12]="UsersNotifications_TitleTrialRunningOut",t[t.UsersNotifications_RequestExtensionLinkText=13]="UsersNotifications_RequestExtensionLinkText",t[t.UsersNotifications_DataDrivenAlert=14]="UsersNotifications_DataDrivenAlert",t[t.UsersNotifications_GroupName=15]="UsersNotifications_GroupName",t[t.UsersNotifications_NewDashboard=16]="UsersNotifications_NewDashboard",t[t.UsersNotifications_TileName=17]="UsersNotifications_TileName",t[t.UsersNotifications_DataDrivenDown=18]="UsersNotifications_DataDrivenDown",t[t.UsersNotifications_DataDrivenUp=19]="UsersNotifications_DataDrivenUp",t[t.UsersNotifications_GoToTile=20]="UsersNotifications_GoToTile",t[t.UsersNotifications_DatasetSettingChangeTitle=21]="UsersNotifications_DatasetSettingChangeTitle",t[t.UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage=22]="UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage",t[t.UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage=23]="UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage",t[t.Generic_LearnMore=24]="Generic_LearnMore",t[t.UsersNotifications_Upgrade=25]="UsersNotifications_Upgrade",t[t.UsersNotifications_GoToConversation=27]="UsersNotifications_GoToConversation",t[t.UsersNotifications_AtMentionedInComment=28]="UsersNotifications_AtMentionedInComment",t[t.FolderNotifications_ServiceAppsUpdateAvailable=29]="FolderNotifications_ServiceAppsUpdateAvailable",t[t.FolderNotifications_GetServiceAppUpdate=30]="FolderNotifications_GetServiceAppUpdate",t[t.UsersNotifications_FeaturedContentEnabledTitle=31]="UsersNotifications_FeaturedContentEnabledTitle",t[t.UsersNotifications_FeaturedContentEnabledMessage=32]="UsersNotifications_FeaturedContentEnabledMessage",t[t.UsersNotifications_GoToAdminPortal=33]="UsersNotifications_GoToAdminPortal",t[t.UsersNotifications_GoToAdminPortalCapacity=34]="UsersNotifications_GoToAdminPortalCapacity",t[t.UsersNotifications_M365TenantSettingTitle=35]="UsersNotifications_M365TenantSettingTitle",t[t.UsersNotifications_M365TenantSettingMessage=36]="UsersNotifications_M365TenantSettingMessage",t[t.UsersNotifications_GoToReportAccess=37]="UsersNotifications_GoToReportAccess",t[t.UsersNotifications_RequestedAccess=38]="UsersNotifications_RequestedAccess",t[t.UsersNotifications_AlertTitle=1e3]="UsersNotifications_AlertTitle",t[t.UsersNotifications_AlertExceeded=1001]="UsersNotifications_AlertExceeded",t[t.UsersNotifications_AlertWentBelow=1002]="UsersNotifications_AlertWentBelow",t[t.UsersNotifications_AlertAction=1003]="UsersNotifications_AlertAction",t[t.UsersNotifications_AlertExceededNoTileName=1004]="UsersNotifications_AlertExceededNoTileName",t[t.UsersNotifications_AlertWentBelowNoTileName=1005]="UsersNotifications_AlertWentBelowNoTileName",t[t.UsersNotifications_LineChartAnomalyAlert_DatetimeMultiple=1200]="UsersNotifications_LineChartAnomalyAlert_DatetimeMultiple",t[t.UsersNotifications_LineChartAnomalyAlert_DatetimeSingle=1201]="UsersNotifications_LineChartAnomalyAlert_DatetimeSingle",t[t.UsersNotifications_LineChartAnomalyAlert_OtherMultiple=1202]="UsersNotifications_LineChartAnomalyAlert_OtherMultiple",t[t.UsersNotifications_LineChartAnomalyAlert_OtherSingle=1203]="UsersNotifications_LineChartAnomalyAlert_OtherSingle",t[t.UsersNotifications_LineChartThreshold_DatetimeMultiple_AlertExceeded=1204]="UsersNotifications_LineChartThreshold_DatetimeMultiple_AlertExceeded",t[t.UsersNotifications_LineChartThreshold_DatetimeMultiple_AlertWentBelow=1205]="UsersNotifications_LineChartThreshold_DatetimeMultiple_AlertWentBelow",t[t.UsersNotifications_LineChartThreshold_DatetimeSingle_AlertExceeded=1206]="UsersNotifications_LineChartThreshold_DatetimeSingle_AlertExceeded",t[t.UsersNotifications_LineChartThreshold_DatetimeSingle_AlertWentBelow=1207]="UsersNotifications_LineChartThreshold_DatetimeSingle_AlertWentBelow",t[t.UsersNotifications_LineChartThreshold_OtherMultiple_AlertExceeded=1208]="UsersNotifications_LineChartThreshold_OtherMultiple_AlertExceeded",t[t.UsersNotifications_LineChartThreshold_OtherMultiple_AlertWentBelow=1209]="UsersNotifications_LineChartThreshold_OtherMultiple_AlertWentBelow",t[t.UsersNotifications_LineChartThreshold_OtherSingle_AlertExceeded=1210]="UsersNotifications_LineChartThreshold_OtherSingle_AlertExceeded",t[t.UsersNotifications_LineChartThreshold_OtherSingle_AlertWentBelow=1211]="UsersNotifications_LineChartThreshold_OtherSingle_AlertWentBelow",t[t.UsersNotifications_CapacityAutoscaled_Title=2e3]="UsersNotifications_CapacityAutoscaled_Title",t[t.UsersNotifications_CapacityAutoscaled=2001]="UsersNotifications_CapacityAutoscaled",t[t.UsersNotifications_CapacityThrottled_Title=2002]="UsersNotifications_CapacityThrottled_Title",t[t.UsersNotifications_CapacityThrottled=2003]="UsersNotifications_CapacityThrottled",t[t.UsersNotifications_TeamsAppInstallationSuccess=2101]="UsersNotifications_TeamsAppInstallationSuccess",t[t.UsersNotifications_TeamsAppInstallationOpen=2102]="UsersNotifications_TeamsAppInstallationOpen"})(powerbi=powerbi||{}),(function(e){!(function(){(e.userNotifications||(e.userNotifications={})).createUserNotificationHttpService=function(t){return new i(t)};var i=(t.prototype.getActiveNotification=function(t,i,e){t=this.httpService.powerbiRequestOptions(t,"LoadMoreNotifications"),i="metadata/notifications?take="+i;return this.httpService.get(i=e?i+"&skip="+e:i,t)},t.prototype.getActiveNotificationSummary=function(t,i){t=this.httpService.powerbiRequestOptions(t,"GetUserNotificationsSummary");return this.httpService.get("metadata/notifications/summary?take="+i,t)},t.prototype.updateNotificationStatus=function(t,i,e){e=e?this.httpService.powerbiRequestOptions(e,"UpdateUserNotificationsStatus"):this.httpService.powerbiRequestOptions();return this.httpService.put("metadata/notifications/"+t+"/action/"+i,null,e)},t.prototype.markNotificationsSeen=function(t,i){i=i?this.httpService.powerbiRequestOptions(i,"UpdateUserNotificationsStatus"):this.httpService.powerbiRequestOptions();return this.httpService.put("metadata/notifications/action/3/collections",{ids:t},i)},t);function t(t){this.httpService=t}})()})(powerbi=powerbi||{}),(function(n){!(function(){var o;(n.userNotifications||(n.userNotifications={})).createUserNotificationInfoService=function(t,i,e){return o=o||new s(t,i,e)};var s=(t.prototype.getNextPageData=function(t){var i=this;t=t||100;var e=this.services.telemetryService.startEvent(n.telemetry.UserNotificationsLoadMoreNotifications),o=this.userNotifications.notifications[this.userNotifications.notifications.length-1].id;this.services.userNotificationHttpService.getActiveNotification(e.event,t,o).then((function(t){i.userNotifications.notifications=i.userNotifications.notifications.concat(i.filterNotSupportedNotifications(t.data)),i.notifyNotificationsUpdated(),e.resolve()}),(function(t){e.reject()}))},t.prototype.registerNotificationsUpdatedListener=function(i){var e=this;return this.notificationsUpdatedListeners.push(i),new n.Promise(function(t){return t((function(){return e.unregisterNotificationsUpdatedListener(i)}))})},t.prototype.unregisterNotificationsUpdatedListener=function(t){_.pull(this.notificationsUpdatedListeners,t)},t.prototype.updateLastSeenDate=function(){var t,i;this.userNotifications&&(this.userNotifications.unseenCount=0,i=(t=this.getLatestNotificationForServer())&&!t.seen,this.userNotifications.notifications.forEach((function(t){t.seen=!0})),this.notifyNotificationsUpdated(),i&&this.services.userNotificationHttpService.updateNotificationStatus(t.id,2).then((function(t){}),(function(t){})))},t.prototype.updateSeenNotifications=function(i){this.userNotifications&&(this.userNotifications.unseenCount-=i.length,this.userNotifications.notifications.forEach((function(t){_.includes(i,t.id)&&(t.seen=!0)})),this.notifyNotificationsUpdated(),this.services.userNotificationHttpService.markNotificationsSeen(i))},t.prototype.dismissNotification=function(i,t){var e;this.userNotifications.totalCount=this.userNotifications.totalCount-1,this.userNotifications.notifications=_.filter(this.userNotifications.notifications,(function(t){return t.id!==i.id})),i.seen||(this.userNotifications.unseenCount=this.userNotifications.unseenCount-1),this.notifyNotificationsUpdated(),!t&&0<i.id&&(e=this.services.telemetryService.startEvent(n.telemetry.UserNotificationsDismissNotification),this.services.userNotificationHttpService.updateNotificationStatus(i.id,1,e.event).then((function(t){e.resolve()}),(function(t){e.reject()})))},t.prototype.dismissAll=function(){var t,i;this.userNotifications&&0<this.userNotifications.notifications.length&&(t=this.getLatestNotificationForServer(),this.userNotifications.totalCount=0,this.userNotifications.unseenCount=0,this.userNotifications.notifications=[],this.notifyNotificationsUpdated(),t&&(i=this.services.telemetryService.startEvent(n.telemetry.UserNotificationsDismissAllNotifications),this.services.userNotificationHttpService.updateNotificationStatus(t.id,0,i.event).then((function(t){i.resolve()}),(function(t){i.reject()}))))},t.prototype.onNotificationAdded=function(){this.getActiveNotification(100)},t.prototype.onNotificationDismiss=function(i){var t=_.find(this.userNotifications.notifications,(function(t){return t.id===i}));t&&this.dismissNotification(t,!0)},t.prototype.onNotificationSeen=function(i){var e=this,o=!1;this.userNotifications.notifications.forEach((function(t){t.id<=i&&0<t.id&&!t.seen&&(t.seen=!0,e.userNotifications.unseenCount=e.userNotifications.unseenCount-1,o=!0)})),o&&this.notifyNotificationsUpdated()},t.prototype.onNotificationDismissAll=function(){0<this.userNotifications.totalCount&&this.getActiveNotification(100)},t.prototype.loadIcon=function(i){if(!i.iconUrl&&i.message.image&&i.message.image.imagePath)switch(i.message.image.imageType){case 0:this.services.profileImageService.findOrGetUserPhoto(i.message.image.imagePath).then((function(t){i.iconUrl=t}));break;case 1:this.services.profileImageService.findOrGetGroupPhoto(i.message.image.imagePath).then((function(t){i.iconUrl=t}))}},t.prototype.addClientNotification=function(t){t&&(t.id=this.clientNotificationId--,t.seen=!1,this.userNotifications&&(this.userNotifications.totalCount++,this.userNotifications.unseenCount++,this.userNotifications.notifications=[t].concat(this.userNotifications.notifications),this.notifyNotificationsUpdated()))},t.prototype.getHighestNotificationLevel=function(t){if(!this.userNotifications||_.isEmpty(this.userNotifications.notifications))return 1;t=_.maxBy(t,(function(t){return t.notificationLevel}));return t&&t.notificationLevel},t.prototype.initialize=function(){var t=this;this.getActiveNotification(100),this.services.syncService.addNotificationsRefreshListener(this),this.services.intervalService((function(){t.getActiveNotification(100)}),6e5)},t.prototype.getLatestNotificationForServer=function(){return _.find(this.userNotifications.notifications,(function(t){return 0<t.id&&!t.seen}))},t.prototype.mergeNotifications=function(t){var i,e,o;t&&(this.userNotifications.totalCount=t.totalCount,this.userNotifications.unseenCount=t.unseenCount,(i=_.filter(this.userNotifications.notifications,(function(t){return t.id<=0})))&&0<i.length&&(this.userNotifications.totalCount=t.totalCount+i.length,(o=_.filter(i,(function(t){return!t.seen})))&&0<o.length&&(this.userNotifications.unseenCount=t.unseenCount+o.length)),o=[],e=_.map(this.userNotifications.notifications,(function(t){return t.id})),0<(o=_.filter(t.notifications,(function(t){return e.indexOf(t.id)<0}))).length&&(i&&0<i.length?this.userNotifications.notifications=i.concat(o).concat(_.filter(this.userNotifications.notifications,(function(t){return 0<t.id}))):this.userNotifications.notifications=o.concat(this.userNotifications.notifications)))},t.prototype.notifyNotificationsUpdated=function(){this.notificationsUpdatedListeners.forEach((function(t){t()}))},t.prototype.getActiveNotification=function(t){var i=this;void 0===t&&(t=100);var e=this.services.telemetryService.startEvent(n.telemetry.UserNotificationsGetNotificationsSummary);this.services.userNotificationHttpService.getActiveNotificationSummary(e.event,t).then((function(t){t=i.filterNotSupportedUserNotifications(t.data);i.userNotifications&&i.userNotifications.notifications?i.mergeNotifications(t):i.userNotifications=t,i.notifyNotificationsUpdated(),e.resolve()}),(function(t){e.reject()}))},t.prototype.filterNotSupportedUserNotifications=function(t){var i;return t&&0<t.totalCount&&(t.notifications=this.filterNotSupportedNotifications(t.notifications),i=_.filter(t.notifications,(function(t){return!t.seen})),t.unseenCount=i?i.length:0),t},t.prototype.filterNotSupportedNotifications=function(t){return _.filter(t,(function(t){return n.userNotifications.contracts.NotificationCategory[t.notificationCategory]}))},t);function t(t,i,e){var o=this;this.notificationsUpdatedListeners=[],this.clientNotificationId=0,this.services=t,i&&!e&&(this.userNotifications={totalCount:0,unseenCount:0,notifications:[]},t.timeout((function(){o.initialize()}),6e3))}})()})(powerbi=powerbi||{}),(function(s){!(function(i){var t=jsCommon.Utility,e=s.telemetryEventFactory,o=s.telemetry.EventFactories;t?t.generateGuid:Function.prototype;i.UserNotificationsGetNotificationsSummaryEventName="PBI.UserNotifications.GetNotificationsSummary",i.UserNotificationsGetNotificationsSummary=o[i.UserNotificationsGetNotificationsSummaryEventName]=function(t){return e({name:i.UserNotificationsGetNotificationsSummaryEventName,baseEvent:i.Verbose(t),info:t,category:s.TelemetryCategory.Verbose,loggers:i.UserNotificationsGetNotificationsSummaryLoggers})},i.UserNotificationsLoadMoreNotificationsEventName="PBI.UserNotifications.LoadMoreNotifications",i.UserNotificationsLoadMoreNotifications=o[i.UserNotificationsLoadMoreNotificationsEventName]=function(t){return e({name:i.UserNotificationsLoadMoreNotificationsEventName,baseEvent:i.CustomerAction(t),info:t,category:s.TelemetryCategory.CustomerAction,loggers:i.UserNotificationsLoadMoreNotificationsLoggers})},i.UserNotificationsDismissNotificationEventName="PBI.UserNotifications.DismissNotification",i.UserNotificationsDismissNotification=o[i.UserNotificationsDismissNotificationEventName]=function(t){return e({name:i.UserNotificationsDismissNotificationEventName,baseEvent:i.CustomerAction(t),info:t,category:s.TelemetryCategory.CustomerAction,loggers:i.UserNotificationsDismissNotificationLoggers})},i.UserNotificationsDismissAllNotificationsEventName="PBI.UserNotifications.DismissAllNotifications",i.UserNotificationsDismissAllNotifications=o[i.UserNotificationsDismissAllNotificationsEventName]=function(t){return e({name:i.UserNotificationsDismissAllNotificationsEventName,baseEvent:i.CustomerAction(t),info:t,category:s.TelemetryCategory.CustomerAction,loggers:i.UserNotificationsDismissAllNotificationsLoggers})}})(s.telemetry||(s.telemetry={}))})(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] || (this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
