"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['singleValueVisuals.min.js'] || (this.parseTimeMarkers['singleValueVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('singleValueVisuals.min.js');var powerbi,__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,a=1,i=arguments.length;a<i;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(r){var b;function t(t){this.defaultTitleColor="#333333",this._animatedTextOptions={},this.mainText=jsCommon.CssConstants.createClassAndSelector("mainText"),this.name=t,this.visualConfiguration={maxFontSize:60}}b=r.visuals||(r.visuals={}),t.prototype.getMetaDataColumn=function(t){if(t&&t.metadata&&t.metadata.columns)for(var e=0,a=t.metadata.columns.length;e<a;e++){var i=t.metadata.columns[e];if(i.isMeasure){this.metaDataColumn=i;break}}},t.prototype.getAdjustedFontHeight=function(t,e,a){var i,e={fontFamily:null===(i=this._animatedTextOptions.textProperties)||void 0===i?void 0:i.fontFamily,fontWeight:null===(i=this._animatedTextOptions.textProperties)||void 0===i?void 0:i.fontWeight,fontStyle:null===(i=this._animatedTextOptions.textProperties)||void 0===i?void 0:i.fontStyle,textDecoration:null===(i=this._animatedTextOptions.textProperties)||void 0===i?void 0:i.textDecoration,text:e};return this.getAdjustedFontHeightCore(e,t,a,0)},t.prototype.getAdjustedFontHeightCore=function(t,e,a,i){return 10<i?a:(t.fontSize=jsCommon.PixelConverter.toString(a),r.TextMeasurementService.measureSvgTextWidth(t)<e?a:this.getAdjustedFontHeightCore(t,e,.9*a,i+1))},t.prototype.clear=function(){this.svg.select(this.mainText.selector).text("")},t.prototype.doValueTransition=function(t,e,a,i,r,o,s,n){if(o||t!==e||null==e){t=t||0,n=n||this.getDefaultDatumTransform();var l=this.svg,u=this.currentViewport,g=u.height,d=u.width,p=this.getSeedFontHeight(d,g),h=this.getTranslateX(d),c=(this.getTranslateY(p),this.metaDataColumn);s=s||b.valueFormatter.create({format:this.getFormatString(this.dataPointObjects,c),value:e,displayUnitSystemType:a,formatSingleValues:!0,allowFormatBeautification:!0,columnType:c?c.type:void 0});o=String(t),u=String(e);!_.isEmpty(e)&&"string"==typeof e||(o=s.format(t),u=s.format(e)),l.classed(this.name,!0);var m,a=[n.getDatum(e,u)],a=l.selectAll("text").data(a),a=a.enter().append("text").classed(this.mainText.class,!0).merge(a),p=this.getAdjustedFontHeight(d,u,p),f=this.getTranslateY(p+(g-p)/2);return a.text(o).attr("text-anchor",this.getTextAnchor()).attr("font-size",p).attr("transform",b.SVGUtil.translate(h,f)).style("font-style",null===(f=this._animatedTextOptions.textProperties)||void 0===f?void 0:f.fontStyle).style("text-decoration",null===(f=this._animatedTextOptions.textProperties)||void 0===f?void 0:f.textDecoration).style("font-weight",null===(f=this._animatedTextOptions.textProperties)||void 0===f?void 0:f.fontWeight).style("font-family",null===(f=this._animatedTextOptions.textProperties)||void 0===f?void 0:f.fontFamily).style("fill",this.getTextColor()).call(b.tooltipUtils.tooltipUpdate,[o]),null==e||c&&b.AxisHelper.isDateTime(c.type)||"string"==typeof e?a.text(u).call(b.tooltipUtils.tooltipUpdate,[u]):(m=t,a.transition().duration(r).tween("text",function(t){var t=n.getValue(t),e=d3.interpolate(m,t);return function(t){t=e(t);this.textContent=s.format(t)}})),b.SVGUtil.flushAllD3TransitionsIfNeeded(i,a),a}},t.prototype.getDefaultDatumTransform=function(){return{getDatum:function(t,e){return{value:t}},getValue:function(t){return t.value}}},Object.defineProperty(t.prototype,"animatedTextOptions",{get:function(){return this._animatedTextOptions},set:function(t){this._animatedTextOptions=t},enumerable:!1,configurable:!0}),t.prototype.getTextColor=function(){var t,e=this.style&&b.ColorHelper.getThemeColor(this.style,"foreground");return(null===(t=this._animatedTextOptions)||void 0===t?void 0:t.titleColor)||e||this.defaultTitleColor},t.prototype.getSeedFontHeight=function(t,e){t=Math.floor(.75*Math.min(t,e)),e=this.visualConfiguration.maxFontSize;return e?Math.min(e,t):t},t.prototype.getTranslateX=function(t){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return 0;case"right":return t}return t/2},t.prototype.getTranslateY=function(t){return t},t.prototype.getTextAnchor=function(){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return"start";case"right":return"end"}return"middle"},t.prototype.getFormatString=function(t,e){return b.valueFormatter.getFormatStringWithDataPointObjects(t,e,b.StandardObjectPropertyIdentifiers.formatString)},b.AnimatedText=t}(powerbi=powerbi||{}),function(t){var o,i;function e(t,e){var a=i.call(this,"animatedNumber")||this;return t&&(a.svg=t),e&&(a.animator=e),a}o=t.visuals||(t.visuals={}),i=o.AnimatedText,__extends(e,i),e.prototype.init=function(t){var e=(this.options=t).element;this.svg||(this.svg=d3.select(e.get(0)).append("svg")),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportDependantProperties()},e.prototype.updateViewportDependantProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},e.prototype.update=function(t){this.currentViewport=t.viewport;var e=this.dataViews=t.dataViews;e&&e[0]&&(e=e[0],this.updateViewportDependantProperties(),this.getMetaDataColumn(e),e=e&&e.single?e.single.value:0,this.updateInternal(e,t.suppressAnimations,!0,this.formatter))},e.prototype.setFormatter=function(t){this.formatter=t},e.prototype.onDataChanged=function(t){this.update({dataViews:t.dataViews,suppressAnimations:t.suppressAnimations,viewport:this.currentViewport})},e.prototype.onResizing=function(t){this.update({dataViews:this.dataViews,suppressAnimations:!0,viewport:t})},e.prototype.canResizeTo=function(t){return!0},e.prototype.updateInternal=function(t,e,a,i){void 0===a&&(a=!1);var r=this.value,e=o.AnimatorCommon.GetAnimationDuration(this.animator,e);this.doValueTransition(r,t,null,this.options.animation,e,a,i),this.value=t},o.AnimatedNumber=e}(powerbi=powerbi||{}),define("SingleValueVisuals/animatedNumberModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createAnimatedNumber=void 0,e.createAnimatedNumber=function(){return new powerbi.visuals.AnimatedNumber}}),function(x){var C,i,P,t,V,L,r;function D(t){var e=r.call(this,D.cardClassName)||this;return e.isScrollable=!1,e.displayUnitSystemType=x.DisplayUnitSystemType.WholeUnits,t&&(e.tooltipsEnabled=t.tooltipsEnabled,e.isScrollable=!!t.isScrollable,e.interactivityEnabled=t.interactivityEnabled,t.animator&&(e.animator=t.animator),null!=t.displayUnitSystemType&&(e.displayUnitSystemType=t.displayUnitSystemType),t.cardSmallViewportProperties&&(e.cardSmallViewportProperties=t.cardSmallViewportProperties),e.featureSwitches=t.featureSwitches||{}),e}C=x.visuals||(x.visuals={}),i=x.visuals.builder,P=C.CardUtil.DefaultStyle,t=jsCommon.CssConstants.createClassAndSelector,V=x.visuals.KpiUtil,L=x.visuals.TextUtil,r=C.AnimatedText,__extends(D,r),D.prototype.init=function(t){var a=this;this.animationOptions=t.animation;var e=t.element;this.tooltipsEnabled&&(this.tooltipService=C.createTooltipService(t.host)),this.kpiImage=d3.select(e.get(0)).append("div").classed(D.KPIImage.class,!0);e=this.svg=d3.select(e.get(0)).append("svg");this.graphicsContext=e.append("g"),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportProperties(),this.isScrollable&&(e.attr("class",D.cardClassName),this.labelContext=e.append("g")),this.interactivityEnabled&&e.attr("tabindex",0).attr("focusable",!0),this.svg.on("contextmenu",function(){var t=d3.event,e={data:[a.selector],position:{x:t.clientX,y:t.clientY}};a.hostServices.onContextMenu(e),t.preventDefault(),t.stopPropagation()})},D.prototype.onDataChanged=function(t){var e,a,i,r=t.dataViews[0];r&&(this.getMetaDataColumn(r),r.single&&(e=r.single.value,a=r.single.objects,r.single.column&&(this.selector={metadata:[r.single.column.queryName]})),this.cardFormatSetting=this.getDefaultFormatSettings(this.style),!(i=r.metadata)||(t=i.objects)&&(r=this.cardFormatSetting.labelSettings,(i=t.labels)&&r&&C.DataLabelViewModel.updateLabelSettingsFromLabelsObject(i,r,void 0,this.style),r.precision!==C.DataLabelViewModel.defaultLabelPrecision&&r.precision<0&&(r.precision=0),i=t.categoryLabels,r=this.cardFormatSetting.categoryLabelSetting,i&&r&&C.DataLabelViewModel.updateLabelSettingsFromLabelsObject(i,r,void 0,this.style),this.cardFormatSetting.wordWrap=x.DataViewObjects.getValue(t,C.cardProps.wordWrap.show,this.cardFormatSetting.wordWrap))),this.updateInternal(e,a,!0,!0)},D.prototype.onResizing=function(t){this.currentViewport=t,this.updateViewportProperties(),this.updateInternal(this.value,this.dataPointObjects,!0,!0)},D.prototype.updateViewportProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},D.prototype.setTextProperties=function(t,e){D.cardTextProperties=C.FontProperties.toTextProperties(e,t)},D.prototype.isSmallViewport=function(){return!!(this.cardSmallViewportProperties&&this.currentViewport.width<=this.cardSmallViewportProperties.cardSmallViewportWidth)},D.prototype.getCardPrecision=function(t){return(t=void 0===t?!1:t)?C.DataLabelViewModel.defaultLabelPrecision:this.cardFormatSetting.labelSettings.precision},D.prototype.getCardDisplayUnits=function(t){var e=!this.metaDataColumn||!this.metaDataColumn.type||this.metaDataColumn.type.numeric;return(t=void 0===t?!1:t)||!e?0:this.cardFormatSetting.labelSettings.displayUnits},D.prototype.getAdjustedFontHeight=function(t,e,a){a=r.prototype.getAdjustedFontHeight.call(this,t,e,a);return Math.min(a,P.card.maxFontSize)},D.prototype.clear=function(t){void 0===t&&(t=!1),this.svg.select(D.Value.selector).text(""),t||this.svg.select(D.Label.selector).text(""),r.prototype.clear.call(this)},D.prototype.updateInternal=function(t,e,a,i){void 0===i&&(i=!1);var r=this.value,o=C.AnimatorCommon.GetAnimationDuration(this.animator,a);if(void 0!==t){var s=this.metaDataColumn,n=this.cardFormatSetting.labelSettings,l=this.cardFormatSetting.categoryLabelSetting,u=this.isSmallViewport(),g=this.getCardPrecision(u),d=this.getCardDisplayUnits(u),p=0===d,h=this.getFormatString(e,s),c=C.valueFormatter.create({format:h,value:p?t:d,precision:C.DataLabelViewModel.getLabelPrecision(g,h),displayUnitSystemType:p&&g===C.DataLabelViewModel.defaultLabelPrecision?this.displayUnitSystemType:x.DisplayUnitSystemType.WholeUnits,formatSingleValues:p,allowFormatBeautification:!0,columnType:s?s.type:void 0}),m=this.cardFormatSetting,f=n.fontProperties.size.px;this.setTextProperties(t,this.cardFormatSetting.categoryLabelSetting.fontProperties);var b,v,y,S,a=(l.show?x.TextMeasurementService.estimateSvgTextHeight(D.cardTextProperties):0)+P.label.paddingTop,u=this.currentViewport.width,d=this.currentViewport.height,h=this.getTranslateX(u),g=(d-a-f)/2,w=s&&s.displayName,p=V.isKpi(s)&&V.getKpiImageMetadata(s,t,1);if(this.isScrollable){if(!i&&r===t)return;p?(this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(p,t,h,g,f)):(v=void 0,v=_.isEmpty(t)||"string"!=typeof t?c.format(t):t,s=[{displayName:w,value:v}],this.kpiImage.selectAll("div").remove(),b=this.getTranslateY(f+g),(v=(S=this.graphicsContext.attr("transform",C.SVGUtil.translate(h,b)).selectAll("text").data(s)).enter().append("text").attr("class",D.Value.class).merge(S)).text(function(t){return t.value}).style("text-anchor",this.getTextAnchor()).styles(C.FontProperties.toSVGStyle(n.fontProperties)),n.preserveWhitespace?v.style("white-space","pre"):v.style("white-space","normal"),m.wordWrap?(s=v.node(),L.wordBreak(s,u,d-a,void 0,!0,n.preserveWhitespace),1<(y=s.childElementCount)&&(s=f,b=this.getTranslateY(s+(g=(d-a-(f*=y))/2)),this.graphicsContext.attr("transform",C.SVGUtil.translate(h,b)))):v.call(C.AxisHelper.LabelLayoutStrategy.clip,u,x.TextMeasurementService.svgEllipsis),this.addTooltip(v),S.exit().remove()),l.show&&w?(y=[w],b=this.getTranslateY(f+a+g),(a=(v=this.labelContext.attr("transform",C.SVGUtil.translate(h,b)).selectAll("text").data(y)).enter().append("text").attr("class",D.Label.class).merge(v)).text(function(t){return t}).styles(C.FontProperties.toSVGStyle(l.fontProperties)).style("text-anchor",this.getTextAnchor()),l.preserveWhitespace?a.style("white-space","pre"):a.style("white-space","normal"),(y=a.node())&&(m.wordWrap?L.wordBreak(y,u,d-b,void 0,!0,l.preserveWhitespace):a.call(C.AxisHelper.LabelLayoutStrategy.clip,u,x.TextMeasurementService.svgEllipsis)),v.exit().remove()):this.labelContext.selectAll("text").remove()}else p?(this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(p,t,h,g,f)):(this.kpiImage.selectAll("div").remove(),(S=this.doValueTransition(r,t,this.displayUnitSystemType,this.animationOptions,o,i,c,{getDatum:function(t,e){return{displayName:w,value:e,unformattedValue:t}},getValue:function(t){return t.unformattedValue}})).classed("value",!0),this.addTooltip(S),this.graphicsContext.call(C.tooltipUtils.tooltipUpdate,[t]));this.interactivityEnabled&&(S=void 0,S=(p?this.kpiImage.selectAll("div"):this.graphicsContext.selectAll("text")).datum(),this.svg.attr("aria-label",C.tooltipUtils.formatTooltipInfo([S]))),this.value=t,this.dataPointObjects=e}else void 0!==r&&this.clear()},D.prototype.displayStatusGraphic=function(t,e,a,i,r){this.graphicsContext.selectAll("text").remove();var o=this.kpiImage.select("div");(o=!o||o.empty()?this.kpiImage.append("div"):o).attr("class",["value",t.class].join(" ")).style("position","absolute").style("font-size",r+"px");var s=o.node().offsetWidth,t=o.node().offsetHeight;o.style("transform",C.SVGUtil.translateWithPixels(a-s/2,this.getTranslateY(r+i)-t));e={displayName:this.metaDataColumn&&this.metaDataColumn.displayName,kpiValue:{value:e,metadata:this.metaDataColumn.kpi}};o.datum(e),this.addTooltip(o)},D.prototype.getDefaultFormatSettings=function(e){function t(t){return C.ColorHelper.getThemeColor(e,t)}return{labelSettings:C.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:t(P.value.colorName),fontSize:P.value.textSize,fontFamily:P.value.fontFamily,preserveWhitespace:!0,style:e,textClassName:"callout"}),categoryLabelSetting:C.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:t(P.label.colorName),fontSize:P.label.textSize,fontFamily:P.label.fontFamily,preserveWhitespace:!0,style:e,textClassName:"largeLightLabel"}),wordWrap:!1}},D.prototype.getDataLabelSettingsOptions=function(t,e,a){return{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0,bold:!0,italic:!0,underline:!0}},D.prototype.getDataLabelSettingsOptionsWithWordWrap=function(t,e,a){return e.wordWrap=this.cardFormatSetting.wordWrap,{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0,wordWrap:!0,bold:!0,italic:!0,underline:!0}},D.prototype.enumerateObjectInstances=function(t){this.cardFormatSetting||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style));var e=this.cardFormatSetting,a=e.labelSettings,i=e.categoryLabelSetting,r=new C.ObjectEnumerationBuilder;switch(t.objectName){case"categoryLabels":C.DataLabelViewModel.enumerateCategoryLabels(r,i,!0,this.featureSwitches,void 0,void 0,this.style,this.getExtraLabelConfig(t.objectName));break;case"labels":C.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(r,a,!0),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"wordWrap":r.pushInstance({objectName:"wordWrap",selector:null,properties:{show:e.wordWrap}})}return r.complete()},D.prototype.getFormattingModel=function(){var t=this;return this.cardFormatSetting||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style)),new C.builder.FormattingModelBuilder(function(){return t.getCalloutValueCard()},function(){return t.getCategoryLabelCard()}).build()},D.prototype.getCalloutValueCard=function(){var e=this,t=this.cardFormatSetting.labelSettings,a=__assign(__assign({},C.cardProps.labels),{precision:C.cardProps.labels.labelPrecision,displayUnits:C.cardProps.labels.labelDisplayUnits,wordWrap:C.cardProps.wordWrap.show}),t={cardBuilder:new i.FormattingCardBuilder(new i.FormattingCardUidBuilder("labels"),"Visual_Gauge_CalloutValue",a,function(t){return e.hostServices.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:this.getDataLabelSettingsOptionsWithWordWrap(void 0,t,!0),omitGroupDisplayNames:!0};return C.DataLabelViewModel.getDataLabelsFormattingModel(t)},D.prototype.getCategoryLabelCard=function(){var e=this,t=this.cardFormatSetting.categoryLabelSetting,a=C.cardProps.categoryLabels,a=__assign(__assign({},a),{color:__assign(__assign({},a.color),{instanceKind:3})});return C.DataLabelViewModel.getCategoryLabelsCard({cardName:"Visual_CategoryLabel",dataLabelSettings:t,isShowCategory:!1,localize:function(t){return e.hostServices.getLocalizedString(t)},props:a,revertToDefaultProps:C.cardProps.categoryLabels,showBackground:!1,showValueColor:!0,style:this.style,featureSwitches:this.featureSwitches})},D.prototype.getExtraLabelConfig=function(t){return{objectName:t,propertyInstanceKind:{color:3,backgroundColor:3}}},D.prototype.addTooltip=function(t){var e=this,a=this.hostServices.tooltips();this.tooltipsEnabled&&a&&a.enabled()&&this.tooltipService.addTooltip(t,function(t){t=t.data;return t.kpiValue?[{displayName:t.displayName,kpiValue:t.kpiValue}]:[{displayName:t.displayName,value:t.value}]},function(){return e.getTooltipIdentity()&&[e.getTooltipIdentity()]})},D.prototype.getTooltipIdentity=function(){return this.metaDataColumn&&C.SelectionId.createWithMeasure(this.metaDataColumn.queryName)},D.cardClassName="card",D.Label=t("label"),D.Value=t("value"),D.KPIImage=t("caption"),D.cardTextProperties={fontSize:null,text:null,fontFamily:C.DataLabelViewModel.DefaultFontProperties.family},t=D,C.Card=t}(powerbi=powerbi||{}),define("SingleValueVisuals/cardModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createCard=void 0,e.createCard=function(t){return new powerbi.visuals.Card(t)}}),function(y){var S,l,t,u;function w(t,e){this.lastAngle=-Math.PI/2,t&&(t.gaugeSmallViewPortProperties&&(this.gaugeSmallViewPortProperties=t.gaugeSmallViewPortProperties),this.animator=t.animator,this.tooltipsEnabled=t.tooltipsEnabled,this.behavior=t.behavior,this.featureSwitches=e||{})}S=y.visuals||(y.visuals={}),l=y.visuals.builder,t=jsCommon.CssConstants.createClassAndSelector,u=y.data.DataRoleHelper,w.prototype.getDataLabelsCard=function(){var t=__assign(__assign({},S.gaugeProps.labels),{displayUnits:S.gaugeProps.labels.labelDisplayUnits,precision:S.gaugeProps.labels.labelPrecision}),e=this.data?this.data.minLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);return this.generateLabelsCard("labels","Visual_DataPointsLabels",t,this.getDataLabelSettingsOptions(void 0,e),void 0)},w.prototype.getTargetLabelCard=function(){var t=__assign(__assign({},S.gaugeProps.target),{displayUnits:S.gaugeProps.target.labelDisplayUnits,precision:S.gaugeProps.target.labelPrecision}),e=this.data&&this.data.target?this.data.target.label.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);return this.generateLabelsCard("target","Visual_Gauge_Axis_TargetLabel",t,this.getDataLabelSettingsOptions(void 0,e),!0)},w.prototype.getCalloutValueCard=function(){var t=__assign(__assign({},S.gaugeProps.calloutValue),{displayUnits:S.gaugeProps.calloutValue.labelDisplayUnits,precision:S.gaugeProps.calloutValue.labelPrecision}),e=S.ColorHelper.getThemeColor(this.style,S.ForegroundColorName),a=S.Font.Family.lightSecondary.family,a=this.data?this.data.calloutLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style,e,a);return this.generateLabelsCard("calloutValue","Visual_Gauge_CalloutValue",t,this.getDataLabelSettingsOptions(void 0,a),!0)},w.prototype.generateLabelsCard=function(t,e,a,i,r){var o=this,r={cardBuilder:new l.FormattingCardBuilder(new l.FormattingCardUidBuilder(t),e,a,function(t){return o.hostService.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:i,omitDescription:r};return S.DataLabelViewModel.getDataLabelsFormattingModel(r)},w.prototype.getColorsCard=function(){var e=this,t=this.data?this.data.dataPointSettings:S.GaugeConverter.getDefaultDataPointSettings(this.style),a=__assign({},S.gaugeProps.dataPoint),i=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("datapoint"),"Visual_Colors",a,function(t){return e.hostService.getLocalizedString(t)}),r={value:t.fillColor},o={value:t.targetColor};return i.addGroup("datapoint",function(t){t.addSimpleSlice(a.fill.propertyName,new l.ColorPickerBuilder({descriptor:__assign(__assign({},a.fill),{instanceKind:3}),value:r}).build()).addSimpleSlice(a.target.propertyName,new l.ColorPickerBuilder({descriptor:__assign(__assign({},a.target),{instanceKind:3}),value:o}).build())}),i.build()},w.prototype.getGaugeAxisCard=function(){var e=this,a=this.dataView;if(a&&a.metadata){var i=__assign({},S.gaugeProps.axis),t=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("axis"),"Visual_Gauge_Axis",i,function(t){return e.hostService.getLocalizedString(t)}),r=w.getGaugeObjectsProperties(a),o=r.min,s=r.max,n=r.target;return t.addGroup("axis",function(t){t.addSimpleSlice(i.min.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},i.min),{instanceKind:null!==(t=e.featureSwitches)&&void 0!==t&&t.expressionBasedFormatting?3:1}),value:o,options:{maxValue:null!=s?{type:1,value:s}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(a,S.gaugeRoleNames.minValue))}).addSimpleSlice(i.max.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},i.max),{instanceKind:null!==(t=e.featureSwitches)&&void 0!==t&&t.expressionBasedFormatting?3:1}),value:s,options:{minValue:null!=o?{type:0,value:o}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(a,S.gaugeRoleNames.maxValue))}).addSimpleSlice(i.target.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},i.target),{instanceKind:null!==(t=e.featureSwitches)&&void 0!==t&&t.expressionBasedFormatting?3:1}),value:n,options:{minValue:null!=o?{type:0,value:o}:void 0,maxValue:null!=s?{type:1,value:s}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(a,S.gaugeRoleNames.targetValue))})}),t.build()}},w.prototype.getFormattingModel=function(){var t=this;return new S.builder.FormattingModelBuilder(function(){return t.getGaugeAxisCard()},function(){return t.getColorsCard()},function(){return t.getDataLabelsCard()},function(){return t.getTargetLabelCard()},function(){return t.getCalloutValueCard()}).build()},w.prototype.enumerateObjectInstances=function(t){var e=new S.ObjectEnumerationBuilder;switch(t.objectName){case"axis":this.enumerateAxis(e);break;case"labels":var a=this.data?this.data.minLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,a),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"target":var i=this.data&&this.data.target?this.data.target.label.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,i),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"calloutValue":var r=S.ColorHelper.getThemeColor(this.style,S.ForegroundColorName),i=S.Font.Family.lightSecondary.family,a=this.data?this.data.calloutLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style,r,i);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,a),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"dataPoint":this.enumerateDataPoint(e)}return e.complete()},w.prototype.getDataLabelSettingsOptions=function(t,e){return{dataLabelsSettings:e,show:!0,precision:!0,displayUnits:!0,fontSize:!0,fontFamily:!0,enumeration:t,style:this.style,bold:!0,italic:!0,underline:!0}},w.prototype.getExtraLabelConfig=function(t){return{objectName:t,propertyInstanceKind:{color:3}}},w.prototype.enumerateAxis=function(t){var e=this.dataView;e&&e.metadata&&(e=w.getGaugeObjectsProperties(e),t.pushInstance({selector:null,objectName:"axis",properties:e,propertyInstanceKind:{min:null!==(e=this.featureSwitches)&&void 0!==e&&e.expressionBasedFormatting?3:1,max:null!==(e=this.featureSwitches)&&void 0!==e&&e.expressionBasedFormatting?3:1,target:null!==(e=this.featureSwitches)&&void 0!==e&&e.expressionBasedFormatting?3:1}}))},w.prototype.enumerateDataPoint=function(t){var e=this.data?this.data.dataPointSettings:S.GaugeConverter.getDefaultDataPointSettings(this.style),a={};a.fill={solid:{color:e.fillColor}},null!=e.targetColor&&(a.target={solid:{color:e.targetColor}}),t.pushInstance({selector:null,objectName:S.gaugeProps.dataPoint.target.objectName,properties:a,propertyInstanceKind:{fill:3,target:3}})},w.getGaugeObjectsProperties=function(t){var e={},a=t.metadata.objects,i=!!a&&!!a.axis;return u.hasRoleInDataView(t,S.gaugeRoleNames.minValue)||(e.min=i?a.axis.min:void 0),u.hasRoleInDataView(t,S.gaugeRoleNames.maxValue)||(e.max=i?a.axis.max:void 0),u.hasRoleInDataView(t,S.gaugeRoleNames.targetValue)||(e.target=i?a.axis.target:void 0),e},w.prototype.init=function(t){this.element=t.element,this.currentViewport=t.viewport,this.style=t.style,this.settings=w.DefaultStyleProperties,this.tooltipService=S.createTooltipService(t.host),this.labelPosition=0,this.margin={top:0,left:0,right:0,bottom:0},this.color=d3.scaleOrdinal([S.ColorHelper.getSentimentColor(this.style,"bad"),S.ColorHelper.getSentimentColor(this.style,"neutral"),S.ColorHelper.getSentimentColor(this.style,"good")]).domain([0,1,2]),this.hostService=t.host,this.behavior&&(this.interactivityService=S.createInteractivityService(this.hostService));var e=this.svg=d3.select(this.element.get(0)).append("svg").classed("gauge",!0);this.interactivityService&&(r=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),e.attr("tabindex",0).attr("focusable",!0).classed(S.SetFocusRingClassName,!r));var a=this.mainGraphicsContext=e.append("g");a.attr("class",w.MainGaugeGroupClassName),this.initKpiBands();var i=this.backgroundArc=d3.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2),r=this.foregroundArc=d3.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2);this.backgroundArcPath=a.append("path").classed("backgroundArc",!0).attr("d",i),this.foregroundArcPath=a.append("path").datum({endAngle:-Math.PI/2}).classed("foregroundArc",!0).attr("d",r);e=this.animatedNumberGraphicsContext=e.append("g");this.animatedNumber=new S.AnimatedNumber(e),this.animatedNumber.init(t);t=this.gaugeVisualProperties=this.getGaugeVisualProperties(),t=this.getAnimatedNumberProperties(t.radius,t.innerRadiusFactor,t.top,t.left);this.animatedNumberGraphicsContext.attr("transform",t.transformString),this.animatedNumber.onResizing(t.viewport)},w.prototype.update=function(t){var e,a,i;this.currentViewport=t.viewport,t.dataViews&&t.dataViews[0]&&(e=this.dataView=t.dataViews[0],a=y.data.createDataViewCategoricalReaderAdvanced(e,{formatStringProp:S.gaugeProps.general.formatString}),(t.type&y.VisualUpdateType.Data||!this.data)&&(this.data=S.GaugeConverter.convert(a,this.style),i=S.getInvalidValueWarnings([e],!1,!1,!1,["Tooltips"]),this.hostService.setWarnings(i)),(t.type&y.VisualUpdateType.Resize||t.type&y.VisualUpdateType.ResizeEnd)&&(t.suppressAnimations=!0),this.dataView.single={value:this.data.calloutLabel.value,column:void 0},this.labels=[this.data.minLabel,this.data.maxLabel],this.showTargetLabel=0<=this.data.target.ratio&&this.data.target.ratio<=1&&150<this.currentViewport.width&&this.showSideNumbersLabelText()&&this.data.target.label.settings.show,i=w.calculatePosition(this.data,this.showTargetLabel,this.currentViewport,this.gaugeSmallViewPortProperties),this.labelPosition=i.labelPosition,this.margin=i.margin,this.gaugeVisualProperties=this.getGaugeVisualProperties(),this.drawViewPort(this.gaugeVisualProperties),this.updateInternal(t.suppressAnimations),this.updateCalloutValue(t.suppressAnimations))},w.prototype.updateCalloutValue=function(t){var e,a,i=this.data.calloutLabel.settings;this.data.calloutLabel.settings.show?(e=this.getAnimatedNumberProperties(this.gaugeVisualProperties.radius,this.gaugeVisualProperties.innerRadiusFactor,this.gaugeVisualProperties.top,this.gaugeVisualProperties.left),a={fontFamily:i.fontProperties.family,fontStyle:i.fontProperties.style,fontWeight:i.fontProperties.weight,textDecoration:i.fontProperties.textDecoration},this.animatedNumberGraphicsContext.attr("transform",e.transformString),this.animatedNumber.animatedTextOptions={textProperties:a,titleColor:i.fontProperties.color},a=this.data.calloutLabel.value,i=this.data.calloutLabel.formatter,this.animatedNumber.setFormatter(i),this.animatedNumber.update({viewport:e.viewport,dataViews:[this.dataView],suppressAnimations:t}),this.animatedNumberGraphicsContext.selectAll("title").remove(),this.animatedNumberGraphicsContext.append("title").text(i.format(a))):(this.animatedNumber.clear(),this.animatedNumberGraphicsContext.selectAll("title").remove())},w.prototype.initKpiBands=function(){if(this.settings.kpiBands.show)for(var t=this.kpiArcs=[],e=this.kpiArcPaths=[],a=this.mainGraphicsContext,i=0;i<3;i++){var r=d3.arc().innerRadius(0).outerRadius(0).startAngle(0).endAngle(0);t.push(r);r=a.append("path").attr("d",r);e.push(r)}},w.prototype.updateKpiBands=function(t,e,a,i){if(this.settings.kpiBands.show)for(var r=0;r<i.length;r++)this.kpiArcs[r].innerRadius(t*e-(w.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness)).outerRadius(t*e-w.KpiBandDistanceFromMainArc).startAngle(i[r].start).endAngle(i[r].end),this.kpiArcPaths[r].attr("fill",i[r].fill).attr("d",this.kpiArcs[r]).attr("transform",a)},w.prototype.removeTargetElements=function(){this.targetLine&&(this.targetLine.remove(),this.targetText.remove(),this.targetConnector.remove(),this.targetLine=this.targetConnector=this.targetText=null)},w.prototype.updateTargetLine=function(t,e,a,i){this.targetLine||(this.targetLine=this.mainGraphicsContext.append("line"));var r=this.data.target.ratio*Math.PI,o=i-t*Math.sin(r),t=a-t*Math.cos(r),i=i-e*Math.sin(r),r=a-e*Math.cos(r);this.targetLine.attr("x1",r).attr("y1",i).attr("x2",t).attr("y2",o)},w.prototype.getAnimatedNumberProperties=function(t,e,a,i){var r=Math.PI/4,t=t*e-(this.settings.kpiBands.show?w.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness:0),e=t*Math.cos(r),t=t*Math.sin(r),r=2*e;return{transformString:S.SVGUtil.translate(i-e,a-t),viewport:{height:t,width:r,scale:1}}},w.prototype.getGaugeVisualProperties=function(){var t=this.currentViewport,e=this.margin,a=t.width-e.right-e.left,i=a/2,r=t.height-e.top-e.bottom,o=Math.min(i,r),s=w.InnerRadiusFactor,t=e.left+i,i=o+(r-o)/2+e.top;return{radius:o,innerRadiusOfArc:o*s,left:t,top:i,height:r,width:a,margin:e,transformString:S.SVGUtil.translate(t,i),innerRadiusFactor:s}},w.prototype.drawViewPort=function(t){var e=this.settings.kpiBands.separationRadians,a=w.InnerRadiusFactor,i=this.backgroundArc,r=this.color,o=[{fill:r(0),start:-Math.PI/2,end:-Math.PI/2+Math.PI/4-e},{fill:r(1),start:-Math.PI/2+ +Math.PI/4+e,end:-Math.PI/2+3*Math.PI/4-e},{fill:r(2),start:-Math.PI/2+3*Math.PI/4+e,end:Math.PI/2}],s=t.radius,r=t.transformString;this.updateKpiBands(s,a,r,o),i.innerRadius(s*a).outerRadius(s).startAngle(-Math.PI/2).endAngle(Math.PI/2),this.backgroundArcPath.attr("d",i).attr("transform",r);e=this.foregroundArc;e.innerRadius(s*a).outerRadius(s).startAngle(-Math.PI/2),this.foregroundArcPath.datum({endAngle:this.lastAngle}).attr("transform",r).attr("d",e);o=t.innerRadiusOfArc,i=t.left,a=t.top,r=t.margin,e=t.height;!this.settings.targetLine.show||!$.isNumeric(this.data.target.label.value)||this.data.target.ratio<0||1<this.data.target.ratio?this.removeTargetElements():(this.updateTargetLine(s,o,i,a),this.renderTarget(s,e,t.width,r)),this.svg.attr("height",this.currentViewport.height).attr("width",this.currentViewport.width)},w.prototype.updateInternal=function(t){var e=this.gaugeVisualProperties.height,a=this.gaugeVisualProperties.width,i=this.gaugeVisualProperties.radius,r=this.margin,o=S.AnimatorCommon.GetAnimationDuration(this.animator,t),s=this.data,t=this.lastAngle=-Math.PI/2+Math.PI*this.data.ratio;this.foregroundArcPath.transition().ease(S.D3Helper.easeCompat(this.settings.transition.ease)).duration(o).call(this.arcTween,[t,this.foregroundArc]),this.renderMinMaxLabels(this.labels,i,e,a,r),this.updateVisualConfigurations(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.foregroundArcPath,function(t){return s.tooltipInfo},function(t){return s.identity&&[s.identity]}),this.tooltipService.addTooltip(this.backgroundArcPath,function(t){return s.tooltipInfo},function(t){return s.identity&&[s.identity]})),this.interactivityService&&(this.interactivityService.bind([],this.behavior,{paths:[this.foregroundArcPath]}),r=this.hostService.getLocalizedString("Role_DisplayName_MinValue")+" "+s.minLabel.text+". "+this.hostService.getLocalizedString("Role_DisplayName_MaxValue")+" "+s.maxLabel.text+".",this.svg.attr("aria-label",s.formattedTooltip?s.formattedTooltip.concat(" "+r):r)),this.foregroundArcPath.datum().identity=s.identity},w.prototype.updateVisualConfigurations=function(){var t=this.settings,e=this.data.dataPointSettings,a=this.data.strokeSettings;this.mainGraphicsContext.select("line").attr("stroke",e.targetColor).attr("stroke-width",t.targetLine.thickness),a&&a.visible&&this.mainGraphicsContext.select("path").style("stroke",a.color).style("stroke-width",a.width),this.backgroundArcPath.style("fill",S.ColorHelper.getThemeColor(this.style,"backgroundLight")),this.foregroundArcPath.style("fill",e.fillColor)},w.prototype.renderMinMaxLabels=function(t,e,a,i,r){if(this.svg.selectAll(w.LabelText.selector).remove(),this.data.minLabel.settings.show)for(var o=this.data.minLabel.settings,s=t.length,n=s-1,l=this.labelPosition,u=o.fontProperties,g=u.size.px,d=this.settings.labels.padding,p=0;p<s;p++){var h,c,m,f,b=this.gaugeVisualProperties.top,v=S.FontProperties.toTextProperties(u,t[p].text);this.showSideNumbersLabelText()&&(h=r.left+i/2-e*Math.cos(Math.PI*p/n),c=void 0,m=1===p,f=!1,2===l?(f=!0,b+=d,c=m?"end":"start",v.text=y.TextMeasurementService.getTailoredTextOrDefault(v,e)):(c=m?"start":"end",h+=d*(m?1:-1)),v=this.mainGraphicsContext.append("text").attr("x",h).attr("y",b).attr("dy",f?g:0).attr("class",w.LabelText.class).style("text-anchor",c).styles(S.FontProperties.toSVGStyle(u)).text(v.text).append("title").text(v.text),f||this.truncateTextIfNeeded(v,h,m))}},w.prototype.truncateTextIfNeeded=function(t,e,a){e=a?this.currentViewport.width-e:e;t.call(S.AxisHelper.LabelLayoutStrategy.clip,e,y.TextMeasurementService.svgEllipsis)},w.prototype.renderTarget=function(t,e,a,i){var r=this.data.target,o=this.data.target.label.settings,s=r.label.value,n=r.ratio,l=t+(e-t)/2+i.top,u=.5<n,g=this.settings.labels.padding,d=u?"start":"end",p=this.data.target.label.formatter,r=Math.asin(10/t)/Math.PI,e=n<r||1-r<n?u?1-r:r:n,r=i.left+a/2-(t+g)*Math.cos(Math.PI*e),g=l-(t+g)*Math.sin(Math.PI*e);this.targetText||(this.targetText=this.mainGraphicsContext.append("text").classed(w.TargetText.class,!0)),this.targetText.attr("x",r).attr("y",g).style("display",this.showTargetLabel?"":"none").style("text-anchor",d).styles(S.FontProperties.toSVGStyle(o.fontProperties)).text(p.format(s)),this.truncateTextIfNeeded(this.targetText,r,u),this.targetText.call(S.tooltipUtils.tooltipUpdate,[p.format(s)]),this.targetConnector||(this.targetConnector=this.mainGraphicsContext.append("line").classed(w.TargetConnector.class,!0)),n===e?this.targetConnector.style("display","none"):this.targetConnector.attr("x1",i.left+a/2-t*Math.cos(Math.PI*n)).attr("y1",l-t*Math.sin(Math.PI*n)).attr("x2",r).attr("y2",g).style("stroke-width",this.settings.targetLine.thickness).style("stroke",S.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")).style("display","")},w.prototype.arcTween=function(t,i){t.attrTween("d",function(e){var a=d3.interpolate(e.endAngle,i[0]);return function(t){return e.endAngle=a(t),i[1](e)}})},w.calculatePosition=function(t,e,a,i){var r=w.DefaultStyleProperties,o={margin:{top:0,left:0,bottom:0,right:0},labelPosition:0};if(i&&i.smallGaugeMarginsOnSmallViewPort&&a.height<i.MinHeightGaugeSideNumbersVisible){var s=i.GaugeMarginsOnSmallViewPort;return o.margin={top:s,bottom:s,left:s,right:s},o}if(!t)return o;var n,i=2*r.labels.padding,s=t&&t.minLabel.settings.show;e&&(e=(t.target.ratio<=.5?t.target.ratio:1-t.target.ratio)*Math.PI,n=t.target.label.requiredSpace.width+i,n=(a.width-n)/(Math.cos(e)+1),0<(n=a.width-2*n)&&(t.target.ratio<.5?o.margin.left=n:o.margin.right=n),e=(a.height-t.target.label.requiredSpace.height-i)/Math.sin(e),0<(n=a.height-e)&&(o.margin.top=n)),s&&(n=Math.max(o.margin.left,t.minLabel.requiredSpace.width+i),s=Math.max(o.margin.right,t.maxLabel.requiredSpace.width+i),i=t.minLabel.requiredSpace.height+i,(a.width-n-s)/2<a.height-o.margin.top-i?(o.labelPosition=2,o.margin.bottom=i):(o.labelPosition=1,o.margin={left:n,right:s,top:o.margin.top,bottom:r.labels.padding}));t=t.strokeSettings;return t&&t.visible&&(o.margin={left:o.margin.left+t.width,right:o.margin.right+t.width,top:o.margin.top+t.width,bottom:o.margin.bottom+t.width}),o},w.prototype.showSideNumbersLabelText=function(){return!(this.gaugeSmallViewPortProperties&&this.gaugeSmallViewPortProperties.hideGaugeSideNumbersOnSmallViewPort&&this.currentViewport.height<this.gaugeSmallViewPortProperties.MinHeightGaugeSideNumbersVisible)},w.DefaultStyleProperties={transition:{ease:"cubic-in-out"},targetLine:{show:!0,thickness:2},labels:{count:2,padding:5,fontSize:S.DataLabelViewModel.DefaultLabelFontSizeInPt},kpiBands:{show:!1,separationRadians:Math.PI/128,thickness:5}},w.InnerRadiusFactor=.7,w.KpiBandDistanceFromMainArc=2,w.MainGaugeGroupClassName="mainGroup",w.LabelText=t("labelText"),w.TargetConnector=t("targetConnector"),w.TargetText=t("targetText"),t=w,S.Gauge=t}(powerbi=powerbi||{}),function(t){var i;function e(){}i=t.visuals||(t.visuals={}),e.prototype.bindEvents=function(t,e,a){var i=this,t=t.paths;if(!_.isEmpty(t))for(var r=0,o=t;r<o.length;r++){var s=o[r];s&&s.on("contextmenu",function(){return i.handleContextMenu(e)})}},e.prototype.renderSelection=function(t){},e.prototype.handleContextMenu=function(e){var a=i.InteractivityUtils.getPositionOfLastInputEvent(),t=d3.event;t.preventDefault(),i.EventBubblingUtil.markAsHandled(t),i.InteractivityUtils.tryToSelectD3Target(function(t){e.handleContextMenu(t,a)})},i.GaugeBehavior=e}(powerbi=powerbi||{}),function(s){var d;function n(){}d=s.visuals||(s.visuals={}),n.getDefaultGaugeLabelSettings=function(t,e,a){t=d.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:e,fontSize:d.DataLabelViewModel.minLabelFontSize,style:t,textClassName:"largeLightLabel"});return a&&(t.fontProperties=d.FontProperties.inherit(t.fontProperties,{family:a})),t.position=null,t.bold=!1,t.italic=!1,t.underline=!1,t},n.getDefaultDataPointSettings=function(t){var e=t.colorPalette.dataColors.getAllColors();return{fillColor:d.ColorHelper.getDataColorByIndex(t,0,d.ForegroundColorName),targetColor:e&&1<e.length?d.ColorHelper.getDataColorByIndex(t,1,d.ForegroundColorName):d.ColorHelper.getThemeColor(t,"foregroundNeutralSecondary")}},n.convert=function(t,e){var a,i=t.columns,r=t.objects.getStaticObjects(),o=i.getValueMetadataColumn(d.gaugeRoleNames.y),s=this.parseGaugeData(t),n=this.convertDataLabelSettings(r,"labels",e,s.minDynamicFormatString),l=this.convertDataLabelSettings(r,"labels",e,s.maxDynamicFormatString),u=this.convertDataLabelSettings(r,"target",e,s.targetDynamicFormatString),g=d.ColorHelper.getThemeColor(e,d.ForegroundColorName),t=d.Font.Family.lightSecondary.family,g=this.convertDataLabelSettings(r,"calloutValue",e,s.valueDynamicFormatString,g,t),t=o&&null!=o.queryName?d.SelectionIdBuilder.builder().withMeasure(o.queryName).createSelectionId():void 0;return e.isHighContrast&&(a={visible:!0,color:d.ColorHelper.getThemeColor(e,d.ForegroundColorName),width:d.CartesianHelper.defaultLineStrokeWidth}),{maxLabel:this.createLabel(s.max,i.getValueMetadataColumn(d.gaugeRoleNames.maxValue),l,o),minLabel:this.createLabel(s.min,i.getValueMetadataColumn(d.gaugeRoleNames.minValue),n,o,s.max),target:{label:this.createLabel(s.target,i.getValueMetadataColumn(d.gaugeRoleNames.targetValue),u,o),ratio:this.getTargetRatio(s)},calloutLabel:this.createLabel(s.value,o,g,o),tooltipInfo:s.tooltipItems,formattedTooltip:d.tooltipUtils.formatTooltipInfo(s.tooltipItems),ratio:this.getValueRatio(s),dataPointSettings:this.convertDataPointSettings(r,e),identity:t,strokeSettings:a}},n.parseGaugeData=function(t){var e,a=t.columns,i=t.objects.getStaticObjects(),r=a.getValueMetadataColumn(d.gaugeRoleNames.y),o=i?i.axis:null,s=t.data.hasValues(d.gaugeRoleNames.y),n=t.data.hasValues(d.gaugeRoleNames.maxValue),l=t.data.hasValues(d.gaugeRoleNames.minValue),i={max:null,min:null,target:null,value:null,tooltipItems:[]};return s&&(i.value=t.data.getValue(d.gaugeRoleNames.y,0),i.valueDynamicFormatString=i.minDynamicFormatString=i.maxDynamicFormatString=t.data.getFormatString(d.gaugeRoleNames.y,0),e=d.converterHelper.formatFromMetadataColumn(i.value,r,d.gaugeProps.general.formatString,!1,i.valueDynamicFormatString),i.tooltipItems.push({displayName:t.data.getValueDisplayName(d.gaugeRoleNames.y),value:e})),t.data.hasValues(d.gaugeRoleNames.targetValue)?(a=a.getValueMetadataColumn(d.gaugeRoleNames.targetValue),i.target=t.data.getValue(d.gaugeRoleNames.targetValue,0),i.targetDynamicFormatString=t.data.getFormatString(d.gaugeRoleNames.targetValue,0),e=d.converterHelper.formatFromMetadataColumn(i.target,a,d.gaugeProps.general.formatString,!1,i.targetDynamicFormatString),i.tooltipItems.push({displayName:t.data.getValueDisplayName(d.gaugeRoleNames.targetValue),value:e})):o&&(i.target=o.target),n?(i.max=t.data.getValue(d.gaugeRoleNames.maxValue,0),i.maxDynamicFormatString=t.data.getFormatString(d.gaugeRoleNames.maxValue,0)):o&&null!=o.max?i.max=o.max:(i.max=1,s&&i.value&&0!==i.value&&(n=!1,!r||null!=(r=d.valueFormatter.getFormatString(r,d.gaugeProps.general.formatString,!0))&&(n=d.valueFormatter.getFormatMetadata(r).hasPercent),n||(i.max=i.value<0?0:2*i.value))),l?(i.min=t.data.getValue(d.gaugeRoleNames.minValue,0),i.minDynamicFormatString=t.data.getFormatString(d.gaugeRoleNames.minValue,0)):o&&null!=o.min?i.min=o.min:(i.min=0,s&&null!=i.value&&i.value<0&&(i.min=2*i.value)),d.TooltipBuilder.addTooltipMeasures(t,i.tooltipItems,0,void 0,d.gaugeProps.general.formatString),i},n.createLabel=function(t,e,a,i,r){var o=a.fontProperties,o=d.FontProperties.toTextProperties(o),r=this.getFormatter(a,e,i,r||t);return o.text=r.format(t),{value:t,requiredSpace:{width:s.TextMeasurementService.measureSvgTextWidth(o),height:s.TextMeasurementService.estimateSvgTextHeight(o)},text:o.text,formatter:r,settings:a}},n.getFormatter=function(t,e,a,i){i=0===t.displayUnits?i:null;e&&e.objects&&!_.isEmpty(s.DataViewObjects.getValue(e.objects,d.gaugeProps.general.formatString))||(e=a);a=t.dynamicFormatString||d.valueFormatter.getFormatString(e,d.gaugeProps.general.formatString),e=d.DataLabelViewModel.getLabelPrecision(t.precision,a),e=d.DataLabelViewModel.getOptionsForLabelFormatter(t,a,i,e);return e.formatSingleValues=!(0<t.displayUnits),0===t.displayUnits&&(e.value=i),d.valueFormatter.create(e)},n.getValueRatio=function(t){if(!_.isNumber(t.value)||!this.isValid(t)||t.value<=t.min)return 0;if(t.value>=t.max)return 1;var e=t.max-t.min;return(t.value-t.min)/e},n.isValid=function(t){return _.isNumber(t.min)&&_.isNumber(t.max)&&t.min<=t.max},n.getTargetRatio=function(t){if(!this.isValid(t)||!_.isNumber(t.target))return-1;var e=t.max-t.min;return 0!=e?(t.target-t.min)/e:0},n.convertDataLabelSettings=function(t,e,a,i,r,o){o=n.getDefaultGaugeLabelSettings(a,r,o);return o.dynamicFormatString=i,t&&(e=t[e],d.DataLabelViewModel.updateLabelSettingsFromLabelsObject(e,o,void 0,a)),o},n.convertDataPointSettings=function(t,e){var a=n.getDefaultDataPointSettings(e),e=d.ColorHelper.create(e);return{fillColor:e.getColorForPropertyWithDefaultColor(t,d.gaugeProps.dataPoint.fill,a.fillColor),targetColor:e.getColorForPropertyWithDefaultColor(t,d.gaugeProps.dataPoint.target,a.targetColor)}},d.GaugeConverter=n}(powerbi=powerbi||{}),define("SingleValueVisuals/gaugeModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createGauge=void 0,e.createGauge=function(t,e){return new powerbi.visuals.Gauge(t,e)}});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['singleValueVisuals.min.js'] || (this.parseTimeMarkers['singleValueVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
