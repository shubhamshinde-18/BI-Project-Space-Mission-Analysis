"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['slicerVisual.min.js'] || (this.parseTimeMarkers['slicerVisual.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('slicerVisual.min.js');var es6,powerbi,__extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t){for(var i=0,r=t.length,n=e.length;i<r;i++,n++)e[n]=t[i];return e},__awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(i,t){function r(e){try{o(l.next(e))}catch(e){t(e)}}function n(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,n)}o((l=l.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(i,r){var n,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(i,s)}catch(e){t=[6,e],o=0}finally{n=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(n){!function(r){var e;function t(e,t,i){this.columns=t,this.selectedDataPoints=i,this.column=e&&!_.isEmpty(e.categories)?e.categories[0]:null,this.column&&(this.objects=this.column.objects),this.count=this.column&&this.column.values?this.column.values.length:0,this.isImage=r.converterHelper.isImageUrlColumn(this.columns[0])}e=r.readers||(r.readers={}),t.prototype.getDataPointsCount=function(){return this.count},t.prototype.getMetadataColumn=function(){return this.column&&this.column.source||this.columns[0]},t.prototype.getDataViewDataPoint=function(e){var t,i;return this.count,this.objects&&(t=this.objects[e],i=n.DataViewObjects.getValue(t,r.slicerProps.general.count,i)),{scopeId:this.column.identity[e],count:i,value:this.column.values[e]}},t.prototype.isImageData=function(){return this.isImage},t.prototype.getLevel=function(){return 0},t.prototype.hasCount=function(){return!_.isEmpty(this.objects)},t.prototype.getSelectedNodes=function(){return this.selectedDataPoints},t.prototype.getMetadataColumns=function(){return this.column&&[this.column.source]},t.prototype.getIdentityExprs=function(){return this.column&&this.column.identityFields&&[this.column.identityFields]},e.SlicerCategoricalDataReader=t}(n.visuals||(n.visuals={}))}(powerbi=powerbi||{}),function(a){var s,t,i,l;function e(e){e&&(this.preventVirtualKeyboardOnTheFirstTap=e.preventVirtualKeyboardOnTheFirstTap,this.featureSwitches=e.featureSwitches),this.culture=a.formattingService.getCurrentCulture(),this.inputElements=[],this.eventsHelper=new s.SlicerUtil.EventsHelper;e=this.hostServices=e.hostServices;this.startInputLabel=e.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=e.getLocalizedString("Slicer_EndLabel")}s=a.visuals||(a.visuals={}),t=a.data.RangeFilterPattern,i=a.data.SQExprBuilder,l=jsCommon.StringExtensions,e.prototype.createRange=function(e){return new s.DateRange(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},e.prototype.getSliderOptions=function(e,t){return{min:0,max:s.DateUtil.getDifferenceInDays(e.bounds.max,e.bounds.min),step:1}},e.prototype.areEqual=function(e,t){return s.DateUtil.isEqual(e,t)},e.prototype.defaultValue=function(){return new Date(0)},e.prototype.startProperty=function(){return s.slicerProps.data.startDate},e.prototype.endProperty=function(){return s.slicerProps.data.endDate},e.prototype.formatValue=function(e,t){return a.formattingService.formatValue(e,"d")},e.prototype.parseSingleSliderValue=function(e,t){return null},e.prototype.inputStyleProperties=function(){return{background:s.slicerProps.date.background,fontColor:s.slicerProps.date.fontColor,textSize:s.slicerProps.date.textSize,fontFamily:s.slicerProps.date.fontFamily,bold:s.slicerProps.date.bold,italic:s.slicerProps.date.italic,underline:s.slicerProps.date.underline}},e.prototype.parseInput=function(e,t,i){return a.formattingService.parseDate(e)},e.prototype.isInputValid=function(e,t,i,r){return!(null==e||0===i&&e>t.max||1===i&&e<t.min)},e.prototype.setRange=function(e,t,i,r,n,o){null==n?(this.featureSwitches.useModernDatePickerSlicer||(i.val(a.formattingService.formatValue(e.min,"d")),r.val(a.formattingService.formatValue(e.max,"d"))),i.attr("aria-label",l.format(this.startInputLabel,a.formattingService.formatValue(o.min,"d"),a.formattingService.formatValue(e.max,"d"))),r.attr("aria-label",l.format(this.endInputLabel,a.formattingService.formatValue(e.min,"d"),a.formattingService.formatValue(o.max,"d")))):0===n?(this.featureSwitches.useModernDatePickerSlicer||i.val(a.formattingService.formatValue(e.min,"d")),i.attr("aria-label",l.format(this.startInputLabel,a.formattingService.formatValue(o.min,"d"),a.formattingService.formatValue(o.max,"d")))):1===n&&(this.featureSwitches.useModernDatePickerSlicer||r.val(a.formattingService.formatValue(e.max,"d")),r.attr("aria-label",l.format(this.endInputLabel,a.formattingService.formatValue(o.min,"d"),a.formattingService.formatValue(o.max,"d"))))},e.prototype.enumerateObjectInstances=function(e,t,i){if("date"===e.objectName&&t&&t.inputStyle){var r=s.slicerProps.date,e={selector:null,objectName:"date",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}};return i&&i.enableBIU&&(e.properties[r.bold.propertyName]=t.inputStyle.labelBold,e.properties[r.italic.propertyName]=t.inputStyle.labelItalic,e.properties[r.underline.propertyName]=t.inputStyle.labelUnderline),[e]}},e.prototype.getValuesCard=function(t,e){var i=this,r=s.slicerProps.date,n=new s.builder.FormattingCardBuilder(new s.builder.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[r.fontFamily,r.textSize,r.fontColor,r.background,r.bold,r.italic,r.underline],function(e){return i.hostServices.getLocalizedString(e)}),o=(new s.builder.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:t.inputStyle.fontFamily}).withFontSizeProperties({descriptor:r.textSize,value:t.inputStyle.textSize});e&&e.enableBIU&&o.withBold({descriptor:r.bold,value:t.inputStyle.labelBold}).withItalic({descriptor:r.italic,value:t.inputStyle.labelItalic}).withUnderline({descriptor:r.underline,value:t.inputStyle.labelUnderline});var a=o.build();return n.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",a),e.addSimpleSlice("color",function(){var e={value:t.inputStyle.fontColor};return new s.builder.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.inputStyle.background};return new s.builder.ColorPickerBuilder({descriptor:r.background,value:e}).build()})}),n.build()},e.prototype.getDataPointsForSingleValueRange=function(e){return[]},e.prototype.createInputElement=function(e,t){var i=this,r=this.culture.calendar.patterns.d,n=InJs.DomFactory.textBox().attr("type","text").attr(s.RangeSlicerConstants.DisableDragAttribute,"true").prop("readonly",!!this.preventVirtualKeyboardOnTheFirstTap).attr("placeholder",r).addClass(s.RangeSlicerConstants.InputClass.class).appendTo(e);e.attr("tabindex","0"),e.keydown(function(e){13!==e.keyCode&&32!==e.keyCode||n.focus()}),n.datepicker({showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,nextText:"",prevText:"",firstDay:this.culture.calendar.firstDay,dayNamesMin:this.culture.calendar.days.namesAbbr,dateFormat:this.culture.calendar.patterns.d.replace("yyyy","yy").toLowerCase(),monthNamesShort:this.culture.calendar.months.names,onClose:function(){n.prop("readonly",!!i.preventVirtualKeyboardOnTheFirstTap)}}),n.on("click",function(e){i.preventVirtualKeyboardOnTheFirstTap&&n.is("[readonly]")&&(n.prop("readonly",!1),n.blur()),n.datepicker("show")}),this.preventVirtualKeyboardOnTheFirstTap&&n.on("touchstart",function(e){n.is("[readonly]")||n.is(":focus")||n.focus()});var o=n.datepicker("widget");return o.attr("prevent-focus-loss","false"),n.attr("prevent-focus-loss","false"),n.datepicker("option","beforeShow",function(){o.addClass("themeableElement"),i.unregisterPopupHideEvents=i.eventsHelper.onPopupHideEvent(function(e,t){i.onPopupHideEvent(e,t)},e.get(0)),i.fixLayout(o,n,1e3)}),this.inputElements.push(n),n},e.prototype.onPopupHideEvent=function(e,t){"resize"!==e&&((t=$(t)).hasClass("hasDatepicker")||t.hasClass("ui-datepicker")||t.hasClass("ui-icon")||$(t).closest(".ui-datepicker").length)||this.hideDatepicker()},e.prototype.hideDatepicker=function(){this.unbindPopupHideEventHandlers();for(var e=0,t=this.inputElements;e<t.length;e++){var i=t[e];i.datepicker("widget").is(":visible")&&i.datepicker("hide").blur()}},e.prototype.onDestroy=function(){this.hideDatepicker()},e.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&this.unregisterPopupHideEvents()},e.prototype.fixLayout=function(e,t,i){var r=this;setTimeout(function(){e.is(":visible")?(s.SlicerHelper.fixWidgetPosition(e,t,null,!0),e.find(".ui-datepicker-current-day").addClass("backgroundToForegroundColor")):0<i&&r.fixLayout(e,t,i-20)},20)},e.prototype.filterExpr=function(e){e=t.roundUpDateRange(e);return{lower:i.dateTime(e.min),upper:i.dateTime(e.max)}},e.prototype.comparisonKind=function(){return{lower:2,upper:3}},e.prototype.addAriaDescription=function(e){var t=this.culture.calendar.patterns.d,t=a.formattingService.format(this.hostServices.getLocalizedString("DateSlicer_InputTextHint"),[t]);e.attr("aria-description",t)},s.DateSlicer=e}(powerbi=powerbi||{}),function(o){var a,n,s,l,c,d;function e(e,t){var i=this;this.DefaultRestatementColorName="foregroundDark",this.verticalSlicerRenderer=e,this.popup=$("<div ></div>").addClass("slicer-dropdown-popup"),jsCommon.BrowserUtils.isIOSWebView()&&this.popup.addClass(a.SlicerUtil.Selectors.DisableScrollHover.class),this.popup.on("slicer.dataPointSelected",function(e){i.strictSingleSelect&&(i.hidePopup(),e.stopPropagation())}),this.content=$("<div ></div>").addClass("slicer-dropdown-content"),this.loader=$("<div ></div>").addClass("slicer-dropdown-loader"),this.hostServices=t.hostServices,this.controlId="slicer-dropdown-popup-"+jsCommon.Utility.generateGuid(),this.popup.addClass("visual").attr("focus-nav-mode","Group").attr("id",this.controlId).keydown(function(e){27!==e.keyCode||i.popup.is(":hidden")?9!==e.keyCode||i.popup.is(":hidden")||(i.hidePopup(),jsCommon.FocusManager.focus(jsCommon.FocusGroupNavigation.getFocusNextElement(!0,i.menu.get(0))),e.preventDefault(),e.stopPropagation()):(i.hidePopup(),i.menu.focus(),e.preventDefault(),e.stopPropagation())}),$("body").append(this.popup),this.popup.append(this.content),this.popup.append(this.loader),this.featureSwitches=t.featureSwitches,this.eventsHelper=new a.SlicerUtil.EventsHelper}a=o.visuals||(o.visuals={}),n=jsCommon.FocusManager,s=a.Units.FontSize,l=jsCommon.PixelConverter,c="aria-expanded",d="focused",e.prototype.onClear=function(){this.verticalSlicerRenderer.onClear()},e.prototype.onModeChange=function(e){this.popup.remove(),this.verticalSlicerRenderer.onModeChange(e)},e.prototype.hasSlider=function(){return!1},e.prototype.supportsOrientation=function(){return!1},e.prototype.enumerateObjectInstances=function(e){return this.verticalSlicerRenderer.enumerateObjectInstances(e,this.featureSwitches)},e.prototype.getValuesCard=function(){return this.verticalSlicerRenderer.getValuesCard(this.featureSwitches)},e.prototype.getSlicerSettingsCardOptions=function(e,t){return this.verticalSlicerRenderer.getSlicerSettingsCardOptions(e,t)},e.prototype.getAdditionalCards=function(){return this.verticalSlicerRenderer.getAdditionalCards()},e.prototype.init=function(e,t){return this.container=t,this.style=e.visualInitOptions.style,this.slicerSelectionHandler=this.verticalSlicerRenderer.init(e,this.content),this.slicerSelectionHandler},e.prototype.onDestroy=function(){this.verticalSlicerRenderer&&this.verticalSlicerRenderer.onDestroy(),this.unbindPopupHideEventHandlers(),this.popup.remove()},e.prototype.render=function(e){this.options=e,this.data=this.verticalSlicerRenderer.converter(this.options.dataView,this.options.isSlicer),this.renderMenu(this.data.restatement),this.isExpanded&&this.showPopup(this.setFocus,!0)},e.prototype.renderMenu=function(e){var t,i,r,n=this;this.menu||(this.menu=InJs.DomFactory.div(),this.menu.addClass("slicer-dropdown-menu"),this.menu.attr(((r={role:"combobox","aria-haspopup":"listbox",tabindex:"0","aria-controls":this.controlId})[c]="false",r[a.RangeSlicerConstants.DisableDragAttribute]="true",r)),this.container.append(this.menu),this.menu.click(function(e){n.onRenderMenuClick(e),n.popup.removeClass(d)}),this.menu.on("touchstart keydown",function(e){e.preventDefault(),("touchstart"===e.type||40===e.keyCode&&!e.ctrlKey||38===e.keyCode&&!e.ctrlKey||32===e.keyCode||13===e.keyCode)&&n.onRenderMenuClick(e,!0)}),this.restatement=InJs.DomFactory.div(),this.restatement.addClass("slicer-restatement"),this.menu.append(this.restatement),this.icon=$("<i ></i>").addClass("dropdown-chevron"),this.icon.appendTo(this.menu)),this.menu.attr({"aria-label":this.options.restatement}),this.icon.addClass("powervisuals-glyph"),this.icon.addClass("chevron-down"),this.settings=this.defaultRestatementSetting(),this.options.dataView.metadata&&this.options.dataView.metadata.objects&&(t=this.options.dataView.metadata.objects,i=a.ColorHelper.create(this.style),r=a.FontProperties.createFromObjectOrStyle(o.DataViewObjects.getObject(t,"items"),{color:"fontColor",family:"fontFamily",size:"textSize"},i,this.style,"foregroundNeutralSecondary","lightLabel",{color:this.settings.fontColor,family:this.settings.fontFamily,size:s.createFromPt(this.settings.textSize)}),this.settings.fontColor=r.color,this.settings.fontFamily=r.family,this.settings.textSize=r.size.pt,this.settings.background=i.getColorForPropertyWithDefaultColor(t,a.slicerProps.items.background,this.settings.background),this.strictSingleSelect=o.DataViewObjects.getValue(t,a.slicerProps.selection.strictSingleSelect,this.strictSingleSelect)),this.restatement.text(e),this.menu.css({"background-color":this.settings.background||"",color:this.settings.fontColor,"font-size":l.fromPointToPixel(this.settings.textSize),"font-family":this.settings.fontFamily}),this.popup.css({"background-color":this.settings.background||""})},e.prototype.onRenderMenuClick=function(e,t){if(e.stopPropagation(),this.popup.is(":hidden"))return this.isExpanded=!0,this.setFocus=t,this.hostServices.setShouldDeferData(!1),this.loader.css({"background-color":this.settings.background||""}),this.loader.show(),this.popup.addClass(d),void this.showPopup(!1,!1);this.popup.removeClass(d),this.hidePopup()},e.prototype.showPopup=function(t,i){var r=this;window.requestAnimationFrame(function(){var e;r.popup&&(r.unbindPopupHideEventHandlers(),e=r.menu.width()+10,r.popup.css({width:e}),r.menu.attr(c,"true"),r.icon.removeClass("chevron-down"),r.icon.addClass("chevron-up"),a.SlicerHelper.fixWidgetPosition(r.popup,r.menu,null,!0),i&&r.verticalSlicerRenderer.renderVerticalSlicer(r.data,r.options,function(){r.loader.hide(),r.focusCallbackTimeout&&window.clearTimeout(r.focusCallbackTimeout),r.focusCallbackTimeout=window.setTimeout(function(){t&&n.focusChildInGroup(r.popup.get(0)),r.focusCallbackTimeout=void 0,r.setFocus=!1},0)}),r.unregisterPopupHideEvents=r.eventsHelper.onPopupHideEvent(function(e,t){r.onPopupHideEvent(e,t)},r.menu.get(0),r.popup.get(0),!0),r.popup.show())})},e.prototype.hidePopup=function(){this.popup&&(this.isResize=!1,this.isExpanded=!1,this.popup.hide(),this.hostServices.setShouldDeferData(!0),this.menu.attr(c,"false"),this.icon.removeClass("chevron-up"),this.icon.addClass("chevron-down"),this.unbindPopupHideEventHandlers())},e.prototype.onPopupHideEvent=function(e,t){"resize"!==e?("focusin"===e&&(this.isResize=!1),(t=$(t)).parents(".slicer-dropdown-popup").length||t.is(this.menu)||this.menu.find(t).length||this.isResize||this.hidePopup()):this.isResize=!0},e.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&(this.unregisterPopupHideEvents(),this.unregisterPopupHideEvents=void 0)},e.prototype.defaultRestatementSetting=function(){return{textSize:10,fontFamily:a.Font.Family.regular.css,fontColor:a.ColorHelper.getThemeColor(this.style,this.DefaultRestatementColorName),background:this.style.isHighContrast?a.ColorHelper.getThemeColor(this.style,a.BackgroundColorName):void 0}},a.DropdownSlicerRenderer=e}(powerbi=powerbi||{}),function(e){var t;t=e.visuals||(e.visuals={}),t=(e=t.HorizontalSlicer||(t.HorizontalSlicer={})).Selectors||(e.Selectors={}),e=jsCommon.CssConstants.createClassAndSelector,t.container=e("horizontalSlicerContainer"),t.ItemsContainer=e("slicerItemsContainer"),t.NavigationArrow=e("navigationArrow"),t.LeftNavigationArrow=e("left"),t.RightNavigationArrow=e("right"),t.MultiSelectEnabled=e("isMultiSelectEnabled"),t.FlexDisplay=e("flexDisplay"),t.CanScrollRight=e("canScrollRight"),t.CanScrollLeft=e("canScrollLeft"),t.IndividualItemContainer=e("individualItemContainer"),t.ImageContainer=e("horizontalImageContainer"),t.HorizontalSlicerImage=e("horizontalSlicerImage"),t.Input=e("slicerCheckbox")}(powerbi=powerbi||{}),function(y){!function(l){var n=jsCommon.Utility,f=jsCommon.PixelConverter,v={marginRight:2,paddingLeft:8,paddingRight:8},e=(t.prototype.hasSlider=function(){return!1},t.prototype.getDefaultValue=function(){if(this.data&&!_.isEmpty(this.data.defaultValueByLevel))return this.data.defaultValueByLevel[0].value},t.prototype.getIdentityFields=function(){return l.SlicerUtil.DefaultValueHandler.getIdentityFields(this.dataView)},t.prototype.supportsOrientation=function(){return!0},t.prototype.getSlicerSettings=function(e){return e&&e.slicerSettings||l.DataConversion.DefaultSlicerProperties(this.style)},t.prototype.enumerateObjectInstances=function(e){var t=this.originalData,i=this.getSlicerSettings(t);return l.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(e,t,i,this.dataView,this.featureSwitches)},t.prototype.getValuesCard=function(){var e=this.originalData,t=this.getSlicerSettings(e);return l.SlicerUtil.ObjectEnumerator.getValuesCard(this.hostServices,e,t,this.expressionBasedFormatting,this.featureSwitches)},t.prototype.getSlicerSettingsCardOptions=function(e,t){var i=this.originalData,r=(r=i?i.slicerSettings:void 0)||l.DataConversion.DefaultSlicerProperties(this.style);return l.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:r,data:i,dataView:this.dataView,hostServices:this.hostServices,orientation:t})},t.prototype.getAdditionalCards=function(){var e=this.originalData,t=(t=e?e.slicerSettings:void 0)||l.DataConversion.DefaultSlicerProperties(this.style);return l.SlicerUtil.ObjectEnumerator.getAdditionalCards(this.hostServices,e,t,this.dataView)},t.prototype.onModeChange=function(e){l.SlicerUtil.clearSlicerFilter(this.hostServices,e)},t.prototype.getRestatement=function(){return this.data&&this.data.restatement},t.prototype.onClear=function(e){l.SlicerUtil.clearFilters(this.selectionHandler,e)},t.prototype.init=function(e,t){var r=this;this.element=t,this.currentViewport=e.visualInitOptions.viewport;var i=this.hostServices=e.visualInitOptions.host;this.style=e.visualInitOptions.style,this.behavior&&(this.selectionHandler=new l.SlicerSelectionHandler(i,this.behavior)),this.loadMoreData=function(){return e.loadMoreData()};var n=document.createElement("div");n.className=l.HorizontalSlicer.Selectors.container.class;t=this.container=d3.select(n);this.searchComponent.create(t);var i=this.body=t.append("div").classed(l.SlicerUtil.Selectors.Body.class+" "+l.HorizontalSlicer.Selectors.FlexDisplay.class,!0),o={color:l.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")},a={color:l.ColorHelper.getThemeColor(this.style,"foreground")};this.leftNavigationArrow=i.append("button").call(this.horizontalSlicerLayout.getNavigationArrowsClass,!0).attr("aria-label",this.hostServices.getLocalizedString("Previous_ButtonText")).attr("tabindex",-1).styles(o).on("pointerover",function(){return r.leftNavigationArrow.styles(a)}).on("pointerleave",function(){return r.leftNavigationArrow.styles(o)}),this.itemsContainer=i.append("div").classed(l.HorizontalSlicer.Selectors.ItemsContainer.class+" "+l.HorizontalSlicer.Selectors.FlexDisplay.class,!0).attr("tabindex","0").attr("role","listbox");t=this.itemsContainer.node();return $(t).on("keydown",function(e){var t=e.keyCode,i=39===t||40===t;!i&&(37!==t&&38!==t)||(r.focusNextElement(i),e.stopPropagation())}),this.rightNavigationArrow=i.append("button").call(this.horizontalSlicerLayout.getNavigationArrowsClass,!1).attr("aria-label",this.hostServices.getLocalizedString("Next_ButtonText")).attr("tabindex",-1).styles(o).on("pointerover",function(){return r.rightNavigationArrow.styles(a)}).on("pointerleave",function(){return r.rightNavigationArrow.styles(o)}),this.element.get(0).appendChild(n),this.bindNavigationEvents(),this.selectionHandler},t.prototype.render=function(e){this.hasSearchableData=e.hasSearchableData;var t=this.hostServices.getLocalizedString(l.SlicerUtil.DisplayNameKeys.SelectAll),i=e.dataView;if(this.originalData=this.data=l.DataConversion.convert({dataView:i,localizedSelectAllText:t,selectionHandler:this.selectionHandler,hostServices:this.hostServices,style:this.style,isSlicer:e.isSlicer,featureSwitches:this.featureSwitches,slicerType:1}),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(e.viewport,this.originalData,i)),this.updateItemsContainerLabel(),this.updateStyle(this.hasSearchableData),!i||!this.data||_.isEmpty(this.data.slicerDataPoints))return this.itemsContainer.selectAll("*").remove(),void(this.itemsToDisplay=0);this.dataView=i,this.currentViewport&&e.viewport&&(this.currentViewport.height!==e.viewport.height||this.currentViewport.width!==e.viewport.width)&&!this.isMaxDimensionsNeedsReCalculate()||this.calculateAndSetMaxItemDimensions(),this.currentViewport=e.viewport,this.itemsToDisplay=this.horizontalSlicerLayout.calculateNumberOfItemsToDisplay(this.element,this.totalItemWidth,this.totalItemHeight,this.getDataPointsCount()),0!==this.itemsToDisplay&&this.renderCore()},t.prototype.renderCore=function(){this.horizontalSlicerLayout.renderCore&&this.horizontalSlicerLayout.renderCore(this.container);var e,t,i,r,n,o,a,s=this.data;s&&s.slicerDataPoints&&(this.normalizePosition(),e=this.getDataPointsCount(),t=this.itemsToDisplay,r=(i=this.dataStartIndex)+this.itemsToDisplay<=e-1,n=0<i,o=this.container.classed(l.HorizontalSlicer.Selectors.CanScrollRight.class)&&!r&&document.activeElement===this.rightNavigationArrow.node(),a=this.container.classed(l.HorizontalSlicer.Selectors.CanScrollLeft.class)&&!n&&document.activeElement===this.leftNavigationArrow.node(),(o||a)&&this.itemsContainer.node().focus(),this.container.classed(l.HorizontalSlicer.Selectors.CanScrollRight.class,r),this.container.classed(l.HorizontalSlicer.Selectors.CanScrollLeft.class,n),this.renderItems(s.slicerSettings),this.bindInteractivityService(),.8*e<=i+t&&this.loadMoreData())},t.prototype.updateStyle=function(e){var t=this.data,i=t&&t.slicerSettings,e=e&&i.search.enabled;this.searchComponent.update(i,t&&t.searchKey,e,!1),i&&this.container.classed(l.HorizontalSlicer.Selectors.MultiSelectEnabled.class,!i.selection.singleSelect)},t.prototype.renderItems=function(e){var n=this,t=this.itemsToDisplay,i=this.dataStartIndex,t=this.data.slicerDataPoints.slice(i,i+t),t=this.horizontalSlicerLayout.bindData(t,this.data,this.itemsContainer),o=t.enter().append("div").classed(l.HorizontalSlicer.Selectors.IndividualItemContainer.class,!0).classed("containerBackground",!e.items.accessibilityContrastProperties).classed("containerBackgroundContrast",e.items.accessibilityContrastProperties).attr("role","option").attr("tabindex",0).each(function(e){var t=d3.select(this);e.isImage?((e=t.append("div").classed(l.HorizontalSlicer.Selectors.ImageContainer.class,!0)).append("div").classed(l.HorizontalSlicer.Selectors.Input.class,!0).append("input").attr("type","checkbox"),e.append("img").classed(l.HorizontalSlicer.Selectors.HorizontalSlicerImage.class,!0)):t.append("div").classed(l.SlicerUtil.Selectors.LabelText.class,!0).classed(l.HorizontalSlicer.Selectors.FlexDisplay.class,!0)}).merge(t);o.each(function(e){var t=d3.select(this);l.SlicerUtil.updateDisableState(t,e),t.attr("aria-label",e.tooltip).attr("aria-setsize",-1).attr("aria-posinset",e.levelIndex||1)}),o.attr("aria-selected",function(e){return!0===e.selected}),o.order(),o.select(l.SlicerUtil.Selectors.LabelText.selector).styles({"padding-left":f.toString(v.paddingLeft),"padding-right":f.toString(v.paddingRight)}),o.styles({"margin-right":function(e,t){return n.horizontalSlicerLayout.getDataPointRightMargin(t,n.itemsToDisplay)}}),this.domHelper.setSlicerTextStyle(o,e,this.featureSwitches),t.exit().remove(),this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=window.requestAnimationFrame(function(){o.select("img").attr("title",function(e){return e.tooltip}).attr("src",function(e){return e.value}),o.select(l.SlicerUtil.Selectors.LabelText.selector).attr("title",function(e){return e.tooltip}).text(function(e){return e.value});var e=n.element.find(l.SlicerUtil.Selectors.LabelText.selector),t=e.first(),i=t.height(),r=t.width();e.each(function(e,t){y.TextMeasurementService.wordBreakOverflowingText(t,r,i)})})},t.prototype.bindInteractivityService=function(){var e,t,i,r=l.HorizontalSlicer.Selectors.IndividualItemContainer.selector;this.selectionHandler&&this.body&&(e=this.body.selectAll(r),t=this.data,(i=this.searchComponent.input).empty()||(r=i.node().value,(_.isEmpty(r)||_.isEmpty(t.searchKey))&&i.property("value",t.searchKey)),i={slicerContainer:this.container,itemsContainer:e,settings:t.slicerSettings,searchInput:i,style:this.style},this.selectionHandler.bind(t.retainedDataPoints,{behaviorOptions:i,orientation:1})),this.behavior.renderSelection()},t.prototype.normalizePosition=function(){var e=this.getDataPointsCount(),e=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,e);this.dataStartIndex=n.clampValue(this.dataStartIndex,0,e)},t.prototype.bindNavigationEvents=function(){this.registerMouseWheelScrollEvents(),this.registerMouseClickEvents()},t.prototype.registerMouseClickEvents=function(){var e=this,t=this.container.selectAll(l.HorizontalSlicer.Selectors.RightNavigationArrow.selector),i=this.container.selectAll(l.HorizontalSlicer.Selectors.LeftNavigationArrow.selector);t.on("click",function(){e.scrollRight()}),i.on("click",function(){e.scrollLeft()})},t.prototype.registerMouseWheelScrollEvents=function(){var t=this,e=this.body.node();e.addEventListener("mousewheel",function(e){t.onMouseWheel(e.wheelDelta)}),e.addEventListener("DOMMouseScroll",function(e){t.onMouseWheel(e.detail)})},t.prototype.onMouseWheel=function(e){e<0?this.scrollRight():0<e&&this.scrollLeft()},t.prototype.scrollRight=function(){var e=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,this.getDataPointsCount());this.dataStartIndex!==e&&(this.dataStartIndex+=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.min(this.dataStartIndex,e),this.renderCore())},t.prototype.scrollLeft=function(){0!==this.dataStartIndex&&(this.dataStartIndex-=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.max(this.dataStartIndex,0),this.renderCore())},t.prototype.getScaledTextWidth=function(e){return e/jsCommon.TextSizeDefaults.TextSizeMin*80},t.prototype.isMaxDimensionsNeedsReCalculate=function(){if(!this.lastCalculatedProperties)return!0;var e=this.data.slicerSettings,t=e.general.outlineWeight,i=e.slicerText,r=i.outline,n=i.outlineStyle,o=i.textSize,e=i.fontFamily,i=this.lastCalculatedProperties;return i.textSize!==o||i.fontFamily!==e||i.outline!==r||i.outlineStyle!==n||i.outlineWeight!==t||i.hasImage!==this.data.hasImages},t.prototype.calculateAndSetMaxItemDimensions=function(){var e=this.data,t=this.data.slicerSettings,i=this.getDataPointsCount(),r=0,n=0,o=t.slicerText.outline,a=t.slicerText.outlineStyle,s=t.general.outlineWeight;if(0===i)n=r=0;else if(e.hasImages)n=r=100;else{var l=e.slicerDataPoints,c=Math.min(i,50),d=jQuery.extend(!0,{},this.textProperties),u=t.slicerText.textSize,p=t.slicerText.fontFamily;d.fontSize=f.fromPoint(u),d.fontFamily=p,d.text="Sample";for(var h=jsCommon.WordBreaker.getMaxWordWidth,S=y.TextMeasurementService.measureSvgTextHeight(d),m=0;m<c;m++){var g=l[m].value;d.text=g;r=Math.max(r,h(g,y.TextMeasurementService.measureSvgTextWidth,d)),g=Math.min(2,jsCommon.WordBreaker.wordCount(g)),n=Math.max(n,S*g)}r=Math.min(r,this.getScaledTextWidth(u))}i=v.paddingLeft+v.paddingRight+v.marginRight,t=this.featureSwitches.outlineDropdownToCheckboxes?a:o,t=this.domHelper.getRowsOutlineWidth(t,s);this.totalItemWidth=r+i+t,this.totalItemHeight=n+i+t;t=this.horizontalSlicerLayout.calculateTotalItemDimensions(this.totalItemWidth,this.totalItemHeight);this.totalItemWidth=t.width,this.totalItemHeight=t.height,this.lastCalculatedProperties={outline:o,outlineStyle:a,outlineWeight:s,textSize:u,fontFamily:p,hasImage:e.hasImages}},t.prototype.focusNextElement=function(e){var t,i,r=this.horizontalSlicerLayout.findNextElement(document.activeElement,e);r||(e?this.scrollRight():this.scrollLeft(),t=this.itemsContainer.node(),i=document.activeElement,t.contains(i)||(i=t),r=this.horizontalSlicerLayout.findNextElement(i,e)),r&&r.focus()},t.prototype.updateItemsContainerLabel=function(){var e;null!==(e=this.data)&&void 0!==e&&e.categorySourceName&&this.itemsContainer.attr("aria-label",this.data.categorySourceName)},t.prototype.getDataPointsCount=function(){return _.size(this.data.slicerDataPoints)},t.prototype.addWarnings=function(e){l.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},t);function t(e,t){this.viewModelAdapter=t,this.textProperties={fontFamily:l.Font.Family.regular.css,fontSize:"14px"},e&&(this.horizontalSlicerLayout=e.horizontalSlicerLayout,t=e.featureSwitches,this.featureSwitches=e.featureSwitches,this.expressionBasedFormatting=t&&t.expressionBasedFormatting),this.behavior=new l.SlicerWebBehavior,this.horizontalSlicerLayout||(this.horizontalSlicerLayout=new i),this.domHelper=new l.SlicerUtil.DOMHelper,this.dataStartIndex=0,this.searchComponent=new l.SlicerSearchInput(this.featureSwitches,null==e?void 0:e.hostServices)}l.HorizontalSlicerRenderer=e;var i=(o.prototype.bindData=function(e,t,i){return i.selectAll(l.HorizontalSlicer.Selectors.IndividualItemContainer.selector).data(e,function(e){return l.SlicerUtil.getDataPointKey(e)})},o.prototype.calculateTotalItemDimensions=function(e,t){return{width:e,height:t}},o.prototype.calculateNumberOfItemsToDisplay=function(e,t,i,r){e=e.find(l.SlicerUtil.Selectors.Body.selector).width()-2*o.NavigationArrowWidth;if(0===t)return 0;t=Math.round(e/t);return n.clampValue(t,1,r)},o.prototype.findNextElement=function(e,t){return $(e).hasClass(l.HorizontalSlicer.Selectors.ItemsContainer.class)?t?e.firstElementChild:void 0:t?e.nextElementSibling:e.previousElementSibling},o.prototype.getNavigationArrowsClass=function(e,t){t?e.classed(l.HorizontalSlicer.Selectors.NavigationArrow.class,!0).classed(l.HorizontalSlicer.Selectors.LeftNavigationArrow.class,!0):e.classed(l.HorizontalSlicer.Selectors.NavigationArrow.class,!0).classed(l.HorizontalSlicer.Selectors.RightNavigationArrow.class,!0)},o.prototype.getScrollSize=function(e){return 1===e?e:e-1},o.prototype.getLastStartIndex=function(e,t){return t-e},o.prototype.getDataPointRightMargin=function(e,t){return this.isLastRowItem(e,t)?"0px":f.toString(v.marginRight)},o.prototype.isLastRowItem=function(e,t){return e===t-1},o.NavigationArrowWidth=19,o);function o(){}l.HorizontalSlicerLayout=i}(y.visuals||(y.visuals={}))}(powerbi=powerbi||{}),function(e){var i;function t(){}i=e.visuals||(e.visuals={}),t.prototype.bindEvents=function(e,t){this.selectionHandler=t,this.slicerSettings=e.settings,this.style=e.style,this.items=e.itemsContainer,i.SlicerWebBehavior.bindSlicerEvents(e,this.items,t,this.slicerSettings)},t.prototype.renderSelection=function(){i.SlicerWebBehavior.setSelectionOnSlicerItems(this.items,this.selectionHandler,this.style)},i.HorizontalSlicerWebBehavior=t}(powerbi=powerbi||{}),function(r){!function(s){var l=r.visuals.builder,t=r.data.SQExprBuilder,a=jsCommon.StringExtensions;s.NumericSlicerOptions=r.createEnumType([{value:s.slicerMode.between,displayName:function(e){return e.get("Visual_SliderMode_Between")}},{value:s.slicerMode.before,displayName:function(e){return e.get("Visual_SliderMode_LessThanEqualLabel")}},{value:s.slicerMode.after,displayName:function(e){return e.get("Visual_SliderMode_GreaterThanEqualLabel")}},{value:s.slicerMode.basic,displayName:function(e){return e.get("Visual_SliderMode_Basic")}},{value:s.slicerMode.dropdown,displayName:function(e){return e.get("Visual_SliderMode_Dropdown")}},{value:s.slicerMode.single,displayName:function(e){return e.get("Visual_SliderMode_SingleVal")}}]);var e=(i.prototype.createRange=function(e){return new(e.isSourceInteger?s.NonScaledNumericRange:s.NumericRange)(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},i.prototype.areEqual=function(e,t){return e===t},i.prototype.defaultValue=function(){return 0},i.prototype.startProperty=function(){return s.slicerProps.data.numericStart},i.prototype.endProperty=function(){return s.slicerProps.data.numericEnd},i.prototype.parseSingleSliderValue=function(e,t){e=t[e];return{min:e,max:e}},i.prototype.formatValue=function(e,t){return t?t.format(e):e.toString()},i.prototype.getSliderOptions=function(e,t){return t?{min:0,max:e.dataPoints.length-1,step:1}:e.isSourceInteger?{min:e.bounds.min,max:e.bounds.max,step:1}:{min:e.bounds.min,max:e.bounds.max,step:null}},i.prototype.inputStyleProperties=function(){return{background:s.slicerProps.numericInputStyle.background,fontColor:s.slicerProps.numericInputStyle.fontColor,textSize:s.slicerProps.numericInputStyle.textSize,fontFamily:s.slicerProps.numericInputStyle.fontFamily,bold:s.slicerProps.numericInputStyle.bold,italic:s.slicerProps.numericInputStyle.italic,underline:s.slicerProps.numericInputStyle.underline}},i.prototype.parseInput=function(e,t,i){e=parseFloat(e);return!i||!$.isNumeric(e)||-1<_.indexOf(t,e)?e:this.findClosestPoint(e,t)},i.prototype.findClosestPoint=function(e,t){for(var i=_.head(t),r=Math.abs(i-e),n=1;n<t.length;n++){var o=Math.abs(t[n]-e);o<r&&(r=o,i=t[n])}return i},i.prototype.isInputValid=function(e,t,i,r){return!(!$.isNumeric(e)||0===i&&e>t.max||1===i&&e<t.min||r&&e===t.min)},i.prototype.setRange=function(e,t,i,r,n,o){e.min,e.max,null==n?(i.val(t.format(e.min)),i.attr("aria-label",a.format(this.startInputLabel,t.format(o.min),t.format(e.max))),r.val(t.format(e.max)),r.attr("aria-label",a.format(this.endInputLabel,t.format(e.min),t.format(o.max)))):0===n?(i.val(t.format(e.min)),i.attr("aria-label",a.format(this.startInputLabel,t.format(o.min),t.format(o.max)))):1===n&&(r.val(t.format(e.max)),r.attr("aria-label",a.format(this.endInputLabel,t.format(o.min),t.format(o.max))))},i.prototype.createInputElement=function(e,t){return InJs.DomFactory.textBox().attr("type","text").attr(s.RangeSlicerConstants.DisableDragAttribute,"true").addClass(s.RangeSlicerConstants.InputClass.class).appendTo(e)},i.prototype.enumerateObjectInstances=function(e,t,i){if("numericInputStyle"===e.objectName&&t&&t.inputStyle){var r=s.slicerProps.numericInputStyle,e={selector:null,objectName:"numericInputStyle",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}};return i&&i.enableBIU&&(e.properties[r.bold.propertyName]=t.inputStyle.labelBold,e.properties[r.italic.propertyName]=t.inputStyle.labelItalic,e.properties[r.underline.propertyName]=t.inputStyle.labelUnderline),[e]}},i.prototype.getValuesCard=function(t,e){var i=this,r=s.slicerProps.numericInputStyle,n=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[r.fontFamily,r.textSize,r.fontColor,r.background,r.bold,r.italic,r.underline],function(e){return i.hostServices.getLocalizedString(e)}),o=(new l.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:t.inputStyle.fontFamily}).withFontSizeProperties({descriptor:r.textSize,value:t.inputStyle.textSize});e&&e.enableBIU&&o.withBold({descriptor:r.bold,value:t.inputStyle.labelBold}).withItalic({descriptor:r.italic,value:t.inputStyle.labelItalic}).withUnderline({descriptor:r.underline,value:t.inputStyle.labelUnderline});var a=o.build();return n.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",a),e.addSimpleSlice("color",function(){var e={value:t.inputStyle.fontColor};return new l.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.inputStyle.background};return new l.ColorPickerBuilder({descriptor:r.background,value:e}).build()})}),n.build()},i.prototype.getDataPointsForSingleValueRange=function(e){e=e.categorical.categories[0],e=e&&e.values||[],e=_.filter(e,function(e){return $.isNumeric(e)}),e=_.sortBy(e,function(e){return e});return e=_.uniq(e)},i.prototype.filterExpr=function(e){return{lower:t.double(e.min),upper:t.double(e.max)}},i.prototype.comparisonKind=function(){return{lower:2,upper:4}},i);function i(e){this.hostServices=e.hostServices,this.startInputLabel=this.hostServices.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=this.hostServices.getLocalizedString("Slicer_EndLabel")}s.NumericSlicer=e}(r.visuals||(r.visuals={}))}(powerbi=powerbi||{}),function(x){!function(l){var o=x.visuals.builder,s=jsCommon.Color,i=jsCommon.CssConstants,c=l.Units.FontSize,r=jsCommon.PixelConverter,d=x.data.SQExprBuilder,n="Segoe UI,wf_segoe-ui_normal,helvetica,arial,sans-serif",a=i.createClassAndSelector("date-slicer-range"),u=i.createClassAndSelector("date-slicer"),p=i.createClassAndSelector("date-slicer-head"),h=i.createClassAndSelector("date-slicer-slider"),S=i.createClassAndSelector("date-slicer-control"),t=i.createClassAndSelector("roundHandles"),m=i.createClassAndSelector("wrap");l.DateSlicerClass=i.createClassAndSelector("date-slicer-datepicker"),l.DateSlicerWrapperClass=i.createClassAndSelector("date-slicer-datepicker-wrapper");var g,f=i.createClassAndSelector("noUi-connect"),v=i.createClassAndSelector("noUi-connects"),y=i.createClassAndSelector("noUi-background"),b=i.createClassAndSelector("noUi-handle"),C="foregroundNeutralSecondary";(e=g=l.RangeSlicerConstants||(l.RangeSlicerConstants={})).InputClass=i.createClassAndSelector("date-slicer-input"),e.DisableDragAttribute="drag-resize-disabled",l.RangeSlicerSupportedModes=[l.slicerMode.after,l.slicerMode.before,l.slicerMode.between];var e=(Object.defineProperty(w.prototype,"defaultSliderMode",{get:function(){return this.singleValue?l.slicerMode.single:l.slicerMode.between},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"activeMode",{get:function(){return this.data.mode||this.defaultSliderMode},enumerable:!1,configurable:!0}),w.prototype.init=function(e,t){this.host=t,this.style=e.visualInitOptions.style,this.featureSwitches=e.visualInitOptions.featureSwitches},w.prototype.onModeChange=function(e){-1<_.indexOf(l.RangeSlicerSupportedModes,e)?this.data&&this.updateMode(e):l.SlicerUtil.clearSlicerFilter(this.hostServices,e)},w.prototype.onClear=function(){var e;this.data&&this.data.initialValue&&(this.data.value=this.data.initialValue,this.data.state=0,this.updateProperties(),e=this.hostServices.getLocalizedString("Slicer_ClearSelectionsCleared"),this.hostServices.alertWithDebounce("announce-clear-selection",e))},w.prototype.render=function(e){if(_.isEmpty(e.dataView))this.hostServices.setWarnings([new l.DateSlicerNoDataWarning]);else{if(this.dataView=e.dataView,this.reader=x.data.createDataViewCategoricalReaderAdvanced(this.dataView),this.originalData=this.data=this.converter(this.reader,e),!this.isMetaColumnsValid(this.reader))return this.hostServices.setWarnings([new l.DateSlicerNoDataWarning]),void(this.isRendered&&this.disableSlicer());this.isRendered&&this.enableSlicer(),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(e.viewport,this.originalData,this.dataView)),this.isRendered||this.initControls(),this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,null,this.data.bounds),this.range=this.rangeSlicerRenderer.createRange(this.data),this.updateInputControls(),this.updateSlider(this.activeMode),this.updateProperties(),this.isDataColumnsValid(this.reader)||(this.hostServices.setWarnings([new l.DateSlicerNoDataWarning]),this.isRendered&&this.disableSlicer())}},w.prototype.hasSlider=function(){return!!this.data&&this.data.sliderSettings.show},w.prototype.supportsOrientation=function(){return!1},w.prototype.enumerateObjectInstances=function(e){var t=this.originalData;return"date"===e.objectName||"numericInputStyle"===e.objectName?this.rangeSlicerRenderer.enumerateObjectInstances(e,t,this.featureSwitches):"slider"===e.objectName&&t?[{selector:null,objectName:"slider",properties:{show:t.sliderSettings.show,color:t.sliderSettings.color},propertyInstanceKind:{color:this.featureSwitches.expressionBasedFormatting?3:1}}]:void 0},w.prototype.getSlicerSettingsCardOptions=function(){},w.prototype.getValuesCard=function(){var e=this.originalData;if(e)return this.rangeSlicerRenderer.getValuesCard(e,this.featureSwitches)},w.prototype.getAdditionalCards=function(){var t=this,i=this.originalData;if(i){var r=l.slicerProps.slider,e=[r.show,r.color,r.handleFillColor,r.handleBorderColor,r.secondaryLineColor],n=new o.FormattingCardBuilder(new o.FormattingCardUidBuilder("slider"),"Slicer_Slider",e,function(e){return t.hostServices.getLocalizedString(e)});return n.addTopLevelToggle("show",function(){return new l.builder.ToggleSwitchBuilder({descriptor:r.show,value:i.sliderSettings.show}).build()}),null!==(e=this.featureSwitches)&&void 0!==e&&e.slicerSliderColors?n.addGroup("handles",function(e){e.withDisplayName("Slicer_Handles"),t.data.sliderSettings.drawRoundSliderHandles?e.addSimpleSlice("fill",function(){var e={value:i.sliderSettings.handleFillColor};return new o.ColorPickerBuilder({descriptor:r.handleFillColor,value:e}).build()}).addSimpleSlice("border",function(){var e={value:i.sliderSettings.handleBorderColor};return new o.ColorPickerBuilder({descriptor:r.handleBorderColor,value:e}).build()}):e.addSimpleSlice("color",function(){var e={value:i.sliderSettings.handleBorderColor};return new o.ColorPickerBuilder({descriptor:r.handleBorderColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")})}).addGroup("primaryLine",function(e){e.withDisplayName("Primary_Line").addSimpleSlice("primaryLineColor",function(){var e={value:i.sliderSettings.primaryLineColor};return new o.ColorPickerBuilder({descriptor:r.color,value:e}).build()},function(e){return e.withCustomDisplayName("Visual_LegendTitleColor")})}).addGroup("secondaryLine",function(e){e.withDisplayName("Visual_Secondary_Line").addSimpleSlice("secondaryLineColor",function(){var e={value:i.sliderSettings.secondaryLineColor};return new o.ColorPickerBuilder({descriptor:r.secondaryLineColor,value:e}).build()})}):n.addGroup("colors",function(e){e.withDisplayName("Generic_Color").addSimpleSlice("color",function(){var e={value:i.sliderSettings.color};return new o.ColorPickerBuilder({descriptor:r.color,value:e}).build()})}),[n.build()]}},w.prototype.isDataColumnsValid=function(e){if(this.singleValue)return 0<e.columns.getCategoryCount();e=e.columns.getMetadataColumns(l.slicerRoles.value);if(!_.isEmpty(e)){e=e[0];if(e.aggregates&&null!=e.aggregates.min&&null!=e.aggregates.max)return!0}return!1},w.prototype.isMetaColumnsValid=function(e){e=e.columns.getMetadataColumns(l.slicerRoles.value);return!_.isEmpty(e)},w.prototype.converter=function(e,t){var i={state:0,mode:null,formatter:null,identity:null,value:null,initialValue:null,bounds:null,filter:null,properties:{filter:null},sliderSettings:(n=this.style,{color:l.ColorHelper.getThemeColor(n,C),show:!0,drawRoundSliderHandles:!1,minSliderVisibilityHeight:0,minSliderVisibilityWidth:150,handleFillColor:l.ColorHelper.getThemeColor(n,"background"),handleBorderColor:l.ColorHelper.getThemeColor(n,C),primaryLineColor:l.ColorHelper.getThemeColor(n,C),secondaryLineColor:l.ColorHelper.getThemeColor(n,"foregroundNeutralLight")}),inputStyle:(o=this.style,{textSize:9,fontFamily:l.Font.Family.regular.css,fontColor:l.ColorHelper.getThemeColor(o,"foregroundDark"),background:null,labelBold:!1,labelItalic:!1,labelUnderline:!1}),dataPoints:null,wrapRangeBoxes:!1,isSourceInteger:!1,hideDatePickerButton:!0},r=e.columns.getMetadataColumns(l.slicerRoles.value)[0],n=l.valueFormatter.getFormatString(r,l.slicerProps.general.formatString);i.isSourceInteger=!0===r.type.integer,i.formatter=l.valueFormatter.createDefaultFormatter(n),i.identity=r.expr;var o=this.rangeSlicerRenderer.defaultValue(),n=this.rangeSlicerRenderer.defaultValue();this.singleValue?(i.dataPoints=this.rangeSlicerRenderer.getDataPointsForSingleValueRange(this.dataView),0<i.dataPoints.length&&(o=i.dataPoints[0],n=i.dataPoints[i.dataPoints.length-1])):(null!=(a=r.aggregates).min&&(o=a.min),null!=a.max&&(n=a.max)),i.value={min:o,max:n},i.initialValue={min:o,max:n},i.bounds={min:i.value.min,max:i.value.max};var a=e.objects.getStaticObjects();a?(i.filter=x.DataViewObjects.getValue(a,l.slicerProps.general.filter),i.properties.start=i.filter?x.DataViewObjects.getValue(a,this.rangeSlicerRenderer.startProperty(),null):null,i.properties.end=i.filter?x.DataViewObjects.getValue(a,this.rangeSlicerRenderer.endProperty(),null):null,i.properties.mode=x.DataViewObjects.getValue(a,l.slicerProps.data.mode,null),i.hideDatePickerButton=x.DataViewObjects.getValue(a,l.slicerProps.date.hideDatePickerButton,!0),o=this.rangeSlicerRenderer.inputStyleProperties(),n=l.ColorHelper.create(this.style),e=this.rangeSlicerRenderer instanceof l.NumericSlicer?x.DataViewObjects.getObject(a,"numericInputStyle"):x.DataViewObjects.getObject(a,"date"),e=l.FontProperties.createFromObjectOrStyle(e,{color:"fontColor",family:"fontFamily",size:"textSize"},n,this.style,"foregroundDark","smallLabel",{color:i.inputStyle.fontColor,family:i.inputStyle.fontFamily,size:c.createFromPt(i.inputStyle.textSize)}),i.inputStyle.fontColor=e.color,i.inputStyle.fontFamily=e.family,i.inputStyle.textSize=e.size.pt,i.inputStyle.background=n.getColorForPropertyWithDefaultColor(a,o.background,i.inputStyle.background),i.inputStyle.labelBold=x.DataViewObjects.getValue(a,o.bold,i.inputStyle.labelBold),i.inputStyle.labelItalic=x.DataViewObjects.getValue(a,o.italic,i.inputStyle.labelItalic),i.inputStyle.labelUnderline=x.DataViewObjects.getValue(a,o.underline,i.inputStyle.labelUnderline),i.sliderSettings.color=n.getColorForPropertyWithDefaultColor(a,l.slicerProps.slider.color,i.sliderSettings.color),i.sliderSettings.show=x.DataViewObjects.getValue(a,l.slicerProps.slider.show,i.sliderSettings.show),null!==(o=this.featureSwitches)&&void 0!==o&&o.slicerSliderColors&&(i.sliderSettings.handleFillColor=n.getColorForPropertyWithDefaultColor(a,l.slicerProps.slider.handleFillColor,i.sliderSettings.handleFillColor),i.sliderSettings.primaryLineColor=n.getColorForPropertyWithDefaultColor(a,l.slicerProps.slider.color,i.sliderSettings.color),i.sliderSettings.handleBorderColor=n.getColorForPropertyWithDefaultColor(a,l.slicerProps.slider.handleBorderColor,i.sliderSettings.primaryLineColor),i.sliderSettings.secondaryLineColor=n.getColorForPropertyWithDefaultColor(a,l.slicerProps.slider.secondaryLineColor,i.sliderSettings.secondaryLineColor)),null!==i.properties.start&&(i.state|=1,i.value.min=i.properties.start,i.properties.start<i.bounds.min&&(i.bounds.min=i.properties.start)),null!==i.properties.end&&(i.state=i.state|=2,i.value.max=i.properties.end,i.properties.end>i.bounds.max&&(i.bounds.max=i.properties.end)),i.value.min>i.bounds.max&&(i.value.max=i.bounds.max=i.value.min),i.value.max<i.bounds.min&&(i.value.min=i.bounds.min=i.value.max),null!=i.properties.mode&&(i.mode=i.properties.mode),i.filter&&(i.properties.filter={min:i.value.min,max:i.value.max})):(i.state=0,i.properties.start=null,i.properties.end=null,i.properties.mode=null);a=s.parseColorString(null!==(a=this.featureSwitches)&&void 0!==a&&a.slicerSliderColors?i.sliderSettings.handleBorderColor:i.sliderSettings.color);return i.sliderSettings.activeColor=s.calculateHighlightColor(a,.5,.2),i.sliderSettings.hoverColor=s.hexString(s.darken(a,100)),i.sliderSettings.label=t.restatement,i.properties.bounds={min:i.bounds.min,max:i.bounds.max},i},w.prototype.initControls=function(){this.isRendered=!0,this.createHtmlControls(),this.updateMode(this.data.mode)},w.prototype.createHtmlControls=function(){var e=this;this.container=InJs.DomFactory.div().addClass(u.class).appendTo(this.host),this.container.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()});var t=InJs.DomFactory.div().addClass(p.class).css(this.getFontStyles()).appendTo(this.container),t=InJs.DomFactory.div().addClass(a.class).appendTo(t);this.startContainer=InJs.DomFactory.div().addClass(S.class).appendTo(t),this.endContainer=InJs.DomFactory.div().addClass(S.class).appendTo(t),this.useModernDatePicker?(this.data.value.min,Date,this.data.value.max,Date,this.data.bounds.min,Date,this.data.bounds.max,Date,this.startComponentRef=this.hostServices.getUIComponentFactory().createDatePicker(this.startContainer.get(0),this.data.value.min,function(){return e.onRangeChange(0)},jsCommon.Utility.generateGuid(),this.data.bounds.min,this.data.bounds.max,this.data.hideDatePickerButton),this.endComponentRef=this.hostServices.getUIComponentFactory().createDatePicker(this.endContainer.get(0),this.data.value.max,function(){return e.onRangeChange(1)},jsCommon.Utility.generateGuid(),this.data.bounds.min,this.data.bounds.max,this.data.hideDatePickerButton),this.start=this.startComponentRef.datePickerElement.find(":input").first(),this.end=this.endComponentRef.datePickerElement.find(":input").first(),this.startButton=this.startComponentRef.datePickerElement.find(":button"),this.endButton=this.endComponentRef.datePickerElement.find(":button"),this.data.hideDatePickerButton?(this.start.addClass(g.InputClass.class),this.end.addClass(g.InputClass.class)):(this.start.addClass(l.DateSlicerClass.class),this.startComponentRef.datePickerElement.addClass(l.DateSlicerWrapperClass.class),this.end.addClass(l.DateSlicerClass.class),this.endComponentRef.datePickerElement.addClass(l.DateSlicerWrapperClass.class))):(this.start=this.rangeSlicerRenderer.createInputElement(this.startContainer,0),this.end=this.rangeSlicerRenderer.createInputElement(this.endContainer,1)),this.rangeSlicerRenderer.addAriaDescription&&(this.rangeSlicerRenderer.addAriaDescription(this.start),this.rangeSlicerRenderer.addAriaDescription(this.end)),l.SlicerUtil.enableHover()&&(t=l.SlicerUtil.Selectors.EnableHover.class,this.start.addClass(t),this.end.addClass(t)),this.bindEventHandlersToInputElements(),this.sliderContainer=InJs.DomFactory.div().addClass(h.class).appendTo(this.container)},w.prototype.bindEventHandlersToInputElements=function(){var t=this;this.start.on("click touchend contextmenu",function(e){e.stopPropagation()}),this.end.on("click touchend contextmenu",function(e){e.stopPropagation()}),this.start.on("change",function(e){t.onRangeChange(0)}),this.start.on("keyup",function(e){13===e.which&&(t.start.blur(),t.start.focus())}),this.start.on("focus",function(e){t.singleValue&&!t.data.filter||(t.useModernDatePicker?(t.data.value.min,Date,t.startComponentRef.writeValue(t.data.value.min)):t.start.val(t.rangeSlicerRenderer.formatValue(t.data.value.min,null))),t.preventTextSelection||t.start.select()}),this.start.on("blur",function(e){t.singleValue&&!t.data.filter||(t.useModernDatePicker?(t.data.value.min,Date,t.startComponentRef.writeValue(t.data.value.min)):t.start.val(t.rangeSlicerRenderer.formatValue(t.data.value.min,t.data.formatter)))}),this.end.on("change",function(e){t.onRangeChange(1)}),this.end.on("keyup",function(e){13===e.which&&(t.end.blur(),t.end.focus())}),this.end.on("focus",function(e){t.useModernDatePicker?(t.data.value.max,Date,t.endComponentRef.writeValue(t.data.value.max)):t.end.val(t.rangeSlicerRenderer.formatValue(t.data.value.max,null)),t.preventTextSelection||t.end.select()}),this.end.on("blur",function(e){t.useModernDatePicker?(t.data.value.max,Date,t.endComponentRef.writeValue(t.data.value.max)):t.end.val(t.rangeSlicerRenderer.formatValue(t.data.value.max,t.data.formatter))})},w.prototype.onRangeChange=function(e){var t=(0===e?this.start:this.end).val(),t=this.rangeSlicerRenderer.parseInput(t,this.data.dataPoints,this.singleValue);this.rangeSlicerRenderer.isInputValid(t,this.data.value,e,this.singleValue)?this.updateRange({min:t,max:t},e):(this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,e,this.data.bounds),this.useModernDatePicker&&(this.data.value.min,Date,this.data.value.max,Date,this.startComponentRef.writeValue(this.data.value.min),this.endComponentRef.writeValue(this.data.value.max)))},w.prototype.onDestroy=function(){this.rangeSlicerRenderer.onDestroy&&this.rangeSlicerRenderer.onDestroy()},w.prototype.getFontStyles=function(){var e={};return e["font-size"]=r.fromPointToPixel(9),e["font-family"]=n,e["font-weight"]=l.DataLabelRenderer.defaultFontProperties.weight,e},w.prototype.updateSliderControl=function(){var e,t,r=this,i=this.createSliderOptions();this.slider?(this.slider.updateOptions(i),e=[],this.singleValue?(t=_.indexOf(this.data.dataPoints,this.data.value.min),e.push(t)):(t=this.range.getScaledValue(),this.activeMode!==l.slicerMode.before&&e.push(t.min),this.activeMode!==l.slicerMode.after&&e.push(t.max)),this.slider.set(e)):(this.sliderOptions=i,this.slider&&(this.slider.destroy(),this.sliderContainer.empty()),this.sliderElement=InJs.DomFactory.div().attr(g.DisableDragAttribute,"true").attr("rtl",("rtl"===document.dir).toString()).appendTo(this.sliderContainer),noUiSlider.create(this.sliderElement.get(0),this.sliderOptions),this.slider=this.sliderElement.get(0).noUiSlider,this.slider.on("slide",function(e,t,i){window.requestAnimationFrame(function(){var e=r.parseSliderValue(i);r.rangeSlicerRenderer.setRange(e,r.data.formatter,r.start,r.end,null,r.data.bounds),r.useModernDatePicker&&(e.min,Date,e.max,Date,r.startComponentRef.writeValue(e.min),r.endComponentRef.writeValue(e.max))})}),this.slider.on("change",_.debounce(function(e,t,i){i=r.parseSliderValue(i),t=r.getChangeType(r.activeMode,t);r.updateRange(i,t)},100)),this.applyHandlesHoverState(this.sliderContainer.find(b.selector))),this.updateAccessibilityAttributes(this.data,this.sliderContainer.find(b.selector),this.activeMode);var n=null!==(i=this.featureSwitches)&&void 0!==i&&i.slicerSliderColors?this.data.sliderSettings.handleBorderColor:this.data.sliderSettings.color,i=null!==(i=this.featureSwitches)&&void 0!==i&&i.slicerSliderColors?this.data.sliderSettings.primaryLineColor:this.data.sliderSettings.color;this.sliderContainer.find(f.selector).css({"background-color":i}),this.sliderContainer.find(v.selector).css({"background-color":this.data.sliderSettings.secondaryLineColor}),this.sliderContainer.find(b.selector).each(function(e,t){var i=$(t),t=i.is(":hover")?r.data.sliderSettings.activeColor:n;r.setSliderHandleColor(i,t)}),this.sliderContainer.find(f.selector).addClass("backgroundToSelectedBackgroundColor"),this.sliderContainer.find(y.selector).addClass("backgroundToForegroundColor");i=this.sliderContainer.find(b.selector);this.data.sliderSettings.drawRoundSliderHandles?(i.addClass("backgroundToSolidBackgroundColor"),i.addClass("highContrastSelectedBorderColor")):i.addClass("backgroundToSelectedBackgroundColor")},w.prototype.setSliderHandleColor=function(e,t){var i={"border-color":"","background-color":""};this.data.sliderSettings.drawRoundSliderHandles&&(i["background-color"]=this.data.sliderSettings.handleFillColor),i[this.data.sliderSettings.drawRoundSliderHandles?"border-color":"background-color"]=t,e.css(i)},w.prototype.disableSlicer=function(){this.disableSlider(),1&this.data.state||(this.useModernDatePicker?this.startComponentRef.writeValue():this.start.val(""),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)),2&this.data.state||(this.useModernDatePicker?this.endComponentRef.writeValue():this.end.val(""),this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor)),this.data.bounds.min=this.data.bounds.max=null,this.updateProperties()},w.prototype.disableSlider=function(){this.sliderElement&&this.sliderElement.get(0).setAttribute("disabled","true"),this.sliderContainer.css("opacity","0.1"),this.slider&&this.slider.set([0,100])},w.prototype.enableSlicer=function(){this.sliderElement&&!this.rangeSlicerRenderer.areEqual(this.data.bounds.min,this.data.bounds.max)&&this.sliderElement.get(0).removeAttribute("disabled"),this.sliderContainer.css("opacity","1.0"),this.start.prop("disabled",!1),this.end.prop("disabled",!1)},w.prototype.applyHandlesHoverState=function(e){var t,i=!1,r=!1,n=this,o=null===(t=this.featureSwitches)||void 0===t?void 0:t.slicerSliderColors;e.on("mouseenter",function(){r=!0,i||n.setSliderHandleColor($(this),n.data.sliderSettings.hoverColor)}).on("mouseleave",function(){r=!1,i||n.setSliderHandleColor($(this),o?n.data.sliderSettings.handleBorderColor:n.data.sliderSettings.color)}).on("mousedown touchstart",function(){var e=this;i=!0,n.setSliderHandleColor($(this),n.data.sliderSettings.activeColor);var t=function(){$(document).off("mouseup touchEnd",t),i&&(i=!1,n.setSliderHandleColor($(e),o?n.data.sliderSettings.handleBorderColor:n.data.sliderSettings.color))};$(document).on("mouseup touchEnd",t)}).on("mouseup touchend",function(){i=!1,n.setSliderHandleColor($(this),r?n.data.sliderSettings.hoverColor:o?n.data.sliderSettings.handleBorderColor:n.data.sliderSettings.color)})},w.prototype.updateInputControls=function(){this.singleValue&&!this.data.filter&&(this.useModernDatePicker?this.startComponentRef.writeValue():this.start.val(""));var e={fontSize:r.fromPoint(this.data.inputStyle.textSize),fontFamily:this.data.inputStyle.fontFamily||n,fontWeight:this.data.inputStyle.labelBold?i.boldValue:i.normalValue,fontStyle:this.data.inputStyle.labelItalic?i.italicValue:i.normalValue},t={"font-size":e.fontSize,"font-family":e.fontFamily,"font-weight":e.fontWeight,"font-style":e.fontStyle,"text-decoration":this.data.inputStyle.labelUnderline?i.underlineValue:i.noneValue};this.start.parent().css(t),this.end.parent().css(t);t={color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background||"","text-decoration":this.data.inputStyle.labelUnderline?i.underlineValue:i.noneValue};this.start.css(t),this.end.css(t),this.startButton&&this.startButton.css(t),this.endButton&&this.endButton.css(t),this.useModernDatePicker&&(this.data.value.min,Date,this.data.value.max,Date,this.data.bounds.min,Date,this.data.bounds.max,Date,this.startComponentRef.updateDateRange(this.data.bounds.min,this.data.bounds.max),this.endComponentRef.updateDateRange(this.data.bounds.min,this.data.bounds.max),this.startComponentRef.writeValue(this.data.value.min),this.endComponentRef.writeValue(this.data.value.max)),this.setInputWidth(this.start,e),this.setInputWidth(this.end,e)},w.prototype.setInputWidth=function(e,t){e.css("width","");var i,r=e.val();r&&(i=r.toString(),r=x.TextMeasurementService.measureSvgTextWidth(t,i),t=parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right")),i=2*parseFloat(e.css("border-width")),r=Math.ceil(r+t+i),e.outerWidth(!1)<r&&e.css({width:r}))},w.prototype.disableInput=function(e,t){t=s.parseColorString(t);t.A=.3,e.css({color:s.rgbString(t)})},w.prototype.createSliderOptions=function(){var e,t,i=this.rangeSlicerRenderer.getSliderOptions(this.data,this.singleValue),r=this.range.getScaledValue();switch(this.activeMode){case l.slicerMode.before:e=r.max,t=[!0,!1];break;case l.slicerMode.after:e=r.min,t=[!1,!0];break;case l.slicerMode.between:e=[r.min,r.max],t=!0;break;case l.slicerMode.single:e=_.indexOf(this.data.dataPoints,this.data.value.min),t=!1}return{connect:t,behaviour:"tap",range:{min:i.min===i.max?0:i.min,max:i.min===i.max?1:i.max},start:e,step:i.step}},w.prototype.parseSliderValue=function(e){if((this.data.isSourceInteger||this.singleValue)&&(e=_.map(e,function(e){return Math.round(e)})),this.singleValue)return this.rangeSlicerRenderer.parseSingleSliderValue(e[0],this.data.dataPoints);var t=this.range.getScaledValue();switch(this.activeMode){case l.slicerMode.before:t.max=e[0];break;case l.slicerMode.after:t.min=e[0];break;case l.slicerMode.between:t.min=e[0],t.max=e[1]}return this.range.setScaledValue(t),this.range.getValue()},w.prototype.updateSlider=function(e){e===l.slicerMode.after?(this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor),this.start.prop("disabled",!1)):e===l.slicerMode.before?(this.end.prop("disabled",!1),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)):(this.end.prop("disabled",!1),this.start.prop("disabled",!1)),e===l.slicerMode.single?this.endContainer.hide():this.endContainer.show(),!this.data.sliderSettings.show||this.shouldHideSmallSlider()?this.sliderContainer.hide():(this.sliderContainer.show(),this.updateSliderControl()),this.sliderContainer.toggleClass(t.class,!!this.data.sliderSettings.drawRoundSliderHandles),this.container.find(p.selector).toggleClass(m.class,!!this.data.wrapRangeBoxes),this.rangeSlicerRenderer.areEqual(this.data.bounds.min,this.data.bounds.max)&&this.disableSlider()},w.prototype.updateMode=function(e){var t=this.data.mode;null==e?e=this.defaultSliderMode:this.data.mode=e,e===l.slicerMode.before?(t===l.slicerMode.after&&1&this.data.state&&(this.data.value.max=this.data.value.min,this.data.value.min=this.data.bounds.min,this.data.state=2),this.data.state&=-2):e===l.slicerMode.after&&(t===l.slicerMode.before&&2&this.data.state&&(this.data.value.min=this.data.value.max,this.data.state=1),this.data.state&=-3),this.updateProperties()},w.prototype.updateProperties=function(){var e={min:this.data.value.min,max:this.data.value.max},t={min:this.data.bounds.min,max:this.data.bounds.max},i={start:1&this.data.state?this.data.value.min:null,end:2&this.data.state?this.data.value.max:null,mode:this.data.mode,filter:e,bounds:t};this.requireToUpdate(i)&&(this.data.properties.filter=e,this.data.properties.bounds=t,i=this.createPersistProperties(i,this.data.identity,this.data.state),this.hostServices.persistProperties(i),this.hostServices.onSelect({type:0,visualObjects:[]}))},w.prototype.getChangeType=function(e,t){var i=null;switch(e){case l.slicerMode.after:case l.slicerMode.single:i=0;break;case l.slicerMode.before:i=1;break;default:i=0===t?0:1}return i},w.prototype.createPersistProperties=function(e,t,i){var r=null==e.mode?this.defaultSliderMode:e.mode,r=this.createFilter(e,r,i,t),t={merge:[{objectName:"general",selector:void 0,properties:{}}],replace:[{objectName:"data",selector:void 0,properties:{}}],remove:[{objectName:"data",selector:void 0,properties:{}},{objectName:"general",selector:void 0,properties:{}}]};return null!==r?t.merge[0].properties[l.slicerProps.general.filter.propertyName]=r:t.remove[1].properties[l.slicerProps.general.filter.propertyName]=!0,1&i&&null!==e.start?t.replace[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=e.start:null==e.start&&(t.remove[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=!0),2&i&&null!==e.end?t.replace[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=e.end:null==e.end&&(t.remove[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=!0),null!=e.mode&&(t.replace[0].properties[l.slicerProps.data.mode.propertyName]=e.mode),t},w.prototype.updateRange=function(e,t){null==t?(this.data.value.min=e.min,this.data.value.max=e.max):0===t?(this.data.value.min=e.min,null!==this.data.bounds.min&&!this.singleValue&&this.rangeSlicerRenderer.areEqual(this.data.value.min,this.data.bounds.min)?this.data.state&=-2:this.data.state|=1):1===t&&(this.data.value.max=e.max,null!==this.data.bounds.max&&this.rangeSlicerRenderer.areEqual(this.data.value.max,this.data.bounds.max)?this.data.state&=-3:this.data.state|=2),this.updateProperties()},w.prototype.createFilter=function(e,t,i,r){var n=null,o=e.filter,a=null,s=this.rangeSlicerRenderer.filterExpr(o);return t===l.slicerMode.single?n=1&i?d.compare(0,r,s.lower):null:(e=this.rangeSlicerRenderer.comparisonKind(),1&i&&2&i?(o=d.compare(e.lower,r,s.lower),t=d.compare(e.upper,r,s.upper),n=d.and(o,t)):1&i?n=d.compare(e.lower,r,s.lower):2&i&&(n=d.compare(e.upper,r,s.upper))),a=null!==n?x.data.SemanticFilter.fromSQExpr(n):a},w.prototype.requireToUpdate=function(e){return(null!==this.data.properties.filter||0!==this.data.state||e.mode!==this.data.properties.mode&&(e.mode!==this.defaultSliderMode||null!==this.data.properties.mode))&&!(null!=this.data.properties.filter&&e.mode===this.data.properties.mode&&this.rangeSlicerRenderer.areEqual(e.start,this.data.properties.start)&&this.rangeSlicerRenderer.areEqual(e.end,this.data.properties.end)&&this.rangeSlicerRenderer.areEqual(e.filter.min,this.data.properties.filter.min)&&this.rangeSlicerRenderer.areEqual(e.filter.max,this.data.properties.filter.max)&&this.rangeSlicerRenderer.areEqual(e.bounds.min,this.data.properties.bounds.min)&&this.rangeSlicerRenderer.areEqual(e.bounds.max,this.data.properties.bounds.max))},w.prototype.shouldHideSmallSlider=function(){var e=this.data.sliderSettings;if((this.container.width()||0)<=e.minSliderVisibilityWidth)return!0;if(0<e.minSliderVisibilityHeight){var t=this.endContainer.position().top+this.endContainer.outerHeight();if(this.container.parent().outerHeight()-t<e.minSliderVisibilityHeight)return!0}return!1},w.prototype.updateAccessibilityAttributes=function(e,t,i){var r,n=e.value.min,o=e.value.max;switch(i){case l.slicerMode.before:r=this.getRangeText(e.bounds.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t,r,o);break;case l.slicerMode.after:r=this.getRangeText(e.bounds.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t,r,n);break;case l.slicerMode.between:r=this.getRangeText(e.bounds.min,e.value.max),this.addAccessibilityAttributesToSliderHandle(t.first(),r,n),r=this.getRangeText(e.value.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t.last(),r,o)}t.attr("aria-label",e.sliderSettings.label)},w.prototype.addAccessibilityAttributesToSliderHandle=function(e,t,i){e.attr("aria-valuetext",this.rangeSlicerRenderer.formatValue(i,this.data.formatter)).attr("aria-description",t)},w.prototype.getRangeText=function(e,t){return this.isCategorySourceNumeric?x.formattingService.format(this.hostServices.getLocalizedString("Slicer_Range_Hint"),[e,t]):x.formattingService.format(this.hostServices.getLocalizedString("Slicer_Range_Hint"),[x.formattingService.formatValue(e,"d"),x.formattingService.formatValue(t,"d")])},w);function w(e,t,i,r,n){this.viewModelAdapter=n,this.isRendered=!1,e&&(this.hostServices=e.hostServices,this.preventTextSelection=e.preventTextSelection,this.featureSwitches=e.featureSwitches),this.rangeSlicerRenderer=t,this.singleValue=i,this.isCategorySourceNumeric=r,this.useModernDatePicker=!this.isCategorySourceNumeric&&this.featureSwitches.useModernDatePickerSlicer}l.RangeSlicer=e}(x.visuals||(x.visuals={}))}(powerbi=powerbi||{}),function(o){var a,s,i,r,t,n,l,c,d,u;function p(e,t){this.isRendered=!1,this.hostServices=e.hostServices,this.relativeSlicerComponent=a.RelativeSlicerUtil.relativeUnitSlicerFactory(t)}a=o.visuals||(o.visuals={}),s=a.Units.FontSize,i=o.visuals.controls.SelectMenu,r=o.data.RelativeDateRangeHelper,t=o.data.RelativeDateFilterPattern,n=o.data.SemanticFilter,l=jsCommon.PixelConverter,c=jsCommon.CssConstants,d="slicer-select-menu",u=".ui-selectmenu-button",p.prototype.init=function(e,t){this.host=t,this.isRendered=!1,this.style=e.visualInitOptions.style,this.eventsHelper=new a.SlicerUtil.EventsHelper},p.prototype.onDestroy=function(){this.unregisterSelectMenuCloseEvents&&this.unregisterSelectMenuCloseEvents(),this.rangeSelectMenu&&this.rangeSelectMenu.destroy(),this.periodSelectMenu&&this.periodSelectMenu.destroy()},p.prototype.hasSlider=function(){return!1},p.prototype.supportsOrientation=function(){return!1},p.prototype.onClear=function(){this.data.range=a.relativeSlicerRelativeQualifier.last,this.data.period=a.relativeSlicerPeriod.none,this.data.duration=1,this.data.filter=null,this.renderInternal(),a.SlicerUtil.clearSlicerFilter(this.hostServices,this.data.mode)},p.prototype.enumerateObjectInstances=function(e,t){var i=this.relativeSlicerComponent.getVisualObjectInstance(this.data);if("dateRange"===e.objectName&&i)return[i];if("numericInputStyle"===e.objectName){i=a.slicerProps.numericInputStyle,e={selector:null,objectName:"numericInputStyle",properties:{fontColor:this.data.inputStyle.fontColor,background:this.data.inputStyle.background,textSize:this.data.inputStyle.textSize,fontFamily:this.data.inputStyle.fontFamily}};return t&&t.enableBIU&&(e.properties[i.bold.propertyName]=this.data.inputStyle.labelBold,e.properties[i.italic.propertyName]=this.data.inputStyle.labelItalic,e.properties[i.underline.propertyName]=this.data.inputStyle.labelUnderline),[e]}},p.prototype.getValuesCard=function(e){var t=this,i=a.slicerProps.numericInputStyle,r=new a.builder.FormattingCardBuilder(new a.builder.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[i.fontFamily,i.textSize,i.fontColor,i.background,i.bold,i.italic,i.underline,a.slicerProps.dateRange.includeToday,a.slicerProps.dateRange.anchorDate],function(e){return t.hostServices.getLocalizedString(e)}),n=(new a.builder.FontControlBuilder).withFontFamily({descriptor:i.fontFamily,value:this.data.inputStyle.fontFamily}).withFontSizeProperties({descriptor:i.textSize,value:this.data.inputStyle.textSize});e&&e.enableBIU&&n.withBold({descriptor:i.bold,value:this.data.inputStyle.labelBold}).withItalic({descriptor:i.italic,value:this.data.inputStyle.labelItalic}).withUnderline({descriptor:i.underline,value:this.data.inputStyle.labelUnderline});var o=n.build();return r.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",o),e.addSimpleSlice("color",function(){var e={value:t.data.inputStyle.fontColor};return new a.builder.ColorPickerBuilder({descriptor:i.fontColor,value:e}).build()}),t.relativeSlicerComponent.appendVisualSlices(e,t.data)}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.data.inputStyle.background};return new a.builder.ColorPickerBuilder({descriptor:i.background,value:e}).build()})}),r.build()},p.prototype.getSlicerSettingsCardOptions=function(){},p.prototype.getAdditionalCards=function(){},p.prototype.onModeChange=function(e){a.SlicerUtil.clearSlicerFilter(this.hostServices,e)},p.converter=function(e,t,i,r){var n={mode:i,range:a.relativeSlicerRelativeQualifier.last,period:a.relativeSlicerPeriod.none,duration:1,includeToday:!0,identity:null,anchorDate:void 0,filter:null,inputStyle:{textSize:9,fontFamily:a.Font.Family.regular.css,fontColor:a.ColorHelper.getThemeColor(t,"foregroundDark"),background:null,labelBold:!1,labelItalic:!1,labelUnderline:!1}},i=e.columns.getMetadataColumns(a.slicerRoles.value);i.length;i=i[0];n.identity=i.expr;i=e.objects.getStaticObjects();return i&&(e=a.ColorHelper.create(t),n.filter=o.DataViewObjects.getValue(i,a.slicerProps.general.filter,n.filter),n.range=o.DataViewObjects.getValue(i,a.slicerProps.data.relativeRange,n.range),n.period=o.DataViewObjects.getValue(i,r,n.period),n.duration=Math.abs(o.DataViewObjects.getValue(i,a.slicerProps.data.relativeDuration,n.duration)),n.includeToday=o.DataViewObjects.getValue(i,a.slicerProps.dateRange.includeToday,n.includeToday),n.anchorDate=o.DataViewObjects.getValue(i,a.slicerProps.dateRange.anchorDate,n.anchorDate),t=a.FontProperties.createFromObjectOrStyle(o.DataViewObjects.getObject(i,"numericInputStyle"),{color:"fontColor",family:"fontFamily",size:"textSize"},e,t,"foregroundDark","smallLabel",{color:n.inputStyle.fontColor,family:n.inputStyle.fontFamily,size:s.createFromPt(n.inputStyle.textSize)}),n.inputStyle.fontColor=t.color,n.inputStyle.fontFamily=t.family,n.inputStyle.textSize=t.size.pt,n.inputStyle.background=e.getColorForPropertyWithDefaultColor(i,a.slicerProps.numericInputStyle.background,n.inputStyle.background),n.inputStyle.labelBold=o.DataViewObjects.getValue(i,a.slicerProps.numericInputStyle.bold,n.inputStyle.labelBold),n.inputStyle.labelItalic=o.DataViewObjects.getValue(i,a.slicerProps.numericInputStyle.italic,n.inputStyle.labelItalic),n.inputStyle.labelUnderline=o.DataViewObjects.getValue(i,a.slicerProps.numericInputStyle.underline,n.inputStyle.labelUnderline)),n},p.prototype.render=function(e){var i=this,e=o.data.createDataViewCategoricalReaderAdvanced(e.dataView);this.data=p.converter(e,this.style,this.relativeSlicerComponent.getMode(),this.relativeSlicerComponent.getRelativePropertyId()),this.isRendered||(this.initControls(),this.unregisterSelectMenuCloseEvents=this.eventsHelper.onPopupHideEvent(function(e,t){i.onSelectMenuClose(e,t)},this.selectionContainer.get(0))),this.updateProperties(this.data.range,this.data.period,this.data.duration),this.renderInternal()},p.prototype.onSelectMenuClose=function(e,t){$(t).hasClass(d)||$(t).closest("."+d).length||(this.rangeSelectMenu.close(),this.periodSelectMenu.close())},p.prototype.initControls=function(){var t=this;this.isRendered=!0,this.container=InJs.DomFactory.div().addClass("relative-slicer").appendTo(this.host),this.selectionContainer=InJs.DomFactory.div().addClass("selection-container").appendTo(this.container),this.selectionContainer.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()}),this.rangeSelectMenuContainer=InJs.DomFactory.div().addClass("range-menu").appendTo(this.selectionContainer);var e={onChange:function(e){t.rangeChanged(e)},container:this.rangeSelectMenuContainer,options:this.getSelectMenuOptions(a.relativeSlicerRelativeQualifier.type.members()),className:d,selectedValue:"Select",title:this.hostServices.getLocalizedString("Visual_Axis_Range")};this.rangeSelectMenu=new i(e),this.rangeSelectMenu.update({selectedValue:a.relativeSlicerRelativeQualifier.last}),this.durationInput=InJs.DomFactory.textBox().attr("type","number").attr("min","1").attr("drag-resize-disabled","true").addClass("duration-input").attr("aria-label",this.hostServices.getLocalizedString("Duration")).appendTo(this.selectionContainer),this.durationInput.val(this.data.duration.toString()),this.durationInput.on("change",_.debounce(function(e){t.durationChanged()},100)),this.periodSelectMenuContainer=InJs.DomFactory.div().addClass("period-menu").appendTo(this.selectionContainer);e=this.relativeSlicerComponent.getListOfOptions(),e={onChange:function(e){t.periodChanged(e)},container:this.periodSelectMenuContainer,options:this.getSelectMenuOptions(e),className:d,title:this.hostServices.getLocalizedString("DaxTemplates_PeriodField")};this.periodSelectMenu=new i(e),this.periodSelectMenu.disableOption(a.relativeSlicerPeriod.none),this.updatePeriod(),this.restatementContainer=InJs.DomFactory.div().addClass("restatement-container").appendTo(this.container),this.restatementIcon=$("<i ></i>").addClass("restatement-icon").addClass("pbi-glyph-datetime").appendTo(this.restatementContainer),this.restatement=InJs.DomFactory.div().addClass("restatement").appendTo(this.restatementContainer),this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText"))},p.prototype.updatePeriod=function(){var e=this.relativeSlicerComponent.getPeriods(this.data);this.periodSelectMenu.update({options:this.getSelectMenuOptions(e),selectedValue:this.data.period})},p.prototype.rangeChanged=function(e){this.data.range=e,this.data.range===a.relativeSlicerRelativeQualifier.current?(this.durationInput.attr("type","text"),this.durationInput.val("-"),this.durationInput.prop("disabled",!0),this.data.duration=0):("-"===this.durationInput.val()?(this.durationInput.attr("type","number"),this.durationInput.val("1"),this.data.duration=1):this.updateDuration(),this.durationInput.prop("disabled",!1)),this.updatePeriod();e=this.updateProperties(this.data.range,this.data.period,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.periodChanged=function(e){this.updateDuration();e=this.updateProperties(this.data.range,e,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.durationChanged=function(){this.updateDuration();var e=this.updateProperties(this.data.range,this.data.period,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.renderInternal=function(){var e=this.relativeSlicerComponent.getSelectedPeriodOption(this.data),t=l.fromPointToPixel(this.data.inputStyle.textSize),i={"font-size":t,"font-family":this.data.inputStyle.fontFamily,color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background||"","font-weight":this.data.inputStyle.labelBold?c.boldValue:c.normalValue,"font-style":this.data.inputStyle.labelItalic?c.italicValue:c.normalValue,"text-decoration":this.data.inputStyle.labelUnderline?c.underlineValue:c.noneValue};this.durationInput.css(i),i["font-size"]=t-1,this.restatement.css(i);var r=this.rangeSelectMenuContainer.find(u);r.css(i);t=a.relativeSlicerRelativeQualifier.type.members([this.data.range])[0].displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)});r.attr("title",t);t=this.periodSelectMenuContainer.find(u);t.css(i);e=e.displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)});t.attr("title",e),this.rangeSelectMenu.update({selectedValue:this.data.range}),this.updatePeriod(),this.periodSelectMenu.disableOption(a.relativeSlicerPeriod.none),0===this.data.duration?(this.durationInput.attr("type","text"),this.durationInput.val("-"),this.durationInput.prop("disabled",!0)):(this.durationInput.attr("type","number"),this.durationInput.prop("disabled",!1),this.durationInput.val(Math.abs(this.data.duration).toString())),this.setRestatement()},p.prototype.updateProperties=function(e,t,i){this.data.range=e;var r,e=this.data.period!==t;this.data.period=t,this.data.duration=i;i=null;if(null!==(i=this.data.period!==a.relativeSlicerPeriod.none?this.createFilter():i)||!this.data.filter){i=i?n.fromSQExpr(i):null;return n.isSameFilter(i,this.data.filter)&&!e||(r=this.createProperties(i),this.setRestatement()),r}this.onClear()},p.prototype.updateDuration=function(){this.data.range===a.relativeSlicerRelativeQualifier.current?this.data.duration=0:this.isDurationValid()&&(this.data.duration=Math.min(parseInt(this.durationInput.val(),10),this.getDurationMax()))},p.prototype.isDurationValid=function(){var e=parseInt(this.durationInput.val(),10);return $.isNumeric(e)&&0<e},p.prototype.getDurationMax=function(){var e=this.data.period!==a.relativeSlicerPeriod.none?this.data.period:a.relativeSlicerPeriod.days;return r.getDurationMax(a.RelativeSlicerUtil.toRelativeDateQualifier(this.data.range),a.RelativeSlicerUtil.toRelativeDateUnit(e))},p.prototype.createFilter=function(){var e;return this.data.identity&&(e=a.RelativeSlicerUtil.toRelativeDateRangeOptions(this.data),e=t.buildFilterCondition({field:this.data.identity,options:e})),e},p.prototype.getRelativePropertyName=function(){return this.relativeSlicerComponent.getRelativePropertyId().propertyName},p.prototype.createProperties=function(e){var t={merge:[],replace:[],remove:[]},i={objectName:"general",selector:null,properties:{}};null!==e?(i.properties[a.slicerProps.general.filter.propertyName]=e,t.merge.push(i)):(i.properties[a.slicerProps.general.filter.propertyName]=!0,t.remove.push(i));e={objectName:"data",selector:null,properties:{}};null!=this.data.mode&&(e.properties[a.slicerProps.data.mode.propertyName]=this.data.mode),null!=this.data.range&&(e.properties[a.slicerProps.data.relativeRange.propertyName]=this.data.range),null!=this.data.duration&&(e.properties[a.slicerProps.data.relativeDuration.propertyName]=this.data.duration),null!=this.data.period&&(i=this.getRelativePropertyName(),e.properties[i]=this.data.period),t.replace.push(e);e={objectName:"dateRange",selector:null,properties:{}};return null!=this.data.includeToday&&(e.properties[a.slicerProps.dateRange.includeToday.propertyName]=this.data.includeToday),this.data.anchorDate&&(e.properties[a.slicerProps.dateRange.anchorDate.propertyName]=this.data.anchorDate),t.replace.push(e),this.hostServices.onSelect({type:0,visualObjects:[]}),t},p.prototype.setRestatement=function(){var e,t,i=this;this.data.period===a.relativeSlicerPeriod.none?this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText")):(e=a.RelativeSlicerUtil.toRelativeDateRangeOptions(this.data),t=null===(t=null===(t=this.hostServices)||void 0===t?void 0:t.networkAvailability())||void 0===t?void 0:t.isNetworkAvailable(),this.restatement.text(r.getRestatement(e,t,function(e,t){return i.hostServices.getLocalizedString(e,t)},null===(t=this.hostServices.visualTimeSynchronization())||void 0===t?void 0:t.getAnchorTime())))},p.prototype.getSelectMenuOptions=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var n=r[i],o=n.displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)});t.push({text:o,value:n.value})}return t},a.RelativeSlicer=p}(powerbi=powerbi||{}),function(e){var t,i;function r(){}t=e.visuals||(e.visuals={}),i=jsCommon.StringExtensions,r.prototype.getVisualObjectInstance=function(e){},r.prototype.appendVisualSlices=function(e,t){},r.prototype.getMode=function(){return t.slicerMode.relativeTime},r.prototype.getRelativePropertyId=function(){return t.slicerProps.data.relativeTimePeriod},r.prototype.getListOfOptions=function(){return t.relativeSlicerPeriod.typeTime.members()},r.prototype.getSelectedPeriodOption=function(e){return i.isNullOrUndefinedOrWhiteSpaceString(e.period),t.relativeSlicerPeriod.typeTime.members([e.period])[0]},r.prototype.getPeriods=function(e){return(e.range!==t.relativeSlicerRelativeQualifier.current?t.relativeSlicerPeriod.typeTime:t.relativeSlicerPeriod.typeTimeCurrent).members()},t.RelativeTimeComponent=r}(powerbi=powerbi||{}),function(e){var i,t;function r(){}i=e.visuals||(e.visuals={}),t=jsCommon.StringExtensions,r.prototype.getVisualObjectInstance=function(e){return{selector:null,objectName:"dateRange",properties:{includeToday:e.includeToday,anchorDate:e.anchorDate}}},r.prototype.appendVisualSlices=function(e,t){null!=t.includeToday&&e.addSimpleSlice("includeToday",function(){return new i.builder.ToggleSwitchBuilder({descriptor:i.slicerProps.dateRange.includeToday,value:t.includeToday}).build()}),e.addSimpleSlice("anchorDate",function(){return new i.builder.DatePickerBuilder({descriptor:i.slicerProps.dateRange.anchorDate,value:t.anchorDate,placeholder:""}).build()})},r.prototype.getMode=function(){return i.slicerMode.relativeDate},r.prototype.getRelativePropertyId=function(){return i.slicerProps.data.relativePeriod},r.prototype.getListOfOptions=function(){return i.relativeSlicerPeriod.typeDate.members()},r.prototype.getSelectedPeriodOption=function(e){return t.isNullOrUndefinedOrWhiteSpaceString(e.period),i.relativeSlicerPeriod.typeDate.members([e.period])[0]},r.prototype.getPeriods=function(e){var t=(e.range!==i.relativeSlicerRelativeQualifier.current?i.relativeSlicerPeriod.typeDate:i.relativeSlicerPeriod.typeDateCurrent).members();if(e.range===i.relativeSlicerRelativeQualifier.current)switch(e.period){case i.relativeSlicerPeriod.calendarWeeks:e.period=i.relativeSlicerPeriod.weeks;break;case i.relativeSlicerPeriod.calendarMonths:e.period=i.relativeSlicerPeriod.months;break;case i.relativeSlicerPeriod.calendarYears:e.period=i.relativeSlicerPeriod.years}return t},i.RelativeDateComponent=r}(powerbi=powerbi||{}),function(x){var E,i,y,b,C,w,D,T;E=x.visuals||(x.visuals={}),i=x.data.DefaultSQExprVisitor,y=x.visuals.FontProperties,b=x.visuals.Units.FontSize,C=x.visuals.outline,w=x.data.SemanticFilter,D=x.data.SQConstantExpr,T=jsCommon.UrlUtils,function(m){m.DefaultSlicerOutlineColorName="foregroundNeutralSecondaryAlt2",m.DefaultSlicerTextColorName="foregroundNeutralSecondary";function M(e,t,i,r,n,o,a,s,l,c,d,u,p,h,S){var m=E.valueFormatter.getFormatString(o,E.slicerProps.general.formatString);l&&(l.children=[]);for(var g=0,f=i;g<f.length;g++){var v=f[g],y=void 0,b=void 0,y=t&&t.isDefaultFilter&&!_.isEmpty(t.defaultValueByLevel)&&t.defaultValueByLevel[e]?D.getTextValue(t.defaultValueByLevel[e].value):(b=function(e,t,i){if(!_.isEmpty(i)){for(var r=[],n=0,o=i;n<o.length;n++){var a=o[n];x.DataViewScopeIdentity.equals(a.identities[e],t.identity)&&r.push(a)}return r}}(e,v,n),_.isEmpty(b)?x.data.SQExprConverter.getFirstComparandValue(v.identity):b[0].valueMap[e]);S.calculatedIndex++;var C,w=E.valueFormatter.format(y,m),y=function(e,t,i,r,n,o,a,s,l,c){c={value:t,tooltip:t,identity:null,selected:e,count:i?0:void 0,isImage:r,level:n,parent:a,scopeIdentity:o,partially:s,disabled:!1,index:c};F(c,l),a&&a.children.push(c);return c}(v.checked,w,s.hasCount(),s.isImageData(),e,v.identity,l,!_.isEmpty(v.children),r,S.calculatedIndex);h&&c.push(y),y.selected&&(p?(C={dataPoint:y,selectionIndex:v.index},u.push(C)):d.push(y)),_.isEmpty(v.children)||(C=a.getMetadataColumnByLevel(w=e+1),M(w,t,v.children,r,b,C,a,s,y,c,d,u,p,h,S))}}function F(e,t){for(var i=E.SelectionIdBuilder.builder(),r=e;r;)i.withColumnIdentity(r.scopeIdentity,t[e.level]),r=r.parent;e.identity=i.createSelectionId()}function g(e,t,i,r){if(_.isEmpty(t))return e.getLocalizedString("All");if(1!==t.length||i)return e.getLocalizedString("Slicer_Restatement_Multiple");var n=t[0];if(null==n.parent)return n.value;for(var o=[],t=e.getLocalizedString("MultiColumn_Join_Separator"),a=e.getLocalizedString("NamePattern_Bracket");n;){var s=r[n.level].displayName;o.unshift(jsCommon.StringExtensions.format(a,n.value,s)),n=n.parent}return o.join(t)}function f(e,t){null!=e.dataPoint.level&&t.dataPoint.level,null!=e.selectionIndex&&t.selectionIndex;var i=e.dataPoint.level-t.dataPoint.level;return 0!=i?i:(e.selectionIndex,t.selectionIndex,e.selectionIndex-t.selectionIndex)}m.DefaultSlicerProperties=function(e){return{general:{outlineWeight:1,outlineColor:E.ColorHelper.getThemeColor(e,m.DefaultSlicerOutlineColorName)},slicerText:{color:E.ColorHelper.getThemeColor(e,m.DefaultSlicerTextColorName),outlineStyle:0,outline:C.none,textSize:10,fontFamily:E.Font.Family.regular.css,labelBold:!1,labelItalic:!1,labelUnderline:!1},selection:{selectAllCheckboxEnabled:!1,singleSelect:!0,strictSingleSelect:!1},search:{enabled:!1,outlineStyle:4,outline:C.bottomOnly,borderColor:"#C8C8C8",background:"#ffffff"},expandCollapse:{indentation:15,visible:!0,toggleType:0},items:{padding:void 0,accessibilityContrastProperties:!1}}},m.convert=function(e){var t=e.dataView,i=e.hostServices,r=e.selectionHandler;if(t&&t.metadata&&!_.isEmpty(t.metadata.columns)){var n=i.getLocalizedString("ListJoin_Separator"),o=new E.readers.SlicerDataViewReader(t,i.getLocalizedString("ListJoin_Separator")),a=o.getIdentityFields();if(!_.isEmpty(a)){var s=t.metadata&&t.metadata.objects&&x.DataViewObjects.getValue(t.metadata.objects,E.slicerProps.general.filter),l=o.getColumns(),a={columns:l,defaultValuePropertyId:E.slicerProps.general.defaultValue,filter:s,fieldSQExprs:a},a=new E.SlicerFilterAnalyzer(a,i.ignoreDefaultFilter());_.isEmpty(a.selectedIdentities)||(o=new E.readers.SlicerDataViewReader(t,n,a.selectedIdentities));l=a.hasMappedColumn&&!E.SlicerUtil.doDataViewColumnSupportSelectAll({columns:l});!function(e,t,i,r,n){var o=t.filter,a=i.isSelectionModeInverted();{var s,l;o&&!w.isSameFilter(o,e)&&(i.handleClearSelection(),s=E.slicerProps.general.filter,(l={})[s.propertyName]=t.filter,l={merge:[{objectName:s.objectName,selector:void 0,properties:l}]},r.persistProperties(l))}!n||!a&&w.isSameFilter(o,e)||E.SlicerUtil.clearFilters(i,!1)}(s,a,r,i,l),r.setColumns(o.getColumns()),r.setQueryNameByLevel(o.getQueryNamePerLevel());l=function(e,t,i,r,n){var o=r.hostServices,a=r.selectionHandler,s=r.style,l=r.localizedSelectAllText,c=null!=r.isSlicer&&r.isSlicer,d=null!=a&&a.isSelectionModeInverted();d=e.filter?e.isAnyFilter?x.DataViewObjects.getValue(t.objects,E.slicerProps.data.isInvertedSelectionMode,d):e.isNotFilter:!e.hasMappedColumn&&x.DataViewObjects.getValue(t.objects,E.slicerProps.data.isInvertedSelectionMode,d);var u=function(e,t,i){var r=m.DefaultSlicerProperties(t),n=e.objects,o=E.ColorHelper.create(t);n&&(r.items.accessibilityContrastProperties=x.DataViewObjects.getValue(n,E.slicerProps.items.accessibilityContrastProperties,!1),e="lightLabel",r.items.accessibilityContrastProperties&&0===i&&(e="largeLightLabel"),e=y.createFromObjectOrStyle(x.DataViewObjects.getObject(n,"items"),{color:"fontColor",family:"fontFamily",size:"textSize"},o,t,"foregroundNeutralSecondary",e,{color:r.slicerText.color,family:r.slicerText.fontFamily,size:b.createFromPt(r.slicerText.textSize)}),r.slicerText.color=e.color,r.slicerText.fontFamily=e.family,r.slicerText.textSize=e.size.pt,r.items.accessibilityContrastProperties&&1===i&&(r.slicerText.outline=C.frame,r.slicerText.outlineStyle=15),r.slicerText.outline=x.DataViewObjects.getValue(n,E.slicerProps.items.outline,r.slicerText.outline),r.slicerText.outlineStyle=x.DataViewObjects.getValue(n,E.slicerProps.items.outlineStyle,r.slicerText.outlineStyle),(i=o.getColorForProperty(n,E.slicerProps.items.background,void 0))&&(r.slicerText.background=i),r.search.enabled=x.DataViewObjects.getValue(n,E.slicerProps.general.selfFilterEnabled,r.search.enabled),r.search.outlineStyle=x.DataViewObjects.getValue(n,E.slicerProps.searchBox.outlineStyle,r.search.outlineStyle),r.search.outline=x.DataViewObjects.getValue(n,E.slicerProps.searchBox.outline,r.search.outline),r.search.borderColor=o.getColorForPropertyWithDefaultColor(n,E.slicerProps.searchBox.borderColor,r.search.borderColor),i=o.getColorForProperty(n,E.slicerProps.searchBox.background,void 0),r.search.background=i||r.slicerText.background||r.search.background,r.expandCollapse.toggleType=x.DataViewObjects.getValue(n,E.slicerProps.items.expandCollapseToggleType,r.expandCollapse.toggleType),r.expandCollapse.indentation=x.DataViewObjects.getValue(n,E.slicerProps.items.steppedLayoutIndentation,r.expandCollapse.indentation),r.general.outlineWeight=x.DataViewObjects.getValue(n,E.slicerProps.general.outlineWeight,r.general.outlineWeight),r.general.outlineColor=o.getColorForPropertyWithDefaultColor(n,E.slicerProps.general.outlineColor,r.general.outlineColor),r.selection.selectAllCheckboxEnabled=x.DataViewObjects.getValue(n,E.slicerProps.selection.selectAllCheckboxEnabled,r.selection.selectAllCheckboxEnabled),r.selection.singleSelect=x.DataViewObjects.getValue(n,E.slicerProps.selection.singleSelect,r.selection.singleSelect),r.selection.strictSingleSelect=x.DataViewObjects.getValue(n,E.slicerProps.selection.strictSingleSelect,r.selection.strictSingleSelect),r.slicerText.labelBold=x.DataViewObjects.getValue(n,E.slicerProps.items.bold,!1),r.slicerText.labelItalic=x.DataViewObjects.getValue(n,E.slicerProps.items.italic,!1),r.slicerText.labelUnderline=x.DataViewObjects.getValue(n,E.slicerProps.items.underline,!1),r.items.padding=x.DataViewObjects.getValue(n,E.slicerProps.items.padding,void 0));return r}(t,s,r.slicerType);a&&(a.setSelectionModeInverted(d),a.setDefaultValueMode(w.isDefaultFilter(e.filter)));var p=i.getQueryNamePerLevel(),h=o.getFilterExpressionMetadata(),S=[],s=[],h=function e(t,i,r,n,o,a,s,l,c,d,u){var p=i.getSelectedNodes();var h=i.getDataPointsCount();var S=[];var m=i.getMetadataColumn();var g=u&&u.fieldParameters&&m.parameter&&2===m.parameter.kind;var f=E.valueFormatter.getFormatString(m,E.slicerProps.general.formatString);var v=i.getLevel();var y=0;for(var b=0;b<h;b++){var C,w,x,D,P,I,V,R=i.getDataViewDataPoint(b);R&&(y++,l.calculatedIndex++,C=E.SlicerUtil.tryRemoveValueFromRetainedList(R.scopeId,p),w=E.valueFormatter.format(R.value,f),x=i.isImageData()&&T.isValidImageUrl(w),D=w,P=!1,I=v+":"+y,null!=d&&d.hasMappedColumn&&null==R.value&&(P=!0,D=o.getLocalizedString("DQP_Disabled_Blank")),I={value:w,tooltip:D,identity:null,selected:null!=C&&C.checked,partially:C&&!_.isEmpty(C.children),count:R.count,isImage:x,level:v,parent:c,isCollapsed:R.isCollapsed,scopeIdentity:R.scopeId,levelIndex:y,disabled:P,index:l.calculatedIndex,id:c?c.id+","+I:I},C&&C.checked&&(g?(V={dataPoint:I,selectionIndex:C.index},n.push(V)):r.push(I)),S.push(I),c&&c.children.push(I),F(I,a),!R.isCollapsed&&R.childrenReader?(I.children=[],S.push.apply(S,e(t,R.childrenReader,r,n,o,a,s,l,I,void 0,u)||[])):C&&!_.isEmpty(C.children)&&(V=v+1,R=t.getMetadataColumnByLevel(V),M(V,d,C.children,a,s&&s.cachedValueItems,R,t,i,I,S,r,n,g,!1,l)))}_.isEmpty(p)||M(v,d,p,a,s&&s.cachedValueItems,m,t,i,c,S,r,n,g,!c||!1===c.isCollapsed,l);return S}(i,i.getDataPointsReader(),S,s,o,p,h,{calculatedIndex:0},void 0,e,r.featureSwitches);0<s.length&&(S.length,S=_.chain(s).sort(f).map(function(e){return e.dataPoint}).value());r=a.toFilterExpressionMetadata(S);o.setFilterExpressionMetadata(r);s=function(e){var t=x.DataViewObjects.getValue(e.objects,E.slicerProps.general.selfFilter,void 0);if(!t)return"";e=t.conditions();e.length;t=e[0];if(t){e=new v;return t.accept(e),e.getValueForField()}}(t),r=u.selection,t=r.strictSingleSelect;!t&&c&&a.isDisableMultipleSelectForMappedColumn()&&(t=!0,u.selection.strictSingleSelect=!0);r.selectAllCheckboxEnabled&&!t&&_.isEmpty(s)&&(r=n?o.getLocalizedString("DQP_Disabled_SelectAll"):l,h.unshift({value:l,tooltip:r,identity:E.SelectionId.createWithMeasure(l),selected:!1,isSelectAllDataPoint:!0,partially:0<S.length,count:void 0,disabled:n,levelIndex:0,index:0,id:"0:0"}));a&&a.setStrictSingleSelect(t,_.isEmpty(S)?h:S);return{categorySourceName:i.getDisplayName(),slicerSettings:u,slicerDataPoints:h,defaultValueByLevel:e.defaultValueByLevel,searchKey:s,restatement:g(o,S,d,i.getColumns()),warnings:new E.VisualWarningBuilder,retainedDataPoints:S,queryNameByLevel:p}}(a,t.metadata,o,e,l);return l.hasImages=_.some(l.slicerDataPoints,function(e){return e.isImage}),l}}},m.getRestatement=g;var e,v=(__extends(t,e=i),t.prototype.visitConstant=function(e){e.type&&e.type.text&&(this.value=e.value)},t.prototype.visitContains=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitColumnRef=function(e){this.fieldExpr=e},t.prototype.visitHierarchyLevel=function(e){this.fieldExpr=e},t.prototype.visitDefault=function(e){this.value=void 0,this.fieldExpr=void 0},t.prototype.getValueForField=function(){return this.fieldExpr&&this.value},t);function t(){return null!==e&&e.apply(this,arguments)||this}}(E.DataConversion||(E.DataConversion={}))}(powerbi=powerbi||{}),function(p){var h,o,i,e,n,r;function S(){return h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown])}function a(e){this.areControlButtonsAlwaysVisible=!1,this.enableInFocusRenderers=!1,this.enableMultiElementRows=!1,this.preventVirtualKeyboardOnTheFirstTap=!1,this.isInFocus=!1,this.hasSearchableData=!1,this.lockKeyboardNavigation=!0,this.isSlicer=!1,e&&(this.enableInFocusRenderers=e.enableInFocusRenderers,this.enableMultiElementRows=e.enableMultiElementRows,this.preventVirtualKeyboardOnTheFirstTap=e.preventVirtualKeyboardOnTheFirstTap,this.lockKeyboardNavigation=!1!==e.lockKeyboardNavigation,this.featureSwitches=e.featureSwitches,this.isSlicer=e.isSlicer),this.activeMode=h.slicerMode.basic,this.slicerOrientation=0,this.viewModelAdapter=new h.SlicerViewModelAdapter}h=p.visuals||(p.visuals={}),o=p.visuals.controls,i=jsCommon.FocusManagerFocusEventName,e=p.data.RelativeFilterType,n=p.visuals.builder,r="full-screen",a.prototype.init=function(e){var t=this;this.initOptions=e,this.element=e.element,this.style=e.style,this.visibilityHelper=p.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,"slicerResponsiveIcon"),this.currentViewport=e.viewport,this.hostServices=e.host,this.loadMoreHandler=new h.SimpleLoadMoreDataHandler(this.hostServices),this.container=InJs.DomFactory.div().addClass("slicer-container").appendTo(this.element),this.alert=InJs.DomFactory.span().appendTo(this.container).attr("aria-live","polite").attr("role","status").hide(),this.headerContainer=InJs.DomFactory.div().appendTo(this.container).addClass("slicer-header-wrapper"),this.slicerContainer=InJs.DomFactory.div().appendTo(this.container).addClass("slicer-content-wrapper"),this.initializeSlicerRenderer(),this.container.on(i,function(){t.areControlButtonsAlwaysVisible=!0,t.container.addClass("focused"),t.alert.text(t.activeMode);var e=!!t.slicerRenderer&&t.slicerRenderer.hasSlider();t.updateSlicerHeader(e)}),this.container.on("focusin",function(){t.container.addClass("focused")})},a.prototype.destroy=function(){this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy(),this.slicerHeader&&this.slicerHeader.destroy()},a.prototype.update=function(e){this.isInFocus=!!e.isInFocus,e.type&p.VisualUpdateType.Resize&&this.resizing(e.viewport),(!e.type||e.type&p.VisualUpdateType.Data)&&this.dataChanged(e.dataViews,e.operationKind)},a.prototype.dataChanged=function(e,t){_.isEmpty(e)||(this.dataView=e[0],t=t!==p.VisualDataChangeOperationKind.Append,this.render(t,!0))},a.prototype.resizing=function(e){this.currentViewport=e,this.render(!1)},a.prototype.enumerateObjectInstances=function(e){if(this.dataView)switch(e.objectName){case"header":case"modeSelection":return this.slicerHeader.enumerateObjectInstances(e);case"general":var t,i=this.slicerHeader.enumerateObjectInstances(e);return this.slicerRenderer&&this.slicerRenderer.supportsOrientation()&&(t=this.data?this.data.orientation:0,i[0].properties.orientation=t),this.viewModelAdapter&&this.viewModelAdapter.enumerateObjectInstances(e,i,this.dataView,this.activeMode,this.slicerOrientation),i;default:return this.slicerRenderer.enumerateObjectInstances(e,this.featureSwitches)}},a.prototype.getFormattingModel=function(){var e=this;if(this.dataView)return new h.builder.FormattingModelBuilder(function(){return e.getSlicerSettingsCard()},function(){return e.slicerHeader.getSlicerHeaderCard(e.hostServices)},function(){return e.slicerRenderer.getValuesCard(e.featureSwitches)},function(){return e.slicerRenderer.getAdditionalCards()}).build()},a.prototype.getSlicerSettingsCard=function(){var t=this,e=new n.FormattingCardUidBuilder("slicerSettings");this.slicerRenderer&&this.slicerRenderer.supportsOrientation()&&(r=this.data?this.data.orientation:0);var i=this.slicerRenderer.getSlicerSettingsCardOptions(e,r);if(i){var r=i.groups,i=i.revertToDefaultDescriptors;return new n.FormattingCardBuilder(e,"Slicer_Settings",i,function(e){return t.hostServices.getLocalizedString(e)}).withGroups(r).build()}},a.prototype.resolveFormattingPlaceholder=function(e){if(h.builder.isVisualFormattingSlicePlaceholder(e)){e=e.name;if("responsive"===e)return this.getResponsiveSlice()}},a.prototype.getResponsiveSlice=function(){var t=this;if(this.dataView&&this.viewModelAdapter)return this.viewModelAdapter.getResponsiveSlice(this.dataView,this.activeMode,this.slicerOrientation,function(e){return t.hostServices.getLocalizedString(e)})},a.prototype.loadMoreData=function(){return this.loadMoreHandler.updateDataView(this.dataView),this.loadMoreHandler.loadMoreData()},a.prototype.onClearSelection=function(){this.slicerRenderer&&this.slicerRenderer.onClear&&this.slicerRenderer.onClear()},a.converter=function(e,t,i){if(e){var r,n,o=null,a=0,s=!1,l=!1,c=S(),d=1,u=!1;return e.metadata&&e.metadata.objects&&(n=e.metadata.objects,a=p.DataViewObjects.getValue(n,h.slicerProps.general.orientation,a),s=p.DataViewObjects.getValue(n,h.slicerProps.selection.strictSingleSelect,s),o=p.DataViewObjects.getValue(n,h.slicerProps.data.mode,o)),e.metadata&&e.metadata.columns&&(n=h.SlicerUtil.readMetadataColumns(e.metadata.columns),_.isEmpty(n)||(e=n[0],o=h.SlicerPluginMethods.getValidatedSlicerMode(n,o),r=_.join(_.map(n,function(e){return e.displayName}),i),u=!_.some(n,function(e){return!0!==e.type.text}),1===n.length?(u=!0===e.type.text,l=!0===e.type.numeric,e.parameter&&1===e.parameter.kind?(c=_.union(S(),h.slicerMode.type.members([o])),s=s||!e.parameter.supportsMultipleValues):!0===e.type.dateTime?c=h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between,h.slicerMode.relativeDate,h.slicerMode.relativeTime]):l&&(c=_.union(c,h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between])),e.parameter&&(c=_.union(c,h.slicerMode.type.members([h.slicerMode.single]))))):a=0,h.slicerMode.slicerModeSupportsMinMax(o)&&1===n.length&&(d=e.aggregates&&null!=e.aggregates.min&&null!=e.aggregates.max?d:2))),{orientation:a,categorySourceName:r,isCategorySourceNumeric:l,mode:o||h.slicerMode.basic,switchMode:d,hasSearchableData:u,activeOptions:c,showIcon:!1,showTabularSlicer:!1,warningObjectCollection:new h.VisualWarningBuilder,strictSingleSelect:s}}},a.prototype.render=function(e,t){this.updateViewport(),this.previousData=this.data,this.data=this.originalData=a.converter(this.dataView,this.featureSwitches,this.hostServices.getLocalizedString("ListJoin_Separator")),this.viewModelAdapter&&this.dataView&&(this.data=this.viewModelAdapter.applySlicerChanges(this.currentViewport,this.originalData,this.dataView)),this.data&&(this.hasSearchableData=this.data.hasSearchableData),this.renderSlicer(e,t),this.data&&this.data.showIcon?this.visibilityHelper.updateVisibility({showIcon:!0,viewport:this.currentViewport}):this.visibilityHelper.updateVisibility({showIcon:!1})},a.prototype.renderSlicer=function(e,t){this.updateSlicerRendererIfNeeded(),this.slicerRenderer.render({dataView:this.dataView,viewport:this.currentViewport,resetScrollbarPosition:e,hasSearchableData:this.hasSearchableData,restatement:this.data&&this.data.categorySourceName,isSlicer:this.isSlicer,isSearchMode:!!this.selectionHandler&&this.selectionHandler.isSearchMode()}),this.updateSlicerHeader(this.slicerRenderer.hasSlider());e=null!=this.slicerRenderer.getRestatement;this.slicerHeader&&this.slicerHeader.setFilterRestatement(e?this.slicerRenderer.getRestatement():void 0,e),t&&this.loadMoreHandler.onLoadMoreDataCompleted(),this.updateWarnings()},a.prototype.updateSlicerRendererIfNeeded=function(){var e,t;if(this.enableInFocusRenderers&&this.container.hasClass(r)!==this.isInFocus)return this.isInFocus?this.container.addClass(r):this.container.removeClass(r),void this.initializeSlicerRenderer();this.data&&(t=this.data.mode||h.slicerMode.basic,this.activeMode!==t||h.slicerMode.isRangeSlicerMode(this.activeMode)&&this.previousData&&this.previousData.isCategorySourceNumeric!==this.data.isCategorySourceNumeric?(this.activeMode=t,this.initializeSlicerRenderer()):(e=this.data.showTabularSlicer,t=this.data.orientation||0,(this.slicerOrientation!==t||this.previousData&&this.previousData.showTabularSlicer!==e)&&this.initializeSlicerRenderer()))},a.prototype.updateViewport=function(){var e={height:this.currentViewport.height};this.container.css(e)},a.prototype.updateSlicerHeader=function(i){var e,t,r,n=this;this.dataView&&(e=p.data.createDataViewCategoricalReader(this.dataView),this.slicerHeader||(t={onClear:function(){n.slicerRenderer&&n.slicerRenderer.onClear(!0)},onChange:function(e){n.slicerRenderer&&n.slicerRenderer.onModeChange(e)},host:this.headerContainer,visibilityState:this.data.switchMode,selectedValue:this.activeMode,hoverContainer:this.element,enableInFocusRenderers:this.enableInFocusRenderers,slicerModeOptions:this.slicerActiveOptions()},r={localize:this.hostServices.getLocalizedString.bind(this.hostServices),getViewMode:this.hostServices.getViewMode.bind(this.hostServices),applySlicerHeaderChanges:function(e){var t=e;return t=n.viewModelAdapter&&n.dataView&&n.data?n.viewModelAdapter.applySlicerHeaderChanges(n.currentViewport,e,n.dataView,n.data,i):t},tooltipService:this.hostServices.tooltips()},this.slicerHeader=new o.SlicerHeader(t,r,this.style,this.featureSwitches)),this.slicerHeader.update(e,{text:this.data.categorySourceName,restatement:this.slicerRenderer.getRestatement?this.slicerRenderer.getRestatement():void 0,selectedValue:this.activeMode,visibilityState:this.data.switchMode,isInFocus:this.isInFocus,slicerModeOptions:this.slicerActiveOptions(),areControlButtonsAlwaysVisible:this.areControlButtonsAlwaysVisible,strictSingleSelect:this.data.strictSingleSelect}))},a.prototype.slicerActiveOptions=function(){if(this.data.isCategorySourceNumeric){for(var e=[],t=0,i=this.data.activeOptions;t<i.length;t++){var r=i[t];e.push(h.NumericSlicerOptions.members([r.value])[0])}return e}return this.data.activeOptions},a.prototype.initializeSlicerRenderer=function(){switch(this.slicerRenderer&&this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy(),this.slicerOrientation=this.data&&this.data.orientation||0,this.slicerContainer.empty(),this.activeMode){case h.slicerMode.basic:return void this.initializeBasicSlicer();case h.slicerMode.dropdown:return void this.initializeDropdownSlicer();case h.slicerMode.relativeDate:return void this.initializeRelativeSlicer(e.Date);case h.slicerMode.relativeTime:return void this.initializeRelativeSlicer(e.Time);case h.slicerMode.between:case h.slicerMode.before:case h.slicerMode.after:return void this.initializeRangeSlicer(!1);case h.slicerMode.single:return void this.initializeRangeSlicer(!0);default:return this.activeMode,void this.initializeVerticalSlicer()}},a.prototype.initializeBasicSlicer=function(){if(this.enableInFocusRenderers&&this.isInFocus)this.initializeInFocusVerticalSlicer();else switch(this.slicerOrientation){case 1:this.initializeHorizontalOrTabularSlicer();break;case 0:this.initializeVerticalSlicer()}},a.prototype.initializeInFocusVerticalSlicer=function(){this.hostServices.setShouldDeferData(!1);var e=this.slicerRenderer=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckListSlicerStrategy,{hostServices:this.hostServices,featureSwitches:this.featureSwitches},this.lockKeyboardNavigation),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},a.prototype.initializeVerticalSlicer=function(){var e=this.slicerRenderer=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckBoxSlicerStrategy,{hostServices:this.hostServices,featureSwitches:this.featureSwitches},this.lockKeyboardNavigation),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},a.prototype.initializeRangeSlicer=function(e){var t;this.data.isCategorySourceNumeric?(i=new h.RangeSlicerViewModelAdapter,t=new h.NumericSlicer({hostServices:this.hostServices}),this.slicerRenderer=new h.RangeSlicer({hostServices:this.hostServices,featureSwitches:this.featureSwitches},t,e,this.data.isCategorySourceNumeric,i)):(i=new h.RangeSlicerViewModelAdapter,t=new h.DateSlicer({preventVirtualKeyboardOnTheFirstTap:this.preventVirtualKeyboardOnTheFirstTap,hostServices:this.hostServices,featureSwitches:this.featureSwitches}),this.slicerRenderer=new h.RangeSlicer({preventTextSelection:this.preventVirtualKeyboardOnTheFirstTap,hostServices:this.hostServices,featureSwitches:this.featureSwitches},t,e,this.data.isCategorySourceNumeric,i));var i=this.createInitOptions();this.selectionHandler=this.slicerRenderer.init(i,this.slicerContainer)},a.prototype.initializeHorizontalOrTabularSlicer=function(){var e=new(!!this.data&&this.data.showTabularSlicer?h.TabularSlicerLayout:h.HorizontalSlicerLayout),t=new h.HorizontalSlicerViewModelAdapter,e=this.slicerRenderer=new h.HorizontalSlicerRenderer({hostServices:this.hostServices,horizontalSlicerLayout:e,featureSwitches:this.featureSwitches},t),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},a.prototype.initializeRelativeSlicer=function(e){var t={hostServices:this.hostServices},e=this.slicerRenderer=h.RelativeSlicerUtil.createRelativeSlicer(e,t),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},a.prototype.initializeDropdownSlicer=function(){var e,t;this.enableInFocusRenderers&&this.isInFocus?this.initializeInFocusVerticalSlicer():(t={hostServices:this.hostServices,featureSwitches:this.featureSwitches},e=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckBoxSlicerStrategy,t),this.slicerRenderer=new h.DropdownSlicerRenderer(e,t),t=this.createInitOptions(),this.selectionHandler=this.slicerRenderer.init(t,this.slicerContainer))},a.prototype.createInitOptions=function(){var e=this;return{visualInitOptions:this.initOptions,loadMoreData:function(){return e.loadMoreData()},enableMultiElementRows:this.enableMultiElementRows}},a.prototype.updateWarnings=function(){this.data&&(this.slicerHeader.addWarnings(this.data.warningObjectCollection),this.slicerRenderer.addWarnings&&this.slicerRenderer.addWarnings(this.data.warningObjectCollection),this.hostServices.setWarnings(this.data.warningObjectCollection.complete()))},h.Slicer=a}(powerbi=powerbi||{}),function(e){var l,n,o,a;function s(){}l=e.visuals||(e.visuals={}),n=jsCommon.BrowserUtils,o=jsCommon.DOMConstants,a=jsCommon.KeyUtils,s.prototype.bindEvents=function(e,t){this.behavior=this.createWebBehavior(e),this.behavior.bindEvents(e.behaviorOptions,t)},s.prototype.renderSelection=function(){this.behavior&&this.behavior.renderSelection()},s.bindSlicerEvents=function(e,t,i,r){s.bindSlicerItemSelectionEvent(t,i,r),e.searchInput&&s.bindSlicerSearchEvent(e.searchInput,e.clearSearchTextButton,i)},s.setSelectionOnSlicerItems=function(e,t,o){var a=t.isSelectionModeInverted(),s=t.hasSelection();e.each(function(e,t){var i,r=!!e.partially||e.isSelectAllDataPoint&&s,e=!s&&a||s&&!r&&l.SlicerUtil.getSlicerDataPointCheckedState(e,a);$(this).toggleClass("selected",e),$(this).toggleClass("partiallySelected",!!r),o.isHighContrast&&(n=this.getElementsByTagName("span")[0],e?(i=l.ColorHelper.getThemeColor(o,"foregroundSelected"),n&&(n.style.backgroundColor=i,n.style.borderColor=i)):(i=l.ColorHelper.getThemeColor(o,"foreground"),n&&(n.style.backgroundColor="",n.style.borderColor=i,n.style.boxShadow="none")));var n=this.getElementsByTagName("input")[0];n&&(n.checked=e)})},s.bindSlicerItemSelectionEvent=function(e,r,n){var o=this;e.on("keydown",function(e){var t=d3.event,i=t.keyCode;32!==i&&13!==i||(32===i&&t.preventDefault(),o.toggleItemSelection(e,r,n))}).on("click",function(e){$(d3.event.target).trigger("slicer.dataPointSelected"),o.toggleItemSelection(e,r,n)})},s.toggleItemSelection=function(e,t,i,r){e.disabled||(r=r||d3.event,e.isSelectAllDataPoint?(t.toggleSelectionModeInversion(),t.persistSelectionFilter(l.slicerProps.general.filter)):(i=s.isMultiSelect(e,r,i,t)?3:0,t.handleSelection(e,i,{x:r.clientX,y:r.clientY})&&t.persistSelectionFilter(l.slicerProps.general.filter)))},s.toggleItemSelectionFromExternal=function(e,t,i,r){this.toggleItemSelection(t,i,r,e)},s.bindSlicerSearchEvent=function(t,e,i){var r=this;t.empty()||(t.on(o.keyDownEventName,function(){var e=d3.event;n.isCtrlOrMeta(e)&&a.isCtrlShortcutKey(e.keyCode)||a.isArrowKey(e.keyCode)||a.isDeleteKey(e.keyCode)?e.stopPropagation():27===e.keyCode?(r.clearSearch(i),e.preventDefault()):13===e.keyCode&&(s.startSearch(t,i),e.stopPropagation())}).on(o.keyUpEventName,_.debounce(function(){s.startSearch(t,i)},s.searchInputTimeoutDuration)),e&&!e.empty()&&e.on(o.mouseClickEventName,function(){r.clearSearch(i),d3.event.stopPropagation()}))},s.clearSearch=function(e){e.setSearchMode(!0),e.persistSelfFilter(l.slicerProps.general.selfFilter,null)},s.startSearch=function(e,t){e=e.node(),e=e&&e.value,e=_.trim(e);t.setSearchMode(!0),t.persistSelfFilter(l.slicerProps.general.selfFilter,e)},s.isMultiSelect=function(e,t,i,r){return!i.selection.strictSingleSelect&&!r.isDisableMultipleSelectForMappedColumn()&&(r.isSelectionModeInverted()||!i.selection.singleSelect||n.isCtrlOrMeta(t)||1===r.getDataMultiSelectMode()||s.hasParentSelected(e))},s.hasParentSelected=function(e){for(;e.parent;){if(e.parent.selected)return!0;e=e.parent}},s.prototype.createWebBehavior=function(e){e=new(1===e.orientation?l.HorizontalSlicerWebBehavior:l.VerticalSlicerWebBehavior);return e},s.searchInputTimeoutDuration=500,l.SlicerWebBehavior=s}(powerbi=powerbi||{}),function(p){!function(s){var e,l,n,i,o,r,a,c,d;function u(e,t,i,r){this.services=t,this.settings=e,this.style=i,this.originalData=this.data=u.DefaultData(this.style,e.text),this.featureSwitches=r,this.render()}e=s.controls||(s.controls={}),l=p.visuals.builder,n=p.visuals.Units.FontSize,i=s.outline,o=jsCommon.PixelConverter,r=p.visuals.controls.SelectMenu,a=jsCommon.StringExtensions,c=jsCommon.CssConstants,d="foregroundNeutralSecondary",u.DefaultData=function(e,t){return{borderStyle:"solid",borderBottomWidth:1,show:!0,outline:i.none,outlineStyle:0,fontColor:s.ColorHelper.getThemeColor(e,"foregroundDark"),textSize:9,fontFamily:s.Font.Family.regular.css,iconColor:s.ColorHelper.getThemeColor(e,d),iconHoverColor:s.ColorHelper.getThemeColor(e,"foreground"),outlineColor:s.ColorHelper.getThemeColor(e,"foregroundNeutralSecondaryAlt2"),outlineWeight:1,searchEnabled:!1,background:null,showRestatement:!1,menu:{fontColor:s.ColorHelper.getThemeColor(e,d)},warnings:new s.VisualWarningBuilder,text:t,labelBold:!1,labelItalic:!1,labelUnderline:!1}},u.InFocusModeData=function(e,t){t=u.DefaultData(e,t);return t.borderStyle="none",t.background=s.ColorHelper.getThemeColor(e,"foregroundNeutralLight"),t.textSize=o.toPoint(13),t.fontColor=s.ColorHelper.getThemeColor(e,"foregroundNeutralDark"),t.fontFamily=s.Font.Family.regular.css,t},u.prototype.destroy=function(){this.selectMenu&&this.selectMenu.destroy()},u.prototype.enumerateObjectInstances=function(e){var t=this.originalData;if(t){if("header"!==e.objectName)return"general"===e.objectName?[{selector:null,objectName:"general",properties:{outlineColor:t.outlineColor,outlineWeight:t.outlineWeight}}]:void 0;e={selector:null,objectName:"header",properties:{text:t.text,show:t.show,fontColor:t.fontColor,background:t.background,textSize:t.textSize,fontFamily:t.fontFamily,outlineColor:t.outlineColor,outlineWeight:t.outlineWeight},propertyInstanceKind:{text:3,fontColor:this.featureSwitches.expressionBasedFormatting?3:1,background:this.featureSwitches.expressionBasedFormatting?3:1}};return this.featureSwitches.outlineDropdownToCheckboxes?e.properties.outlineStyle=t.outlineStyle:e.properties.outline=t.outline,this.settings.supportsRestatement&&(e.properties.showRestatement=t.showRestatement),this.featureSwitches&&this.featureSwitches.enableBIU&&(e.properties.bold=t.labelBold,e.properties.italic=t.labelItalic,e.properties.underline=t.labelUnderline),[e]}},u.prototype.getSlicerHeaderCard=function(t){var i=this,r=this.originalData;if(r){var n=s.slicerProps.header,e=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("slicerHeader"),"Slicer_Header",[n.text,n.fontFamily,n.textSize,n.bold,n.italic,n.underline,n.fontColor,n.showRestatement,n.outlineStyle,n.outline,s.slicerProps.general.outlineColor,s.slicerProps.general.outlineWeight,n.background,n.show],function(e){return t.getLocalizedString(e)}),o=(new s.builder.FontControlBuilder).withFontFamily({descriptor:n.fontFamily,value:r.fontFamily}).withFontSizeProperties({descriptor:n.textSize,value:r.textSize});this.featureSwitches&&this.featureSwitches.enableBIU&&o.withBold({descriptor:n.bold,value:r.labelBold}).withItalic({descriptor:n.italic,value:r.labelItalic}).withUnderline({descriptor:n.underline,value:r.labelUnderline});var a=o.build();return e.addTopLevelToggle("show",function(){return new s.builder.ToggleSwitchBuilder({descriptor:n.show,value:r.show}).build()}).addGroup("text",function(e){e.withDisplayName("Text").addSimpleSlice("title",new l.TextInputBuilder({descriptor:__assign(__assign({},n.text),{instanceKind:3}),value:r.text,placeholder:""}).build()).addCompositeSlice("fontselector","Font",a).addSimpleSlice("color",function(){var e={value:r.fontColor};return new l.ColorPickerBuilder({descriptor:__assign(__assign({},n.fontColor),{instanceKind:i.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()}),i.settings.supportsRestatement&&e.addSimpleSlice("labelContents",new l.ToggleSwitchBuilder({descriptor:n.showRestatement,value:r.showRestatement}).build())}).addGroup("border",function(e){e.withDisplayName("Visual_Border"),i.featureSwitches.outlineDropdownToCheckboxes?e.addSimpleSlice("border position",new l.FlagSelectionBuilder({descriptor:n.outlineStyle,value:r.outlineStyle}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("border position",new l.DropdownBuilder({descriptor:n.outline,value:r.outline}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("color",function(){var e={value:r.outlineColor};return new l.ColorPickerBuilder({descriptor:__assign(__assign({},s.slicerProps.general.outlineColor),{instanceKind:i.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")}).addSimpleSlice("lineWidth",new l.SliderBuilder({descriptor:s.slicerProps.general.outlineWeight,value:r.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}},localize:function(e){return t.getLocalizedString(e)}}).build(),function(e){return e.withCustomDisplayName("Visual_Line_Width")})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:r.background};return new l.ColorPickerBuilder({descriptor:__assign(__assign({},n.background),{instanceKind:i.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")})}),e.build()}},u.prototype.update=function(e,t){$.extend(this.settings,t),this.settings.enableInFocusRenderers&&this.settings.isInFocus?this.data=u.InFocusModeData(this.style,t.text):(this.originalData=u.converter(e,this.style,t.text),this.data=this.services.applySlicerHeaderChanges(this.originalData)),this.maintainSelectMenu(),this.updateTitle()},u.prototype.setFilterRestatement=function(e,t){this.settings.restatement=e,this.settings.supportsRestatement=t,this.updateTitleText()},u.converter=function(e,t,i){var r=u.DefaultData(t,i),i=e.objects.getStaticObjects(),e=s.ColorHelper.create(t);return i&&(t=s.FontProperties.createFromObjectOrStyle(p.DataViewObjects.getObject(i,"header"),{color:"fontColor",family:"fontFamily",size:"textSize"},e,t,"foregroundDark","title",{color:r.fontColor,family:r.fontFamily,size:n.createFromPt(r.textSize)}),r.fontColor=t.color,r.fontFamily=t.family,r.textSize=t.size.pt,r.show=p.DataViewObjects.getValue(i,s.slicerProps.header.show,r.show),r.text=p.DataViewObjects.getValue(i,s.slicerProps.header.text,r.text),r.menu.fontColor=e.getColorForPropertyWithDefaultColor(i,s.slicerProps.header.fontColor,r.menu.fontColor),r.background=e.getColorForPropertyWithDefaultColor(i,s.slicerProps.header.background,r.background),r.outlineColor=e.getColorForPropertyWithDefaultColor(i,s.slicerProps.general.outlineColor,r.outlineColor),r.outlineWeight=p.DataViewObjects.getValue(i,s.slicerProps.general.outlineWeight,r.outlineWeight),r.outlineStyle=p.DataViewObjects.getValue(i,s.slicerProps.header.outlineStyle,r.outlineStyle),r.outline=p.DataViewObjects.getValue(i,s.slicerProps.header.outline,r.outline),r.searchEnabled=p.DataViewObjects.getValue(i,s.slicerProps.general.selfFilterEnabled,r.searchEnabled),r.showRestatement=p.DataViewObjects.getValue(i,s.slicerProps.header.showRestatement,r.showRestatement),r.labelBold=p.DataViewObjects.getValue(i,s.slicerProps.header.bold,r.labelBold),r.labelItalic=p.DataViewObjects.getValue(i,s.slicerProps.header.italic,r.labelItalic),r.labelUnderline=p.DataViewObjects.getValue(i,s.slicerProps.header.underline,r.labelUnderline)),r},u.prototype.render=function(){this.header=InJs.DomFactory.div().addClass("slicer-header").appendTo(this.settings.host),this.addTitle(),this.maintainSelectMenu()},u.prototype.maintainSelectMenu=function(){var e;this.selectMenu||0===this.services.getViewMode()?this.updateSelectMenu():this.addSelectMenu(),this.selectMenuContainer&&(e=this.data,this.selectMenuContainer.find("span.ui-icon").css("color",this.data.iconColor).hover(function(){$(this).css("color",e.iconHoverColor)},function(){$(this).css("color",e.iconColor)}))},u.prototype.addSelectMenu=function(){var t=this,i=this.services.localize("Slicer_SelectMenu_Tooltip");this.selectMenuContainer=InJs.DomFactory.div().addClass("slicer-header-selectmenu").toggleClass(s.SlicerUtil.Selectors.EnableHover.class,s.SlicerUtil.enableHover()).appendTo(this.title);var e={onChange:function(e){t.settings.onChange&&t.settings.onChange(e)},onFocus:function(e){s.SlicerUtil.showTooltip(t.services.tooltipService,e,i)},onBlur:function(){s.SlicerUtil.hideTooltip(t.services.tooltipService)},container:this.selectMenuContainer,options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,className:"slicer-select-menu",disabled:2===this.settings.visibilityState,title:i};this.selectMenu=new r(e),u.addHoverInOut(this.settings.hoverContainer,function(){0!==t.services.getViewMode()&&(t.selectMenuContainer.css("visibility","visible"),t.selectMenuContainer.css("display","flex"))},function(){t.settings.areControlButtonsAlwaysVisible||(_.isEmpty(t.data.text)?t.selectMenuContainer.css("visibility","hidden"):t.selectMenuContainer.css("display","none"))})},u.prototype.addTitle=function(){var t=this;this.title=InJs.DomFactory.div().addClass("slicer-header-title").appendTo(this.header);var i=this.services.localize(s.SlicerUtil.DisplayNameKeys.Clear);this.clearButton=InJs.DomFactory.span().addClass("slicer-header-clear").toggleClass(s.SlicerUtil.Selectors.EnableHover.class,s.SlicerUtil.enableHover()).attr("aria-label",i).attr("role","button").attr("tabindex","0").on("mouseenter focus",function(e){s.SlicerUtil.showTooltip(t.services.tooltipService,e,i)}).on("mouseleave blur",function(){s.SlicerUtil.hideTooltip(t.services.tooltipService)}).on("keydown",function(e){32!==e.keyCode&&13!==e.keyCode||t.settings.onClear&&(t.settings.onClear(),e.stopPropagation())}).appendTo(this.title),this.clearButton.click(function(){t.settings.onClear&&t.settings.onClear()}),u.addHoverInOut(this.settings.hoverContainer,function(){t.settings.strictSingleSelect||(t.clearButton.css("visibility","visible"),t.clearButton.css("display","block"))},function(){t.settings.areControlButtonsAlwaysVisible||(_.isEmpty(t.data.text)?t.clearButton.css("visibility","hidden"):t.clearButton.css("display","none"))}),this.textElement=$("<h3></h3>").addClass("slicer-header-text").appendTo(this.title)},u.prototype.updateTitle=function(){var e,t,i,r;this.data.show?(e=o.fromPoint(this.data.textSize),t=!1,this.settings.areControlButtonsAlwaysVisible&&(this.settings.strictSingleSelect||(this.clearButton.css("visibility","visible"),this.clearButton.css("display","block")),0!==this.services.getViewMode()&&(this.selectMenuContainer.css("visibility","visible"),this.selectMenuContainer.css("display","flex"))),this.data.searchEnabled&&(i=u.DefaultData(this.style,this.settings.text),t=(this.featureSwitches.outlineDropdownToCheckboxes?this.data.outlineStyle===i.outlineStyle:this.data.outline===i.outline)&&this.data.outlineWeight===i.outlineWeight&&this.data.outlineColor===i.outlineColor),this.title.show(),i=this.featureSwitches.outlineDropdownToCheckboxes?this.data.outlineStyle:this.data.outline,this.title.css({"border-style":t?"none":this.data.borderStyle,"border-color":this.data.outlineColor,"border-width":s.VisualBorderUtil.getBorderCss(i,this.data.outlineWeight),"background-color":_.isEmpty(this.data.background)?"":this.data.background,"font-size":e}),this.clearButton.css({"font-size":e}),this.textElement.css({"font-size":o.fromPoint(this.data.textSize),"font-family":this.data.fontFamily,color:this.data.fontColor,"font-weight":this.data.labelBold?c.boldValue:c.normalValue,"font-style":this.data.labelItalic?c.italicValue:c.normalValue,"text-decoration":this.data.labelUnderline?c.underlineValue:c.noneValue}),this.updateTitleText(),r=this.data,this.clearButton.css("color",this.data.iconColor).hover(function(){$(this).css("color",r.iconHoverColor)},function(){$(this).css("color",r.iconColor)})):this.title.hide()},u.prototype.updateTitleText=function(){var e,t=this.data.text;this.data.showRestatement&&this.settings.restatement&&(e=this.services.localize("NamePattern_Colon"),t=a.format(e,t,this.settings.restatement)),this.textElement.text(t).attr("title",t).attr("aria-label",t)},u.prototype.updateSelectMenu=function(){this.selectMenu&&0===this.services.getViewMode()?this.selectMenuContainer.hide():this.selectMenu&&(this.selectMenuContainer.show(),this.selectMenu.update({options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,disabled:2===this.settings.visibilityState}))},u.prototype.getSelectMenuOptions=function(){for(var e=[],t=0,i=this.settings.slicerModeOptions;t<i.length;t++){var r=i[t],n=r.displayName({get:this.services.localize});e.push({text:n,value:r.value})}return e},u.prototype.addWarnings=function(e){s.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},u.addHoverInOut=function(e,t,i){s.SlicerUtil.enableHover()&&e.hover(t,i)},e.SlicerHeader=u}(p.visuals||(p.visuals={}))}(powerbi=powerbi||{}),function(s){var h,S,e,l,m,c,d,u,p,g,f;h=s.visuals||(s.visuals={}),l=jsCommon.BrowserUtils,m=s.visuals.builder,c=jsCommon.Color,d=jsCommon.EnumExtensions,u=jsCommon.PixelConverter,p=s.data.SQExprBuilder,g=s.data.SemanticFilter,f=jsCommon.CssConstants,function(r){var n,e,o;e=n=r.Selectors||(r.Selectors={}),t=jsCommon.CssConstants.createClassAndSelector,e.ClearSearchTextButton=t("clearSearchTextButton"),e.HeaderContainer=t("headerContainer"),e.Header=t("slicerHeader"),e.Hidden=t("hidden"),e.Icon=t("icon"),e.TitleHeader=t("titleHeader"),e.HeaderText=t("headerText"),e.Body=t("slicerBody"),e.Label=t("slicerLabel"),e.LabelText=t("slicerText"),e.LabelImage=t("slicerImage"),e.CountText=t("slicerCountText"),e.SearchHeader=t("searchHeader"),e.SearchIconClass=t("searchIcon"),e.SearchInput=t("searchInput"),e.SearchHeaderCollapsed=t("collapsed"),e.SearchHeaderShow=t("show"),e.MultiSelectEnabled=t("isMultiSelectEnabled"),e.EnableHover=t("enable-hover"),e.DisableScrollHover=t("disableScrollHover"),(t=o=r.DisplayNameKeys||(r.DisplayNameKeys={})).SelectAll="SelectAll",t.Search="SearchBox_Text",(r.SettingsHelper||(r.SettingsHelper={})).areSettingsDefined=function(e){return null!=e&&null!=e.slicerSettings},r.readMetadataColumns=function(e){if(!_.isEmpty(e)){for(var t=[],i=0,r=e;i<r.length;i++){var n=r[i];if(n.roles&&n.roles[h.slicerRoles.value]&&void 0!==n.index)if(n.rolesIndex&&n.rolesIndex[h.slicerRoles.value])for(var o=0,a=n.rolesIndex[h.slicerRoles.value];o<a.length;o++)t[a[o]]=n;else t.push(n)}return t}},r.buildDataPointInfo=function(e,t){var i={dataMap:{},metadata:[t[e.level]]},r=[],n=[],o=e;for(r.push(e),n.push(e.levelIndex);o.parent;)o=o.parent,r.unshift(o),n.unshift(o.levelIndex);for(var a=0,s=r;a<s.length;a++){var l=s[a],c=t[l.level];i.dataMap[c]=[l.scopeIdentity]}return{selector:i,path:n}},r.buildContainsFilter=function(e,t){var i;if(!_.isEmpty(t)&&!_.isEmpty(e)){for(var r=p.text(t),n=void 0,o=0,a=e;o<a.length;o++)var s=a[o],s=p.contains(s,r),n=n?p.or(n,s):s;i=g.fromSQExpr(n)}return i},(r.DefaultValueHandler||(r.DefaultValueHandler={})).getIdentityFields=function(e){if(e){e=e.categorical;if(e&&!_.isEmpty(e.categories))return e.categories[0].identityFields}},r.tryRemoveValueFromRetainedList=function(e,t,i){if(e&&!_.isEmpty(t))for(var r=0,n=t.length;r<n;r++){var o=t[r];if(s.DataViewScopeIdentity.equals(e,o.identity,i))return t.splice(r,1)[0]}},r.getSlicerDataPointCheckedState=function e(t,i){i=t.parent?e(t.parent,i):i;return t.selected?!i:i},r.clearSlicerFilter=function(e,t){var i={remove:[{objectName:"general",selector:null,properties:{filter:!0}}],replace:[{objectName:"data",selector:null,properties:((i={})[h.slicerProps.data.mode.propertyName]=t,i)}]};e.persistProperties(i),e.onSelect({type:0,visualObjects:[]}),i=e.getLocalizedString("Slicer_ClearSelectionsCleared"),e.alertWithDebounce("announce-clear-selection",i)},r.addWarningsToSlicerVisual=function(e,t){var i,r=(e=e.complete())?e.visualObjectWarnings:void 0;for(i in r)t.addForVisualObject.apply(t,__spreadArray([i],r[i]||[]))},r.getDataPointKey=function(e){return e.identity.getKey()},r.clearFilters=function(e,t){e.handleClearSelection(),e.persistSelectionFilter(h.slicerProps.general.filter,null,!0!==t)},r.clearSearchFilter=function(e){e.setSearchMode(!0),e.persistSelfFilter(h.slicerProps.general.selfFilter,null)},r.isDataViewColumnMapped=function(e){return _.some(e.columns,function(e){return 1===(null===(e=e.parameter)||void 0===e?void 0:e.kind)})},r.doDataViewColumnSupportMultipleValues=function(e){return _.some(e.columns,function(e){return null===(e=e.parameter)||void 0===e?void 0:e.supportsMultipleValues})},r.doDataViewColumnSupportSelectAll=function(e){return _.some(e.columns,function(e){return null===(e=e.parameter)||void 0===e?void 0:e.supportsSelectAll})},r.updateDisableState=function(e,t){e.attr("disabled",!!t.disabled||void 0)},r.showTooltip=function(e,t,i){var r;e&&(r=t.target.getBoundingClientRect(),e.show({coordinates:[r.x,r.y],dataItems:[{displayName:i,value:""}],suppressAnnouncements:"focus"===t.type,isTouchEvent:!1,identities:[]}))},r.hideTooltip=function(e){e&&e.hide({isTouchEvent:!1,immediately:!0})};var t=(i.prototype.onPopupHideEvent=function(e,t,i,r){var n=this;return this.popup=i,this.popupHideEventHandler=e,this.boundBox=t,this.originalOffset=$(t).offset(),this.scrollEventHandler=function(e){return n.scrollEventReceived(e)},this.focusEventHandler=function(e){return n.focusInEventReceived(e,r)},this.popupHideEvent=function(e){return n.popupHideEventReceived(e)},this.mouseEventHandler=function(e){return n.onMouseDown(e,r)},this.bindPopupHideHandlers(),$.proxy(this.unbindPopupHideHandlers,this)},i.prototype.popupHideEventReceived=function(e){this.popupHideEventHandler(e.type,e.target)},i.prototype.scrollEventReceived=function(e){var t;this.boundBox&&((t=$(this.boundBox).offset()).left===this.originalOffset.left&&t.top===this.originalOffset.top||(this.originalOffset=t,this.popupHideEventHandler(e.type,e.target)))},i.prototype.focusInEventReceived=function(e,t){!this.popup||this.popup.contains(e.target)||t&&this.isContextMenuElement(e.target)||this.popupHideEventHandler(e.type,e.target)},i.prototype.onMouseDown=function(e,t){2===e.button&&t&&(!this.popup||this.popup.contains(e.target)||this.isContextMenuElement(e.target))||this.popupHideEventHandler(e.type,e.target)},i.prototype.bindPopupHideHandlers=function(){document.addEventListener("mousedown",this.mouseEventHandler,!0),document.addEventListener("pointerdown",this.mouseEventHandler,!0),document.addEventListener("touchstart",this.popupHideEvent,!0),$(window).on("resize",$.proxy(this.popupHideEventReceived,this)),$(this.boundBox).on("destroy",$.proxy(this.popupHideEventReceived,this)),document.addEventListener("scroll",this.scrollEventHandler,!0),document.addEventListener("focusin",this.focusEventHandler,!0)},i.prototype.unbindPopupHideHandlers=function(){document.removeEventListener("mousedown",this.mouseEventHandler,!0),document.removeEventListener("pointerdown",this.mouseEventHandler,!0),document.removeEventListener("touchstart",this.popupHideEvent,!0),$(window).off("resize",this.popupHideEventReceived),document.removeEventListener("scroll",this.scrollEventHandler,!0),$(this.boundBox).off("destroy",this.popupHideEventReceived),document.removeEventListener("focusin",this.focusEventHandler,!0)},i.prototype.isContextMenuElement=function(e){return 0<$(e).parents("drop-down-list:first").length},i);function i(){}r.EventsHelper=t;a.prototype.addSearch=function(e,t){t=t.append("div").classed(n.SearchHeader.class,!0).classed(n.SearchHeaderCollapsed.class,!0);return t.append("span").classed("powervisuals-glyph search",!0).classed(n.Icon.class,!0).classed(n.SearchIconClass.class,!0).attr("title",e.getLocalizedString(o.Search)),t.append("input").attr("type","text").attr("aria-label",e.getLocalizedString(o.Search)).attr("placeholder",e.getLocalizedString(o.Search)).attr("spellcheck",!1).classed(n.SearchInput.class,!0).attr("drag-resize-disabled","true"),t},a.prototype.addClearSearchButton=function(e,t){var i=t.append("span").classed("powervisuals-glyph x",!0).classed(n.Icon.class,!0).classed(n.ClearSearchTextButton.class,!0);return t.select(r.Selectors.SearchInput.selector).attr("placeholder",e.getLocalizedString(o.Search)),i},a.prototype.configureSearchBoxIcon=function(e,t){t=_.isEmpty(t);e.select(r.Selectors.SearchIconClass.selector).classed(r.Selectors.Hidden.class,!t),e.select(r.Selectors.ClearSearchTextButton.selector).classed(r.Selectors.Hidden.class,t)},a.prototype.getRowHeight=function(e,t,i){i=i.outlineDropdownToCheckboxes?e.slicerText.outlineStyle:e.slicerText.outline;return s.TextMeasurementService.estimateSvgTextHeight(this.getTextProperties(e.slicerText.textSize,e.slicerText.fontFamily,t))+this.getRowsOutlineWidth(i,e.general.outlineWeight)},a.prototype.setSlicerTextStyle=function(e,t,i){i=i.outlineDropdownToCheckboxes?t.slicerText.outlineStyle:t.slicerText.outline;e.styles({color:t.slicerText.color,"background-color":t.slicerText.background,"border-style":"solid","border-color":t.general.outlineColor,"border-width":h.VisualBorderUtil.getBorderCss(i,t.general.outlineWeight),"font-size":u.fromPoint(t.slicerText.textSize),"font-family":t.slicerText.fontFamily,"line-height":Math.floor(1.79*t.slicerText.textSize)+"px","font-weight":t.slicerText.labelBold?f.boldValue:f.normalValue,"font-style":t.slicerText.labelItalic?f.italicValue:f.normalValue,"text-decoration":t.slicerText.labelUnderline?f.underlineValue:f.noneValue});var r=this.calculateSlicerTextHighlightColor(t.slicerText.color);e.on("mouseover",function(e){d3.select(this).styles({color:r})}),e.on("mouseout",function(e){d3.select(this).styles({color:t.slicerText.color})})},a.prototype.getRowsOutlineWidth=function(e,t){if("number"==typeof e){var i=d.hasFlag(e,1),r=d.hasFlag(e,4);return i&&r?2*t:i||r?t:0}switch(e){case h.outline.none:case h.outline.leftRight:return 0;case h.outline.bottomOnly:case h.outline.topOnly:return t;case h.outline.topBottom:case h.outline.frame:return 2*t;default:return 0}},a.prototype.calculateSlicerTextHighlightColor=function(e){e=c.parseColorString(e);return e&&255===e.R&&255===e.G&&255===e.B?"#C8C8C8":c.calculateHighlightColor(e,.8,.2)},a.prototype.getTextProperties=function(e,t,i){return i.fontSize=u.fromPoint(e),i.fontFamily=t,i},t=a;function a(){}r.DOMHelper=t,r.enableHover=function(){return!l.isIOSWebView()&&!l.isAndroidWebView()}}(h.SlicerUtil||(h.SlicerUtil={})),S=h.SlicerUtil||(h.SlicerUtil={}),(e=S.ObjectEnumerator||(S.ObjectEnumerator={})).enumerateObjectInstances=function(e,t,i,r,n){if(t)switch(e.objectName){case"items":return function(e,t,i){var r=t,n=S.SettingsHelper.areSettingsDefined(e)&&e.slicerSettings.slicerText,t=(n&&e.slicerSettings.slicerText.color?e.slicerSettings:r).slicerText.color,n=(n&&e.slicerSettings.slicerText.background?e.slicerSettings:r).slicerText.background,n={fontColor:t,background:n,textSize:r.slicerText.textSize,fontFamily:r.slicerText.fontFamily};i.outlineDropdownToCheckboxes?n.outlineStyle=r.slicerText.outlineStyle:n.outline=r.slicerText.outline;i&&i.enableBIU&&(n.bold=r.slicerText.labelBold,n.italic=r.slicerText.labelItalic,n.underline=r.slicerText.labelUnderline);!_.isEmpty(e.queryNameByLevel)&&1<e.queryNameByLevel.length&&(n.steppedLayoutIndentation=r.expandCollapse.indentation,n.expandCollapseToggleType=r.expandCollapse.toggleType);return[{selector:null,objectName:"items",properties:n}]}(t,i,n);case"selection":return function(e,t,i){var r=S.SettingsHelper.areSettingsDefined(e)&&e.slicerSettings.selection,n=(r&&e.slicerSettings.selection.selectAllCheckboxEnabled?e.slicerSettings:t).selection.selectAllCheckboxEnabled,o=(r&&void 0!==e.slicerSettings.selection.singleSelect?e.slicerSettings:t).selection.singleSelect,t=(r&&void 0!==e.slicerSettings.selection.strictSingleSelect?e.slicerSettings:t).selection.strictSingleSelect;t||!S.isDataViewColumnMapped(i.metadata)||S.doDataViewColumnSupportMultipleValues(i.metadata)||(t=!0);i={selector:null,objectName:"selection",properties:{strictSingleSelect:t}};t||(i.properties.singleSelect=o,i.properties.selectAllCheckboxEnabled=n);return[i]}(t,i,r)}},e.getValuesCard=function(t,e,i,r,n){if(e){var o=S.SettingsHelper.areSettingsDefined(e)&&e.slicerSettings.slicerText,a=(o&&e.slicerSettings.slicerText.color?e.slicerSettings:i).slicerText.color,s=(o&&e.slicerSettings.slicerText.background?e.slicerSettings:i).slicerText.background,l=h.slicerProps.items,o=new m.FormattingCardBuilder(new m.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[l.fontFamily,l.textSize,l.bold,l.italic,l.underline,l.fontColor,l.padding,l.outline,l.outlineStyle,h.slicerProps.general.outlineColor,h.slicerProps.general.outlineWeight,l.background],function(e){return t.getLocalizedString(e)}),e=(new h.builder.FontControlBuilder).withFontFamily({descriptor:l.fontFamily,value:i.slicerText.fontFamily}).withFontSizeProperties({descriptor:l.textSize,value:i.slicerText.textSize});n&&n.enableBIU&&e.withBold({descriptor:l.bold,value:i.slicerText.labelBold}).withItalic({descriptor:l.italic,value:i.slicerText.labelItalic}).withUnderline({descriptor:l.underline,value:i.slicerText.labelUnderline});var c=e.build();return o.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("fontselector","Font",c).addSimpleSlice("color",function(){return new m.ColorPickerBuilder({descriptor:l.fontColor,value:{value:a}}).build()}),n&&n.slicerAccessibility&&e.addSimpleSlice("padding",function(){return new m.NumUpDownBuilder({descriptor:l.padding,value:i.items.padding,options:{minValue:{type:0,value:0},maxValue:{type:1,value:999},unitSymbol:"Numeric_Pixel"}}).build()})}).addGroup("border",function(e){e.withDisplayName("Visual_Border"),n.outlineDropdownToCheckboxes?e.addSimpleSlice("border position",new m.FlagSelectionBuilder({descriptor:l.outlineStyle,value:i.slicerText.outlineStyle}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("border position",new m.DropdownBuilder({descriptor:l.outline,value:i.slicerText.outline}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("color",function(){var e={value:i.general.outlineColor};return new m.ColorPickerBuilder({descriptor:__assign(__assign({},h.slicerProps.general.outlineColor),{instanceKind:r?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")}).addSimpleSlice("lineWidth",new m.SliderBuilder({descriptor:h.slicerProps.general.outlineWeight,value:i.general.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}},localize:function(e){return t.getLocalizedString(e)}}).build(),function(e){return e.withCustomDisplayName("Visual_Line_Width")})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){return new m.ColorPickerBuilder({descriptor:l.background,value:{value:s}}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")})}),o.build()}},e.getAdditionalCards=function(t,e,i,r){if(e){var n=h.slicerProps.items,o=new m.FormattingCardBuilder(new m.FormattingCardUidBuilder("hierarchy"),"Hierarchy",[n.steppedLayoutIndentation,n.expandCollapseToggleType],function(e){return t.getLocalizedString(e)});return!_.isEmpty(e.queryNameByLevel)&&1<e.queryNameByLevel.length?(o.addGroup("levels",function(e){e.withDisplayName("Slicer_Hierarchy_Levels").addSimpleSlice("steppedIndentation",function(){return new m.SliderBuilder({descriptor:n.steppedLayoutIndentation,value:i.expandCollapse.indentation,options:{minValue:{type:0,value:0},maxValue:{type:1,value:40}},localize:function(e){return t.getLocalizedString(e)}}).build()})}).addGroup("expandCollapseButtons",function(e){e.withDisplayName("Slicer_ExpandCollapse").addSimpleSlice("expand/collapseIcon",function(){return new m.DropdownBuilder({descriptor:n.expandCollapseToggleType,value:i.expandCollapse.toggleType}).build()})}),[o.build()]):void 0}},e.getSlicerSettingsFormattingOptions=function(e){var t=e.cardUidBuilder,i=e.currentSlicerSettings,r=e.data,n=e.dataView,o=e.hostServices,a=e.orientation;if(r){var s=[],l=[],e=r&&r.slicerSettings,r=new m.FormattingGroupBuilder(new m.FormattingGroupUidBuilder(t,"options"),function(e){return o.getLocalizedString(e)});l.push(h.slicerProps.general.selfFilterEnabled),r.withDisplayName("Desktop_FileMenu_Options"),null!=a&&r.addSimpleSlice("orientation",new m.DropdownBuilder({descriptor:h.slicerProps.general.orientation,value:a}).build());r=r.build();0<r.slices.length&&s.push(r);var e=e&&e.selection,i=i.selection,c=(e&&e.selectAllCheckboxEnabled?e:i).selectAllCheckboxEnabled,d=(e&&void 0!==e.singleSelect?e:i).singleSelect,u=(e&&void 0!==e.strictSingleSelect?e:i).strictSingleSelect;u||!S.isDataViewColumnMapped(n.metadata)||S.doDataViewColumnSupportMultipleValues(n.metadata)||(u=!0);var p=h.slicerProps.selection,t=new m.FormattingGroupBuilder(new m.FormattingGroupUidBuilder(t,"selection"),function(e){return o.getLocalizedString(e)});return l.push(h.slicerProps.general.selfFilterEnabled,h.slicerProps.general.orientation,p.strictSingleSelect,p.singleSelect,p.selectAllCheckboxEnabled),t.withDisplayName("ExpandCollapseNode").addSimpleSlice("strictSingleSelect",function(){return new m.ToggleSwitchBuilder({descriptor:p.strictSingleSelect,value:u}).build()}),u||t.addSimpleSlice("singleSelect",function(){return new m.ToggleSwitchBuilder({descriptor:p.singleSelect,value:d}).build()}).addSimpleSlice("selectAllCheckboxEnabled",function(){return new m.ToggleSwitchBuilder({descriptor:p.selectAllCheckboxEnabled,value:c}).build()}),s.push(t.build()),{groups:s,revertToDefaultDescriptors:l}}}}(powerbi=powerbi||{}),function(e){var t;t=e.visuals||(e.visuals={}),t=(e=t.SlicerUtil||(t.SlicerUtil={})).Selectors||(e.Selectors={}),e=jsCommon.CssConstants.createClassAndSelector,t.Clear=e("clear")}(powerbi=powerbi||{}),function(e){((e=(e=e.visuals||(e.visuals={})).SlicerUtil||(e.SlicerUtil={})).DisplayNameKeys||(e.DisplayNameKeys={})).Clear="Slicer_Clear"}(powerbi=powerbi||{}),function(e){var o,i,a;function s(){}o=e.visuals||(e.visuals={}),i=e.visuals.slicerMode,a=e.visuals.SlicerResponsiveBreakpoints,s.prototype.applySlicerChanges=function(e,t,i){return t=this.shouldApplyResponsiveChanges(i,t.mode,t.orientation)?this.applyResponsiveSlicerChanges(e,t):t},s.prototype.applySlicerHeaderChanges=function(e,t,i,r,n){return t=t.show&&this.shouldApplyResponsiveChanges(i,r.mode,r.orientation)?this.applyResponsiveSlicerHeaderChanges(e,t,r,n):t},s.prototype.enumerateObjectInstances=function(e,t,i,r,n){this.doesSlicerModeSupportsResponsive(r,n)&&"general"===e.objectName&&this.enumerateGeneral(i,t)},s.prototype.enumerateGeneral=function(e,t){t[0].selector;e={selector:null,properties:{responsive:o.ViewModelAdapterUtils.getResponsiveVisualProperties(e,o.slicerProps).responsive},objectName:"general"};_.merge(t[0],e)},s.prototype.getResponsiveSlice=function(e,t,i,r){if(this.doesSlicerModeSupportsResponsive(t,i)){i=o.slicerProps.general,e=o.ViewModelAdapterUtils.getResponsiveVisualProperties(e,o.slicerProps);return{item:new o.builder.SimpleFormattingSliceBuilder({uidBuilder:new o.builder.FormattingSliceUidBuilder(new o.builder.FormattingGroupUidBuilder(new o.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new o.builder.ToggleSwitchBuilder({descriptor:i.responsive,value:e.responsive}).build(),localize:r}).build(),revertToDefaultDescriptors:[i.responsive]}}},s.prototype.shouldApplyResponsiveChanges=function(e,t,i){return this.doesSlicerModeSupportsResponsive(t,i)&&o.ViewModelAdapterUtils.shouldApplyResponsiveChanges(e,o.slicerProps)},s.prototype.doesSlicerModeSupportsResponsive=function(e,t){return s.isRangeSlicerMode(e)||s.isHorizontalSlicer(e,t)},s.prototype.applyResponsiveSlicerChanges=function(e,t){t=o.ViewModelAdapterUtils.cloneData(t);return this.applyIconResponsiveChanges(e,t),this.applyResponsiveSlicerHorizontalChanges(t),t},s.prototype.applyResponsiveSlicerHeaderChanges=function(e,t,i,r){var n=o.ViewModelAdapterUtils.cloneData(t);return this.applyHeaderChanges(e,i,n,r),this.updateResponsiveHeaderWarnings(n,t),n},s.prototype.applyIconResponsiveChanges=function(t,e){var i;s.isRangeSlicerMode(e.mode)?i=a.rangeSlicer.iconBreakpoints:s.isHorizontalSlicer(e.mode,e.orientation)?i=a.horizontalSlicer.iconBreakpoints:(e.mode,e.orientation),_.some(i,function(e){return t.height<=e.height&&t.width<=e.width})&&(e.showIcon=!0)},s.prototype.applyResponsiveSlicerHorizontalChanges=function(e){s.isHorizontalSlicer(e.mode,e.orientation)&&(e.showTabularSlicer=!0)},s.prototype.applyHeaderChanges=function(e,t,i,r){var n;s.isRangeSlicerMode(t.mode)?(n=a.rangeSlicer,i.show=r?e.height>=n.hideHeaderHeightSlider:e.height>=n.hideHeaderHeightNoSlider):s.isHorizontalSlicer(t.mode,t.orientation)?(n=a.horizontalSlicer,i.show=e.height>=n.hideHeaderHeight):(t.mode,t.orientation);e=o.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(e,a.slicerHeader.fontSize);i.textSize=Math.min(i.textSize,e)},s.prototype.updateResponsiveHeaderWarnings=function(e,t){var i;e.show!==t.show?i=new o.SlicerHeaderNotRenderedWarning:e.textSize!==t.textSize&&(i=new o.SlicerHeaderFontSizeWarning),i&&e.warnings.addForVisualObject("header",{selector:null,warnings:[i]})},s.isRangeSlicerMode=function(e){return i.isRangeSlicerMode(e)},s.isHorizontalSlicer=function(e,t){return e===i.basic&&1===t},o.SlicerViewModelAdapter=s}(powerbi=powerbi||{}),function(i){var r;function t(){}r=i.visuals||(i.visuals={}),t.prototype.applyChanges=function(e,t,i){return t=r.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,r.slicerProps)?this.applyResponsiveRangeSlicerChanges(e,t):t},t.prototype.applyResponsiveRangeSlicerChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyRangeSlicerDataChanges(t),this.applySliderChanges(t),t},t.prototype.applySliderChanges=function(e){e.sliderSettings=i.Prototype.inherit(e.sliderSettings),e.sliderSettings.drawRoundSliderHandles=!0,e.sliderSettings.minSliderVisibilityHeight=t.MinSliderVisibilityHeight,e.sliderSettings.minSliderVisibilityWidth=t.MinSliderVisibilityWidth},t.prototype.applyRangeSlicerDataChanges=function(e){e.wrapRangeBoxes=!0},t.MinSliderVisibilityHeight=35,t.MinSliderVisibilityWidth=0,r.RangeSlicerViewModelAdapter=t}(powerbi=powerbi||{}),function(i){var n;function e(){}n=i.visuals||(i.visuals={}),e.prototype.applyChanges=function(e,t,i){var r=t;return n.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,n.slicerProps)&&(r=this.applyResponsiveSlicerChanges(e,r),this.updateWarnings(r,t)),r},e.prototype.applyResponsiveSlicerChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyFontSizeChanges(e,t),t},e.prototype.applyFontSizeChanges=function(e,t){e=n.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(e,n.SlicerResponsiveBreakpoints.horizontalSlicer.fontSize);t.slicerSettings.slicerText.textSize>e&&(t.slicerSettings=i.Prototype.inherit(t.slicerSettings),t.slicerSettings.slicerText=i.Prototype.inherit(t.slicerSettings.slicerText),t.slicerSettings.slicerText.textSize=e)},e.prototype.updateWarnings=function(e,t){e.slicerSettings.slicerText.textSize!==t.slicerSettings.slicerText.textSize&&(t=new n.HorizontalSlicerFontSizeWarning,e.warnings.addForVisualObject("items",{selector:null,warnings:[t]}))},n.HorizontalSlicerViewModelAdapter=e}(powerbi=powerbi||{}),function(r){var o,n,e,a,t;function s(){}o=r.visuals||(r.visuals={}),a=jsCommon.Utility,s.prototype.renderCore=function(e){e.classed(n.Tabular.class,!0)},s.prototype.bindData=function(e,t,i){return this.renderColumns(e,i).selectAll(o.HorizontalSlicer.Selectors.IndividualItemContainer.selector).data(function(e){return e},function(e){return o.SlicerUtil.getDataPointKey(e)})},s.prototype.renderColumns=function(e,t){var i=this.numberOfRows,r=_.chunk(e,i),e=t.selectAll(n.ColumnItemContainer.selector).style("height",null).data(r);e.exit().remove();e=e.enter().append("div").classed(n.ColumnItemContainer.class,!0).merge(e);return this.scaleLastColumnIfNeeded(i,r,t),e},s.prototype.scaleLastColumnIfNeeded=function(e,t,i){t&&_.last(t)&&((t=_.last(t).length)<e&&(i=i.select(n.ColumnItemContainer.selector+":last-child"),e=r.Double.roundToPrecision(100*t/e,.01),i.style("height",e+"%")))},s.prototype.findNextElement=function(e,t){if($(e).hasClass(o.HorizontalSlicer.Selectors.ItemsContainer.class))return t?e.firstElementChild.firstElementChild:e.lastElementChild.lastElementChild;if(t){var i,r=e.nextElementSibling;if(!r)if((i=e.parentElement).nextElementSibling)return i.nextElementSibling.firstElementChild;return r}return!(r=e.previousElementSibling)&&(i=e.parentElement).previousElementSibling?i.previousElementSibling.lastElementChild:r},s.prototype.getScrollSize=function(e){return this.numberOfRows},s.prototype.getLastStartIndex=function(e,t){if(t<=e)return 0;var i=0,r=this.numberOfRows,n=t%r;return 0<n&&(i=r-n),Math.max(t-e+i,0)},s.prototype.calculateTotalItemDimensions=function(e,t){return e=Math.max(e,s.MinItemWidth),t=Math.max(t,s.MinItemHeight),{width:e+=2*s.TabularMargin,height:t+=2*s.TabularMargin}},s.prototype.calculateNumberOfItemsToDisplay=function(e,t,i,r){var n=e.find(o.SlicerUtil.Selectors.Body.selector),e=n.width()-2*s.NavigationArrowWidth,n=n.height();return this.calculateTableDimensions({height:n,width:e},{height:i,width:t},r)},s.prototype.calculateTableDimensions=function(e,t,i){var r=t.width,n=t.height,t=e.width,e=e.height;if(0===r)return 0;r=Math.floor(t/r);this.numberOfRows=0===n?1:Math.floor(e/n),this.numberOfRows=a.clampValue(this.numberOfRows,1,i);n=Math.ceil(Math.sqrt(i));n<=r&&this.numberOfRows>=n?this.numberOfRows=r=n:this.numberOfRows>=i&&1<r&&(this.numberOfRows=Math.ceil(this.numberOfRows/r));r=this.numberOfRows*r;return a.clampValue(r,this.numberOfRows,i)},s.prototype.getNavigationArrowsClass=function(e,t){t?e.classed(n.TabularNavigationArrow.class,!0).classed(o.HorizontalSlicer.Selectors.LeftNavigationArrow.class,!0).classed(n.PbiVisualsGlyph.class,!0).classed(n.TabularLeftNavigationArrow.class,!0):e.classed(n.TabularNavigationArrow.class,!0).classed(o.HorizontalSlicer.Selectors.RightNavigationArrow.class,!0).classed(n.PbiVisualsGlyph.class,!0).classed(n.TabularRightNavigationArrow.class,!0)},s.prototype.getDataPointRightMargin=function(e,t){return"0px"},s.MinItemWidth=40,s.MinItemHeight=40,s.TabularMargin=2,s.NavigationArrowWidth=19,t=s,o.TabularSlicerLayout=t,e=n=n||{},t=jsCommon.CssConstants.createClassAndSelector,e.Tabular=t("tabular"),e.ColumnItemContainer=t("columnItemContainer"),e.PbiVisualsGlyph=t("powervisuals-glyph"),e.TabularNavigationArrow=t("tabularNavigationArrow"),e.TabularLeftNavigationArrow=t("left-nav-arrow"),e.TabularRightNavigationArrow=t("right-nav-arrow")}(powerbi=powerbi||{}),function(p){!function(m){var t=jsCommon.BrowserUtils,c=jsCommon.PixelConverter,r=p.data.SQExpr,n=jsCommon.FocusNavigationUtility,e=(d.prototype.hasSlider=function(){return!1},d.prototype.supportsOrientation=function(){return!this.dataView||!this.data||_.isEmpty(this.data.queryNameByLevel)||1===this.data.queryNameByLevel.length},d.prototype.enumerateObjectInstances=function(e){return m.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(e,this.data,this.settings,this.dataView,this.featureSwitches)},d.prototype.getValuesCard=function(){return m.SlicerUtil.ObjectEnumerator.getValuesCard(this.hostServices,this.data,this.settings,this.expressionBasedFormatting,this.featureSwitches)},d.prototype.getSlicerSettingsCardOptions=function(e,t){return m.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:this.settings,data:this.data,dataView:this.dataView,hostServices:this.hostServices,orientation:t})},d.prototype.getAdditionalCards=function(){return m.SlicerUtil.ObjectEnumerator.getAdditionalCards(this.hostServices,this.data,this.settings,this.dataView)},d.prototype.onModeChange=function(e){m.SlicerUtil.clearSlicerFilter(this.hostServices,e)},d.prototype.getRestatement=function(){return this.data&&this.data.restatement},d.prototype.onClear=function(e){m.SlicerUtil.clearSearchFilter(this.selectionHandler),m.SlicerUtil.clearFilters(this.selectionHandler,e),this.searchComponent&&(this.searchComponent.input.node().value="")},d.prototype.init=function(e,t){var i=this;this.element=t,this.currentViewport=e.visualInitOptions.viewport;var r,n=this.hostServices=e.visualInitOptions.host;this.style=e.visualInitOptions.style,this.settings=m.DataConversion.DefaultSlicerProperties(this.style),this.behavior&&(r=new m.SlicerSelectionHandler(n,this.behavior));t=document.createElement("div");t.className=u.Container.class;n=this.container=d3.select(t);this.searchComponent.create(n),this.verticalSlicerStrategy.hasClearSearchButton()&&this.searchComponent.addClearButton(),this.createBodyElement();n={rowHeight:void 0,enter:function(e){i.createDataPoints(e)},update:function(e){i.updateDataPoints(e,r)},loadMoreData:function(){return e.loadMoreData()},scrollEnabled:!0,viewport:this.currentViewport,baseContainer:this.body,isReadMode:function(){return 1!==i.hostServices.getViewMode()},scrollToFrame:e.enableMultiElementRows?function(e){return i.scrollToFrameForMultiElementRow(e)}:void 0};return this.listView=m.ListViewFactory.createListView(n),this.element.get(0).appendChild(t),this.selectionHandler=r},d.prototype.onDestroy=function(){this.listView&&this.listView.destroy()},d.prototype.render=function(e){this.renderVerticalSlicer(this.converter(e.dataView,e.isSlicer),e)},d.prototype.renderVerticalSlicer=function(e,t,i){this.focusCallback&&(n.contains(this.container.node(),document.activeElement)||(this.focusCallback=void 0,this.listView&&this.listView.resetCallBacks())),this.currentViewport=t.viewport,this.hasSearchableData=t.hasSearchableData;var r=t.dataView;if(this.searchComponent.update(this.settings,this.data&&this.data.searchKey,this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData),this.verticalSlicerStrategy.hasClearSearchButton()),!r||!this.data||_.isEmpty(this.data.slicerDataPoints))return this.listView&&this.listView.empty(),void(i&&i());this.container.node().querySelector("input.searchInput")===document.activeElement&&t.isSearchMode&&this.announceSearchResults(e.slicerDataPoints.length),this.expandable=1<this.data.queryNameByLevel.length,this.setBodyRole(),this.setBodyAriaLabel(),this.updateSelectionStyle(),this.listView.viewport(this.currentViewport).data(this.data.slicerDataPoints,function(e){return m.SlicerUtil.getDataPointKey(e)},t.resetScrollbarPosition&&this.shouldResetScrollPosition,i)},d.prototype.converter=function(e,t){void 0===t&&(t=!1);var i=this.hostServices.getLocalizedString(m.SlicerUtil.DisplayNameKeys.SelectAll),t=m.DataConversion.convert({dataView:e,localizedSelectAllText:i,selectionHandler:this.selectionHandler,hostServices:this.hostServices,style:this.style,isSlicer:t,featureSwitches:this.featureSwitches,slicerType:0});return this.shouldResetScrollPosition=this.getShouldResetScrollPosition(e,t),this.data=t,this.isCollapse=!1,e&&this.data&&(this.settings=t.slicerSettings,this.dataView=e),t},d.prototype.hasSearchEnabled=function(){return this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData)},d.prototype.updateSelectionStyle=function(){var e=this.settings;this.container.classed("isMultiSelectEnabled",e&&e.selection&&!e.selection.singleSelect)},d.prototype.createDataPoints=function(e){var i=this,a=this,r=this.settings,t=e.append("div").classed(u.ItemContainer.class,!0),e=t.append("div").classed(u.Input.class,!0).attr("aria-hidden",!0);this.verticalSlicerStrategy.customizeInputElement(e,r);var s=this.selectionHandler.isSelectionModeInverted();t.on("contextmenu",function(e,t){d3.event.stopPropagation(),d3.event.preventDefault(),i.onContextMenu(e,{x:d3.event.clientX,y:d3.event.clientY})}),t.call(d.updateTabIndex);var l=this.getOptionRole();t.each(function(e,t){var n=this,o=d3.select(this);this.addEventListener("keydown",function(t){var i,r,e=o.data();_.isEmpty(e)||(i=e[0],e=function(e){t.preventDefault(),t.stopPropagation(),e()},39===t.keyCode&&!0===i.isCollapsed||37===t.keyCode&&!1===i.isCollapsed?(r=document.activeElement,t.stopPropagation(),a.expandCollapseNode(i),e(function(){return __awaiter(n,void 0,p.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(r,a.getCurrentRowDataIndex(r),!1,!1,!1,!1,!1,!0)]})})})):39===t.keyCode&&i.children?e(function(){return __awaiter(n,void 0,p.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(document.activeElement,i.children[0].index,!1,!0,!1,!1,!0,!1)]})})}):37===t.keyCode&&i.parent?e(function(){return __awaiter(n,void 0,p.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(document.activeElement,i.parent.index,!1,!1,!0,!1,!0,!1)]})})}):39===t.keyCode||37===t.keyCode?t.stopPropagation():56===t.keyCode&&(t.stopPropagation(),a.expandCollapseAllNodesOnSameLevel(i)))}),a.updateItemState(o,e),a.setAccessibilityAttributes(e,o,l,s),o.attr("data-row-index",e.index).attr("data-row-id",e.id),null!=e.count&&o.append("span").classed(m.SlicerUtil.Selectors.CountText.class,!0).styles({"font-size":c.fromPoint(r.slicerText.textSize),"font-family":r.slicerText.fontFamily})})},d.prototype.getUnusedAriaStatus=function(){return this.data&&this.data.slicerSettings.selection.strictSingleSelect?"aria-checked":"aria-selected"},d.prototype.setAccessibilityAttributes=function(e,t,i,r){t.attr("role",i.role).attr(i.selected,m.SlicerUtil.getSlicerDataPointCheckedState(e,r)).attr("aria-setsize","-1").attr("aria-posinset",e.levelIndex||1)},d.updateTabIndex=function(e){var r,n=!1;e.each(function(e,t){var i=d3.select(this);0===t&&(r=i),n||"0"!==i.attr("tabindex")?n&&"0"===i.attr("tabindex")&&i.attr("tabindex",null):n=!0}),r&&!n&&r.attr("tabindex","0")},d.prototype.updateItemType=function(e,t){var i=e.select(m.SlicerUtil.Selectors.LabelImage.selector),r=e.select(m.SlicerUtil.Selectors.LabelText.selector);if(t.isImage)return r.remove(),(i=i.empty()?e.append("img").classed(m.SlicerUtil.Selectors.LabelImage.class,!0):i).attr("src",t.value),void i.attr("role","none");r.empty()&&(i.remove(),r.empty()&&(r=e.append("span").classed(m.SlicerUtil.Selectors.LabelText.class,!0))),r.text(t.value).attr("title",t.tooltip)},d.prototype.getOptionRole=function(){var e=this.data&&this.data.slicerSettings.selection.strictSingleSelect;return{role:this.expandable?"treeitem":"option",selected:e?"aria-selected":"aria-checked"}},d.prototype.updateDataPoints=function(e,t){var i,r,n,o,a,s,l=this.settings,c=this.data;c&&l&&(i=this.domHelper,r=this.selectionHandler.isSelectionModeInverted(),e.select(u.ItemContainer.selector),e.select(u.Input.selector),e.select(u.ExpandButton.selector),this.verticalSlicerStrategy.updateInputElement(e.selectAll(u.Input.selector),l),!(a=e.selectAll(m.SlicerUtil.Selectors.CountText.selector)).empty()&&this.verticalSlicerStrategy.shouldShowCount()&&(e.select(u.CountText.selector),a.text(function(e){return e.count}),i.setSlicerTextStyle(a,l,this.featureSwitches)),t&&this.body&&(s=(n=this).body.attr("width",this.currentViewport.width),o=this.getOptionRole(),(a=this.body.selectAll(u.ItemContainer.selector)).each(function(e,t){var i=d3.select(this);n.updateItemState(i,e),i.node().hasAttribute("role")&&i.attr(n.getUnusedAriaStatus(),null),n.setAccessibilityAttributes(e,i,o,r),null!=l.items.padding&&(i.style("padding-top",l.items.padding+"px"),i.style("padding-bottom",l.items.padding+"px"))}),e=e.selectAll(m.SlicerUtil.Selectors.LabelText.selector),this.verticalSlicerStrategy.setLabelTextStyle(i,e,l,this.style,this.featureSwitches),d.updateTabIndex(a),s=s.selectAll(u.Input.selector),s={slicerContainer:this.container,itemContainers:a,itemInputs:s,settings:c.slicerSettings,searchInput:this.searchComponent.input,clearSearchTextButton:this.searchComponent.clear,style:this.style},t.bind(c.retainedDataPoints,{behaviorOptions:s,orientation:0})),this.behavior.renderSelection())},d.prototype.announceSearchResults=function(e){e=0===e?this.hostServices.getLocalizedString("ContentList_EmptySearchResults"):1===e?this.hostServices.getLocalizedString("Count_SearchBox_Result_One"):this.hostServices.getLocalizedString("Count_SearchBox_Results").replace("{0}",e.toString());this.hostServices.alertWithDebounce("announce-search",e)},d.prototype.getExpandParameters=function(e){e.isCollapsed,this.isCollapse=!1===e.isCollapsed;var t=m.SlicerUtil.buildDataPointInfo(e,this.data.queryNameByLevel);return{dataRoles:[m.slicerRoles.value],data:t.selector,isCollapse:!e.isCollapsed,nodeIndex:t.path}},d.prototype.expandCollapseNode=function(e){e=this.getExpandParameters(e);this.hostServices.setNodeExpansionState({dataRoles:e.dataRoles,data:e.data,isCollapse:e.isCollapse,nodeIndex:e.nodeIndex})},d.prototype.expandCollapseAllNodesOnSameLevel=function(e){e=this.getExpandParameters(e);this.hostServices.setLevelExpansionState({dataRoles:e.dataRoles,data:e.data,isCollapse:e.isCollapse,nodeIndex:e.nodeIndex})},d.prototype.onContextMenu=function(e,t){var i=m.SlicerUtil.buildDataPointInfo(e,this.data.queryNameByLevel),e=[m.slicerRoles.value],i={nodeIndex:i.path,dataRoles:e,position:{x:d3.event.clientX,y:d3.event.clientY},data:[i.selector]};this.hostServices.onContextMenu(i)},d.prototype.getShouldResetScrollPosition=function(e,t){if(!this.dataView||!this.data||!e||!t||this.isCollapse)return!1;if(1===this.data.queryNameByLevel.length)return!p.DataViewAnalysis.hasSameCategoryIdentity(e,this.dataView);if(jsCommon.ArrayExtensions.hasSameValues(this.data.queryNameByLevel,t.queryNameByLevel,function(e,t){return e===t})){if(_.isEmpty(this.data.slicerDataPoints)||_.isEmpty(t.slicerDataPoints)||!(this.data.slicerDataPoints.length>t.slicerDataPoints.length)||this.isCollapse)return!1;var i=this.listView.getFirstVisibleRow();return i?void 0!==i.levelIndex&&!_.some(t.slicerDataPoints,function(e){return e.identity.equals(i.identity)}):!0}if(this.dataView.matrix&&this.dataView.matrix.rows&&e.matrix&&e.matrix.rows){t=_.map(this.dataView.matrix.rows.levels,function(e){return e.sources[0].expr}),e=_.map(e.matrix.rows.levels,function(e){return e.sources[0].expr});return!jsCommon.ArrayExtensions.hasSameValues(t,e,r.equals)}return!0},d.prototype.updateExpansionState=function(e,t){var i=0;0<t.level&&(i=t.level*c.fromPointToPixel(this.data.slicerSettings.expandCollapse.indentation)),e.styles({"margin-left":i+"px"}),this.updateExpandButton(e,t)},d.prototype.updateExpandButton=function(e,t){var i=e.select(u.ExpandButton.selector);this.expandable&&(i.empty()&&(i=this.createExpandButton(e)),e.attr("aria-expanded",void 0===t.isCollapsed?null:!t.isCollapsed),e.attr("aria-level",t.level+1));e=this.data.slicerSettings,e=c.fromPoint(e.slicerText.textSize);i.styles({"font-size":e,width:e}),i.attr("aria-hidden","true"),void 0!==t.isCollapsed?(e=this.data.slicerSettings.expandCollapse.toggleType,i.classed(u.Hidden.class,!1),i.selectAll(".glyphicon").classed("pbi-glyph-chevrondownsmall",t.isCollapsed&&0===e).classed("pbi-glyph-chevronupsmall",!t.isCollapsed&&0===e).classed("pbi-glyph-explore-content-single",t.isCollapsed&&1===e).classed("pbi-glyph-collapse-content-single",!t.isCollapsed&&1===e).classed("pbi-glyph-caretright",t.isCollapsed&&2===e).classed("pbi-glyph-caretdownright",!t.isCollapsed&&2===e)):this.expandable||i.empty()?i.classed(u.Hidden.class,!0):i.remove()},d.prototype.createExpandButton=function(e){var t=this,e=e.insert("div",":first-child").classed(u.ExpandButton.class,!0).on("click",function(e){d3.event.stopPropagation(),t.expandCollapseNode(e)});return e.append("i").classed("glyphicon",!0),e},d.prototype.scrollToFrameForMultiElementRow=function(e){var t=e.listView,i=e.loadMoreData,r=e.rowHeight,n=e.scrollTop,o=e.totalRows,a=e.visibleGroupContainer,e=e.baseContainer,n=0===n?0:Math.floor(n/r);if(!(this.currentRowPosition&&n===this.currentRowPosition||n<0)){var s=m.SVGUtil.translateWithPixels(0,n*r);a.styles({transform:function(e){return s},"-webkit-transform":s});r=a.selectAll(".row").filter(function(){return""!==this.textContent});return void 0===this.currentRowPosition?(this.currentPosition=this.getInitialPosition(o,e),r&&r.node()&&(this.currentRowPosition=n)):(this.updateCurrentPosition(n,o,e,a,r),this.currentRowPosition=n),t.performScrollToFrame(this.currentPosition.startIndex,this.currentPosition.endIndex,o,this.currentPosition.endIndex-this.currentPosition.startIndex,i)}},d.prototype.getInitialPosition=function(e,t){var i=e,t=Math.ceil($(t.node()).outerHeight()/this.listView.getRowHeight())*Math.floor($(t.node()).outerWidth()/this.defaultMinWidth);return{startIndex:0,endIndex:i=0<t?Math.min(e,t):i}},d.prototype.updateCurrentPosition=function(e,t,i,r,n){var o=Math.abs(e-this.currentRowPosition);if(e===this.currentRowPosition)this.currentPosition=this.scrollPositionStack.pop()||this.getInitialPosition(t,i);else if(e<this.currentRowPosition)for(;0<o;)this.currentPosition=this.scrollPositionStack.pop()||this.currentPosition,o--;else for(;0<o;){var a=Math.ceil($(i.node()).outerHeight()/$(n.node()).outerHeight());if(this.currentPosition.startIndex>=t-1)return;this.scrollPositionStack.push(this.currentPosition);var s=this.getElementsPerRow(r,a,n),a=this.currentPosition.startIndex+s[0];this.currentPosition={startIndex:a,endIndex:Math.min(t,a+_.sum(s)+this.getMaxElementsInRow(r,n))},o--}},d.prototype.getElementsPerRow=function(e,t,i){for(var r=[],n=i.node(),o=0;o<t&&null!==n;o++){r.push(0);for(var a=$(n).position().top;null!==n&&$(n).position().top<=a+5;)r[o]++,n=n.nextElementSibling}return r},d.prototype.getMaxElementsInRow=function(e,t){t=t.node().getAttribute("min-width");return t?$(e.node()).outerWidth()/+t:Math.floor($(e.node()).outerWidth()/this.defaultMinWidth)},d.prototype.createBodyElement=function(){var l=this;this.body=this.container.append("div").classed(m.SlicerUtil.Selectors.Body.class,!0);var c=this.searchComponent.input.node();this.body.on("wheel",function(){l.focusCallback=void 0,l.listView.resetCallBacks(),l.listView.onScroll()}),c.addEventListener("keydown",function(e){40===e.keyCode?(l.searchBarFocusNextElement(),e.preventDefault(),e.stopPropagation()):70===e.keyCode&&e.ctrlKey&&(l.searchBarFocusNextElement(),l.enableSearch(),e.preventDefault(),e.stopPropagation())}),this.body.on("keydown",function(){function e(e){s.preventDefault(),s.stopPropagation(),l.pendingFocusCall||e()}var t,i,r,n,o,a,s=d3.event;40===s.keyCode?(t=document.activeElement,i=s.shiftKey,e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(t,this.getCurrentRowDataIndex(document.activeElement)+2,!1,!0,!0,i,!1,!1)]})})})):38===s.keyCode?(r=document.activeElement,n=s.shiftKey,l.settings.search.enabled&&0===l.getCurrentRowDataIndex(r)||l.settings.search.enabled&&1===l.getCurrentRowDataIndex(r)&&!l.settings.selection.selectAllCheckboxEnabled?(l.focusForJumpRow(c),e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2]})})})):e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(r,this.getCurrentRowDataIndex(document.activeElement)-3,!1,!1,!0,n,!1,!1)]})})})):9===s.keyCode?l.lockKeyboardNavigation&&l.body.node().focus():35===s.keyCode?e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(document.activeElement,this.data.slicerDataPoints.length,!1,!0,!1,!1,!1,!1)]})})}):36===s.keyCode?e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(document.activeElement,1,!1,!1,!1,!1,!1,!1)]})})}):34===s.keyCode?(o=document.activeElement,e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(o,this.getCurrentRowDataIndex(document.activeElement)+this.getRowsPerPage(),!0,!0,!1,!1,!1,!1)]})})})):33===s.keyCode?(a=document.activeElement,e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(a,Math.max(this.getCurrentRowDataIndex(document.activeElement)-this.getRowsPerPage(),1),!1,!1,!1,!1,!1,!1)]})})})):70===s.keyCode&&s.ctrlKey&&e(function(){return __awaiter(l,void 0,p.Promise,function(){return __generator(this,function(e){return[2,this.enableSearch()]})})})})},d.prototype.setBodyRole=function(){var e=this.expandable?"tree":"listbox";this.body.attr("role",e)},d.prototype.setBodyAriaLabel=function(){this.body.attr("aria-label",this.data.categorySourceName)},d.prototype.enableSearch=function(){this.settings.search&&(this.settings.search.enabled=!this.settings.search.enabled,this.searchComponent.update(this.settings,this.data&&this.data.searchKey,this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData),this.verticalSlicerStrategy.hasClearSearchButton()))},d.prototype.focusRowAtIndex=function(o,e,t,a,s,l,c,d){var u=this,p=this.factory.defer(),h=o.getAttribute("data-row-id"),S=d3.event;return this.focusCallback=void 0,this.listView.resetCallBacks(),this.pendingFocusCall?p.resolve(1):(this.pendingFocusCall=!0,this.focusCallback=function(){var e,t,i,r=$(u.container.node()).find(".visibleGroup").get(0),n=$(r).find("[data-row-id='"+h+"']").get(0);n?t=(o=n).parentElement:e=void 0,o&&u.removeFocusForJumpRow(o),d?o?u.focusForJumpRow(o):a||t.previousElementSibling||(i=function(){u.focusForJumpRow(o),o.removeEventListener("blur",i)},o.addEventListener("blur",i)):(s||c||!r?s&&!c&&t?!e&&a&&t.nextElementSibling?e=t.nextElementSibling.firstElementChild:e||a||!t.previousElementSibling||(e=t.previousElementSibling.firstElementChild):c&&r&&(e=a?(e=u.selectItemFromRowId(d3.select(o).data()[0].children[0].id,r),u.adjustBottomRowToInViewRow(e,r)):(e=u.selectItemFromRowId(d3.select(o).data()[0].parent.id,r),u.adjustTopRowToInViewRow(e,r))):!e&&a?(e=r.lastElementChild.firstElementChild,e=u.adjustBottomRowToInViewRow(e,r)):e||a||(e=r.firstElementChild.firstElementChild,e=u.adjustTopRowToInViewRow(e,r)),e?(u.focusForJumpRow(e),l&&u.pendingFocusCall&&((r=u.settings).selection.singleSelect=r.selection.strictSingleSelect,m.SlicerWebBehavior.toggleItemSelectionFromExternal(S,d3.select(e).data()[0],u.selectionHandler,r),u.setAccessibilityAttributes(d3.select(e).data()[0],d3.select(e),u.getOptionRole(),u.selectionHandler.isSelectionModeInverted()))):o&&u.focusForJumpRow(o)),u.pendingFocusCall=!1,p.resolve(0)},this.listView.scrollRowIntoView(e-1,this.focusCallback)),p.promise},d.prototype.getCurrentRowDataIndex=function(e){if(e){e=d3.select(e).data()[0];if(e)return e.index}return 1},d.prototype.adjustBottomRowToInViewRow=function(e,t){return e=e.getBoundingClientRect().y+e.getBoundingClientRect().height>this.container.node().getBoundingClientRect().y+this.container.node().getBoundingClientRect().height?t.lastElementChild.previousElementSibling.firstElementChild:e},d.prototype.adjustTopRowToInViewRow=function(e,t){return e=e.getBoundingClientRect().y<=t.getBoundingClientRect().y&&this.listView.canScrollTop()?t.firstElementChild.nextElementSibling.firstElementChild:e},d.prototype.getRowsPerPage=function(){return this.listView.getVisibleRowsWithoutPadding()},d.prototype.selectItemFromRowId=function(e,t){return d3.select(t).select("[data-row-id='"+e+"']").node()},d.prototype.searchBarFocusNextElement=function(){var e=$(this.container.node()).find(".visibleGroup").get(0).firstElementChild.firstElementChild;this.focusForJumpRow(e)},d.prototype.focusForJumpRow=function(e){e.setAttribute("tabindex","0"),e.setAttribute("focusable","true"),e.classList.add(m.SetFocusRingClassName);t.focus(e,{preventScroll:!0})},d.prototype.removeFocusForJumpRow=function(e){e.setAttribute("tabindex","-1"),e.removeAttribute("focusable"),e.classList.remove(m.SetFocusRingClassName)},d.prototype.updateItemState=function(e,t){this.updateExpansionState(e,t),this.updateItemType(e,t),m.SlicerUtil.updateDisableState(e,t)},d);function d(e,t,i){this.lockKeyboardNavigation=i=void 0===i?!0:i,this.hasSearchableData=!1,this.scrollPositionStack=[],this.defaultMinWidth=50,this.shouldResetScrollPosition=!1,this.isCollapse=!1,this.expandable=!1,this.pendingFocusCall=!1,this.focusCallback=null,this.verticalSlicerStrategy=e,this.behavior=new m.SlicerWebBehavior,this.domHelper=new m.SlicerUtil.DOMHelper,this.hostServices=t.hostServices,t&&(e=t.featureSwitches,this.featureSwitches=t.featureSwitches,this.expressionBasedFormatting=e&&e.expressionBasedFormatting),this.factory=p.createJQueryPromiseFactory(),this.searchComponent=new o(this.featureSwitches,this.hostServices)}m.VerticalSlicerRenderer=e,function(e){var t=(i.prototype.canShowSearchHeader=function(e,t){return!!t},i.prototype.hasClearSearchButton=function(){return!1},i.prototype.setLabelTextStyle=function(e,t,i,r,n){e.setSlicerTextStyle(t,i,n)},i.prototype.shouldShowSearchHeader=function(e,t){return this.strictSingleSelect=e.selection.strictSingleSelect,e.search.enabled&&this.canShowSearchHeader(e,t)},i.prototype.shouldShowCount=function(){return!0},i.prototype.updateInputElement=function(e,t){e.selectAll("span").style("font-size",c.fromPoint(t.slicerText.textSize)).classed(this.strictSingleSelect?"radiobutton":"checkbox",!0).classed(this.strictSingleSelect?"checkbox":"radiobutton",!1)},i.prototype.customizeInputElement=function(e,t){e.append("span").style("font-size",c.fromPoint(t.slicerText.textSize)).classed("glyphicon",!0).classed(this.strictSingleSelect?"radiobutton":"checkbox",!0).classed(t.items.accessibilityContrastProperties?"checkboxOutlineContrast":"checkboxOutline",!0)},i);function i(){}e.CheckBoxSlicerStrategy=t;var a=m.Font.Family.regular.css,t=(r.prototype.hasClearSearchButton=function(){return!0},r.prototype.setLabelTextStyle=function(e,t,i,r,n){var o=m.DataConversion.DefaultSlicerProperties(r);o.slicerText.textSize=c.toPoint(13),o.slicerText.fontFamily=a,o.slicerText.color=m.ColorHelper.getThemeColor(r,m.ForegroundColorName),e.setSlicerTextStyle(t,o,n)},r.prototype.canShowSearchHeader=function(e,t){return e.search.enabled||t},r.prototype.shouldShowSearchHeader=function(e,t){return this.canShowSearchHeader(e,t)},r.prototype.updateInputElement=function(e){},r.prototype.shouldShowCount=function(){return!1},r.prototype.customizeInputElement=function(e){e.append("span").classed("powervisuals-glyph checkmark",!0)},r);function r(){}e.CheckListSlicerStrategy=t}(e=m.VerticalSlicerRenderer||(m.VerticalSlicerRenderer={}));var u,i,o=(a.prototype.create=function(e){this.container=this.domHelper.addSearch(this.hostServices,e),this.input=this.container.select(m.SlicerUtil.Selectors.SearchInput.selector)},a.prototype.addClearButton=function(){this.clear=this.domHelper.addClearSearchButton(this.hostServices,this.container)},a.prototype.update=function(e,t,i,r){var n,o,a,s=this.container.classed(m.SlicerUtil.Selectors.SearchHeaderShow.class);this.container.classed(m.SlicerUtil.Selectors.SearchHeaderShow.class,i),this.container.classed(m.SlicerUtil.Selectors.SearchHeaderCollapsed.class,!i),e&&i&&(n=this.container.select(m.SlicerUtil.Selectors.SearchInput.selector),o=this.container.select(m.SlicerUtil.Selectors.SearchIconClass.selector),n.empty()?r&&this.domHelper.configureSearchBoxIcon(this.container,void 0):(a=(a=n.node())&&a.value,r&&this.domHelper.configureSearchBoxIcon(this.container,a),(_.isEmpty(a)||_.isEmpty(t)&&i!==s)&&n.property("value",t),s=Math.ceil(c.fromPointToPixel(e.slicerText.textSize)),t=this.featureSwitches.outlineDropdownToCheckboxes?e.search.outlineStyle:e.search.outline,this.container.styles({color:e.slicerText.color,"border-style":t,"border-color":e.search.borderColor,background:e.search.background,height:s+"px"}),n.styles({background:e.search.background,color:e.slicerText.color,"font-size":c.fromPoint(e.slicerText.textSize),"font-family":e.slicerText.fontFamily}),o.styles({color:e.slicerText.color})))},a);function a(e,t){this.featureSwitches=e,this.hostServices=t,this.domHelper=new m.SlicerUtil.DOMHelper}m.SlicerSearchInput=o,i=u=m.VerticalSlicerSelectors||(m.VerticalSlicerSelectors={}),e=jsCommon.CssConstants.createClassAndSelector,i.Container=e("slicerContainer"),i.ItemContainer=e("slicerItemContainer"),i.Input=e("slicerCheckbox"),i.ExpandButton=e("expandButton"),i.Hidden=e("hidden"),i.CountText=e("slicerCountText")}(p.visuals||(p.visuals={}))}(powerbi=powerbi||{}),function(e){var i;function t(){}i=e.visuals||(e.visuals={}),t.prototype.bindEvents=function(e,t){this.itemContainers=e.itemContainers,this.itemInputs=e.itemInputs,this.selectionHandler=t,this.settings=e.settings,this.style=e.style,i.SlicerWebBehavior.bindSlicerEvents(e,this.itemContainers,t,this.settings)},t.prototype.renderSelection=function(){i.SlicerWebBehavior.setSelectionOnSlicerItems(this.itemInputs,this.selectionHandler,this.style)},i.VerticalSlicerWebBehavior=t}(powerbi=powerbi||{}),function(e){var i,t,r,n;function o(e){switch(e){case i.relativeSlicerPeriod.minutes:return r.Minute;case i.relativeSlicerPeriod.hours:return r.Hour;case i.relativeSlicerPeriod.days:return r.Day;case i.relativeSlicerPeriod.weeks:return r.Week;case i.relativeSlicerPeriod.calendarWeeks:return r.CalendarWeek;case i.relativeSlicerPeriod.months:return r.Month;case i.relativeSlicerPeriod.calendarMonths:return r.CalendarMonth;case i.relativeSlicerPeriod.years:return r.Year;case i.relativeSlicerPeriod.calendarYears:return r.CalendarYear;default:return}}function a(e){switch(e){case i.relativeSlicerRelativeQualifier.last:return t.Last;case i.relativeSlicerRelativeQualifier.current:return t.Current;case i.relativeSlicerRelativeQualifier.next:return t.Next;default:return}}i=e.visuals||(e.visuals={}),t=e.data.RelativeDateQualifier,r=e.data.RelativeDateUnit,n=e.data.RelativeFilterType,(e=i.RelativeSlicerUtil||(i.RelativeSlicerUtil={})).toRelativeDateRangeOptions=function(e){return{duration:e.duration,includeToday:e.includeToday,relativeUnit:o(e.period),relativeQualifier:a(e.range),anchorDate:e.anchorDate}},e.toRelativeDateUnit=o,e.toRelativeDateQualifier=a,e.relativeUnitSlicerFactory=function(e){switch(e){case n.Time:return new i.RelativeTimeComponent;case n.Date:return new i.RelativeDateComponent;default:n.Unsupported;return}},e.createRelativeSlicer=function(e,t){switch(e){case n.Time:return new i.RelativeSlicer(t,n.Time);case n.Date:return new i.RelativeSlicer(t,n.Date);default:n.Unsupported;return}}}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importSlicerModule=function(){}}(es6=es6||{}),function(c){var d,u,t,p,h;function e(e,t){this.hasMappedColumn=!1,this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}d=c.visuals||(c.visuals={}),u=c.data.SemanticFilter,t=c.data.SQExpr,p=c.data.SQExprConverter,h=c.data.SQExprUtils,e.prototype.analyze=function(e,t){var i=this;if(this.hasMappedColumn=d.SlicerUtil.isDataViewColumnMapped({columns:e.columns}),this.isAnyFilter=u.isAnyFilter(this.filter),!this.isAnyFilter){var r,n,o=e.fieldSQExprs;if(!this.filter||(r=p.asFilterNodes(this.filter,o))&&(this.isNotFilter=_.some(r,function(e){return!e.selected}),this.hasMappedColumn&&(n=_.some(r,function(e){return i.isSQExprBlank(e)}),(this.isNotFilter||n)&&(this.isNotFilter=!1,this.filter=void 0)),this.selectedIdentities=r,this.isDefaultFilter=1===this.selectedIdentities.length&&h.isDefaultValue(this.selectedIdentities[0].identity.expr)),this.defaultValueByLevel=this.getDataViewDefaultValuePerLevel(e.columns,e.defaultValuePropertyId),!_.isEmpty(_.compact(this.defaultValueByLevel))&&!t&&(this.filter||(this.filter=d.SlicerSelectionHandler.buildDefaultValueFilter(e.columns),this.selectedIdentities=p.asFilterNodes(this.filter,o),this.isDefaultFilter=!0),this.isDefaultFilter&&!_.isEmpty(this.selectedIdentities)))for(var a=this.selectedIdentities[0],s=0;a;){var l=this.defaultValueByLevel[s],l=c.data.createDataViewScopeIdentity(h.getDataViewScopeIdentityComparisonExpr(o[s],l.identityFieldsValues));this.isNotFilter=!1,a.identity=l,_.isEmpty(a.children)||a.children.length,a=_.isEmpty(a.children)?void 0:a.children[0],s++}}},e.prototype.isSQExprBlank=function(e){e=e.identity.expr;return!!t.isCompare(e)&&t.isIsBlank(e)},e.prototype.getDataViewDefaultValuePerLevel=function(e,t){if(!_.isEmpty(e))return _.map(e,function(e){return c.DataViewObjects.getValue(e.objects,t)})},d.SlicerFilterAnalyzer=e}(powerbi=powerbi||{}),function(u){var h,p,a,S;function m(e,t){this.hostService=e,this.behavior=t,this.isInvertedSelectionMode=!1,this.isSearchUpdateMode=!1,this.selected=[]}h=u.visuals||(u.visuals={}),p=u.data.SemanticFilter,a=u.data.Selector,S=u.data.SQExprBuilder,m.buildDefaultValueFilter=function(e,t){for(var i=[],r=[],n=(t=void 0===t?!1:t)?i:r,o=0,a=e;o<a.length;o++){var s=a[o],l=1===(null===(c=s.parameter)||void 0===c?void 0:c.kind),c=!(null===(d=s.parameter)||void 0===d||!d.supportsSelectAll),d=null!=u.DataViewObjects.getValue(s.objects,h.slicerProps.general.defaultValue);l&&c||d?n.push.apply(n,m.getMetadataColumnIdentityExprs(s)):n=i}if(!_.isEmpty(i)||!_.isEmpty(r))return p.getDefaultAnyValueFilter(r,i)},m.getMetadataColumnIdentityExprs=function(e){return _.isEmpty(e.identityExprs)?[e.expr]:e.identityExprs},m.prototype.setDefaultValueMode=function(e){this.useDefaultValue=e},m.prototype.bind=function(e,t){this.selected=_.filter(e,function(e){return e.selected}),this.behavior.bindEvents(t,this),this.behavior.renderSelection()},m.prototype.setSelectionModeInverted=function(e){this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=e},m.prototype.setColumns=function(e){this.columns=e,this.columnExprs=_.map(e,function(e){return e.expr}),this.supportsDefaultValueByLevel=_.map(e,function(e){return null!=u.DataViewObjects.getValue(e.objects,h.slicerProps.general.defaultValue)})},m.prototype.hasSelection=function(){return!_.isEmpty(this.selected)},m.prototype.isSelectionModeInverted=function(){return this.isInvertedSelectionMode},m.prototype.setQueryNameByLevel=function(e){this.queryNameByLevel=e},m.prototype.persistSelfFilter=function(e,t){t=h.SlicerUtil.buildContainsFilter(this.columnExprs,t);this.hostService.persistProperties(m.createChangeForProperty(e,t))},m.prototype.setSearchMode=function(e){this.isSearchUpdateMode=e},m.prototype.isSearchMode=function(){return this.isSearchUpdateMode},m.prototype.handleClearSelection=function(){var e;this.previouslySelected=this.selected.slice(),this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=!1,1===this.selected.length&&this.isStrictSingleSelect||this.hasDefaultValue()&&this.useDefaultValue||(e=this.hostService.getLocalizedString("Slicer_ClearSelectionsCleared"),this.hostService.alertWithDebounce("announce-clear-selection",e),this.useDefaultValue=!0,this.resetSelected(),this.behavior.renderSelection())},m.prototype.persistSelectionFilter=function(e,t,i){void 0===t&&(t=!1);var r,n=this.getFilterFromDataPoints();n&&!_.isEmpty(this.selected)&&(r=this.toFilterExpressionMetadata(this.selected),this.hostService.setFilterExpressionMetadata(r));n=m.createChangeForProperty(e,n),t=!(t||!this.isInvertedSelectionMode)||null,t=m.createChangeForProperty(h.slicerProps.data.isInvertedSelectionMode,t),n=this.mergeObjectInstancesToPersist(n,t);this.hostService.persistProperties(n,i),this.sendSelectionToHost()},m.prototype.getDataMultiSelectMode=function(){return this.hostService.dataMultiSelectMode()},m.prototype.sendSelectionToHost=function(){var e,i,t;this.hostService.onSelect&&(t=_.isEmpty(this.selected)?[]:_.map(this.selected,function(e){return e.identity}),e=h.InteractivityService.createSelectEventArgs(t,0),t=_.isEmpty(this.previouslySelected)?[]:_.map(this.previouslySelected,function(e){return e.identity}),i=h.InteractivityService.createSelectEventArgs(t,0),t=_.size(e.visualObjects)!==_.size(i.visualObjects)||_.some(e.visualObjects,function(e,t){return!a.equalsSelectorsByColumn(e.selectorsByColumn,i.visualObjects[t].selectorsByColumn)}),e.fireDataSelectedEvent=t||this.isInvertedSelectionMode!==this.previousInversionMode,this.hostService.onSelect(e))},m.prototype.handleSelection=function(e,t,i){if(this.onSelecting(e,i))return!1;var r=e.partially,i=e.selected;this.useDefaultValue=!1,this.previouslySelected=this.selected.slice(),0===t||this.isStrictSingleSelect?this.resetSelected():this.clearDataPointState(e);i=this.getDataPointSelectedState(e,t,r,i);return this.updateSelectedState(e,i),this.behavior.renderSelection(),!0},m.prototype.getDataPointSelectedState=function(e,t,i,r){return i?h.SlicerUtil.getSlicerDataPointCheckedState(e,this.isInvertedSelectionMode)?e.selected:!e.selected:!!this.isStrictSingleSelect||(0===t?!r||1<this.selected.length:!r)},m.prototype.onSelecting=function(e,t){e=h.SlicerUtil.buildDataPointInfo(e,this.queryNameByLevel),t={type:0,visualObjects:[{objectName:h.InteractivityService.dataPointObjectName,selectorsByColumn:e.selector}],position:t};return this.hostService.onSelecting(t),0!==t.action&&null!=t.action},m.prototype.updateSelectedState=function(e,t){var i=e.selected;i!==(e.selected=t)&&(this.clearDataPointState(e,!0),this.updateParentState(e)),e.selected?this.selected.push(e):i&&!e.selected&&_.remove(this.selected,e)},m.prototype.setStrictSingleSelect=function(e,t){this.isStrictSingleSelect=e,this.adjustStrictSingleSelectSelection(t)},m.prototype.resetSelected=function(){_.isEmpty(this.selected)||_.each(this.selected,function(e){return e.selected=!1}),this.selected=[]},m.prototype.clearDataPointState=function(e,t){if((t=void 0===t?!1:t)||(e.selected&&_.remove(this.selected,e),e.selected=!1),!_.isEmpty(e.children)&&e.partially){e.partially=!1;for(var i=0,r=e.children;i<r.length;i++){var n=r[i];this.clearDataPointState(n)}}},m.prototype.updateParentState=function(e){if(e.parent)for(var t=e.parent;t;)e.selected?t.partially=!0:t.partially=_.some(t.children,function(e){return e.selected}),t=t.parent},m.prototype.mergeObjectInstancesToPersist=function(e,t){var i,r={};return r.merge=e.merge,r.remove=e.remove,_.isEmpty(t.merge)||(r.merge=r.merge||[],(i=r.merge).push.apply(i,t.merge||[])),_.isEmpty(t.remove)||(r.remove=r.remove||[],(i=r.remove).push.apply(i,t.remove||[])),r},m.prototype.toFilterExpressionMetadata=function(e){if(!_.isEmpty(e)){for(var t={expressions:this.columnExprs,cachedValueItems:[]},i=0,r=0,n=e;r<n.length;r++){for(var o=n[r],a={identities:[],valueMap:{}};o;)a.identities.unshift(o.scopeIdentity),a.valueMap[o.level]=o.value,i=Math.max(i,o.level),o=o.parent;t.cachedValueItems.push(a)}return t.expressions=this.columnExprs.slice(0,i+1),t}},m.prototype.isDisableMultipleSelectForMappedColumn=function(){var e=this.columns;return _.some(e,function(e){var t;return 1===(null===(t=e.parameter)||void 0===t?void 0:t.kind)&&!(null!==(e=e.parameter)&&void 0!==e&&e.supportsMultipleValues)})},m.prototype.toggleSelectionModeInversion=function(e){return void 0===e&&(e=!1),this.previouslySelected=this.selected.slice(),this.useDefaultValue=!1,this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=!this.isInvertedSelectionMode,this.resetSelected(),e&&this.hostService.persistProperties(m.createChangeForProperty(h.slicerProps.data.isInvertedSelectionMode,!!this.isInvertedSelectionMode||null)),this.behavior.renderSelection(),this.isInvertedSelectionMode},m.prototype.getFilterFromDataPoints=function(){var e=h.SlicerUtil.isDataViewColumnMapped({columns:this.columns});if(_.isEmpty(this.selected)&&(this.hasDefaultValue()||this.isInvertedSelectionMode&&e)){var t=!this.useDefaultValue||e;return m.buildDefaultValueFilter(this.columns,t)}t=this.buildSelectorsByLevel();if(t){e=m.buildExprForSlicerSelection(t.selected,t.unselected,e),e=this.ensureAnyFilter(e,t.maxLevel);return p.fromSQExpr(e)}},m.buildExprForSlicerSelection=function(e,t,i){e=m.buildExprsFromSelectorsByLevel(e),i=m.buildExprForUnselectedState(t,!i);return e&&i?e=S.and(e,i):i&&(e=i),e},m.prototype.ensureAnyFilter=function(e,t){t+=1;if(t<this.columns.length){for(var i=S.anyValue(),r=[],n=t;n<this.columns.length;n++)this.supportsDefaultValueByLevel[n]&&r.push.apply(r,m.getMetadataColumnIdentityExprs(this.columns[n]));_.isEmpty(r)||(t=Array.apply(null,Array(r.length)).map(function(){return i}),e=S.and(e,u.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(r,t)))}return e},m.getInExprByLevel=function(e){for(var t=0,i=a.filterExprsFromSelectors(e);t<i.length;t++)var r=i[t],n=u.data.ScopeIdentityExtractor.getInExpr(r),o=o?u.data.SQExprBuilder.or(o,n):n||r;return o},m.prototype.hasDefaultValue=function(){if(!_.isEmpty(this.columns))return null!=u.DataViewObjects.getValue(this.columns[0].objects,h.slicerProps.general.defaultValue)},m.buildExprsFromSelectorsByLevel=function(e,t){for(var i in void 0===t&&(t=!1),e)var r=m.getInExprByLevel(e[i]),n=n?S.or(n,r):r;return n=t&&n?S.not(n):n},m.prototype.buildSelectorsByLevel=function(){if(!_.isEmpty(this.selected)){for(var e={},t={},i={},r=0,n=0,o=this.selected;n<o.length;n++){for(var a,s,l,c=o[n],d=-1,u=c,p={data:[]};u;)p.data.unshift(u.scopeIdentity),u=u.parent,d++;r=Math.max(r,d),h.SlicerUtil.getSlicerDataPointCheckedState(c,this.isInvertedSelectionMode)?(s=e,(s=(a=this.getFirstUnselectedParent(c,this.isInvertedSelectionMode))?(l=this.ensureState(a,i)).selectedChildren:s)[d]=s[d]||[],s[d].push(p)):((l=this.ensureState(c,i)).selector=p,t[d]=t[d]||[],t[d].push(l))}return{selected:e,unselected:t,maxLevel:r}}},m.buildExprForUnselectedState=function(e,t){var i,r={};for(i in e){for(var n,o,a=[],s=[],l=0,c=e[i];l<c.length;l++){var d=c[l];_.isEmpty(d.selectedChildren)?s.push(d.selector):a.push(d)}_.isEmpty(s)||(r[i]=s),_.isEmpty(a)||(n=m.getExprForUnselectedStateWithSelection(a),o=o?S.and(n,o):n)}t=m.buildExprsFromSelectorsByLevel(r,t);return o=o?S.and(t,o):t},m.getExprForUnselectedStateWithSelection=function(e){for(var t=0,i=e;t<i.length;t++)var r=i[t],n=m.buildExprsFromSelectorsByLevel(r.selectedChildren),r=S.not(m.getInExprByLevel([r.selector])),r=S.or(n,r),o=o?S.and(r,o):r;return o},m.prototype.ensureState=function(e,t){var i=t[e.identity.getKey()];return i||(i={selector:{},selectedChildren:{}},t[e.identity.getKey()]=i),i},m.prototype.getFirstUnselectedParent=function(e,t){for(;e;){if(e.selected&&!h.SlicerUtil.getSlicerDataPointCheckedState(e,t))return e;e=e.parent}},m.createChangeForProperty=function(e,t){var i={},r={objectName:e.objectName,selector:void 0,properties:i};return null==t?(i[e.propertyName]={},{remove:[r]}):(i[e.propertyName]=t,{merge:[r]})},m.prototype.adjustStrictSingleSelectSelection=function(e){var t;if(this.isStrictSingleSelect&&!_.isEmpty(e)&&(1!==_.filter(e,function(e){return e.selected}).length||this.isInvertedSelectionMode)){if(1<e.length){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(n.selected&&!this.isInvertedSelectionMode||!n.selected&&this.isInvertedSelectionMode){t=n;break}}if(!t)if(h.SlicerUtil.isDataViewColumnMapped({columns:this.columns}))for(var o=0,a=e;o<a.length;o++){var s=a[o];if(!s.disabled){t=s;break}}else t=e[0]}this.isInvertedSelectionMode&&this.toggleSelectionModeInversion(null==t),t&&(t.selected=!0,this.selected=[t],this.persistSelectionFilter(h.slicerProps.general.filter,void 0,!0))}},h.SlicerSelectionHandler=m}(powerbi=powerbi||{}),function(e){var t;(t=e.visuals||(e.visuals={})).initializeSlicerFactoryES6=function(){t.setCreateSlicer(function(t){return es6.powerbi.visuals.importSlicerModule().then(function(e){return new e.Slicer(t)})})}}(powerbi=powerbi||{}),function(e){!function(e){var r;function t(e,t,i){this.dataView=e,this.listJoinSeparator=t,this.initMetadataColumns(),e.categorical?this.reader=new r.SlicerCategoricalDataReader(e.categorical,this.columns,i):this.reader=new r.SlicerMatrixDataReader(e.matrix,this.columns,void 0,i)}r=e.readers||(e.readers={}),t.prototype.getIdentityFields=function(){var e=this.getMetadataColumns();return this.reader.getIdentityExprs()||_.map(e,function(e){return e.identityExprs})},t.prototype.getDataPointsReader=function(){return this.reader},t.prototype.getQueryNamePerLevel=function(){var e=this.getMetadataColumns();return _.map(e,function(e){return e.queryName})},t.prototype.getDisplayNamePerLevel=function(){var e=this.getMetadataColumns();return _.map(e,function(e){return e.displayName})},t.prototype.getDisplayName=function(){var e=this.getDisplayNamePerLevel();return _.join(e,this.listJoinSeparator)},t.prototype.getColumns=function(){return this.columns},t.prototype.getMetadataColumnByLevel=function(e){return this.columns[e]},t.prototype.getMetadataColumns=function(){return this.reader.getMetadataColumns()||this.columns},t.prototype.initMetadataColumns=function(){this.columns=e.SlicerUtil.readMetadataColumns(this.dataView.metadata.columns)},r.SlicerDataViewReader=t}(e.visuals||(e.visuals={}))}(powerbi=powerbi||{}),function(n){!function(e){function r(e,t,i,r){this.matrix=e,this.metadataColumns=t,this.root=i,this.selectedDataPoints=r,this.root=i,this.level=i&&i.level+1||0,this.root||(this.root=e&&e.rows&&e.rows.root,this.root&&(this.metadata=e.rows.levels[this.level].sources[0])),this.count=this.root&&this.root.children&&this.root.children.length||0}e=e.readers||(e.readers={}),r.prototype.getDataPointsCount=function(){return this.count},r.prototype.getMetadataColumn=function(){return this.metadata||this.metadataColumns[this.level]},r.prototype.getDataViewDataPoint=function(e){this.count;var t,i=this.root.children[e];if(!i.isSubtotal)return i.levelValues.length,_.some(i.children,function(e){return!e.isSubtotal})&&(t=_.find(this.selectedDataPoints,function(e){return n.DataViewScopeIdentity.equals(e.identity,i.identity)}),t=new r(this.matrix,this.metadataColumns,i,t&&t.children)),{scopeId:i.identity,isCollapsed:i.isCollapsed,value:i.levelValues[0].value,childrenReader:t}},r.prototype.isImageData=function(){return!1},r.prototype.getLevel=function(){return this.level},r.prototype.hasCount=function(){return!1},r.prototype.getSelectedNodes=function(){return this.selectedDataPoints},r.prototype.getMetadataColumns=function(){},r.prototype.getIdentityExprs=function(){return this.metadataColumns&&_.map(this.metadataColumns,function(e){return e.identityExprs})},e.SlicerMatrixDataReader=r}(n.visuals||(n.visuals={}))}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['slicerVisual.min.js'] || (this.parseTimeMarkers['slicerVisual.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
